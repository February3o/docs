"use strict";var Cw=Object.defineProperty,Dw=Object.defineProperties,Rw=Object.getOwnPropertyDescriptors,WM=Object.getOwnPropertySymbols,Iw=Object.prototype.hasOwnProperty,Pw=Object.prototype.propertyIsEnumerable,W_=(qn,Rt,ye)=>Rt in qn?Cw(qn,Rt,{enumerable:!0,configurable:!0,writable:!0,value:ye}):qn[Rt]=ye,ka=(qn,Rt)=>{for(var ye in Rt||(Rt={}))Iw.call(Rt,ye)&&W_(qn,ye,Rt[ye]);if(WM)for(var ye of WM(Rt))Pw.call(Rt,ye)&&W_(qn,ye,Rt[ye]);return qn},Nd=(qn,Rt)=>Dw(qn,Rw(Rt)),jM=(qn,Rt,ye)=>(W_(qn,"symbol"!=typeof Rt?Rt+"":Rt,ye),ye);(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[179],{2810:(qn,Rt,ye)=>{ye.d(Rt,{d:()=>Ut});var N=ye(6682);const F={type:"change"},Ze={type:"start"},mt={type:"end"},ut=new N.zHn,sn=new N.JOQ,Xt=Math.cos(70*N.M8C.DEG2RAD);class _n extends N.pBf{constructor(Ft,ri){super(),this.object=Ft,this.domElement=ri,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new N.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:N.RsA.ROTATE,MIDDLE:N.RsA.DOLLY,RIGHT:N.RsA.PAN},this.touches={ONE:N.QmN.ROTATE,TWO:N.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return Vn.phi},this.getAzimuthalAngle=function(){return Vn.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(Q){Q.addEventListener("keydown",he),this._domElementKeyEvents=Q},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",he),this._domElementKeyEvents=null},this.saveState=function(){fe.target0.copy(fe.target),fe.position0.copy(fe.object.position),fe.zoom0=fe.object.zoom},this.reset=function(){fe.target.copy(fe.target0),fe.object.position.copy(fe.position0),fe.object.zoom=fe.zoom0,fe.object.updateProjectionMatrix(),fe.dispatchEvent(F),fe.update(),gt=bn.NONE},this.update=function(){const Q=new N.Pa4,Ve=(new N._fP).setFromUnitVectors(Ft.up,new N.Pa4(0,1,0)),st=Ve.clone().invert(),kt=new N.Pa4,Kt=new N._fP,an=new N.Pa4,jt=2*Math.PI;return function(){const Oe=fe.object.position;Q.copy(Oe).sub(fe.target),Q.applyQuaternion(Ve),Vn.setFromVector3(Q),fe.autoRotate&&gt===bn.NONE&&ht(function Je(){return 2*Math.PI/60/60*fe.autoRotateSpeed}()),fe.enableDamping?(Vn.theta+=ce.theta*fe.dampingFactor,Vn.phi+=ce.phi*fe.dampingFactor):(Vn.theta+=ce.theta,Vn.phi+=ce.phi);let Ae=fe.minAzimuthAngle,me=fe.maxAzimuthAngle;isFinite(Ae)&&isFinite(me)&&(Ae<-Math.PI?Ae+=jt:Ae>Math.PI&&(Ae-=jt),me<-Math.PI?me+=jt:me>Math.PI&&(me-=jt),Vn.theta=Ae<=me?Math.max(Ae,Math.min(me,Vn.theta)):Vn.theta>(Ae+me)/2?Math.max(Ae,Vn.theta):Math.min(me,Vn.theta)),Vn.phi=Math.max(fe.minPolarAngle,Math.min(fe.maxPolarAngle,Vn.phi)),Vn.makeSafe(),!0===fe.enableDamping?fe.target.addScaledVector(Ye,fe.dampingFactor):fe.target.add(Ye),Vn.radius=tn(fe.zoomToCursor&&Nr||fe.object.isOrthographicCamera?Vn.radius:Vn.radius*ke),Q.setFromSpherical(Vn),Q.applyQuaternion(st),Oe.copy(fe.target).add(Q),fe.object.lookAt(fe.target),!0===fe.enableDamping?(ce.theta*=1-fe.dampingFactor,ce.phi*=1-fe.dampingFactor,Ye.multiplyScalar(1-fe.dampingFactor)):(ce.set(0,0,0),Ye.set(0,0,0));let He=!1;if(fe.zoomToCursor&&Nr){let je=null;if(fe.object.isPerspectiveCamera){const Ht=Q.length();je=tn(Ht*ke),fe.object.position.addScaledVector(Jn,Ht-je),fe.object.updateMatrixWorld()}else if(fe.object.isOrthographicCamera){const Ht=new N.Pa4(Rn.x,Rn.y,0);Ht.unproject(fe.object),fe.object.zoom=Math.max(fe.minZoom,Math.min(fe.maxZoom,fe.object.zoom/ke)),fe.object.updateProjectionMatrix(),He=!0;const Pn=new N.Pa4(Rn.x,Rn.y,0);Pn.unproject(fe.object),fe.object.position.sub(Pn).add(Ht),fe.object.updateMatrixWorld(),je=Q.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),fe.zoomToCursor=!1;null!==je&&(this.screenSpacePanning?fe.target.set(0,0,-1).transformDirection(fe.object.matrix).multiplyScalar(je).add(fe.object.position):(ut.origin.copy(fe.object.position),ut.direction.set(0,0,-1).transformDirection(fe.object.matrix),Math.abs(fe.object.up.dot(ut.direction))<Xt?Ft.lookAt(fe.target):(sn.setFromNormalAndCoplanarPoint(fe.object.up,fe.target),ut.intersectPlane(sn,fe.target))))}else fe.object.isOrthographicCamera&&(fe.object.zoom=Math.max(fe.minZoom,Math.min(fe.maxZoom,fe.object.zoom/ke)),fe.object.updateProjectionMatrix(),He=!0);return ke=1,Nr=!1,!!(He||kt.distanceToSquared(fe.object.position)>Gn||8*(1-Kt.dot(fe.object.quaternion))>Gn||an.distanceToSquared(fe.target)>0)&&(fe.dispatchEvent(F),kt.copy(fe.object.position),Kt.copy(fe.object.quaternion),an.copy(fe.target),He=!1,!0)}}(),this.dispose=function(){fe.domElement.removeEventListener("contextmenu",ie),fe.domElement.removeEventListener("pointerdown",Lt),fe.domElement.removeEventListener("pointercancel",Pi),fe.domElement.removeEventListener("wheel",Z),fe.domElement.removeEventListener("pointermove",Xr),fe.domElement.removeEventListener("pointerup",Pi),null!==fe._domElementKeyEvents&&(fe._domElementKeyEvents.removeEventListener("keydown",he),fe._domElementKeyEvents=null)};const fe=this,bn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let gt=bn.NONE;const Gn=1e-6,Vn=new N.$V,ce=new N.$V;let ke=1;const Ye=new N.Pa4,rt=new N.FM8,nt=new N.FM8,on=new N.FM8,Qe=new N.FM8,Tt=new N.FM8,Cn=new N.FM8,kn=new N.FM8,ai=new N.FM8,mn=new N.FM8,Jn=new N.Pa4,Rn=new N.FM8;let Nr=!1;const rn=[],Wt={};function tt(){return Math.pow(.95,fe.zoomSpeed)}function ht(Q){ce.theta-=Q}function yt(Q){ce.phi-=Q}const hn=function(){const Q=new N.Pa4;return function(st,kt){Q.setFromMatrixColumn(kt,0),Q.multiplyScalar(-st),Ye.add(Q)}}(),$t=function(){const Q=new N.Pa4;return function(st,kt){!0===fe.screenSpacePanning?Q.setFromMatrixColumn(kt,1):(Q.setFromMatrixColumn(kt,0),Q.crossVectors(fe.object.up,Q)),Q.multiplyScalar(st),Ye.add(Q)}}(),In=function(){const Q=new N.Pa4;return function(st,kt){const Kt=fe.domElement;if(fe.object.isPerspectiveCamera){Q.copy(fe.object.position).sub(fe.target);let jt=Q.length();jt*=Math.tan(fe.object.fov/2*Math.PI/180),hn(2*st*jt/Kt.clientHeight,fe.object.matrix),$t(2*kt*jt/Kt.clientHeight,fe.object.matrix)}else fe.object.isOrthographicCamera?(hn(st*(fe.object.right-fe.object.left)/fe.object.zoom/Kt.clientWidth,fe.object.matrix),$t(kt*(fe.object.top-fe.object.bottom)/fe.object.zoom/Kt.clientHeight,fe.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),fe.enablePan=!1)}}();function ci(Q){fe.object.isPerspectiveCamera||fe.object.isOrthographicCamera?ke/=Q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),fe.enableZoom=!1)}function Zn(Q){fe.object.isPerspectiveCamera||fe.object.isOrthographicCamera?ke*=Q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),fe.enableZoom=!1)}function Yt(Q){if(!fe.zoomToCursor)return;Nr=!0;const Ve=fe.domElement.getBoundingClientRect(),kt=Q.clientY-Ve.top,an=Ve.height;Rn.x=(Q.clientX-Ve.left)/Ve.width*2-1,Rn.y=-kt/an*2+1,Jn.set(Rn.x,Rn.y,1).unproject(Ft).sub(Ft.position).normalize()}function tn(Q){return Math.max(fe.minDistance,Math.min(fe.maxDistance,Q))}function Di(Q){rt.set(Q.clientX,Q.clientY)}function Vi(Q){Qe.set(Q.clientX,Q.clientY)}function Mr(){1===rn.length?rt.set(rn[0].pageX,rn[0].pageY):rt.set(.5*(rn[0].pageX+rn[1].pageX),.5*(rn[0].pageY+rn[1].pageY))}function zr(){1===rn.length?Qe.set(rn[0].pageX,rn[0].pageY):Qe.set(.5*(rn[0].pageX+rn[1].pageX),.5*(rn[0].pageY+rn[1].pageY))}function ar(){const Q=rn[0].pageX-rn[1].pageX,Ve=rn[0].pageY-rn[1].pageY,st=Math.sqrt(Q*Q+Ve*Ve);kn.set(0,st)}function Zs(Q){if(1==rn.length)nt.set(Q.pageX,Q.pageY);else{const st=Fe(Q);nt.set(.5*(Q.pageX+st.x),.5*(Q.pageY+st.y))}on.subVectors(nt,rt).multiplyScalar(fe.rotateSpeed);const Ve=fe.domElement;ht(2*Math.PI*on.x/Ve.clientHeight),yt(2*Math.PI*on.y/Ve.clientHeight),rt.copy(nt)}function Bn(Q){if(1===rn.length)Tt.set(Q.pageX,Q.pageY);else{const Ve=Fe(Q);Tt.set(.5*(Q.pageX+Ve.x),.5*(Q.pageY+Ve.y))}Cn.subVectors(Tt,Qe).multiplyScalar(fe.panSpeed),In(Cn.x,Cn.y),Qe.copy(Tt)}function lr(Q){const Ve=Fe(Q),st=Q.pageX-Ve.x,kt=Q.pageY-Ve.y,Kt=Math.sqrt(st*st+kt*kt);ai.set(0,Kt),mn.set(0,Math.pow(ai.y/kn.y,fe.zoomSpeed)),ci(mn.y),kn.copy(ai)}function Lt(Q){!1!==fe.enabled&&(0===rn.length&&(fe.domElement.setPointerCapture(Q.pointerId),fe.domElement.addEventListener("pointermove",Xr),fe.domElement.addEventListener("pointerup",Pi)),function Ie(Q){rn.push(Q)}(Q),"touch"===Q.pointerType?function ne(Q){switch(Ue(Q),rn.length){case 1:switch(fe.touches.ONE){case N.QmN.ROTATE:if(!1===fe.enableRotate)return;Mr(),gt=bn.TOUCH_ROTATE;break;case N.QmN.PAN:if(!1===fe.enablePan)return;zr(),gt=bn.TOUCH_PAN;break;default:gt=bn.NONE}break;case 2:switch(fe.touches.TWO){case N.QmN.DOLLY_PAN:if(!1===fe.enableZoom&&!1===fe.enablePan)return;(function ts(){fe.enableZoom&&ar(),fe.enablePan&&zr()})(),gt=bn.TOUCH_DOLLY_PAN;break;case N.QmN.DOLLY_ROTATE:if(!1===fe.enableZoom&&!1===fe.enableRotate)return;(function Ts(){fe.enableZoom&&ar(),fe.enableRotate&&Mr()})(),gt=bn.TOUCH_DOLLY_ROTATE;break;default:gt=bn.NONE}break;default:gt=bn.NONE}gt!==bn.NONE&&fe.dispatchEvent(Ze)}(Q):function Le(Q){let Ve;switch(Q.button){case 0:Ve=fe.mouseButtons.LEFT;break;case 1:Ve=fe.mouseButtons.MIDDLE;break;case 2:Ve=fe.mouseButtons.RIGHT;break;default:Ve=-1}switch(Ve){case N.RsA.DOLLY:if(!1===fe.enableZoom)return;(function $i(Q){Yt(Q),kn.set(Q.clientX,Q.clientY)})(Q),gt=bn.DOLLY;break;case N.RsA.ROTATE:if(Q.ctrlKey||Q.metaKey||Q.shiftKey){if(!1===fe.enablePan)return;Vi(Q),gt=bn.PAN}else{if(!1===fe.enableRotate)return;Di(Q),gt=bn.ROTATE}break;case N.RsA.PAN:if(Q.ctrlKey||Q.metaKey||Q.shiftKey){if(!1===fe.enableRotate)return;Di(Q),gt=bn.ROTATE}else{if(!1===fe.enablePan)return;Vi(Q),gt=bn.PAN}break;default:gt=bn.NONE}gt!==bn.NONE&&fe.dispatchEvent(Ze)}(Q))}function Xr(Q){!1!==fe.enabled&&("touch"===Q.pointerType?function ue(Q){switch(Ue(Q),gt){case bn.TOUCH_ROTATE:if(!1===fe.enableRotate)return;Zs(Q),fe.update();break;case bn.TOUCH_PAN:if(!1===fe.enablePan)return;Bn(Q),fe.update();break;case bn.TOUCH_DOLLY_PAN:if(!1===fe.enableZoom&&!1===fe.enablePan)return;(function fi(Q){fe.enableZoom&&lr(Q),fe.enablePan&&Bn(Q)})(Q),fe.update();break;case bn.TOUCH_DOLLY_ROTATE:if(!1===fe.enableZoom&&!1===fe.enableRotate)return;(function On(Q){fe.enableZoom&&lr(Q),fe.enableRotate&&Zs(Q)})(Q),fe.update();break;default:gt=bn.NONE}}(Q):function J(Q){switch(gt){case bn.ROTATE:if(!1===fe.enableRotate)return;!function ir(Q){nt.set(Q.clientX,Q.clientY),on.subVectors(nt,rt).multiplyScalar(fe.rotateSpeed);const Ve=fe.domElement;ht(2*Math.PI*on.x/Ve.clientHeight),yt(2*Math.PI*on.y/Ve.clientHeight),rt.copy(nt),fe.update()}(Q);break;case bn.DOLLY:if(!1===fe.enableZoom)return;!function Tr(Q){ai.set(Q.clientX,Q.clientY),mn.subVectors(ai,kn),mn.y>0?ci(tt()):mn.y<0&&Zn(tt()),kn.copy(ai),fe.update()}(Q);break;case bn.PAN:if(!1===fe.enablePan)return;!function Ir(Q){Tt.set(Q.clientX,Q.clientY),Cn.subVectors(Tt,Qe).multiplyScalar(fe.panSpeed),In(Cn.x,Cn.y),Qe.copy(Tt),fe.update()}(Q)}}(Q))}function Pi(Q){(function we(Q){delete Wt[Q.pointerId];for(let Ve=0;Ve<rn.length;Ve++)if(rn[Ve].pointerId==Q.pointerId)return void rn.splice(Ve,1)})(Q),0===rn.length&&(fe.domElement.releasePointerCapture(Q.pointerId),fe.domElement.removeEventListener("pointermove",Xr),fe.domElement.removeEventListener("pointerup",Pi)),fe.dispatchEvent(mt),gt=bn.NONE}function Z(Q){!1===fe.enabled||!1===fe.enableZoom||gt!==bn.NONE||(Q.preventDefault(),fe.dispatchEvent(Ze),function xs(Q){Yt(Q),Q.deltaY<0?Zn(tt()):Q.deltaY>0&&ci(tt()),fe.update()}(Q),fe.dispatchEvent(mt))}function he(Q){!1===fe.enabled||!1===fe.enablePan||function Fo(Q){let Ve=!1;switch(Q.code){case fe.keys.UP:Q.ctrlKey||Q.metaKey||Q.shiftKey?yt(2*Math.PI*fe.rotateSpeed/fe.domElement.clientHeight):In(0,fe.keyPanSpeed),Ve=!0;break;case fe.keys.BOTTOM:Q.ctrlKey||Q.metaKey||Q.shiftKey?yt(-2*Math.PI*fe.rotateSpeed/fe.domElement.clientHeight):In(0,-fe.keyPanSpeed),Ve=!0;break;case fe.keys.LEFT:Q.ctrlKey||Q.metaKey||Q.shiftKey?ht(2*Math.PI*fe.rotateSpeed/fe.domElement.clientHeight):In(fe.keyPanSpeed,0),Ve=!0;break;case fe.keys.RIGHT:Q.ctrlKey||Q.metaKey||Q.shiftKey?ht(-2*Math.PI*fe.rotateSpeed/fe.domElement.clientHeight):In(-fe.keyPanSpeed,0),Ve=!0}Ve&&(Q.preventDefault(),fe.update())}(Q)}function ie(Q){!1!==fe.enabled&&Q.preventDefault()}function Ue(Q){let Ve=Wt[Q.pointerId];void 0===Ve&&(Ve=new N.FM8,Wt[Q.pointerId]=Ve),Ve.set(Q.pageX,Q.pageY)}function Fe(Q){return Wt[(Q.pointerId===rn[0].pointerId?rn[1]:rn[0]).pointerId]}fe.domElement.addEventListener("contextmenu",ie),fe.domElement.addEventListener("pointerdown",Lt),fe.domElement.addEventListener("pointercancel",Pi),fe.domElement.addEventListener("wheel",Z,{passive:!1}),this.update()}}var Mn=ye(1223);let Ut=(()=>{class lt{constructor(){this.domWidth=window.innerWidth,this.domHeight=window.innerHeight}init(){return this.scene=new N.xsS,this.renderer=new N.CP7({antialias:!0,logarithmicDepthBuffer:!0}),this.camera=new N.cPb,this.clock=new N.SUY,this.orbit_controls=new _n(this.camera,this.renderer.domElement),this._initScene(),this._initCamera(),this._initRenderer(),this._initResponsiveResize(),this.renderer.setAnimationLoop(()=>{this.renderer.render(this.scene,this.camera)}),{scene:this.scene,camera:this.camera,renderer:this.renderer,orbit_controls:this.orbit_controls,clock:this.clock}}_initScene(){}_initCamera(){this.camera.fov=55,this.camera.aspect=this.domWidth/this.domHeight,this.camera.near=.1,this.camera.far=1e3,this.camera.position.set(3,3,3),this.camera.updateProjectionMatrix()}_initRenderer(){this.renderer.shadowMap.enabled=!0,this.renderer.outputColorSpace=N.KI_,this.renderer.toneMapping=N.LY2,this.renderer.setSize(this.domWidth,this.domHeight)}_initResponsiveResize(){window.addEventListener("resize",()=>{this.camera.aspect=this.domWidth/this.domHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.setPixelRatio(window.devicePixelRatio)})}}return lt.\u0275fac=function(ri){return new(ri||lt)},lt.\u0275prov=Mn.Yz7({token:lt,factory:lt.\u0275fac}),lt})()},7368:(qn,Rt,ye)=>{ye.r(Rt),ye.d(Rt,{ShaderModule:()=>gn});var N=ye(9808),F=ye(1223);let mt={async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};const sn=/[&<>"']/,Xt=new RegExp(sn.source,"g"),_n=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Mn=new RegExp(_n.source,"g"),Ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},lt=b=>Ut[b];function Ft(b,u){if(u){if(sn.test(b))return b.replace(Xt,lt)}else if(_n.test(b))return b.replace(Mn,lt);return b}const ri=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function fe(b){return b.replace(ri,(u,h)=>"colon"===(h=h.toLowerCase())?":":"#"===h.charAt(0)?"x"===h.charAt(1)?String.fromCharCode(parseInt(h.substring(2),16)):String.fromCharCode(+h.substring(1)):"")}const bn=/(^|[^\[])\^/g;function gt(b,u){b="string"==typeof b?b:b.source,u=u||"";const h={replace:(m,v)=>(v=(v=v.source||v).replace(bn,"$1"),b=b.replace(m,v),h),getRegex:()=>new RegExp(b,u)};return h}const Gn=/[^\w:]/g,Vn=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function ce(b,u,h){if(b){let m;try{m=decodeURIComponent(fe(h)).replace(Gn,"").toLowerCase()}catch(v){return null}if(0===m.indexOf("javascript:")||0===m.indexOf("vbscript:")||0===m.indexOf("data:"))return null}u&&!Vn.test(h)&&(h=function on(b,u){ke[" "+b]||(ke[" "+b]=Ye.test(b)?b+"/":Cn(b,"/",!0));const h=-1===(b=ke[" "+b]).indexOf(":");return"//"===u.substring(0,2)?h?u:b.replace(rt,"$1")+u:"/"===u.charAt(0)?h?u:b.replace(nt,"$1")+u:b+u}(u,h));try{h=encodeURI(h).replace(/%25/g,"%")}catch(m){return null}return h}const ke={},Ye=/^[^:]+:\/*[^/]*$/,rt=/^([^:]+:)[\s\S]*$/,nt=/^([^:]+:\/*[^/]*)[\s\S]*$/,Qe={exec:function(){}};function Tt(b,u){const m=b.replace(/\|/g,(E,V,j)=>{let q=!1,de=V;for(;--de>=0&&"\\"===j[de];)q=!q;return q?"|":" |"}).split(/ \|/);let v=0;if(m[0].trim()||m.shift(),m.length>0&&!m[m.length-1].trim()&&m.pop(),m.length>u)m.splice(u);else for(;m.length<u;)m.push("");for(;v<m.length;v++)m[v]=m[v].trim().replace(/\\\|/g,"|");return m}function Cn(b,u,h){const m=b.length;if(0===m)return"";let v=0;for(;v<m;){const E=b.charAt(m-v-1);if(E!==u||h){if(E===u||!h)break;v++}else v++}return b.slice(0,m-v)}function mn(b,u){if(u<1)return"";let h="";for(;u>1;)1&u&&(h+=b),u>>=1,b+=b;return h+b}function Jn(b,u,h,m){const v=u.href,E=u.title?Ft(u.title):null,V=b[1].replace(/\\([\[\]])/g,"$1");if("!"!==b[0].charAt(0)){m.state.inLink=!0;const j={type:"link",raw:h,href:v,title:E,text:V,tokens:m.inlineTokens(V)};return m.state.inLink=!1,j}return{type:"image",raw:h,href:v,title:E,text:Ft(V)}}class Nr{constructor(u){this.options=u||mt}space(u){const h=this.rules.block.newline.exec(u);if(h&&h[0].length>0)return{type:"space",raw:h[0]}}code(u){const h=this.rules.block.code.exec(u);if(h){const m=h[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:h[0],codeBlockStyle:"indented",text:this.options.pedantic?m:Cn(m,"\n")}}}fences(u){const h=this.rules.block.fences.exec(u);if(h){const m=h[0],v=function Rn(b,u){const h=b.match(/^(\s+)(?:```)/);if(null===h)return u;const m=h[1];return u.split("\n").map(v=>{const E=v.match(/^\s+/);if(null===E)return v;const[V]=E;return V.length>=m.length?v.slice(m.length):v}).join("\n")}(m,h[3]||"");return{type:"code",raw:m,lang:h[2]?h[2].trim().replace(this.rules.inline._escapes,"$1"):h[2],text:v}}}heading(u){const h=this.rules.block.heading.exec(u);if(h){let m=h[2].trim();if(/#$/.test(m)){const v=Cn(m,"#");(this.options.pedantic||!v||/ $/.test(v))&&(m=v.trim())}return{type:"heading",raw:h[0],depth:h[1].length,text:m,tokens:this.lexer.inline(m)}}}hr(u){const h=this.rules.block.hr.exec(u);if(h)return{type:"hr",raw:h[0]}}blockquote(u){const h=this.rules.block.blockquote.exec(u);if(h){const m=h[0].replace(/^ *>[ \t]?/gm,""),v=this.lexer.state.top;this.lexer.state.top=!0;const E=this.lexer.blockTokens(m);return this.lexer.state.top=v,{type:"blockquote",raw:h[0],tokens:E,text:m}}}list(u){let h=this.rules.block.list.exec(u);if(h){let m,v,E,V,j,q,de,be,ge,$e,Ge,wt,It=h[1].trim();const wn=It.length>1,Qt={type:"list",raw:"",ordered:wn,start:wn?+It.slice(0,-1):"",loose:!1,items:[]};It=wn?`\\d{1,9}\\${It.slice(-1)}`:`\\${It}`,this.options.pedantic&&(It=wn?It:"[*+-]");const vt=new RegExp(`^( {0,3}${It})((?:[\t ][^\\n]*)?(?:\\n|$))`);for(;u&&(wt=!1,(h=vt.exec(u))&&!this.rules.block.hr.test(u));){if(m=h[0],u=u.substring(m.length),be=h[2].split("\n",1)[0].replace(/^\t+/,ni=>" ".repeat(3*ni.length)),ge=u.split("\n",1)[0],this.options.pedantic?(V=2,Ge=be.trimLeft()):(V=h[2].search(/[^ ]/),V=V>4?1:V,Ge=be.slice(V),V+=h[1].length),q=!1,!be&&/^ *$/.test(ge)&&(m+=ge+"\n",u=u.substring(ge.length+1),wt=!0),!wt){const ni=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),Qn=new RegExp(`^ {0,${Math.min(3,V-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),si=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:\`\`\`|~~~)`),oi=new RegExp(`^ {0,${Math.min(3,V-1)}}#`);for(;u&&($e=u.split("\n",1)[0],ge=$e,this.options.pedantic&&(ge=ge.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(si.test(ge)||oi.test(ge)||ni.test(ge)||Qn.test(u)));){if(ge.search(/[^ ]/)>=V||!ge.trim())Ge+="\n"+ge.slice(V);else{if(q||be.search(/[^ ]/)>=4||si.test(be)||oi.test(be)||Qn.test(be))break;Ge+="\n"+ge}!q&&!ge.trim()&&(q=!0),m+=$e+"\n",u=u.substring($e.length+1),be=ge.slice(V)}}Qt.loose||(de?Qt.loose=!0:/\n *\n *$/.test(m)&&(de=!0)),this.options.gfm&&(v=/^\[[ xX]\] /.exec(Ge),v&&(E="[ ] "!==v[0],Ge=Ge.replace(/^\[[ xX]\] +/,""))),Qt.items.push({type:"list_item",raw:m,task:!!v,checked:E,loose:!1,text:Ge}),Qt.raw+=m}Qt.items[Qt.items.length-1].raw=m.trimRight(),Qt.items[Qt.items.length-1].text=Ge.trimRight(),Qt.raw=Qt.raw.trimRight();const En=Qt.items.length;for(j=0;j<En;j++)if(this.lexer.state.top=!1,Qt.items[j].tokens=this.lexer.blockTokens(Qt.items[j].text,[]),!Qt.loose){const ni=Qt.items[j].tokens.filter(si=>"space"===si.type),Qn=ni.length>0&&ni.some(si=>/\n.*\n/.test(si.raw));Qt.loose=Qn}if(Qt.loose)for(j=0;j<En;j++)Qt.items[j].loose=!0;return Qt}}html(u){const h=this.rules.block.html.exec(u);if(h){const m={type:"html",raw:h[0],pre:!this.options.sanitizer&&("pre"===h[1]||"script"===h[1]||"style"===h[1]),text:h[0]};if(this.options.sanitize){const v=this.options.sanitizer?this.options.sanitizer(h[0]):Ft(h[0]);m.type="paragraph",m.text=v,m.tokens=this.lexer.inline(v)}return m}}def(u){const h=this.rules.block.def.exec(u);if(h){const m=h[1].toLowerCase().replace(/\s+/g," "),v=h[2]?h[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",E=h[3]?h[3].substring(1,h[3].length-1).replace(this.rules.inline._escapes,"$1"):h[3];return{type:"def",tag:m,raw:h[0],href:v,title:E}}}table(u){const h=this.rules.block.table.exec(u);if(h){const m={type:"table",header:Tt(h[1]).map(v=>({text:v})),align:h[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:h[3]&&h[3].trim()?h[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(m.header.length===m.align.length){m.raw=h[0];let E,V,j,q,v=m.align.length;for(E=0;E<v;E++)m.align[E]=/^ *-+: *$/.test(m.align[E])?"right":/^ *:-+: *$/.test(m.align[E])?"center":/^ *:-+ *$/.test(m.align[E])?"left":null;for(v=m.rows.length,E=0;E<v;E++)m.rows[E]=Tt(m.rows[E],m.header.length).map(de=>({text:de}));for(v=m.header.length,V=0;V<v;V++)m.header[V].tokens=this.lexer.inline(m.header[V].text);for(v=m.rows.length,V=0;V<v;V++)for(q=m.rows[V],j=0;j<q.length;j++)q[j].tokens=this.lexer.inline(q[j].text);return m}}}lheading(u){const h=this.rules.block.lheading.exec(u);if(h)return{type:"heading",raw:h[0],depth:"="===h[2].charAt(0)?1:2,text:h[1],tokens:this.lexer.inline(h[1])}}paragraph(u){const h=this.rules.block.paragraph.exec(u);if(h){const m="\n"===h[1].charAt(h[1].length-1)?h[1].slice(0,-1):h[1];return{type:"paragraph",raw:h[0],text:m,tokens:this.lexer.inline(m)}}}text(u){const h=this.rules.block.text.exec(u);if(h)return{type:"text",raw:h[0],text:h[0],tokens:this.lexer.inline(h[0])}}escape(u){const h=this.rules.inline.escape.exec(u);if(h)return{type:"escape",raw:h[0],text:Ft(h[1])}}tag(u){const h=this.rules.inline.tag.exec(u);if(h)return!this.lexer.state.inLink&&/^<a /i.test(h[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(h[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(h[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(h[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:h[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(h[0]):Ft(h[0]):h[0]}}link(u){const h=this.rules.inline.link.exec(u);if(h){const m=h[2].trim();if(!this.options.pedantic&&/^</.test(m)){if(!/>$/.test(m))return;const V=Cn(m.slice(0,-1),"\\");if((m.length-V.length)%2==0)return}else{const V=function kn(b,u){if(-1===b.indexOf(u[1]))return-1;const h=b.length;let m=0,v=0;for(;v<h;v++)if("\\"===b[v])v++;else if(b[v]===u[0])m++;else if(b[v]===u[1]&&(m--,m<0))return v;return-1}(h[2],"()");if(V>-1){const q=(0===h[0].indexOf("!")?5:4)+h[1].length+V;h[2]=h[2].substring(0,V),h[0]=h[0].substring(0,q).trim(),h[3]=""}}let v=h[2],E="";if(this.options.pedantic){const V=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(v);V&&(v=V[1],E=V[3])}else E=h[3]?h[3].slice(1,-1):"";return v=v.trim(),/^</.test(v)&&(v=this.options.pedantic&&!/>$/.test(m)?v.slice(1):v.slice(1,-1)),Jn(h,{href:v&&v.replace(this.rules.inline._escapes,"$1"),title:E&&E.replace(this.rules.inline._escapes,"$1")},h[0],this.lexer)}}reflink(u,h){let m;if((m=this.rules.inline.reflink.exec(u))||(m=this.rules.inline.nolink.exec(u))){let v=(m[2]||m[1]).replace(/\s+/g," ");if(v=h[v.toLowerCase()],!v){const E=m[0].charAt(0);return{type:"text",raw:E,text:E}}return Jn(m,v,m[0],this.lexer)}}emStrong(u,h,m=""){let v=this.rules.inline.emStrong.lDelim.exec(u);if(!v||v[3]&&m.match(/[\p{L}\p{N}]/u))return;const E=v[1]||v[2]||"";if(!E||E&&(""===m||this.rules.inline.punctuation.exec(m))){const V=v[0].length-1;let j,q,de=V,be=0;const ge="*"===v[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(ge.lastIndex=0,h=h.slice(-1*u.length+V);null!=(v=ge.exec(h));){if(j=v[1]||v[2]||v[3]||v[4]||v[5]||v[6],!j)continue;if(q=j.length,v[3]||v[4]){de+=q;continue}if((v[5]||v[6])&&V%3&&!((V+q)%3)){be+=q;continue}if(de-=q,de>0)continue;q=Math.min(q,q+de+be);const $e=u.slice(0,V+v.index+(v[0].length-j.length)+q);if(Math.min(V,q)%2){const wt=$e.slice(1,-1);return{type:"em",raw:$e,text:wt,tokens:this.lexer.inlineTokens(wt)}}const Ge=$e.slice(2,-2);return{type:"strong",raw:$e,text:Ge,tokens:this.lexer.inlineTokens(Ge)}}}}codespan(u){const h=this.rules.inline.code.exec(u);if(h){let m=h[2].replace(/\n/g," ");const v=/[^ ]/.test(m),E=/^ /.test(m)&&/ $/.test(m);return v&&E&&(m=m.substring(1,m.length-1)),m=Ft(m,!0),{type:"codespan",raw:h[0],text:m}}}br(u){const h=this.rules.inline.br.exec(u);if(h)return{type:"br",raw:h[0]}}del(u){const h=this.rules.inline.del.exec(u);if(h)return{type:"del",raw:h[0],text:h[2],tokens:this.lexer.inlineTokens(h[2])}}autolink(u,h){const m=this.rules.inline.autolink.exec(u);if(m){let v,E;return"@"===m[2]?(v=Ft(this.options.mangle?h(m[1]):m[1]),E="mailto:"+v):(v=Ft(m[1]),E=v),{type:"link",raw:m[0],text:v,href:E,tokens:[{type:"text",raw:v,text:v}]}}}url(u,h){let m;if(m=this.rules.inline.url.exec(u)){let v,E;if("@"===m[2])v=Ft(this.options.mangle?h(m[0]):m[0]),E="mailto:"+v;else{let V;do{V=m[0],m[0]=this.rules.inline._backpedal.exec(m[0])[0]}while(V!==m[0]);v=Ft(m[0]),E="www."===m[1]?"http://"+m[0]:m[0]}return{type:"link",raw:m[0],text:v,href:E,tokens:[{type:"text",raw:v,text:v}]}}}inlineText(u,h){const m=this.rules.inline.text.exec(u);if(m){let v;return v=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(m[0]):Ft(m[0]):m[0]:Ft(this.options.smartypants?h(m[0]):m[0]),{type:"text",raw:m[0],text:v}}}}const rn={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:Qe,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};rn.def=gt(rn.def).replace("label",rn._label).replace("title",rn._title).getRegex(),rn.bullet=/(?:[*+-]|\d{1,9}[.)])/,rn.listItemStart=gt(/^( *)(bull) */).replace("bull",rn.bullet).getRegex(),rn.list=gt(rn.list).replace(/bull/g,rn.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+rn.def.source+")").getRegex(),rn._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",rn._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,rn.html=gt(rn.html,"i").replace("comment",rn._comment).replace("tag",rn._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),rn.paragraph=gt(rn._paragraph).replace("hr",rn.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rn._tag).getRegex(),rn.blockquote=gt(rn.blockquote).replace("paragraph",rn.paragraph).getRegex(),rn.normal=ka({},rn),rn.gfm=Nd(ka({},rn.normal),{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),rn.gfm.table=gt(rn.gfm.table).replace("hr",rn.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rn._tag).getRegex(),rn.gfm.paragraph=gt(rn._paragraph).replace("hr",rn.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",rn.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rn._tag).getRegex(),rn.pedantic=Nd(ka({},rn.normal),{html:gt("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",rn._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Qe,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:gt(rn.normal._paragraph).replace("hr",rn.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",rn.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const Wt={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:Qe,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:Qe,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};function Je(b){return b.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,"\u2026")}function tt(b){let h,m,u="";const v=b.length;for(h=0;h<v;h++)m=b.charCodeAt(h),Math.random()>.5&&(m="x"+m.toString(16)),u+="&#"+m+";";return u}Wt._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",Wt.punctuation=gt(Wt.punctuation).replace(/punctuation/g,Wt._punctuation).getRegex(),Wt.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,Wt.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g,Wt._comment=gt(rn._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),Wt.emStrong.lDelim=gt(Wt.emStrong.lDelim).replace(/punct/g,Wt._punctuation).getRegex(),Wt.emStrong.rDelimAst=gt(Wt.emStrong.rDelimAst,"g").replace(/punct/g,Wt._punctuation).getRegex(),Wt.emStrong.rDelimUnd=gt(Wt.emStrong.rDelimUnd,"g").replace(/punct/g,Wt._punctuation).getRegex(),Wt._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,Wt._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,Wt._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,Wt.autolink=gt(Wt.autolink).replace("scheme",Wt._scheme).replace("email",Wt._email).getRegex(),Wt._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,Wt.tag=gt(Wt.tag).replace("comment",Wt._comment).replace("attribute",Wt._attribute).getRegex(),Wt._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Wt._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,Wt._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,Wt.link=gt(Wt.link).replace("label",Wt._label).replace("href",Wt._href).replace("title",Wt._title).getRegex(),Wt.reflink=gt(Wt.reflink).replace("label",Wt._label).replace("ref",rn._label).getRegex(),Wt.nolink=gt(Wt.nolink).replace("ref",rn._label).getRegex(),Wt.reflinkSearch=gt(Wt.reflinkSearch,"g").replace("reflink",Wt.reflink).replace("nolink",Wt.nolink).getRegex(),Wt.normal=ka({},Wt),Wt.pedantic=Nd(ka({},Wt.normal),{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:gt(/^!?\[(label)\]\((.*?)\)/).replace("label",Wt._label).getRegex(),reflink:gt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Wt._label).getRegex()}),Wt.gfm=Nd(ka({},Wt.normal),{escape:gt(Wt.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),Wt.gfm.url=gt(Wt.gfm.url,"i").replace("email",Wt.gfm._extended_email).getRegex(),Wt.breaks=Nd(ka({},Wt.gfm),{br:gt(Wt.br).replace("{2,}","*").getRegex(),text:gt(Wt.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});class ht{constructor(u){this.tokens=[],this.tokens.links=Object.create(null),this.options=u||mt,this.options.tokenizer=this.options.tokenizer||new Nr,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const h={block:rn.normal,inline:Wt.normal};this.options.pedantic?(h.block=rn.pedantic,h.inline=Wt.pedantic):this.options.gfm&&(h.block=rn.gfm,h.inline=this.options.breaks?Wt.breaks:Wt.gfm),this.tokenizer.rules=h}static get rules(){return{block:rn,inline:Wt}}static lex(u,h){return new ht(h).lex(u)}static lexInline(u,h){return new ht(h).inlineTokens(u)}lex(u){let h;for(u=u.replace(/\r\n|\r/g,"\n"),this.blockTokens(u,this.tokens);h=this.inlineQueue.shift();)this.inlineTokens(h.src,h.tokens);return this.tokens}blockTokens(u,h=[]){let m,v,E,V;for(u=this.options.pedantic?u.replace(/\t/g,"    ").replace(/^ +$/gm,""):u.replace(/^( *)(\t+)/gm,(j,q,de)=>q+"    ".repeat(de.length));u;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(j=>!!(m=j.call({lexer:this},u,h))&&(u=u.substring(m.raw.length),h.push(m),!0)))){if(m=this.tokenizer.space(u)){u=u.substring(m.raw.length),1===m.raw.length&&h.length>0?h[h.length-1].raw+="\n":h.push(m);continue}if(m=this.tokenizer.code(u)){u=u.substring(m.raw.length),v=h[h.length-1],!v||"paragraph"!==v.type&&"text"!==v.type?h.push(m):(v.raw+="\n"+m.raw,v.text+="\n"+m.text,this.inlineQueue[this.inlineQueue.length-1].src=v.text);continue}if(m=this.tokenizer.fences(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.heading(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.hr(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.blockquote(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.list(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.html(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.def(u)){u=u.substring(m.raw.length),v=h[h.length-1],!v||"paragraph"!==v.type&&"text"!==v.type?this.tokens.links[m.tag]||(this.tokens.links[m.tag]={href:m.href,title:m.title}):(v.raw+="\n"+m.raw,v.text+="\n"+m.raw,this.inlineQueue[this.inlineQueue.length-1].src=v.text);continue}if(m=this.tokenizer.table(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.lheading(u)){u=u.substring(m.raw.length),h.push(m);continue}if(E=u,this.options.extensions&&this.options.extensions.startBlock){let j=1/0;const q=u.slice(1);let de;this.options.extensions.startBlock.forEach(function(be){de=be.call({lexer:this},q),"number"==typeof de&&de>=0&&(j=Math.min(j,de))}),j<1/0&&j>=0&&(E=u.substring(0,j+1))}if(this.state.top&&(m=this.tokenizer.paragraph(E))){v=h[h.length-1],V&&"paragraph"===v.type?(v.raw+="\n"+m.raw,v.text+="\n"+m.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=v.text):h.push(m),V=E.length!==u.length,u=u.substring(m.raw.length);continue}if(m=this.tokenizer.text(u)){u=u.substring(m.raw.length),v=h[h.length-1],v&&"text"===v.type?(v.raw+="\n"+m.raw,v.text+="\n"+m.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=v.text):h.push(m);continue}if(u){const j="Infinite loop on byte: "+u.charCodeAt(0);if(this.options.silent){console.error(j);break}throw new Error(j)}}return this.state.top=!0,h}inline(u,h=[]){return this.inlineQueue.push({src:u,tokens:h}),h}inlineTokens(u,h=[]){let m,v,E,j,q,de,V=u;if(this.tokens.links){const be=Object.keys(this.tokens.links);if(be.length>0)for(;null!=(j=this.tokenizer.rules.inline.reflinkSearch.exec(V));)be.includes(j[0].slice(j[0].lastIndexOf("[")+1,-1))&&(V=V.slice(0,j.index)+"["+mn("a",j[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(j=this.tokenizer.rules.inline.blockSkip.exec(V));)V=V.slice(0,j.index)+"["+mn("a",j[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(j=this.tokenizer.rules.inline.escapedEmSt.exec(V));)V=V.slice(0,j.index+j[0].length-2)+"++"+V.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;u;)if(q||(de=""),q=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(be=>!!(m=be.call({lexer:this},u,h))&&(u=u.substring(m.raw.length),h.push(m),!0)))){if(m=this.tokenizer.escape(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.tag(u)){u=u.substring(m.raw.length),v=h[h.length-1],v&&"text"===m.type&&"text"===v.type?(v.raw+=m.raw,v.text+=m.text):h.push(m);continue}if(m=this.tokenizer.link(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.reflink(u,this.tokens.links)){u=u.substring(m.raw.length),v=h[h.length-1],v&&"text"===m.type&&"text"===v.type?(v.raw+=m.raw,v.text+=m.text):h.push(m);continue}if(m=this.tokenizer.emStrong(u,V,de)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.codespan(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.br(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.del(u)){u=u.substring(m.raw.length),h.push(m);continue}if(m=this.tokenizer.autolink(u,tt)){u=u.substring(m.raw.length),h.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(u,tt))){u=u.substring(m.raw.length),h.push(m);continue}if(E=u,this.options.extensions&&this.options.extensions.startInline){let be=1/0;const ge=u.slice(1);let $e;this.options.extensions.startInline.forEach(function(Ge){$e=Ge.call({lexer:this},ge),"number"==typeof $e&&$e>=0&&(be=Math.min(be,$e))}),be<1/0&&be>=0&&(E=u.substring(0,be+1))}if(m=this.tokenizer.inlineText(E,Je)){u=u.substring(m.raw.length),"_"!==m.raw.slice(-1)&&(de=m.raw.slice(-1)),q=!0,v=h[h.length-1],v&&"text"===v.type?(v.raw+=m.raw,v.text+=m.text):h.push(m);continue}if(u){const be="Infinite loop on byte: "+u.charCodeAt(0);if(this.options.silent){console.error(be);break}throw new Error(be)}}return h}}class yt{constructor(u){this.options=u||mt}code(u,h,m){const v=(h||"").match(/\S*/)[0];if(this.options.highlight){const E=this.options.highlight(u,v);null!=E&&E!==u&&(m=!0,u=E)}return u=u.replace(/\n$/,"")+"\n",v?'<pre><code class="'+this.options.langPrefix+Ft(v)+'">'+(m?u:Ft(u,!0))+"</code></pre>\n":"<pre><code>"+(m?u:Ft(u,!0))+"</code></pre>\n"}blockquote(u){return`<blockquote>\n${u}</blockquote>\n`}html(u){return u}heading(u,h,m,v){return this.options.headerIds?`<h${h} id="${this.options.headerPrefix+v.slug(m)}">${u}</h${h}>\n`:`<h${h}>${u}</h${h}>\n`}hr(){return this.options.xhtml?"<hr/>\n":"<hr>\n"}list(u,h,m){const v=h?"ol":"ul";return"<"+v+(h&&1!==m?' start="'+m+'"':"")+">\n"+u+"</"+v+">\n"}listitem(u){return`<li>${u}</li>\n`}checkbox(u){return"<input "+(u?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(u){return`<p>${u}</p>\n`}table(u,h){return h&&(h=`<tbody>${h}</tbody>`),"<table>\n<thead>\n"+u+"</thead>\n"+h+"</table>\n"}tablerow(u){return`<tr>\n${u}</tr>\n`}tablecell(u,h){const m=h.header?"th":"td";return(h.align?`<${m} align="${h.align}">`:`<${m}>`)+u+`</${m}>\n`}strong(u){return`<strong>${u}</strong>`}em(u){return`<em>${u}</em>`}codespan(u){return`<code>${u}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(u){return`<del>${u}</del>`}link(u,h,m){if(null===(u=ce(this.options.sanitize,this.options.baseUrl,u)))return m;let v='<a href="'+u+'"';return h&&(v+=' title="'+h+'"'),v+=">"+m+"</a>",v}image(u,h,m){if(null===(u=ce(this.options.sanitize,this.options.baseUrl,u)))return m;let v=`<img src="${u}" alt="${m}"`;return h&&(v+=` title="${h}"`),v+=this.options.xhtml?"/>":">",v}text(u){return u}}class hn{strong(u){return u}em(u){return u}codespan(u){return u}del(u){return u}html(u){return u}text(u){return u}link(u,h,m){return""+m}image(u,h,m){return""+m}br(){return""}}class $t{constructor(){this.seen={}}serialize(u){return u.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(u,h){let m=u,v=0;if(this.seen.hasOwnProperty(m)){v=this.seen[u];do{v++,m=u+"-"+v}while(this.seen.hasOwnProperty(m))}return h||(this.seen[u]=v,this.seen[m]=0),m}slug(u,h={}){const m=this.serialize(u);return this.getNextSafeSlug(m,h.dryrun)}}class In{constructor(u){this.options=u||mt,this.options.renderer=this.options.renderer||new yt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new hn,this.slugger=new $t}static parse(u,h){return new In(h).parse(u)}static parseInline(u,h){return new In(h).parseInline(u)}parse(u,h=!0){let v,E,V,j,q,de,be,ge,$e,Ge,wt,It,wn,Qt,vt,En,ni,Qn,si,m="";const oi=u.length;for(v=0;v<oi;v++)if(Ge=u[v],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[Ge.type]&&(si=this.options.extensions.renderers[Ge.type].call({parser:this},Ge),!1!==si||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(Ge.type)))m+=si||"";else switch(Ge.type){case"space":continue;case"hr":m+=this.renderer.hr();continue;case"heading":m+=this.renderer.heading(this.parseInline(Ge.tokens),Ge.depth,fe(this.parseInline(Ge.tokens,this.textRenderer)),this.slugger);continue;case"code":m+=this.renderer.code(Ge.text,Ge.lang,Ge.escaped);continue;case"table":for(ge="",be="",j=Ge.header.length,E=0;E<j;E++)be+=this.renderer.tablecell(this.parseInline(Ge.header[E].tokens),{header:!0,align:Ge.align[E]});for(ge+=this.renderer.tablerow(be),$e="",j=Ge.rows.length,E=0;E<j;E++){for(de=Ge.rows[E],be="",q=de.length,V=0;V<q;V++)be+=this.renderer.tablecell(this.parseInline(de[V].tokens),{header:!1,align:Ge.align[V]});$e+=this.renderer.tablerow(be)}m+=this.renderer.table(ge,$e);continue;case"blockquote":$e=this.parse(Ge.tokens),m+=this.renderer.blockquote($e);continue;case"list":for(wt=Ge.ordered,It=Ge.start,wn=Ge.loose,j=Ge.items.length,$e="",E=0;E<j;E++)vt=Ge.items[E],En=vt.checked,ni=vt.task,Qt="",vt.task&&(Qn=this.renderer.checkbox(En),wn?vt.tokens.length>0&&"paragraph"===vt.tokens[0].type?(vt.tokens[0].text=Qn+" "+vt.tokens[0].text,vt.tokens[0].tokens&&vt.tokens[0].tokens.length>0&&"text"===vt.tokens[0].tokens[0].type&&(vt.tokens[0].tokens[0].text=Qn+" "+vt.tokens[0].tokens[0].text)):vt.tokens.unshift({type:"text",text:Qn}):Qt+=Qn),Qt+=this.parse(vt.tokens,wn),$e+=this.renderer.listitem(Qt,ni,En);m+=this.renderer.list($e,wt,It);continue;case"html":m+=this.renderer.html(Ge.text);continue;case"paragraph":m+=this.renderer.paragraph(this.parseInline(Ge.tokens));continue;case"text":for($e=Ge.tokens?this.parseInline(Ge.tokens):Ge.text;v+1<oi&&"text"===u[v+1].type;)Ge=u[++v],$e+="\n"+(Ge.tokens?this.parseInline(Ge.tokens):Ge.text);m+=h?this.renderer.paragraph($e):$e;continue;default:{const Dn='Token with "'+Ge.type+'" type was not found.';if(this.options.silent)return void console.error(Dn);throw new Error(Dn)}}return m}parseInline(u,h){h=h||this.renderer;let v,E,V,m="";const j=u.length;for(v=0;v<j;v++)if(E=u[v],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[E.type]&&(V=this.options.extensions.renderers[E.type].call({parser:this},E),!1!==V||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(E.type)))m+=V||"";else switch(E.type){case"escape":case"text":m+=h.text(E.text);break;case"html":m+=h.html(E.text);break;case"link":m+=h.link(E.href,E.title,this.parseInline(E.tokens,h));break;case"image":m+=h.image(E.href,E.title,E.text);break;case"strong":m+=h.strong(this.parseInline(E.tokens,h));break;case"em":m+=h.em(this.parseInline(E.tokens,h));break;case"codespan":m+=h.codespan(E.text);break;case"br":m+=h.br();break;case"del":m+=h.del(this.parseInline(E.tokens,h));break;default:{const q='Token with "'+E.type+'" type was not found.';if(this.options.silent)return void console.error(q);throw new Error(q)}}return m}}class ci{constructor(u){this.options=u||mt}preprocess(u){return u}postprocess(u){return u}}function Yt(b,u){return(h,m,v)=>{"function"==typeof m&&(v=m,m=null);const E=ka({},m),V=function Zn(b,u,h){return m=>{if(m.message+="\nPlease report this to https://github.com/markedjs/marked.",b){const v="<p>An error occurred:</p><pre>"+Ft(m.message+"",!0)+"</pre>";return u?Promise.resolve(v):h?void h(null,v):v}if(u)return Promise.reject(m);if(!h)throw m;h(m)}}((m=ka(ka({},tn.defaults),E)).silent,m.async,v);if(null==h)return V(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof h)return V(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(h)+", string expected"));if(function ai(b){b&&b.sanitize&&!b.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}(m),m.hooks&&(m.hooks.options=m),v){const j=m.highlight;let q;try{m.hooks&&(h=m.hooks.preprocess(h)),q=b(h,m)}catch(ge){return V(ge)}const de=function(ge){let $e;if(!ge)try{m.walkTokens&&tn.walkTokens(q,m.walkTokens),$e=u(q,m),m.hooks&&($e=m.hooks.postprocess($e))}catch(Ge){ge=Ge}return m.highlight=j,ge?V(ge):v(null,$e)};if(!j||j.length<3||(delete m.highlight,!q.length))return de();let be=0;return tn.walkTokens(q,function(ge){"code"===ge.type&&(be++,setTimeout(()=>{j(ge.text,ge.lang,function($e,Ge){if($e)return de($e);null!=Ge&&Ge!==ge.text&&(ge.text=Ge,ge.escaped=!0),be--,0===be&&de()})},0))}),void(0===be&&de())}if(m.async)return Promise.resolve(m.hooks?m.hooks.preprocess(h):h).then(j=>b(j,m)).then(j=>m.walkTokens?Promise.all(tn.walkTokens(j,m.walkTokens)).then(()=>j):j).then(j=>u(j,m)).then(j=>m.hooks?m.hooks.postprocess(j):j).catch(V);try{m.hooks&&(h=m.hooks.preprocess(h));const j=b(h,m);m.walkTokens&&tn.walkTokens(j,m.walkTokens);let q=u(j,m);return m.hooks&&(q=m.hooks.postprocess(q)),q}catch(j){return V(j)}}}function tn(b,u,h){return Yt(ht.lex,In.parse)(b,u,h)}jM(ci,"passThroughHooks",new Set(["preprocess","postprocess"])),tn.options=tn.setOptions=function(b){return function ut(b){mt=b}(tn.defaults=ka(ka({},tn.defaults),b)),tn},tn.getDefaults=function Ze(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}},tn.defaults=mt,tn.use=function(...b){const u=tn.defaults.extensions||{renderers:{},childTokens:{}};b.forEach(h=>{const m=ka({},h);if(m.async=tn.defaults.async||m.async||!1,h.extensions&&(h.extensions.forEach(v=>{if(!v.name)throw new Error("extension name required");if(v.renderer){const E=u.renderers[v.name];u.renderers[v.name]=E?function(...V){let j=v.renderer.apply(this,V);return!1===j&&(j=E.apply(this,V)),j}:v.renderer}if(v.tokenizer){if(!v.level||"block"!==v.level&&"inline"!==v.level)throw new Error("extension level must be 'block' or 'inline'");u[v.level]?u[v.level].unshift(v.tokenizer):u[v.level]=[v.tokenizer],v.start&&("block"===v.level?u.startBlock?u.startBlock.push(v.start):u.startBlock=[v.start]:"inline"===v.level&&(u.startInline?u.startInline.push(v.start):u.startInline=[v.start]))}v.childTokens&&(u.childTokens[v.name]=v.childTokens)}),m.extensions=u),h.renderer){const v=tn.defaults.renderer||new yt;for(const E in h.renderer){const V=v[E];v[E]=(...j)=>{let q=h.renderer[E].apply(v,j);return!1===q&&(q=V.apply(v,j)),q}}m.renderer=v}if(h.tokenizer){const v=tn.defaults.tokenizer||new Nr;for(const E in h.tokenizer){const V=v[E];v[E]=(...j)=>{let q=h.tokenizer[E].apply(v,j);return!1===q&&(q=V.apply(v,j)),q}}m.tokenizer=v}if(h.hooks){const v=tn.defaults.hooks||new ci;for(const E in h.hooks){const V=v[E];v[E]=ci.passThroughHooks.has(E)?j=>{if(tn.defaults.async)return Promise.resolve(h.hooks[E].call(v,j)).then(de=>V.call(v,de));const q=h.hooks[E].call(v,j);return V.call(v,q)}:(...j)=>{let q=h.hooks[E].apply(v,j);return!1===q&&(q=V.apply(v,j)),q}}m.hooks=v}if(h.walkTokens){const v=tn.defaults.walkTokens;m.walkTokens=function(E){let V=[];return V.push(h.walkTokens.call(this,E)),v&&(V=V.concat(v.call(this,E))),V}}tn.setOptions(m)})},tn.walkTokens=function(b,u){let h=[];for(const m of b)switch(h=h.concat(u.call(tn,m)),m.type){case"table":for(const v of m.header)h=h.concat(tn.walkTokens(v.tokens,u));for(const v of m.rows)for(const E of v)h=h.concat(tn.walkTokens(E.tokens,u));break;case"list":h=h.concat(tn.walkTokens(m.items,u));break;default:tn.defaults.extensions&&tn.defaults.extensions.childTokens&&tn.defaults.extensions.childTokens[m.type]?tn.defaults.extensions.childTokens[m.type].forEach(function(v){h=h.concat(tn.walkTokens(m[v],u))}):m.tokens&&(h=h.concat(tn.walkTokens(m.tokens,u)))}return h},tn.parseInline=Yt(ht.lexInline,In.parseInline),tn.Parser=In,tn.parser=In.parse,tn.Renderer=yt,tn.TextRenderer=hn,tn.Lexer=ht,tn.lexer=ht.lex,tn.Tokenizer=Nr,tn.Slugger=$t,tn.Hooks=ci,tn.parse=tn;var Mr=ye(4004),ar=(ye(590),ye(9646)),ts=ye(8306),Ts=ye(4351),Zs=ye(9300);class Bn{}class lr{}class fi{constructor(u){this.normalizedNames=new Map,this.lazyUpdate=null,u?this.lazyInit="string"==typeof u?()=>{this.headers=new Map,u.split("\n").forEach(h=>{const m=h.indexOf(":");if(m>0){const v=h.slice(0,m),E=v.toLowerCase(),V=h.slice(m+1).trim();this.maybeSetNormalizedName(v,E),this.headers.has(E)?this.headers.get(E).push(V):this.headers.set(E,[V])}})}:()=>{this.headers=new Map,Object.keys(u).forEach(h=>{let m=u[h];const v=h.toLowerCase();"string"==typeof m&&(m=[m]),m.length>0&&(this.headers.set(v,m),this.maybeSetNormalizedName(h,v))})}:this.headers=new Map}has(u){return this.init(),this.headers.has(u.toLowerCase())}get(u){this.init();const h=this.headers.get(u.toLowerCase());return h&&h.length>0?h[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(u){return this.init(),this.headers.get(u.toLowerCase())||null}append(u,h){return this.clone({name:u,value:h,op:"a"})}set(u,h){return this.clone({name:u,value:h,op:"s"})}delete(u,h){return this.clone({name:u,value:h,op:"d"})}maybeSetNormalizedName(u,h){this.normalizedNames.has(h)||this.normalizedNames.set(h,u)}init(){this.lazyInit&&(this.lazyInit instanceof fi?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(u=>this.applyUpdate(u)),this.lazyUpdate=null))}copyFrom(u){u.init(),Array.from(u.headers.keys()).forEach(h=>{this.headers.set(h,u.headers.get(h)),this.normalizedNames.set(h,u.normalizedNames.get(h))})}clone(u){const h=new fi;return h.lazyInit=this.lazyInit&&this.lazyInit instanceof fi?this.lazyInit:this,h.lazyUpdate=(this.lazyUpdate||[]).concat([u]),h}applyUpdate(u){const h=u.name.toLowerCase();switch(u.op){case"a":case"s":let m=u.value;if("string"==typeof m&&(m=[m]),0===m.length)return;this.maybeSetNormalizedName(u.name,h);const v=("a"===u.op?this.headers.get(h):void 0)||[];v.push(...m),this.headers.set(h,v);break;case"d":const E=u.value;if(E){let V=this.headers.get(h);if(!V)return;V=V.filter(j=>-1===E.indexOf(j)),0===V.length?(this.headers.delete(h),this.normalizedNames.delete(h)):this.headers.set(h,V)}else this.headers.delete(h),this.normalizedNames.delete(h)}}forEach(u){this.init(),Array.from(this.normalizedNames.keys()).forEach(h=>u(this.normalizedNames.get(h),this.headers.get(h)))}}class On{encodeKey(u){return Le(u)}encodeValue(u){return Le(u)}decodeKey(u){return decodeURIComponent(u)}decodeValue(u){return decodeURIComponent(u)}}const Xr=/%(\d[a-f0-9])/gi,Pi={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Le(b){return encodeURIComponent(b).replace(Xr,(u,h)=>{var m;return null!==(m=Pi[h])&&void 0!==m?m:u})}function J(b){return`${b}`}class Z{constructor(u={}){if(this.updates=null,this.cloneFrom=null,this.encoder=u.encoder||new On,u.fromString){if(u.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Lt(b,u){const h=new Map;return b.length>0&&b.replace(/^\?/,"").split("&").forEach(v=>{const E=v.indexOf("="),[V,j]=-1==E?[u.decodeKey(v),""]:[u.decodeKey(v.slice(0,E)),u.decodeValue(v.slice(E+1))],q=h.get(V)||[];q.push(j),h.set(V,q)}),h}(u.fromString,this.encoder)}else u.fromObject?(this.map=new Map,Object.keys(u.fromObject).forEach(h=>{const m=u.fromObject[h];this.map.set(h,Array.isArray(m)?m:[m])})):this.map=null}has(u){return this.init(),this.map.has(u)}get(u){this.init();const h=this.map.get(u);return h?h[0]:null}getAll(u){return this.init(),this.map.get(u)||null}keys(){return this.init(),Array.from(this.map.keys())}append(u,h){return this.clone({param:u,value:h,op:"a"})}appendAll(u){const h=[];return Object.keys(u).forEach(m=>{const v=u[m];Array.isArray(v)?v.forEach(E=>{h.push({param:m,value:E,op:"a"})}):h.push({param:m,value:v,op:"a"})}),this.clone(h)}set(u,h){return this.clone({param:u,value:h,op:"s"})}delete(u,h){return this.clone({param:u,value:h,op:"d"})}toString(){return this.init(),this.keys().map(u=>{const h=this.encoder.encodeKey(u);return this.map.get(u).map(m=>h+"="+this.encoder.encodeValue(m)).join("&")}).filter(u=>""!==u).join("&")}clone(u){const h=new Z({encoder:this.encoder});return h.cloneFrom=this.cloneFrom||this,h.updates=(this.updates||[]).concat(u),h}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(u=>this.map.set(u,this.cloneFrom.map.get(u))),this.updates.forEach(u=>{switch(u.op){case"a":case"s":const h=("a"===u.op?this.map.get(u.param):void 0)||[];h.push(J(u.value)),this.map.set(u.param,h);break;case"d":if(void 0===u.value){this.map.delete(u.param);break}{let m=this.map.get(u.param)||[];const v=m.indexOf(J(u.value));-1!==v&&m.splice(v,1),m.length>0?this.map.set(u.param,m):this.map.delete(u.param)}}}),this.cloneFrom=this.updates=null)}}class ne{constructor(){this.map=new Map}set(u,h){return this.map.set(u,h),this}get(u){return this.map.has(u)||this.map.set(u,u.defaultValue()),this.map.get(u)}delete(u){return this.map.delete(u),this}has(u){return this.map.has(u)}keys(){return this.map.keys()}}function ie(b){return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer}function Ie(b){return"undefined"!=typeof Blob&&b instanceof Blob}function we(b){return"undefined"!=typeof FormData&&b instanceof FormData}class Fe{constructor(u,h,m,v){let E;if(this.url=h,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=u.toUpperCase(),function ue(b){switch(b){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||v?(this.body=void 0!==m?m:null,E=v):E=m,E&&(this.reportProgress=!!E.reportProgress,this.withCredentials=!!E.withCredentials,E.responseType&&(this.responseType=E.responseType),E.headers&&(this.headers=E.headers),E.context&&(this.context=E.context),E.params&&(this.params=E.params)),this.headers||(this.headers=new fi),this.context||(this.context=new ne),this.params){const V=this.params.toString();if(0===V.length)this.urlWithParams=h;else{const j=h.indexOf("?");this.urlWithParams=h+(-1===j?"?":j<h.length-1?"&":"")+V}}else this.params=new Z,this.urlWithParams=h}serializeBody(){return null===this.body?null:ie(this.body)||Ie(this.body)||we(this.body)||function Ue(b){return"undefined"!=typeof URLSearchParams&&b instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Z?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||we(this.body)?null:Ie(this.body)?this.body.type||null:ie(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Z?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(u={}){var h;const m=u.method||this.method,v=u.url||this.url,E=u.responseType||this.responseType,V=void 0!==u.body?u.body:this.body,j=void 0!==u.withCredentials?u.withCredentials:this.withCredentials,q=void 0!==u.reportProgress?u.reportProgress:this.reportProgress;let de=u.headers||this.headers,be=u.params||this.params;const ge=null!==(h=u.context)&&void 0!==h?h:this.context;return void 0!==u.setHeaders&&(de=Object.keys(u.setHeaders).reduce(($e,Ge)=>$e.set(Ge,u.setHeaders[Ge]),de)),u.setParams&&(be=Object.keys(u.setParams).reduce(($e,Ge)=>$e.set(Ge,u.setParams[Ge]),be)),new Fe(m,v,V,{params:be,headers:de,context:ge,reportProgress:q,responseType:E,withCredentials:j})}}var Q=(()=>((Q=Q||{})[Q.Sent=0]="Sent",Q[Q.UploadProgress=1]="UploadProgress",Q[Q.ResponseHeader=2]="ResponseHeader",Q[Q.DownloadProgress=3]="DownloadProgress",Q[Q.Response=4]="Response",Q[Q.User=5]="User",Q))();class Ve{constructor(u,h=200,m="OK"){this.headers=u.headers||new fi,this.status=void 0!==u.status?u.status:h,this.statusText=u.statusText||m,this.url=u.url||null,this.ok=this.status>=200&&this.status<300}}class st extends Ve{constructor(u={}){super(u),this.type=Q.ResponseHeader}clone(u={}){return new st({headers:u.headers||this.headers,status:void 0!==u.status?u.status:this.status,statusText:u.statusText||this.statusText,url:u.url||this.url||void 0})}}class kt extends Ve{constructor(u={}){super(u),this.type=Q.Response,this.body=void 0!==u.body?u.body:null}clone(u={}){return new kt({body:void 0!==u.body?u.body:this.body,headers:u.headers||this.headers,status:void 0!==u.status?u.status:this.status,statusText:u.statusText||this.statusText,url:u.url||this.url||void 0})}}class Kt extends Ve{constructor(u){super(u,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${u.url||"(unknown url)"}`:`Http failure response for ${u.url||"(unknown url)"}: ${u.status} ${u.statusText}`,this.error=u.error||null}}function an(b,u){return{body:u,headers:b.headers,context:b.context,observe:b.observe,params:b.params,reportProgress:b.reportProgress,responseType:b.responseType,withCredentials:b.withCredentials}}let jt=(()=>{class b{constructor(h){this.handler=h}request(h,m,v={}){let E;if(h instanceof Fe)E=h;else{let q,de;q=v.headers instanceof fi?v.headers:new fi(v.headers),v.params&&(de=v.params instanceof Z?v.params:new Z({fromObject:v.params})),E=new Fe(h,m,void 0!==v.body?v.body:null,{headers:q,context:v.context,params:de,reportProgress:v.reportProgress,responseType:v.responseType||"json",withCredentials:v.withCredentials})}const V=(0,ar.of)(E).pipe((0,Ts.b)(q=>this.handler.handle(q)));if(h instanceof Fe||"events"===v.observe)return V;const j=V.pipe((0,Zs.h)(q=>q instanceof kt));switch(v.observe||"body"){case"body":switch(E.responseType){case"arraybuffer":return j.pipe((0,Mr.U)(q=>{if(null!==q.body&&!(q.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return q.body}));case"blob":return j.pipe((0,Mr.U)(q=>{if(null!==q.body&&!(q.body instanceof Blob))throw new Error("Response is not a Blob.");return q.body}));case"text":return j.pipe((0,Mr.U)(q=>{if(null!==q.body&&"string"!=typeof q.body)throw new Error("Response is not a string.");return q.body}));default:return j.pipe((0,Mr.U)(q=>q.body))}case"response":return j;default:throw new Error(`Unreachable: unhandled observe type ${v.observe}}`)}}delete(h,m={}){return this.request("DELETE",h,m)}get(h,m={}){return this.request("GET",h,m)}head(h,m={}){return this.request("HEAD",h,m)}jsonp(h,m){return this.request("JSONP",h,{params:(new Z).append(m,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(h,m={}){return this.request("OPTIONS",h,m)}patch(h,m,v={}){return this.request("PATCH",h,an(v,m))}post(h,m,v={}){return this.request("POST",h,an(v,m))}put(h,m,v={}){return this.request("PUT",h,an(v,m))}}return b.\u0275fac=function(h){return new(h||b)(F.LFG(Bn))},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})();class jn{constructor(u,h){this.next=u,this.interceptor=h}handle(u){return this.interceptor.intercept(u,this.next)}}const Oe=new F.OlP("HTTP_INTERCEPTORS");let Ae=(()=>{class b{intercept(h,m){return m.handle(h)}}return b.\u0275fac=function(h){return new(h||b)},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})();const Yr=/^\)\]\}',?\n/;let Pr=(()=>{class b{constructor(h){this.xhrFactory=h}handle(h){if("JSONP"===h.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new ts.y(m=>{const v=this.xhrFactory.build();if(v.open(h.method,h.urlWithParams),h.withCredentials&&(v.withCredentials=!0),h.headers.forEach((Ge,wt)=>v.setRequestHeader(Ge,wt.join(","))),h.headers.has("Accept")||v.setRequestHeader("Accept","application/json, text/plain, */*"),!h.headers.has("Content-Type")){const Ge=h.detectContentTypeHeader();null!==Ge&&v.setRequestHeader("Content-Type",Ge)}if(h.responseType){const Ge=h.responseType.toLowerCase();v.responseType="json"!==Ge?Ge:"text"}const E=h.serializeBody();let V=null;const j=()=>{if(null!==V)return V;const Ge=v.statusText||"OK",wt=new fi(v.getAllResponseHeaders()),It=function Gi(b){return"responseURL"in b&&b.responseURL?b.responseURL:/^X-Request-URL:/m.test(b.getAllResponseHeaders())?b.getResponseHeader("X-Request-URL"):null}(v)||h.url;return V=new st({headers:wt,status:v.status,statusText:Ge,url:It}),V},q=()=>{let{headers:Ge,status:wt,statusText:It,url:wn}=j(),Qt=null;204!==wt&&(Qt=void 0===v.response?v.responseText:v.response),0===wt&&(wt=Qt?200:0);let vt=wt>=200&&wt<300;if("json"===h.responseType&&"string"==typeof Qt){const En=Qt;Qt=Qt.replace(Yr,"");try{Qt=""!==Qt?JSON.parse(Qt):null}catch(ni){Qt=En,vt&&(vt=!1,Qt={error:ni,text:Qt})}}vt?(m.next(new kt({body:Qt,headers:Ge,status:wt,statusText:It,url:wn||void 0})),m.complete()):m.error(new Kt({error:Qt,headers:Ge,status:wt,statusText:It,url:wn||void 0}))},de=Ge=>{const{url:wt}=j(),It=new Kt({error:Ge,status:v.status||0,statusText:v.statusText||"Unknown Error",url:wt||void 0});m.error(It)};let be=!1;const ge=Ge=>{be||(m.next(j()),be=!0);let wt={type:Q.DownloadProgress,loaded:Ge.loaded};Ge.lengthComputable&&(wt.total=Ge.total),"text"===h.responseType&&!!v.responseText&&(wt.partialText=v.responseText),m.next(wt)},$e=Ge=>{let wt={type:Q.UploadProgress,loaded:Ge.loaded};Ge.lengthComputable&&(wt.total=Ge.total),m.next(wt)};return v.addEventListener("load",q),v.addEventListener("error",de),v.addEventListener("timeout",de),v.addEventListener("abort",de),h.reportProgress&&(v.addEventListener("progress",ge),null!==E&&v.upload&&v.upload.addEventListener("progress",$e)),v.send(E),m.next({type:Q.Sent}),()=>{v.removeEventListener("error",de),v.removeEventListener("abort",de),v.removeEventListener("load",q),v.removeEventListener("timeout",de),h.reportProgress&&(v.removeEventListener("progress",ge),null!==E&&v.upload&&v.upload.removeEventListener("progress",$e)),v.readyState!==v.DONE&&v.abort()}})}}return b.\u0275fac=function(h){return new(h||b)(F.LFG(N.JF))},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})();const br=new F.OlP("XSRF_COOKIE_NAME"),Qr=new F.OlP("XSRF_HEADER_NAME");class oo{}let ao=(()=>{class b{constructor(h,m,v){this.doc=h,this.platform=m,this.cookieName=v,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const h=this.doc.cookie||"";return h!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,N.Mx)(h,this.cookieName),this.lastCookieString=h),this.lastToken}}return b.\u0275fac=function(h){return new(h||b)(F.LFG(N.K0),F.LFG(F.Lbi),F.LFG(br))},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})(),ns=(()=>{class b{constructor(h,m){this.tokenService=h,this.headerName=m}intercept(h,m){const v=h.url.toLowerCase();if("GET"===h.method||"HEAD"===h.method||v.startsWith("http://")||v.startsWith("https://"))return m.handle(h);const E=this.tokenService.getToken();return null!==E&&!h.headers.has(this.headerName)&&(h=h.clone({headers:h.headers.set(this.headerName,E)})),m.handle(h)}}return b.\u0275fac=function(h){return new(h||b)(F.LFG(oo),F.LFG(Qr))},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})(),lo=(()=>{class b{constructor(h,m){this.backend=h,this.injector=m,this.chain=null}handle(h){if(null===this.chain){const m=this.injector.get(Oe,[]);this.chain=m.reduceRight((v,E)=>new jn(v,E),this.backend)}return this.chain.handle(h)}}return b.\u0275fac=function(h){return new(h||b)(F.LFG(lr),F.LFG(F.zs3))},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})(),Fs=(()=>{class b{static disable(){return{ngModule:b,providers:[{provide:ns,useClass:Ae}]}}static withOptions(h={}){return{ngModule:b,providers:[h.cookieName?{provide:br,useValue:h.cookieName}:[],h.headerName?{provide:Qr,useValue:h.headerName}:[]]}}}return b.\u0275fac=function(h){return new(h||b)},b.\u0275mod=F.oAB({type:b}),b.\u0275inj=F.cJS({providers:[ns,{provide:Oe,useExisting:ns,multi:!0},{provide:oo,useClass:ao},{provide:br,useValue:"XSRF-TOKEN"},{provide:Qr,useValue:"X-XSRF-TOKEN"}]}),b})(),Er=(()=>{class b{}return b.\u0275fac=function(h){return new(h||b)},b.\u0275mod=F.oAB({type:b}),b.\u0275inj=F.cJS({providers:[jt,{provide:Bn,useClass:lo},Pr,{provide:lr,useExisting:Pr}],imports:[[Fs.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),b})();var Yi=ye(2313);const Hr=["*"];let Ji=(()=>{class b{transform(h,m){return null==h&&(h=""),null==m&&(m=""),"string"!=typeof h?(console.error(`LanguagePipe has been invoked with an invalid value type [${typeof h}]`),h):"string"!=typeof m?(console.error(`LanguagePipe has been invoked with an invalid parameter [${typeof m}]`),h):"```"+m+"\n"+h+"\n```"}}return b.\u0275fac=function(h){return new(h||b)},b.\u0275pipe=F.Yjl({name:"language",type:b,pure:!0}),b})();var as=(()=>{return(b=as||(as={})).CommandLine="command-line",b.LineHighlight="line-highlight",b.LineNumbers="line-numbers",as;var b})();class gr{}const Ns=new F.OlP("SECURITY_CONTEXT");let ls=(()=>{class b{constructor(h,m,v,E,V){this.platform=h,this.securityContext=m,this.http=v,this.sanitizer=V,this.initialMarkedOptions={renderer:new yt},this.options=E}get options(){return this._options}set options(h){this._options=Object.assign(Object.assign({},this.initialMarkedOptions),h)}get renderer(){return this.options.renderer}set renderer(h){this.options.renderer=h}compile(h,m=!1,v=!1,E=this.options){const V=this.trimIndentation(h),j=m?this.decodeHtml(V):V,de=tn(v?this.renderEmoji(j):j,E);return this.sanitizer.sanitize(this.securityContext,de)||""}getSource(h){if(!this.http)throw new Error("[ngx-markdown] When using the `src` attribute you *have to* pass the `HttpClient` as a parameter of the `forRoot` method. See README for more information");return this.http.get(h,{responseType:"text"}).pipe((0,Mr.U)(m=>this.handleExtension(h,m)))}highlight(h){if((0,N.NF)(this.platform)&&"undefined"!=typeof Prism){h||(h=document);const m=h.querySelectorAll('pre code:not([class*="language-"])');Array.prototype.forEach.call(m,v=>v.classList.add("language-none")),Prism.highlightAllUnder(h)}}renderKatex(h,m){if(!(0,N.NF)(this.platform))return h;if("undefined"==typeof katex||void 0===katex.renderToString)throw new Error("[ngx-markdown] When using the `katex` attribute you *have to* include KaTeX files to `angular.json` or use imports. See README for more information");return h.replace(/\$([^\s][^$]*?[^\s])\$/gm,(v,E)=>katex.renderToString(E,m))}decodeHtml(h){if(!(0,N.NF)(this.platform))return h;const m=document.createElement("textarea");return m.innerHTML=h,m.value}handleExtension(h,m){const v=h?h.split("?")[0].split(".").splice(-1).join():"";return"md"!==v?"```"+v+"\n"+m+"\n```":m}renderEmoji(h){if(!(0,N.NF)(this.platform))return h;if("undefined"==typeof joypixels||void 0===joypixels.shortnameToUnicode)throw new Error("[ngx-markdown] When using the `emoji` attribute you *have to* include Emoji-Toolkit files to `angular.json` or use imports. See README for more information");return joypixels.shortnameToUnicode(h)}trimIndentation(h){if(!h)return"";let m;return h.split("\n").map(v=>{let E=m;return v.length>0&&(E=isNaN(E)?v.search(/\S|$/):Math.min(v.search(/\S|$/),E)),isNaN(m)&&(m=E),E?v.substring(E):v}).join("\n")}}return b.\u0275fac=function(h){return new(h||b)(F.LFG(F.Lbi),F.LFG(Ns),F.LFG(jt,8),F.LFG(gr,8),F.LFG(Yi.H7))},b.\u0275prov=F.Yz7({token:b,factory:b.\u0275fac}),b})(),bo=(()=>{class b{constructor(h,m){this.element=h,this.markdownService=m,this.error=new F.vpe,this.load=new F.vpe,this.ready=new F.vpe,this._commandLine=!1,this._emoji=!1,this._katex=!1,this._lineHighlight=!1,this._lineNumbers=!1}get emoji(){return this._emoji}set emoji(h){this._emoji=this.coerceBooleanProperty(h)}get katex(){return this._katex}set katex(h){this._katex=this.coerceBooleanProperty(h)}get lineHighlight(){return this._lineHighlight}set lineHighlight(h){this._lineHighlight=this.coerceBooleanProperty(h)}get lineNumbers(){return this._lineNumbers}set lineNumbers(h){this._lineNumbers=this.coerceBooleanProperty(h)}get commandLine(){return this._commandLine}set commandLine(h){this._commandLine=this.coerceBooleanProperty(h)}ngOnChanges(){null==this.data?null==this.src||this.handleSrc():this.handleData()}ngAfterViewInit(){!this.data&&!this.src&&this.handleTransclusion()}render(h,m=!1){let v=this.markdownService.compile(h,m,this.emoji);v=this.katex?this.markdownService.renderKatex(v,this.katexOptions):v,this.element.nativeElement.innerHTML=v,this.handlePlugins(),this.markdownService.highlight(this.element.nativeElement),this.ready.emit()}coerceBooleanProperty(h){return null!=h&&"false"!=`${String(h)}`}handleData(){this.render(this.data)}handleSrc(){this.markdownService.getSource(this.src).subscribe(h=>{this.render(h),this.load.emit(h)},h=>this.error.emit(h))}handleTransclusion(){this.render(this.element.nativeElement.innerHTML,!0)}handlePlugins(){this.commandLine&&(this.setPluginClass(this.element.nativeElement,as.CommandLine),this.setPluginOptions(this.element.nativeElement,{dataFilterOutput:this.filterOutput,dataHost:this.host,dataPrompt:this.prompt,dataOutput:this.output,dataUser:this.user})),this.lineHighlight&&this.setPluginOptions(this.element.nativeElement,{dataLine:this.line,dataLineOffset:this.lineOffset}),this.lineNumbers&&(this.setPluginClass(this.element.nativeElement,as.LineNumbers),this.setPluginOptions(this.element.nativeElement,{dataStart:this.start}))}setPluginClass(h,m){const v=h.querySelectorAll("pre");for(let E=0;E<v.length;E++){const V=m instanceof Array?m:[m];v.item(E).classList.add(...V)}}setPluginOptions(h,m){const v=h.querySelectorAll("pre");for(let E=0;E<v.length;E++)Object.keys(m).forEach(V=>{const j=m[V];if(j){const q=this.toLispCase(V);v.item(E).setAttribute(q,j.toString())}})}toLispCase(h){const m=h.match(/([A-Z])/g);if(!m)return h;let v=h.toString();for(let E=0,V=m.length;E<V;E++)v=v.replace(new RegExp(m[E]),"-"+m[E].toLowerCase());return"-"===v.slice(0,1)&&(v=v.slice(1)),v}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(F.SBq),F.Y36(ls))},b.\u0275cmp=F.Xpm({type:b,selectors:[["markdown"],["","markdown",""]],inputs:{data:"data",src:"src",emoji:"emoji",katex:"katex",katexOptions:"katexOptions",lineHighlight:"lineHighlight",line:"line",lineOffset:"lineOffset",lineNumbers:"lineNumbers",start:"start",commandLine:"commandLine",filterOutput:"filterOutput",host:"host",prompt:"prompt",output:"output",user:"user"},outputs:{error:"error",load:"load",ready:"ready"},features:[F.TTD],ngContentSelectors:Hr,decls:1,vars:0,template:function(h,m){1&h&&(F.F$t(),F.Hsn(0))},encapsulation:2}),b})(),No=(()=>{class b{static forRoot(h){return{ngModule:b,providers:[ls,h&&h.loader||[],h&&h.markedOptions||[],{provide:Ns,useValue:h&&null!=h.sanitize?h.sanitize:F.q3G.HTML}]}}static forChild(){return{ngModule:b}}}return b.\u0275fac=function(h){return new(h||b)},b.\u0275mod=F.oAB({type:b}),b.\u0275inj=F.cJS({}),b})();var ko=ye(6324);let cs=(()=>{class b{constructor(){}ngOnInit(){}}return b.\u0275fac=function(h){return new(h||b)},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-shader"]],decls:1,vars:0,template:function(h,m){1&h&&F._UZ(0,"router-outlet")},directives:[ko.lC],styles:[""]}),b})();var _e=ye(6682);let Uo=(()=>{class b{constructor(h){this.markdownService=h,this.title="star",this.domWidth=window.innerWidth-20,this.domHeight=window.innerHeight-20,this.vertexShader="\n        //vertexShader\n        varying vec2 vUv;\n        uniform float uTime;\n        void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          vUv = uv;\n        }",this.fragmentShader="\n        //fragmentShader\n        #define PI 3.1415926535897932384626433832795\n        varying vec2 vUv;\n        vec2 rotate(vec2 uv, float rotation, vec2 mid) {\n          return vec2(\n            cos(rotation) * (uv.x - mid.x) + sin(rotation) * (uv.y - mid.y) + mid.x,\n            cos(rotation) * (uv.y - mid.y) - sin(rotation) * (uv.x - mid.x) + mid.y\n          );\n        }\n        uniform float uTime;\n        void main() {\n            vec2 rotatedUv = rotate(vUv, PI*0.25, vec2(0.5));\n            float animation = mix(0.001, 0.01, (sin(uTime) + 1.0) * 0.5);\n            float strength = animation / distance(vec2(rotatedUv.x,(rotatedUv.y - 0.5)*5.0 + 0.5), vec2(0.5));\n            strength *= animation / distance(vec2(rotatedUv.y,(rotatedUv.x - 0.5)*5.0 + 0.5), vec2(0.5));\n            vec3 adjustedColor = vec3(0.5, 0.7, 0.9);\n            gl_FragColor = vec4(vec3(adjustedColor * strength ), 1.0);\n        }",this.myValue="print('hello-world')"}ngOnInit(){this.init(),console.log(this.markdownService.compile("I am using __markdown__."))}init(){var h;const m=new _e.cPb(70,this.domWidth/this.domHeight,.01,10);m.position.z=1;const v=new _e.xsS,E=new _e._12(6,6,1),V=new _e.jyz({uniforms:{uOpacity:{value:50},uTime:{value:.1}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,side:_e.ehD}),j=new _e.Kj0(E,V);v.add(j);const q=new _e.CP7({antialias:!0});q.setClearColor(new _e.Ilk(16777215)),q.setSize(this.domWidth,this.domHeight),q.setAnimationLoop(function be(ge){V.uniforms.uTime.value+=.02,q.render(v,m)}),null===(h=document.getElementById("star-container"))||void 0===h||h.appendChild(q.domElement)}onLoad(){}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(ls))},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-star"]],decls:8,vars:8,consts:[[1,"flex-box"],["id","star-container"],[1,"terminal"],[2,"overflow","auto"],[3,"data"]],template:function(h,m){1&h&&(F.TgZ(0,"div",0),F._UZ(1,"div",1),F.qZA(),F.TgZ(2,"div",2)(3,"div",3),F._UZ(4,"markdown",4),F.ALo(5,"language"),F._UZ(6,"markdown",4),F.ALo(7,"language"),F.qZA()()),2&h&&(F.xp6(4),F.Q6J("data",F.xi3(5,2,m.vertexShader,"c")),F.xp6(2),F.Q6J("data",F.xi3(7,5,m.fragmentShader,"c")))},directives:[bo],pipes:[Ji],styles:[""]}),b})();var Cs=ye(2810);let Ds=(()=>{class b{constructor(h){this.threeService=h,this.vertexShader="\n                          //vertexShader\n                          precision lowp float;\n                          varying vec2 vUv;\n                          varying vec3 vPosition;\n                          uniform float uTime;\n                          varying vec3 vNormal;\n                          void main() {\n                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                            vUv = uv;\n                            vPosition = position;\n                            vNormal = normalize(normalMatrix * normal);\n                        }",this.fragmentShader="\n                        //fragmentShader\n                        precision lowp float;\n                        uniform vec3 scanColor;\n                        varying vec2 vUv;\n                        uniform float uTime;\n                        uniform vec3 uSize;\n                        varying vec3 vPosition;\n                        varying vec3 vNormal;\n                        void main() {\n                          \n                          float y = (vPosition.y / uSize.y) + 0.5;\n                          float color = sin(-vUv.y + uTime * 0.3);\n                          color = mod(color, 1.0);\n                          color = step(0.02, color);\n                          if(y < 0.01 || y > 0.99) \n                          color = 1.0;\n                          float alpha = 1.0 - sin(vUv.y) * 0.7;\n\n                          vec3 lightDirection = normalize(vec3(0.9, 1.0, 0.8)); // \u5149\u6e90\u65b9\u5411\n                          float lightIntensity = max(dot(vNormal, lightDirection), 0.0); // \u5149\u7167\u5f3a\u5ea6\n                          vec3 lightColor = vec3(1.0, 1.0, 1.0); // \u5149\u6e90\u989c\u8272\n\n                          vec3 finalColor = vec3(color, 1.0, color) * lightColor * lightIntensity;\n                          gl_FragColor = vec4(finalColor, alpha);\n                          \n                        }\n                      "}ngOnInit(){const{scene:h,camera:m,renderer:v,orbit_controls:E,clock:V}=this.threeService.init();this.scene=h,this.camera=m,this.renderer=v,this.orbit_controls=E,this.clock=V,this.updaetScene(),this.renderer.render(this.scene,this.camera),this.orbit_controls.update()}updaetScene(){var h;const m=new _e.y8_(30);this.scene.add(m);const v=new _e._12(5,5),E=new _e.YBo({color:16777215,side:_e.ehD}),V=new _e.Kj0(v,E);V.rotation.x=-.5*Math.PI,V.position.set(0,0,0),V.receiveShadow=!0;for(let de=0;de<18;de++){const ge=Number(1*Math.random()).toFixed(2),$e=new _e.DvJ(1*Math.random(),Number(ge),1*Math.random());$e.computeBoundingBox();const{max:Ge,min:wt}=$e.boundingBox,It=new _e.Pa4(Ge.x-wt.x,Ge.y-wt.y,Ge.z-wt.z),wn=new _e.jyz({uniforms:{uOpacity:{value:50},uTime:{value:.1},uSize:{value:It},scanColor:{value:new _e.Ilk(65280)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),Qt=new _e.Kj0($e,wn);Qt.position.set(2*Math.random(),Number(ge)/2,2*Math.random()),Qt.castShadow=!0,Qt.name="box",this.scene.add(Qt)}const j=new _e.Ox3(16777215),q=new _e.cBI(j,.2);j.position.set(-3,2,-1),j.target=V,j.castShadow=!0,this.renderer.shadowMap.enabled=!0,this.scene.add(V,j,q),null===(h=document.getElementById("cube-container"))||void 0===h||h.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(this.animation.bind(this))}animation(){this.scene.traverse(function(h){"box"===h.name&&(h.material.uniforms.uTime.value+=.02)}),this.renderer.render(this.scene,this.camera)}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(Cs.d))},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-cube"]],decls:8,vars:8,consts:[[1,"flex-box"],["id","cube-container"],[1,"terminal"],[2,"overflow","auto"],[3,"data"]],template:function(h,m){1&h&&(F.TgZ(0,"div",0),F._UZ(1,"div",1),F.qZA(),F.TgZ(2,"div",2)(3,"div",3),F._UZ(4,"markdown",4),F.ALo(5,"language"),F._UZ(6,"markdown",4),F.ALo(7,"language"),F.qZA()()),2&h&&(F.xp6(4),F.Q6J("data",F.xi3(5,2,m.vertexShader,"c")),F.xp6(2),F.Q6J("data",F.xi3(7,5,m.fragmentShader,"c")))},directives:[bo],pipes:[Ji],styles:[""]}),b})();var Ms=function(b){return URL.createObjectURL(new Blob([b],{type:"text/javascript"}))};try{URL.revokeObjectURL(Ms(""))}catch(b){Ms=function(u){return"data:application/javascript;charset=UTF-8,"+encodeURI(u)}}var Oi=Uint8Array,is=Uint16Array,wo=Uint32Array,Eo=new Oi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),So=new Oi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ks=new Oi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),al=function(b,u){for(var h=new is(31),m=0;m<31;++m)h[m]=u+=1<<b[m-1];var v=new wo(h[30]);for(m=1;m<30;++m)for(var E=h[m];E<h[m+1];++E)v[E]=E-h[m]<<5|m;return[h,v]},ll=al(Eo,2),Js=ll[0],Ua=ll[1];Js[28]=258,Ua[258]=28;for(var Ai=al(So,0)[0],Ko=new is(32768),yr=0;yr<32768;++yr){var Qs=(43690&yr)>>>1|(21845&yr)<<1;Ko[yr]=((65280&(Qs=(61680&(Qs=(52428&Qs)>>>2|(13107&Qs)<<2))>>>4|(3855&Qs)<<4))>>>8|(255&Qs)<<8)>>>1}var Ao=function(b,u,h){for(var m=b.length,v=0,E=new is(u);v<m;++v)++E[b[v]-1];var j,V=new is(u);for(v=0;v<u;++v)V[v]=V[v-1]+E[v-1]<<1;if(h){j=new is(1<<u);var q=15-u;for(v=0;v<m;++v)if(b[v])for(var de=v<<4|b[v],be=u-b[v],ge=V[b[v]-1]++<<be,$e=ge|(1<<be)-1;ge<=$e;++ge)j[Ko[ge]>>>q]=de}else for(j=new is(m),v=0;v<m;++v)b[v]&&(j[v]=Ko[V[b[v]-1]++]>>>15-b[v]);return j},Jo=new Oi(288);for(yr=0;yr<144;++yr)Jo[yr]=8;for(yr=144;yr<256;++yr)Jo[yr]=9;for(yr=256;yr<280;++yr)Jo[yr]=7;for(yr=280;yr<288;++yr)Jo[yr]=8;var Qo=new Oi(32);for(yr=0;yr<32;++yr)Qo[yr]=5;var Ba=Ao(Jo,9,1),cl=Ao(Qo,5,1),Bs=function(b){for(var u=b[0],h=1;h<b.length;++h)b[h]>u&&(u=b[h]);return u},rs=function(b,u,h){var m=u/8|0;return(b[m]|b[m+1]<<8)>>(7&u)&h},eo=function(b,u){var h=u/8|0;return(b[h]|b[h+1]<<8|b[h+2]<<16)>>(7&u)},ca=function(b){return(b/8|0)+(7&b&&1)},Va=function(b,u,h){var m=b.length;if(!m||h&&!h.l&&m<5)return u||new Oi(0);var v=!u||h,E=!h||h.i;h||(h={}),u||(u=new Oi(3*m));var V=function(Dc){var La=u.length;if(Dc>La){var sa=new Oi(Math.max(2*La,Dc));sa.set(u),u=sa}},j=h.f||0,q=h.p||0,de=h.b||0,be=h.l,ge=h.d,$e=h.m,Ge=h.n,wt=8*m;do{if(!be){h.f=j=rs(b,q,1);var It=rs(b,q+1,3);if(q+=3,!It){var Qt=b[(wn=ca(q)+4)-4]|b[wn-3]<<8,vt=wn+Qt;if(vt>m){if(E)throw"unexpected EOF";break}v&&V(de+Qt),u.set(b.subarray(wn,vt),de),h.b=de+=Qt,h.p=q=8*vt;continue}if(1==It)be=Ba,ge=cl,$e=9,Ge=5;else{if(2!=It)throw"invalid block type";var En=rs(b,q,31)+257,ni=rs(b,q+10,15)+4,Qn=En+rs(b,q+5,31)+1;q+=14;for(var si=new Oi(Qn),oi=new Oi(19),Dn=0;Dn<ni;++Dn)oi[ks[Dn]]=rs(b,q+3*Dn,7);q+=3*ni;var Cr=Bs(oi),ui=(1<<Cr)-1,hi=Ao(oi,Cr,1);for(Dn=0;Dn<Qn;){var wn,jr=hi[rs(b,q,ui)];if(q+=15&jr,(wn=jr>>>4)<16)si[Dn++]=wn;else{var mr=0,Dr=0;for(16==wn?(Dr=3+rs(b,q,3),q+=2,mr=si[Dn-1]):17==wn?(Dr=3+rs(b,q,7),q+=3):18==wn&&(Dr=11+rs(b,q,127),q+=7);Dr--;)si[Dn++]=mr}}var ds=si.subarray(0,En),Fr=si.subarray(En);$e=Bs(ds),Ge=Bs(Fr),be=Ao(ds,$e,1),ge=Ao(Fr,Ge,1)}if(q>wt){if(E)throw"unexpected EOF";break}}v&&V(de+131072);for(var Zr=(1<<$e)-1,Ps=(1<<Ge)-1,vo=q;;vo=q){var Xo=(mr=be[eo(b,q)&Zr])>>>4;if((q+=15&mr)>wt){if(E)throw"unexpected EOF";break}if(!mr)throw"invalid length/literal";if(Xo<256)u[de++]=Xo;else{if(256==Xo){vo=q,be=null;break}var ms=Xo-254;Xo>264&&(ms=rs(b,q,(1<<(Po=Eo[Dn=Xo-257]))-1)+Js[Dn],q+=Po);var ra=ge[eo(b,q)&Ps],_r=ra>>>4;if(!ra)throw"invalid distance";if(q+=15&ra,Fr=Ai[_r],_r>3){var Po=So[_r];Fr+=eo(b,q)&(1<<Po)-1,q+=Po}if(q>wt){if(E)throw"unexpected EOF";break}v&&V(de+131072);for(var Hs=de+ms;de<Hs;de+=4)u[de]=u[de-Fr],u[de+1]=u[de+1-Fr],u[de+2]=u[de+2-Fr],u[de+3]=u[de+3-Fr];de=Hs}}h.l=be,h.p=vo,h.b=de,be&&(j=1,h.m=$e,h.d=ge,h.n=Ge)}while(!j);return de==u.length?u:function(b,u,h){(null==u||u<0)&&(u=0),(null==h||h>b.length)&&(h=b.length);var m=new(b instanceof is?is:b instanceof wo?wo:Oi)(h-u);return m.set(b.subarray(u,h)),m}(u,0,de)},H=new Oi(0);var ta="undefined"!=typeof TextDecoder&&new TextDecoder;try{ta.decode(H,{stream:!0})}catch(b){}function na(b,u,h){const m=h.length-b-1;if(u>=h[m])return m-1;if(u<=h[b])return b;let v=b,E=m,V=Math.floor((v+E)/2);for(;u<h[V]||u>=h[V+1];)u<h[V]?E=V:v=V,V=Math.floor((v+E)/2);return V}function Lh(b,u){let h=1;for(let v=2;v<=b;++v)h*=v;let m=1;for(let v=2;v<=u;++v)m*=v;for(let v=2;v<=b-u;++v)m*=v;return h/m}class Ro extends _e.Hyl{constructor(u,h,m,v,E){super(),this.degree=u,this.knots=h,this.controlPoints=[],this.startKnot=v||0,this.endKnot=E||this.knots.length-1;for(let V=0;V<m.length;++V){const j=m[V];this.controlPoints[V]=new _e.Ltg(j.x,j.y,j.z,j.w)}}getPoint(u,h=new _e.Pa4){const m=h,E=function Nl(b,u,h,m){const v=na(b,m,u),E=function po(b,u,h,m){const v=[],E=[],V=[];v[0]=1;for(let j=1;j<=h;++j){E[j]=u-m[b+1-j],V[j]=m[b+j]-u;let q=0;for(let de=0;de<j;++de){const be=V[de+1],ge=E[j-de],$e=v[de]/(be+ge);v[de]=q+be*$e,q=ge*$e}v[j]=q}return v}(v,m,b,u),V=new _e.Ltg(0,0,0,0);for(let j=0;j<=b;++j){const q=h[v-b+j],de=E[j],be=q.w*de;V.x+=q.x*be,V.y+=q.y*be,V.z+=q.z*be,V.w+=q.w*de}return V}(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+u*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!==E.w&&E.divideScalar(E.w),m.set(E.x,E.y,E.z)}getTangent(u,h=new _e.Pa4){const m=h,E=function ac(b,u,h,m,v){const E=function pu(b,u,h,m,v){const E=v<b?v:b,V=[],j=na(b,m,u),q=function Ga(b,u,h,m,v){const E=[];for(let ge=0;ge<=h;++ge)E[ge]=0;const V=[];for(let ge=0;ge<=m;++ge)V[ge]=E.slice(0);const j=[];for(let ge=0;ge<=h;++ge)j[ge]=E.slice(0);j[0][0]=1;const q=E.slice(0),de=E.slice(0);for(let ge=1;ge<=h;++ge){q[ge]=u-v[b+1-ge],de[ge]=v[b+ge]-u;let $e=0;for(let Ge=0;Ge<ge;++Ge){const wt=de[Ge+1],It=q[ge-Ge];j[ge][Ge]=wt+It;const wn=j[Ge][ge-1]/j[ge][Ge];j[Ge][ge]=$e+wt*wn,$e=It*wn}j[ge][ge]=$e}for(let ge=0;ge<=h;++ge)V[0][ge]=j[ge][h];for(let ge=0;ge<=h;++ge){let $e=0,Ge=1;const wt=[];for(let It=0;It<=h;++It)wt[It]=E.slice(0);wt[0][0]=1;for(let It=1;It<=m;++It){let wn=0;const Qt=ge-It,vt=h-It;ge>=It&&(wt[Ge][0]=wt[$e][0]/j[vt+1][Qt],wn=wt[Ge][0]*j[Qt][vt]);const ni=ge-1<=vt?It-1:h-ge;for(let si=Qt>=-1?1:-Qt;si<=ni;++si)wt[Ge][si]=(wt[$e][si]-wt[$e][si-1])/j[vt+1][Qt+si],wn+=wt[Ge][si]*j[Qt+si][vt];ge<=vt&&(wt[Ge][It]=-wt[$e][It-1]/j[vt+1][ge],wn+=wt[Ge][It]*j[ge][vt]),V[It][ge]=wn;const Qn=$e;$e=Ge,Ge=Qn}}let be=h;for(let ge=1;ge<=m;++ge){for(let $e=0;$e<=h;++$e)V[ge][$e]*=be;be*=h-ge}return V}(j,m,b,E,u),de=[];for(let be=0;be<h.length;++be){const ge=h[be].clone(),$e=ge.w;ge.x*=$e,ge.y*=$e,ge.z*=$e,de[be]=ge}for(let be=0;be<=E;++be){const ge=de[j-b].clone().multiplyScalar(q[be][0]);for(let $e=1;$e<=b;++$e)ge.add(de[j-b+$e].clone().multiplyScalar(q[be][$e]));V[be]=ge}for(let be=E+1;be<=v+1;++be)V[be]=new _e.Ltg(0,0,0);return V}(b,u,h,m,v);return function Ia(b){const u=b.length,h=[],m=[];for(let E=0;E<u;++E){const V=b[E];h[E]=new _e.Pa4(V.x,V.y,V.z),m[E]=V.w}const v=[];for(let E=0;E<u;++E){const V=h[E].clone();for(let j=1;j<=E;++j)V.sub(v[E-j].clone().multiplyScalar(Lh(E,j)*m[j]));v[E]=V.divideScalar(m[0])}return v}(E)}(this.degree,this.knots,this.controlPoints,this.knots[0]+u*(this.knots[this.knots.length-1]-this.knots[0]),1);return m.copy(E[1]).normalize(),m}}let Hi,Br,Or;class kl extends _e.aNw{constructor(u){super(u)}load(u,h,m,v){const E=this,V=""===E.path?_e.Zp0.extractUrlBase(u):E.path,j=new _e.hH6(this.manager);j.setPath(E.path),j.setResponseType("arraybuffer"),j.setRequestHeader(E.requestHeader),j.setWithCredentials(E.withCredentials),j.load(u,function(q){try{h(E.parse(q,V))}catch(de){v?v(de):console.error(de),E.manager.itemError(u)}},m,v)}parse(u,h){if(function M(b){const u="Kaydara FBX Binary  \0";return b.byteLength>=u.length&&u===Wi(b,0,u.length)}(u))Hi=(new ml).parse(u);else{const v=Wi(u);if(!function O(b){const u=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let h=0;function m(v){const E=b[v-1];return b=b.slice(h+v),h++,E}for(let v=0;v<u.length;++v)if(m(1)===u[v])return!1;return!0}(v))throw new Error("THREE.FBXLoader: Unknown format.");if(W(v)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+W(v));Hi=(new Fi).parse(v)}const m=new _e.dpR(this.manager).setPath(this.resourcePath||h).setCrossOrigin(this.crossOrigin);return new va(m,this.manager).parse(Hi)}}class va{constructor(u,h){this.textureLoader=u,this.manager=h}parse(){Br=this.parseConnections();const u=this.parseImages(),h=this.parseTextures(u),m=this.parseMaterials(h),v=this.parseDeformers(),E=(new Ul).parse(v);return this.parseScene(v,E,m),Or}parseConnections(){const u=new Map;return"Connections"in Hi&&Hi.Connections.connections.forEach(function(m){const v=m[0],E=m[1],V=m[2];u.has(v)||u.set(v,{parents:[],children:[]});const j={ID:E,relationship:V};u.get(v).parents.push(j),u.has(E)||u.set(E,{parents:[],children:[]});const q={ID:v,relationship:V};u.get(E).children.push(q)}),u}parseImages(){const u={},h={};if("Video"in Hi.Objects){const m=Hi.Objects.Video;for(const v in m){const E=m[v];if(u[parseInt(v)]=E.RelativeFilename||E.Filename,"Content"in E){const j=E.Content instanceof ArrayBuffer&&E.Content.byteLength>0,q="string"==typeof E.Content&&""!==E.Content;if(j||q){const de=this.parseImage(m[v]);h[E.RelativeFilename||E.Filename]=de}}}}for(const m in u){const v=u[m];u[m]=void 0!==h[v]?h[v]:u[m].split("\\").pop()}return u}parseImage(u){const h=u.Content,m=u.RelativeFilename||u.Filename,v=m.slice(m.lastIndexOf(".")+1).toLowerCase();let E;switch(v){case"bmp":E="image/bmp";break;case"jpg":case"jpeg":E="image/jpeg";break;case"png":E="image/png";break;case"tif":E="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",m),E="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+v+'" is not supported.')}if("string"==typeof h)return"data:"+E+";base64,"+h;{const V=new Uint8Array(h);return window.URL.createObjectURL(new Blob([V],{type:E}))}}parseTextures(u){const h=new Map;if("Texture"in Hi.Objects){const m=Hi.Objects.Texture;for(const v in m){const E=this.parseTexture(m[v],u);h.set(parseInt(v),E)}}return h}parseTexture(u,h){const m=this.loadTexture(u,h);m.ID=u.id,m.name=u.attrName;const v=u.WrapModeU,E=u.WrapModeV,j=void 0!==E?E.value:0;if(m.wrapS=0===(void 0!==v?v.value:0)?_e.rpg:_e.uWy,m.wrapT=0===j?_e.rpg:_e.uWy,"Scaling"in u){const q=u.Scaling.value;m.repeat.x=q[0],m.repeat.y=q[1]}if("Translation"in u){const q=u.Translation.value;m.offset.x=q[0],m.offset.y=q[1]}return m}loadTexture(u,h){let m;const v=this.textureLoader.path,E=Br.get(u.id).children;let V;void 0!==E&&E.length>0&&void 0!==h[E[0].ID]&&(m=h[E[0].ID],(0===m.indexOf("blob:")||0===m.indexOf("data:"))&&this.textureLoader.setPath(void 0));const j=u.FileName.slice(-3).toLowerCase();if("tga"===j){const q=this.manager.getHandler(".tga");null===q?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",u.RelativeFilename),V=new _e.xEZ):(q.setPath(this.textureLoader.path),V=q.load(m))}else"psd"===j?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",u.RelativeFilename),V=new _e.xEZ):V=this.textureLoader.load(m);return this.textureLoader.setPath(v),V}parseMaterials(u){const h=new Map;if("Material"in Hi.Objects){const m=Hi.Objects.Material;for(const v in m){const E=this.parseMaterial(m[v],u);null!==E&&h.set(parseInt(v),E)}}return h}parseMaterial(u,h){const m=u.id,v=u.attrName;let E=u.ShadingModel;if("object"==typeof E&&(E=E.value),!Br.has(m))return null;const V=this.parseParameters(u,h,m);let j;switch(E.toLowerCase()){case"phong":j=new _e.xoR;break;case"lambert":j=new _e.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',E),j=new _e.xoR}return j.setValues(V),j.name=v,j}parseParameters(u,h,m){const v={};u.BumpFactor&&(v.bumpScale=u.BumpFactor.value),u.Diffuse?v.color=(new _e.Ilk).fromArray(u.Diffuse.value).convertSRGBToLinear():u.DiffuseColor&&("Color"===u.DiffuseColor.type||"ColorRGB"===u.DiffuseColor.type)&&(v.color=(new _e.Ilk).fromArray(u.DiffuseColor.value).convertSRGBToLinear()),u.DisplacementFactor&&(v.displacementScale=u.DisplacementFactor.value),u.Emissive?v.emissive=(new _e.Ilk).fromArray(u.Emissive.value).convertSRGBToLinear():u.EmissiveColor&&("Color"===u.EmissiveColor.type||"ColorRGB"===u.EmissiveColor.type)&&(v.emissive=(new _e.Ilk).fromArray(u.EmissiveColor.value).convertSRGBToLinear()),u.EmissiveFactor&&(v.emissiveIntensity=parseFloat(u.EmissiveFactor.value)),u.Opacity&&(v.opacity=parseFloat(u.Opacity.value)),v.opacity<1&&(v.transparent=!0),u.ReflectionFactor&&(v.reflectivity=u.ReflectionFactor.value),u.Shininess&&(v.shininess=u.Shininess.value),u.Specular?v.specular=(new _e.Ilk).fromArray(u.Specular.value).convertSRGBToLinear():u.SpecularColor&&"Color"===u.SpecularColor.type&&(v.specular=(new _e.Ilk).fromArray(u.SpecularColor.value).convertSRGBToLinear());const E=this;return Br.get(m).children.forEach(function(V){const j=V.relationship;switch(j){case"Bump":v.bumpMap=E.getTexture(h,V.ID);break;case"Maya|TEX_ao_map":v.aoMap=E.getTexture(h,V.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":v.map=E.getTexture(h,V.ID),void 0!==v.map&&(v.map.colorSpace=_e.KI_);break;case"DisplacementColor":v.displacementMap=E.getTexture(h,V.ID);break;case"EmissiveColor":v.emissiveMap=E.getTexture(h,V.ID),void 0!==v.emissiveMap&&(v.emissiveMap.colorSpace=_e.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":v.normalMap=E.getTexture(h,V.ID);break;case"ReflectionColor":v.envMap=E.getTexture(h,V.ID),void 0!==v.envMap&&(v.envMap.mapping=_e.dSO,v.envMap.colorSpace=_e.KI_);break;case"SpecularColor":v.specularMap=E.getTexture(h,V.ID),void 0!==v.specularMap&&(v.specularMap.colorSpace=_e.KI_);break;case"TransparentColor":case"TransparencyFactor":v.alphaMap=E.getTexture(h,V.ID),v.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",j)}}),v}getTexture(u,h){return"LayeredTexture"in Hi.Objects&&h in Hi.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),h=Br.get(h).children[0].ID),u.get(h)}parseDeformers(){const u={},h={};if("Deformer"in Hi.Objects){const m=Hi.Objects.Deformer;for(const v in m){const E=m[v],V=Br.get(parseInt(v));if("Skin"===E.attrType){const j=this.parseSkeleton(V,m);j.ID=v,V.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),j.geometryID=V.parents[0].ID,u[v]=j}else if("BlendShape"===E.attrType){const j={id:v};j.rawTargets=this.parseMorphTargets(V,m),j.id=v,V.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),h[v]=j}}}return{skeletons:u,morphTargets:h}}parseSkeleton(u,h){const m=[];return u.children.forEach(function(v){const E=h[v.ID];if("Cluster"!==E.attrType)return;const V={ID:v.ID,indices:[],weights:[],transformLink:(new _e.yGw).fromArray(E.TransformLink.a)};"Indexes"in E&&(V.indices=E.Indexes.a,V.weights=E.Weights.a),m.push(V)}),{rawBones:m,bones:[]}}parseMorphTargets(u,h){const m=[];for(let v=0;v<u.children.length;v++){const E=u.children[v],V=h[E.ID],j={name:V.attrName,initialWeight:V.DeformPercent,id:V.id,fullWeights:V.FullWeights.a};if("BlendShapeChannel"!==V.attrType)return;j.geoID=Br.get(parseInt(E.ID)).children.filter(function(q){return void 0===q.relationship})[0].ID,m.push(j)}return m}parseScene(u,h,m){Or=new _e.ZAu;const v=this.parseModels(u.skeletons,h,m),E=Hi.Objects.Model,V=this;v.forEach(function(q){V.setLookAtProperties(q,E[q.ID]),Br.get(q.ID).parents.forEach(function(ge){const $e=v.get(ge.ID);void 0!==$e&&$e.add(q)}),null===q.parent&&Or.add(q)}),this.bindSkeleton(u.skeletons,h,v),this.createAmbientLight(),Or.traverse(function(q){if(q.userData.transformData){q.parent&&(q.userData.transformData.parentMatrix=q.parent.matrix,q.userData.transformData.parentMatrixWorld=q.parent.matrixWorld);const de=Ti(q.userData.transformData);q.applyMatrix4(de),q.updateWorldMatrix()}});const j=(new ha).parse();1===Or.children.length&&Or.children[0].isGroup&&(Or.children[0].animations=j,Or=Or.children[0]),Or.animations=j}parseModels(u,h,m){const v=new Map,E=Hi.Objects.Model;for(const V in E){const j=parseInt(V),q=E[V],de=Br.get(j);let be=this.buildSkeleton(de,u,j,q.attrName);if(!be){switch(q.attrType){case"Camera":be=this.createCamera(de);break;case"Light":be=this.createLight(de);break;case"Mesh":be=this.createMesh(de,h,m);break;case"NurbsCurve":be=this.createCurve(de,h);break;case"LimbNode":case"Root":be=new _e.N$j;break;default:be=new _e.ZAu}be.name=q.attrName?_e.iUV.sanitizeNodeName(q.attrName):"",be.ID=j}this.getTransformData(be,q),v.set(j,be)}return v}buildSkeleton(u,h,m,v){let E=null;return u.parents.forEach(function(V){for(const j in h){const q=h[j];q.rawBones.forEach(function(de,be){if(de.ID===V.ID){const ge=E;E=new _e.N$j,E.matrixWorld.copy(de.transformLink),E.name=v?_e.iUV.sanitizeNodeName(v):"",E.ID=m,q.bones[be]=E,null!==ge&&E.add(ge)}})}}),E}createCamera(u){let h,m;if(u.children.forEach(function(v){const E=Hi.Objects.NodeAttribute[v.ID];void 0!==E&&(m=E)}),void 0===m)h=new _e.Tme;else{let v=0;void 0!==m.CameraProjectionType&&1===m.CameraProjectionType.value&&(v=1);let E=1;void 0!==m.NearPlane&&(E=m.NearPlane.value/1e3);let V=1e3;void 0!==m.FarPlane&&(V=m.FarPlane.value/1e3);let j=window.innerWidth,q=window.innerHeight;void 0!==m.AspectWidth&&void 0!==m.AspectHeight&&(j=m.AspectWidth.value,q=m.AspectHeight.value);const de=j/q;let be=45;void 0!==m.FieldOfView&&(be=m.FieldOfView.value);const ge=m.FocalLength?m.FocalLength.value:null;switch(v){case 0:h=new _e.cPb(be,de,E,V),null!==ge&&h.setFocalLength(ge);break;case 1:h=new _e.iKG(-j/2,j/2,q/2,-q/2,E,V);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+v+"."),h=new _e.Tme}}return h}createLight(u){let h,m;if(u.children.forEach(function(v){const E=Hi.Objects.NodeAttribute[v.ID];void 0!==E&&(m=E)}),void 0===m)h=new _e.Tme;else{let v;v=void 0===m.LightType?0:m.LightType.value;let E=16777215;void 0!==m.Color&&(E=(new _e.Ilk).fromArray(m.Color.value).convertSRGBToLinear());let V=void 0===m.Intensity?1:m.Intensity.value/100;void 0!==m.CastLightOnObject&&0===m.CastLightOnObject.value&&(V=0);let j=0;void 0!==m.FarAttenuationEnd&&(j=void 0!==m.EnableFarAttenuation&&0===m.EnableFarAttenuation.value?0:m.FarAttenuationEnd.value);const q=1;switch(v){case 0:h=new _e.cek(E,V,j,q);break;case 1:h=new _e.Ox3(E,V);break;case 2:let de=Math.PI/3;void 0!==m.InnerAngle&&(de=_e.M8C.degToRad(m.InnerAngle.value));let be=0;void 0!==m.OuterAngle&&(be=_e.M8C.degToRad(m.OuterAngle.value),be=Math.max(be,1)),h=new _e.PMe(E,V,j,de,be,q);break;default:console.warn("THREE.FBXLoader: Unknown light type "+m.LightType.value+", defaulting to a PointLight."),h=new _e.cek(E,V)}void 0!==m.CastShadows&&1===m.CastShadows.value&&(h.castShadow=!0)}return h}createMesh(u,h,m){let v,E=null,V=null;const j=[];return u.children.forEach(function(q){h.has(q.ID)&&(E=h.get(q.ID)),m.has(q.ID)&&j.push(m.get(q.ID))}),j.length>1?V=j:j.length>0?V=j[0]:(V=new _e.xoR({name:_e.aNw.DEFAULT_MATERIAL_NAME,color:13421772}),j.push(V)),"color"in E.attributes&&j.forEach(function(q){q.vertexColors=!0}),E.FBX_Deformer?(v=new _e.TUv(E,V),v.normalizeSkinWeights()):v=new _e.Kj0(E,V),v}createCurve(u,h){const m=u.children.reduce(function(E,V){return h.has(V.ID)&&(E=h.get(V.ID)),E},null),v=new _e.nls({name:_e.aNw.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new _e.x12(m,v)}getTransformData(u,h){const m={};"InheritType"in h&&(m.inheritType=parseInt(h.InheritType.value)),m.eulerOrder="RotationOrder"in h?Hn(h.RotationOrder.value):"ZYX","Lcl_Translation"in h&&(m.translation=h.Lcl_Translation.value),"PreRotation"in h&&(m.preRotation=h.PreRotation.value),"Lcl_Rotation"in h&&(m.rotation=h.Lcl_Rotation.value),"PostRotation"in h&&(m.postRotation=h.PostRotation.value),"Lcl_Scaling"in h&&(m.scale=h.Lcl_Scaling.value),"ScalingOffset"in h&&(m.scalingOffset=h.ScalingOffset.value),"ScalingPivot"in h&&(m.scalingPivot=h.ScalingPivot.value),"RotationOffset"in h&&(m.rotationOffset=h.RotationOffset.value),"RotationPivot"in h&&(m.rotationPivot=h.RotationPivot.value),u.userData.transformData=m}setLookAtProperties(u,h){"LookAtProperty"in h&&Br.get(u.ID).children.forEach(function(v){if("LookAtProperty"===v.relationship){const E=Hi.Objects.Model[v.ID];if("Lcl_Translation"in E){const V=E.Lcl_Translation.value;void 0!==u.target?(u.target.position.fromArray(V),Or.add(u.target)):u.lookAt((new _e.Pa4).fromArray(V))}}})}bindSkeleton(u,h,m){const v=this.parsePoseNodes();for(const E in u){const V=u[E];Br.get(parseInt(V.ID)).parents.forEach(function(q){h.has(q.ID)&&Br.get(q.ID).parents.forEach(function(ge){m.has(ge.ID)&&m.get(ge.ID).bind(new _e.OdW(V.bones),v[ge.ID])})})}}parsePoseNodes(){const u={};if("Pose"in Hi.Objects){const h=Hi.Objects.Pose;for(const m in h)if("BindPose"===h[m].attrType&&h[m].NbPoseNodes>0){const v=h[m].PoseNode;Array.isArray(v)?v.forEach(function(E){u[E.Node]=(new _e.yGw).fromArray(E.Matrix.a)}):u[v.Node]=(new _e.yGw).fromArray(v.Matrix.a)}}return u}createAmbientLight(){if("GlobalSettings"in Hi&&"AmbientColor"in Hi.GlobalSettings){const u=Hi.GlobalSettings.AmbientColor.value,h=u[0],m=u[1],v=u[2];if(0!==h||0!==m||0!==v){const E=new _e.Ilk(h,m,v).convertSRGBToLinear();Or.add(new _e.Mig(E,1))}}}}class Ul{constructor(){this.negativeMaterialIndices=!1}parse(u){const h=new Map;if("Geometry"in Hi.Objects){const m=Hi.Objects.Geometry;for(const v in m){const E=Br.get(parseInt(v)),V=this.parseGeometry(E,m[v],u);h.set(parseInt(v),V)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),h}parseGeometry(u,h,m){switch(h.attrType){case"Mesh":return this.parseMeshGeometry(u,h,m);case"NurbsCurve":return this.parseNurbsGeometry(h)}}parseMeshGeometry(u,h,m){const v=m.skeletons,E=[],V=u.parents.map(function(ge){return Hi.Objects.Model[ge.ID]});if(0===V.length)return;const j=u.children.reduce(function(ge,$e){return void 0!==v[$e.ID]&&(ge=v[$e.ID]),ge},null);u.children.forEach(function(ge){void 0!==m.morphTargets[ge.ID]&&E.push(m.morphTargets[ge.ID])});const q=V[0],de={};"RotationOrder"in q&&(de.eulerOrder=Hn(q.RotationOrder.value)),"InheritType"in q&&(de.inheritType=parseInt(q.InheritType.value)),"GeometricTranslation"in q&&(de.translation=q.GeometricTranslation.value),"GeometricRotation"in q&&(de.rotation=q.GeometricRotation.value),"GeometricScaling"in q&&(de.scale=q.GeometricScaling.value);const be=Ti(de);return this.genGeometry(h,j,E,be)}genGeometry(u,h,m,v){const E=new _e.u9r;u.attrName&&(E.name=u.attrName);const V=this.parseGeoNode(u,h),j=this.genBuffers(V),q=new _e.a$l(j.vertex,3);if(q.applyMatrix4(v),E.setAttribute("position",q),j.colors.length>0&&E.setAttribute("color",new _e.a$l(j.colors,3)),h&&(E.setAttribute("skinIndex",new _e.qlB(j.weightsIndices,4)),E.setAttribute("skinWeight",new _e.a$l(j.vertexWeights,4)),E.FBX_Deformer=h),j.normal.length>0){const de=(new _e.Vkp).getNormalMatrix(v),be=new _e.a$l(j.normal,3);be.applyNormalMatrix(de),E.setAttribute("normal",be)}if(j.uvs.forEach(function(de,be){E.setAttribute(0===be?"uv":`uv${be}`,new _e.a$l(j.uvs[be],2))}),V.material&&"AllSame"!==V.material.mappingType){let de=j.materialIndex[0],be=0;if(j.materialIndex.forEach(function(ge,$e){ge!==de&&(E.addGroup(be,$e-be,de),de=ge,be=$e)}),E.groups.length>0){const ge=E.groups[E.groups.length-1],$e=ge.start+ge.count;$e!==j.materialIndex.length&&E.addGroup($e,j.materialIndex.length-$e,de)}0===E.groups.length&&E.addGroup(0,j.materialIndex.length,j.materialIndex[0])}return this.addMorphTargets(E,u,m,v),E}parseGeoNode(u,h){const m={};if(m.vertexPositions=void 0!==u.Vertices?u.Vertices.a:[],m.vertexIndices=void 0!==u.PolygonVertexIndex?u.PolygonVertexIndex.a:[],u.LayerElementColor&&(m.color=this.parseVertexColors(u.LayerElementColor[0])),u.LayerElementMaterial&&(m.material=this.parseMaterialIndices(u.LayerElementMaterial[0])),u.LayerElementNormal&&(m.normal=this.parseNormals(u.LayerElementNormal[0])),u.LayerElementUV){m.uv=[];let v=0;for(;u.LayerElementUV[v];)u.LayerElementUV[v].UV&&m.uv.push(this.parseUVs(u.LayerElementUV[v])),v++}return m.weightTable={},null!==h&&(m.skeleton=h,h.rawBones.forEach(function(v,E){v.indices.forEach(function(V,j){void 0===m.weightTable[V]&&(m.weightTable[V]=[]),m.weightTable[V].push({id:E,weight:v.weights[j]})})})),m}genBuffers(u){const h={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let m=0,v=0,E=!1,V=[],j=[],q=[],de=[],be=[],ge=[];const $e=this;return u.vertexIndices.forEach(function(Ge,wt){let It,wn=!1;Ge<0&&(Ge^=-1,wn=!0);let Qt=[],vt=[];if(V.push(3*Ge,3*Ge+1,3*Ge+2),u.color){const En=Pe(wt,m,Ge,u.color);q.push(En[0],En[1],En[2])}if(u.skeleton){if(void 0!==u.weightTable[Ge]&&u.weightTable[Ge].forEach(function(En){vt.push(En.weight),Qt.push(En.id)}),vt.length>4){E||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),E=!0);const En=[0,0,0,0],ni=[0,0,0,0];vt.forEach(function(Qn,si){let oi=Qn,Dn=Qt[si];ni.forEach(function(Cr,ui,hi){if(oi>Cr){hi[ui]=oi,oi=Cr;const jr=En[ui];En[ui]=Dn,Dn=jr}})}),Qt=En,vt=ni}for(;vt.length<4;)vt.push(0),Qt.push(0);for(let En=0;En<4;++En)be.push(vt[En]),ge.push(Qt[En])}if(u.normal){const En=Pe(wt,m,Ge,u.normal);j.push(En[0],En[1],En[2])}u.material&&"AllSame"!==u.material.mappingType&&(It=Pe(wt,m,Ge,u.material)[0],It<0&&($e.negativeMaterialIndices=!0,It=0)),u.uv&&u.uv.forEach(function(En,ni){const Qn=Pe(wt,m,Ge,En);void 0===de[ni]&&(de[ni]=[]),de[ni].push(Qn[0]),de[ni].push(Qn[1])}),v++,wn&&(v>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),$e.genFace(h,u,V,It,j,q,de,be,ge,v),m++,v=0,V=[],j=[],q=[],de=[],be=[],ge=[])}),h}genFace(u,h,m,v,E,V,j,q,de,be){for(let ge=2;ge<be;ge++)u.vertex.push(h.vertexPositions[m[0]]),u.vertex.push(h.vertexPositions[m[1]]),u.vertex.push(h.vertexPositions[m[2]]),u.vertex.push(h.vertexPositions[m[3*(ge-1)]]),u.vertex.push(h.vertexPositions[m[3*(ge-1)+1]]),u.vertex.push(h.vertexPositions[m[3*(ge-1)+2]]),u.vertex.push(h.vertexPositions[m[3*ge]]),u.vertex.push(h.vertexPositions[m[3*ge+1]]),u.vertex.push(h.vertexPositions[m[3*ge+2]]),h.skeleton&&(u.vertexWeights.push(q[0]),u.vertexWeights.push(q[1]),u.vertexWeights.push(q[2]),u.vertexWeights.push(q[3]),u.vertexWeights.push(q[4*(ge-1)]),u.vertexWeights.push(q[4*(ge-1)+1]),u.vertexWeights.push(q[4*(ge-1)+2]),u.vertexWeights.push(q[4*(ge-1)+3]),u.vertexWeights.push(q[4*ge]),u.vertexWeights.push(q[4*ge+1]),u.vertexWeights.push(q[4*ge+2]),u.vertexWeights.push(q[4*ge+3]),u.weightsIndices.push(de[0]),u.weightsIndices.push(de[1]),u.weightsIndices.push(de[2]),u.weightsIndices.push(de[3]),u.weightsIndices.push(de[4*(ge-1)]),u.weightsIndices.push(de[4*(ge-1)+1]),u.weightsIndices.push(de[4*(ge-1)+2]),u.weightsIndices.push(de[4*(ge-1)+3]),u.weightsIndices.push(de[4*ge]),u.weightsIndices.push(de[4*ge+1]),u.weightsIndices.push(de[4*ge+2]),u.weightsIndices.push(de[4*ge+3])),h.color&&(u.colors.push(V[0]),u.colors.push(V[1]),u.colors.push(V[2]),u.colors.push(V[3*(ge-1)]),u.colors.push(V[3*(ge-1)+1]),u.colors.push(V[3*(ge-1)+2]),u.colors.push(V[3*ge]),u.colors.push(V[3*ge+1]),u.colors.push(V[3*ge+2])),h.material&&"AllSame"!==h.material.mappingType&&(u.materialIndex.push(v),u.materialIndex.push(v),u.materialIndex.push(v)),h.normal&&(u.normal.push(E[0]),u.normal.push(E[1]),u.normal.push(E[2]),u.normal.push(E[3*(ge-1)]),u.normal.push(E[3*(ge-1)+1]),u.normal.push(E[3*(ge-1)+2]),u.normal.push(E[3*ge]),u.normal.push(E[3*ge+1]),u.normal.push(E[3*ge+2])),h.uv&&h.uv.forEach(function($e,Ge){void 0===u.uvs[Ge]&&(u.uvs[Ge]=[]),u.uvs[Ge].push(j[Ge][0]),u.uvs[Ge].push(j[Ge][1]),u.uvs[Ge].push(j[Ge][2*(ge-1)]),u.uvs[Ge].push(j[Ge][2*(ge-1)+1]),u.uvs[Ge].push(j[Ge][2*ge]),u.uvs[Ge].push(j[Ge][2*ge+1])})}addMorphTargets(u,h,m,v){if(0===m.length)return;u.morphTargetsRelative=!0,u.morphAttributes.position=[];const E=this;m.forEach(function(V){V.rawTargets.forEach(function(j){const q=Hi.Objects.Geometry[j.geoID];void 0!==q&&E.genMorphGeometry(u,h,q,v,j.name)})})}genMorphGeometry(u,h,m,v,E){const V=void 0!==h.PolygonVertexIndex?h.PolygonVertexIndex.a:[],j=void 0!==m.Vertices?m.Vertices.a:[],q=void 0!==m.Indexes?m.Indexes.a:[],be=new Float32Array(3*u.attributes.position.count);for(let wt=0;wt<q.length;wt++){const It=3*q[wt];be[It]=j[3*wt],be[It+1]=j[3*wt+1],be[It+2]=j[3*wt+2]}const $e=this.genBuffers({vertexIndices:V,vertexPositions:be}),Ge=new _e.a$l($e.vertex,3);Ge.name=E||m.attrName,Ge.applyMatrix4(v),u.morphAttributes.position.push(Ge)}parseNormals(u){const m=u.ReferenceInformationType;let E=[];return"IndexToDirect"===m&&("NormalIndex"in u?E=u.NormalIndex.a:"NormalsIndex"in u&&(E=u.NormalsIndex.a)),{dataSize:3,buffer:u.Normals.a,indices:E,mappingType:u.MappingInformationType,referenceType:m}}parseUVs(u){const m=u.ReferenceInformationType;let E=[];return"IndexToDirect"===m&&(E=u.UVIndex.a),{dataSize:2,buffer:u.UV.a,indices:E,mappingType:u.MappingInformationType,referenceType:m}}parseVertexColors(u){const h=u.MappingInformationType,m=u.ReferenceInformationType,v=u.Colors.a;let E=[];"IndexToDirect"===m&&(E=u.ColorIndex.a);for(let V=0,j=new _e.Ilk;V<v.length;V+=4)j.fromArray(v,V).convertSRGBToLinear().toArray(v,V);return{dataSize:4,buffer:v,indices:E,mappingType:h,referenceType:m}}parseMaterialIndices(u){const h=u.MappingInformationType,m=u.ReferenceInformationType;if("NoMappingInformation"===h)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:m};const v=u.Materials.a,E=[];for(let V=0;V<v.length;++V)E.push(V);return{dataSize:1,buffer:v,indices:E,mappingType:h,referenceType:m}}parseNurbsGeometry(u){const h=parseInt(u.Order);if(isNaN(h))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",u.Order,u.id),new _e.u9r;const m=h-1,v=u.KnotVector.a,E=[],V=u.Points.a;for(let ge=0,$e=V.length;ge<$e;ge+=4)E.push((new _e.Ltg).fromArray(V,ge));let j,q;if("Closed"===u.Form)E.push(E[0]);else if("Periodic"===u.Form){j=m,q=v.length-1-j;for(let ge=0;ge<m;++ge)E.push(E[ge])}const be=new Ro(m,v,E,j,q).getPoints(12*E.length);return(new _e.u9r).setFromPoints(be)}}class ha{parse(){const u=[],h=this.parseClips();if(void 0!==h)for(const m in h){const E=this.addClip(h[m]);u.push(E)}return u}parseClips(){if(void 0===Hi.Objects.AnimationCurve)return;const u=this.parseAnimationCurveNodes();this.parseAnimationCurves(u);const h=this.parseAnimationLayers(u);return this.parseAnimStacks(h)}parseAnimationCurveNodes(){const u=Hi.Objects.AnimationCurveNode,h=new Map;for(const m in u){const v=u[m];if(null!==v.attrName.match(/S|R|T|DeformPercent/)){const E={id:v.id,attr:v.attrName,curves:{}};h.set(E.id,E)}}return h}parseAnimationCurves(u){const h=Hi.Objects.AnimationCurve;for(const m in h){const v={id:h[m].id,times:h[m].KeyTime.a.map(ee),values:h[m].KeyValueFloat.a},E=Br.get(v.id);if(void 0!==E){const V=E.parents[0].ID,j=E.parents[0].relationship;j.match(/X/)?u.get(V).curves.x=v:j.match(/Y/)?u.get(V).curves.y=v:j.match(/Z/)?u.get(V).curves.z=v:j.match(/DeformPercent/)&&u.has(V)&&(u.get(V).curves.morph=v)}}}parseAnimationLayers(u){const h=Hi.Objects.AnimationLayer,m=new Map;for(const v in h){const E=[],V=Br.get(parseInt(v));void 0!==V&&(V.children.forEach(function(q,de){if(u.has(q.ID)){const be=u.get(q.ID);if(void 0!==be.curves.x||void 0!==be.curves.y||void 0!==be.curves.z){if(void 0===E[de]){const ge=Br.get(q.ID).parents.filter(function($e){return void 0!==$e.relationship})[0].ID;if(void 0!==ge){const $e=Hi.Objects.Model[ge.toString()];if(void 0===$e)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",q);const Ge={modelName:$e.attrName?_e.iUV.sanitizeNodeName($e.attrName):"",ID:$e.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Or.traverse(function(wt){wt.ID===$e.id&&(Ge.transform=wt.matrix,wt.userData.transformData&&(Ge.eulerOrder=wt.userData.transformData.eulerOrder))}),Ge.transform||(Ge.transform=new _e.yGw),"PreRotation"in $e&&(Ge.preRotation=$e.PreRotation.value),"PostRotation"in $e&&(Ge.postRotation=$e.PostRotation.value),E[de]=Ge}}E[de]&&(E[de][be.attr]=be)}else if(void 0!==be.curves.morph){if(void 0===E[de]){const ge=Br.get(q.ID).parents.filter(function(Qt){return void 0!==Qt.relationship})[0].ID,$e=Br.get(ge).parents[0].ID,Ge=Br.get($e).parents[0].ID,wt=Br.get(Ge).parents[0].ID,It=Hi.Objects.Model[wt],wn={modelName:It.attrName?_e.iUV.sanitizeNodeName(It.attrName):"",morphName:Hi.Objects.Deformer[ge].attrName};E[de]=wn}E[de][be.attr]=be}}}),m.set(parseInt(v),E))}return m}parseAnimStacks(u){const h=Hi.Objects.AnimationStack,m={};for(const v in h){const E=Br.get(parseInt(v)).children;E.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const V=u.get(E[0].ID);m[v]={name:h[v].attrName,layer:V}}return m}addClip(u){let h=[];const m=this;return u.layer.forEach(function(v){h=h.concat(m.generateTracks(v))}),new _e.m7l(u.name,-1,h)}generateTracks(u){const h=[];let m=new _e.Pa4,v=new _e._fP,E=new _e.Pa4;if(u.transform&&u.transform.decompose(m,v,E),m=m.toArray(),v=(new _e.USm).setFromQuaternion(v,u.eulerOrder).toArray(),E=E.toArray(),void 0!==u.T&&Object.keys(u.T.curves).length>0){const V=this.generateVectorTrack(u.modelName,u.T.curves,m,"position");void 0!==V&&h.push(V)}if(void 0!==u.R&&Object.keys(u.R.curves).length>0){const V=this.generateRotationTrack(u.modelName,u.R.curves,v,u.preRotation,u.postRotation,u.eulerOrder);void 0!==V&&h.push(V)}if(void 0!==u.S&&Object.keys(u.S.curves).length>0){const V=this.generateVectorTrack(u.modelName,u.S.curves,E,"scale");void 0!==V&&h.push(V)}if(void 0!==u.DeformPercent){const V=this.generateMorphTrack(u);void 0!==V&&h.push(V)}return h}generateVectorTrack(u,h,m,v){const E=this.getTimesForAllAxes(h),V=this.getKeyframeTrackValues(E,h,m);return new _e.yC1(u+"."+v,E,V)}generateRotationTrack(u,h,m,v,E,V){void 0!==h.x&&(this.interpolateRotations(h.x),h.x.values=h.x.values.map(_e.M8C.degToRad)),void 0!==h.y&&(this.interpolateRotations(h.y),h.y.values=h.y.values.map(_e.M8C.degToRad)),void 0!==h.z&&(this.interpolateRotations(h.z),h.z.values=h.z.values.map(_e.M8C.degToRad));const j=this.getTimesForAllAxes(h),q=this.getKeyframeTrackValues(j,h,m);void 0!==v&&((v=v.map(_e.M8C.degToRad)).push(V),v=(new _e.USm).fromArray(v),v=(new _e._fP).setFromEuler(v)),void 0!==E&&((E=E.map(_e.M8C.degToRad)).push(V),E=(new _e.USm).fromArray(E),E=(new _e._fP).setFromEuler(E).invert());const de=new _e._fP,be=new _e.USm,ge=[];for(let $e=0;$e<q.length;$e+=3)be.set(q[$e],q[$e+1],q[$e+2],V),de.setFromEuler(be),void 0!==v&&de.premultiply(v),void 0!==E&&de.multiply(E),de.toArray(ge,$e/3*4);return new _e.iLg(u+".quaternion",j,ge)}generateMorphTrack(u){const h=u.DeformPercent.curves.morph,m=h.values.map(function(E){return E/100}),v=Or.getObjectByName(u.modelName).morphTargetDictionary[u.morphName];return new _e.dUE(u.modelName+".morphTargetInfluences["+v+"]",h.times,m)}getTimesForAllAxes(u){let h=[];if(void 0!==u.x&&(h=h.concat(u.x.times)),void 0!==u.y&&(h=h.concat(u.y.times)),void 0!==u.z&&(h=h.concat(u.z.times)),h=h.sort(function(m,v){return m-v}),h.length>1){let m=1,v=h[0];for(let E=1;E<h.length;E++){const V=h[E];V!==v&&(h[m]=V,v=V,m++)}h=h.slice(0,m)}return h}getKeyframeTrackValues(u,h,m){const v=m,E=[];let V=-1,j=-1,q=-1;return u.forEach(function(de){if(h.x&&(V=h.x.times.indexOf(de)),h.y&&(j=h.y.times.indexOf(de)),h.z&&(q=h.z.times.indexOf(de)),-1!==V){const be=h.x.values[V];E.push(be),v[0]=be}else E.push(v[0]);if(-1!==j){const be=h.y.values[j];E.push(be),v[1]=be}else E.push(v[1]);if(-1!==q){const be=h.z.values[q];E.push(be),v[2]=be}else E.push(v[2])}),E}interpolateRotations(u){for(let h=1;h<u.values.length;h++){const m=u.values[h-1],v=u.values[h]-m,E=Math.abs(v);if(E>=180){const V=E/180,j=v/V;let q=m+j;const de=u.times[h-1],ge=(u.times[h]-de)/V;let $e=de+ge;const Ge=[],wt=[];for(;$e<u.times[h];)Ge.push($e),$e+=ge,wt.push(q),q+=j;u.times=Pa(u.times,h,Ge),u.values=Pa(u.values,h,wt)}}}}class Fi{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(u){this.nodeStack.push(u),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(u,h){this.currentProp=u,this.currentPropName=h}parse(u){this.currentIndent=0,this.allNodes=new S,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const h=this,m=u.split(/[\r\n]+/);return m.forEach(function(v,E){const V=v.match(/^[\s\t]*;/),j=v.match(/^[\s\t]*$/);if(V||j)return;const q=v.match("^\\t{"+h.currentIndent+"}(\\w+):(.*){",""),de=v.match("^\\t{"+h.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),be=v.match("^\\t{"+(h.currentIndent-1)+"}}");q?h.parseNodeBegin(v,q):de?h.parseNodeProperty(v,de,m[++E]):be?h.popStack():v.match(/^[^\s\t}]/)&&h.parseNodePropertyContinued(v)}),this.allNodes}parseNodeBegin(u,h){const m=h[1].trim().replace(/^"/,"").replace(/"$/,""),v=h[2].split(",").map(function(q){return q.trim().replace(/^"/,"").replace(/"$/,"")}),E={name:m},V=this.parseNodeAttr(v),j=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(m,E):m in j?("PoseNode"===m?j.PoseNode.push(E):void 0!==j[m].id&&(j[m]={},j[m][j[m].id]=j[m]),""!==V.id&&(j[m][V.id]=E)):"number"==typeof V.id?(j[m]={},j[m][V.id]=E):"Properties70"!==m&&(j[m]="PoseNode"===m?[E]:E),"number"==typeof V.id&&(E.id=V.id),""!==V.name&&(E.attrName=V.name),""!==V.type&&(E.attrType=V.type),this.pushStack(E)}parseNodeAttr(u){let h=u[0];""!==u[0]&&(h=parseInt(u[0]),isNaN(h)&&(h=u[0]));let m="",v="";return u.length>1&&(m=u[1].replace(/^(\w+)::/,""),v=u[2]),{id:h,name:m,type:v}}parseNodeProperty(u,h,m){let v=h[1].replace(/^"/,"").replace(/"$/,"").trim(),E=h[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===v&&","===E&&(E=m.replace(/"/g,"").replace(/,$/,"").trim());const V=this.getCurrentNode();if("Properties70"!==V.name){if("C"===v){const q=E.split(",").slice(1),de=parseInt(q[0]),be=parseInt(q[1]);let ge=E.split(",").slice(3);ge=ge.map(function($e){return $e.trim().replace(/^"/,"")}),v="connections",E=[de,be],function Io(b,u){for(let h=0,m=b.length,v=u.length;h<v;h++,m++)b[m]=u[h]}(E,ge),void 0===V[v]&&(V[v]=[])}"Node"===v&&(V.id=E),v in V&&Array.isArray(V[v])?V[v].push(E):"a"!==v?V[v]=E:V.a=E,this.setCurrentProp(V,v),"a"===v&&","!==E.slice(-1)&&(V.a=Xi(E))}else this.parseNodeSpecialProperty(u,v,E)}parseNodePropertyContinued(u){const h=this.getCurrentNode();h.a+=u,","!==u.slice(-1)&&(h.a=Xi(h.a))}parseNodeSpecialProperty(u,h,m){const v=m.split('",').map(function(be){return be.trim().replace(/^\"/,"").replace(/\s/,"_")}),E=v[0],V=v[1],j=v[2],q=v[3];let de=v[4];switch(V){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":de=parseFloat(de);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":de=Xi(de)}this.getPrevNode()[E]={type:V,type2:j,flag:q,value:de},this.setCurrentProp(this.getPrevNode(),E)}}class ml{parse(u){const h=new D(u);h.skip(23);const m=h.getUint32();if(m<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+m);const v=new S;for(;!this.endOfContent(h);){const E=this.parseNode(h,m);null!==E&&v.add(E.name,E)}return v}endOfContent(u){return u.size()%16==0?(u.getOffset()+160+16&-16)>=u.size():u.getOffset()+160+16>=u.size()}parseNode(u,h){const m={},v=h>=7500?u.getUint64():u.getUint32(),E=h>=7500?u.getUint64():u.getUint32();h>=7500?u.getUint64():u.getUint32();const V=u.getUint8(),j=u.getString(V);if(0===v)return null;const q=[];for(let $e=0;$e<E;$e++)q.push(this.parseProperty(u));const de=q.length>0?q[0]:"",be=q.length>1?q[1]:"",ge=q.length>2?q[2]:"";for(m.singleProperty=1===E&&u.getOffset()===v;v>u.getOffset();){const $e=this.parseNode(u,h);null!==$e&&this.parseSubNode(j,m,$e)}return m.propertyList=q,"number"==typeof de&&(m.id=de),""!==be&&(m.attrName=be),""!==ge&&(m.attrType=ge),""!==j&&(m.name=j),m}parseSubNode(u,h,m){if(!0===m.singleProperty){const v=m.propertyList[0];Array.isArray(v)?(h[m.name]=m,m.a=v):h[m.name]=v}else if("Connections"===u&&"C"===m.name){const v=[];m.propertyList.forEach(function(E,V){0!==V&&v.push(E)}),void 0===h.connections&&(h.connections=[]),h.connections.push(v)}else if("Properties70"===m.name)Object.keys(m).forEach(function(E){h[E]=m[E]});else if("Properties70"===u&&"P"===m.name){let v=m.propertyList[0],E=m.propertyList[1];const V=m.propertyList[2],j=m.propertyList[3];let q;0===v.indexOf("Lcl ")&&(v=v.replace("Lcl ","Lcl_")),0===E.indexOf("Lcl ")&&(E=E.replace("Lcl ","Lcl_")),q="Color"===E||"ColorRGB"===E||"Vector"===E||"Vector3D"===E||0===E.indexOf("Lcl_")?[m.propertyList[4],m.propertyList[5],m.propertyList[6]]:m.propertyList[4],h[v]={type:E,type2:V,flag:j,value:q}}else void 0===h[m.name]?"number"==typeof m.id?(h[m.name]={},h[m.name][m.id]=m):h[m.name]=m:"PoseNode"===m.name?(Array.isArray(h[m.name])||(h[m.name]=[h[m.name]]),h[m.name].push(m)):void 0===h[m.name][m.id]&&(h[m.name][m.id]=m)}parseProperty(u){const h=u.getString(1);let m;switch(h){case"C":return u.getBoolean();case"D":return u.getFloat64();case"F":return u.getFloat32();case"I":return u.getInt32();case"L":return u.getInt64();case"R":return m=u.getUint32(),u.getArrayBuffer(m);case"S":return m=u.getUint32(),u.getString(m);case"Y":return u.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const v=u.getUint32(),E=u.getUint32(),V=u.getUint32();if(0===E)switch(h){case"b":case"c":return u.getBooleanArray(v);case"d":return u.getFloat64Array(v);case"f":return u.getFloat32Array(v);case"i":return u.getInt32Array(v);case"l":return u.getInt64Array(v)}const j=function za(b,u){return Va((function(b){if(8!=(15&b[0])||b[0]>>>4>7||(b[0]<<8|b[1])%31)throw"invalid zlib data";if(32&b[1])throw"invalid zlib data: preset dictionaries not supported"}(b),b.subarray(2,-4)),u)}(new Uint8Array(u.getArrayBuffer(V))),q=new D(j.buffer);switch(h){case"b":case"c":return q.getBooleanArray(v);case"d":return q.getFloat64Array(v);case"f":return q.getFloat32Array(v);case"i":return q.getInt32Array(v);case"l":return q.getInt64Array(v)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+h)}}}class D{constructor(u,h){this.dv=new DataView(u),this.offset=0,this.littleEndian=void 0===h||h,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(u){this.offset+=u}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(u){const h=[];for(let m=0;m<u;m++)h.push(this.getBoolean());return h}getUint8(){const u=this.dv.getUint8(this.offset);return this.offset+=1,u}getInt16(){const u=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,u}getInt32(){const u=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,u}getInt32Array(u){const h=[];for(let m=0;m<u;m++)h.push(this.getInt32());return h}getUint32(){const u=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,u}getInt64(){let u,h;return this.littleEndian?(u=this.getUint32(),h=this.getUint32()):(h=this.getUint32(),u=this.getUint32()),2147483648&h?(h=4294967295&~h,u=4294967295&~u,4294967295===u&&(h=h+1&4294967295),u=u+1&4294967295,-(4294967296*h+u)):4294967296*h+u}getInt64Array(u){const h=[];for(let m=0;m<u;m++)h.push(this.getInt64());return h}getUint64(){let u,h;return this.littleEndian?(u=this.getUint32(),h=this.getUint32()):(h=this.getUint32(),u=this.getUint32()),4294967296*h+u}getFloat32(){const u=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,u}getFloat32Array(u){const h=[];for(let m=0;m<u;m++)h.push(this.getFloat32());return h}getFloat64(){const u=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,u}getFloat64Array(u){const h=[];for(let m=0;m<u;m++)h.push(this.getFloat64());return h}getArrayBuffer(u){const h=this.dv.buffer.slice(this.offset,this.offset+u);return this.offset+=u,h}getString(u){const h=this.offset;let m=new Uint8Array(this.dv.buffer,h,u);this.skip(u);const v=m.indexOf(0);return v>=0&&(m=new Uint8Array(this.dv.buffer,h,v)),this._textDecoder.decode(m)}}class S{add(u,h){this[u]=h}}function W(b){const h=b.match(/FBXVersion: (\d+)/);if(h)return parseInt(h[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ee(b){return b/46186158e3}const Ee=[];function Pe(b,u,h,m){let v;switch(m.mappingType){case"ByPolygonVertex":v=b;break;case"ByPolygon":v=u;break;case"ByVertice":v=h;break;case"AllSame":v=m.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+m.mappingType)}"IndexToDirect"===m.referenceType&&(v=m.indices[v]);const E=v*m.dataSize;return function mo(b,u,h,m){for(let v=h,E=0;v<m;v++,E++)b[E]=u[v];return b}(Ee,m.buffer,E,E+m.dataSize)}const et=new _e.USm,cn=new _e.Pa4;function Ti(b){const u=new _e.yGw,h=new _e.yGw,m=new _e.yGw,v=new _e.yGw,E=new _e.yGw,V=new _e.yGw,j=new _e.yGw,q=new _e.yGw,de=new _e.yGw,be=new _e.yGw,ge=new _e.yGw,$e=new _e.yGw,Ge=b.inheritType?b.inheritType:0;if(b.translation&&u.setPosition(cn.fromArray(b.translation)),b.preRotation){const ui=b.preRotation.map(_e.M8C.degToRad);ui.push(b.eulerOrder||_e.USm.DEFAULT_ORDER),h.makeRotationFromEuler(et.fromArray(ui))}if(b.rotation){const ui=b.rotation.map(_e.M8C.degToRad);ui.push(b.eulerOrder||_e.USm.DEFAULT_ORDER),m.makeRotationFromEuler(et.fromArray(ui))}if(b.postRotation){const ui=b.postRotation.map(_e.M8C.degToRad);ui.push(b.eulerOrder||_e.USm.DEFAULT_ORDER),v.makeRotationFromEuler(et.fromArray(ui)),v.invert()}b.scale&&E.scale(cn.fromArray(b.scale)),b.scalingOffset&&j.setPosition(cn.fromArray(b.scalingOffset)),b.scalingPivot&&V.setPosition(cn.fromArray(b.scalingPivot)),b.rotationOffset&&q.setPosition(cn.fromArray(b.rotationOffset)),b.rotationPivot&&de.setPosition(cn.fromArray(b.rotationPivot)),b.parentMatrixWorld&&(ge.copy(b.parentMatrix),be.copy(b.parentMatrixWorld));const wt=h.clone().multiply(m).multiply(v),It=new _e.yGw;It.extractRotation(be);const wn=new _e.yGw;wn.copyPosition(be);const Qt=wn.clone().invert().multiply(be),vt=It.clone().invert().multiply(Qt),En=E,ni=new _e.yGw;if(0===Ge)ni.copy(It).multiply(wt).multiply(vt).multiply(En);else if(1===Ge)ni.copy(It).multiply(vt).multiply(wt).multiply(En);else{const hi=(new _e.yGw).scale((new _e.Pa4).setFromMatrixScale(ge)).clone().invert(),jr=vt.clone().multiply(hi);ni.copy(It).multiply(wt).multiply(jr).multiply(En)}const Qn=de.clone().invert(),si=V.clone().invert();let oi=u.clone().multiply(q).multiply(de).multiply(h).multiply(m).multiply(v).multiply(Qn).multiply(j).multiply(V).multiply(E).multiply(si);const Dn=(new _e.yGw).copyPosition(oi),Cr=be.clone().multiply(Dn);return $e.copyPosition(Cr),oi=$e.clone().multiply(ni),oi.premultiply(be.invert()),oi}function Hn(b){const u=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(b=b||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),u[0]):u[b]}function Xi(b){return b.split(",").map(function(h){return parseFloat(h)})}function Wi(b,u,h){return void 0===u&&(u=0),void 0===h&&(h=b.byteLength),(new TextDecoder).decode(new Uint8Array(b,u,h))}function Pa(b,u,h){return b.slice(0,u).concat(h).concat(b.slice(u))}const Cc="CITY_UNTRIANGULATED";let Wa=(()=>{class b{constructor(h){this.threeService=h,this.vertexShader="\n                          //vertexShader\n                          precision lowp float;\n                          varying vec2 vUv;\n                          varying vec3 vPosition;\n                          uniform float uTime;\n                          varying vec3 vNormal;\n                          void main() {\n                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                            vUv = uv;\n                            vPosition = position;\n                            vNormal = normalize(normalMatrix * normal);\n                        }",this.fragmentShader="\n                        //fragmentShader\n                        #define PI 3.1415926535897932384626433832795\n                        precision lowp float;\n                        uniform vec3 scanColor;\n                        varying vec2 vUv;\n                        uniform float uTime;\n                        uniform vec3 uSize;\n                        varying vec3 vPosition;\n                        varying vec3 vNormal;\n                        void main() {\n                          float dTime = mod(uTime * 25.0, uSize.z); \n                          vec3 distColor = vec3(0.5, 0.5, 0.5);\n                            float topY = vPosition.z + 10.0;\n                            if (dTime > vPosition.z && dTime < topY) {\n                                \n                                float dIndex = sin((topY - dTime) / 10.0 * PI);\n\n                                distColor = mix(distColor, scanColor,  dIndex); \n                            }\n                          \n                          gl_FragColor = vec4(vec3(distColor), 1.0);\n                          \n                        }\n                      "}ngOnInit(){const{scene:h,camera:m,renderer:v,orbit_controls:E,clock:V}=this.threeService.init();this.scene=h,this.camera=m,this.renderer=v,this.orbit_controls=E,this.clock=V,this.updaetScene(),this.renderer.render(this.scene,this.camera),this.orbit_controls.update()}updaetScene(){var h;const m=new _e.y8_(2e3);this.scene.add(m);const v=new _e._12(5,5),E=new _e.YBo({color:16777215,side:_e.ehD}),V=new _e.Kj0(v,E);V.rotation.x=-.5*Math.PI,V.position.set(0,0,0),V.receiveShadow=!0;const j=new _e.Ox3(16777215);new _e.cBI(j,.2),j.position.set(1e3,1e3,1e3),j.target=V,j.castShadow=!0,this.renderer.shadowMap.enabled=!0,this.scene.add(j);const de=new kl;this.camera.far=1e4,this.camera.position.set(800,400,800),this.camera.updateProjectionMatrix(),de.load("assets/model/shanghai.FBX",be=>{this.scene.add(be),be.traverse(ge=>{ge.name===Cc&&(this.setMaterial(ge),this.aroundLine(ge))})}),null===(h=document.getElementById("shanghai-container"))||void 0===h||h.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(this.animation.bind(this))}setMaterial(h){h.geometry.computeBoundingBox(),h.geometry.computeBoundingSphere();const{geometry:m}=h,{max:V,min:j}=m.boundingBox,q=new _e.Pa4(V.x-j.x,V.y-j.y,V.z-j.z);h.material=new _e.jyz({uniforms:{uOpacity:{value:1},uTime:{value:.1},uSize:{value:q},scanColor:{value:new _e.Ilk(65280)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}aroundLine(h){const m=new _e.TOt(h.geometry),v=new _e.Pa4;h.getWorldPosition(v);const{max:E,min:V}=h.geometry.boundingBox,j=new _e.Pa4(E.x-V.x,E.y-V.y,E.z-V.z),q=this.lineMaterial({max:E,min:V,size:j}),de=new _e.ejS(m,q);de.name="aroundLine",de.scale.copy(h.scale),de.rotation.copy(h.rotation),de.position.copy(v),this.scene.add(de)}lineMaterial({max:h,min:m}){return this.lineShaderMaterial||(this.lineShaderMaterial=new _e.jyz({transparent:!0,uniforms:{uColor:{value:new _e.Ilk("#ffffff")},uActive:{value:new _e.Ilk("#000000")},uTime:{value:.1},uOpacity:{value:.6},uMax:{value:h},uMin:{value:m},uRange:{value:200},uSpeed:{value:.2},uStartTime:{value:.1}},vertexShader:"\n                    #define PI 3.14159265359\n\n                    uniform mediump float uStartTime;\n                    uniform mediump float uTime;\n                    uniform mediump float uRange;\n                    uniform mediump float uSpeed;\n                \n                    uniform vec3 uColor;\n                    uniform vec3 uActive;\n                    uniform vec3 uMin;\n                    uniform vec3 uMax;\n                \n                    varying vec3 vColor;\n                \n                    float lerp(float x, float y, float t) {\n                        return (1.0 - t) * x + t * y;\n                    }\n                    void main() { \n                        if (uStartTime >= 0.99) {\n                            float iTime = mod(uTime * uSpeed - uStartTime, 1.0);\n                            float rangeY = lerp(uMin.y, uMax.y, iTime);\n                            if (rangeY < position.y && rangeY > position.y - uRange) {\n                                float index = 1.0 - sin((position.y - rangeY) / uRange * PI);\n                                float r = lerp(uActive.r, uColor.r, index);\n                                float g = lerp(uActive.g, uColor.g, index);\n                                float b = lerp(uActive.b, uColor.b, index);\n                \n                                vColor = vec3(r, g, b);\n                                // vColor = vec3(0.0, 0.0, 0.0);\n                            } else {\n                                vColor = uColor;\n                            }\n                        }\n                        vec3 vPosition = vec3(position.x, position.y, position.z * uStartTime);\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n                    } \n      ",fragmentShader:"\n                    precision mediump float;\n\n                    float distanceTo(vec2 src, vec2 dst) {\n                        float dx = src.x - dst.x;\n                        float dy = src.y - dst.y;\n                        float dv = dx * dx + dy * dy;\n                        return sqrt(dv);\n                    } \n                    \n                    float lerp(float x, float y, float t) {\n                        return (1.0 - t) * x + t * y;\n                    }\n                    \n                    #define PI 3.14159265359\n                    #define PI2 6.28318530718\n                    uniform float uTime;\n                    uniform float uOpacity;\n                    uniform float uStartTime;\n\n                    varying vec3 vColor; \n\n                    void main() {\n\n                        gl_FragColor = vec4(vColor, uOpacity * uStartTime);\n                    }\n      "})),this.lineShaderMaterial}animation(){this.scene.traverse(function(h){h.name===Cc&&(h.material.uniforms.uTime.value+=.02),"aroundLine"===h.name&&h.material.uniforms.uStartTime.value<1&&(h.material.uniforms.uStartTime.value+=.02)}),this.renderer.render(this.scene,this.camera)}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(Cs.d))},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-shanghai"]],decls:2,vars:0,consts:[[1,"flex-box"],["id","shanghai-container"]],template:function(h,m){1&h&&(F.TgZ(0,"div",0),F._UZ(1,"div",1),F.qZA())},styles:[""]}),b})();var ja=ye(6246);function Bl(b,u){if(1&b){const h=F.EpF();F.TgZ(0,"span",3),F.NdJ("click",function(){const E=F.CHM(h).$implicit;return F.oxw().handleSwitchButtonClick(E)}),F.TgZ(1,"b",4),F._uU(2),F.qZA(),F._UZ(3,"i",5),F.qZA()}if(2&b){const h=u.$implicit;F.xp6(2),F.Oqu(h.name)}}const mu=[{name:"\u5ba2\u5385",key:"living",position:new _e.Pa4(0,0,0),target:new _e.Pa4(0,0,5)},{name:"\u5367\u5ba4",key:"bed",position:new _e.Pa4(-32,0,0),target:new _e.Pa4(0,0,5)},{name:"\u4e66\u623f",key:"book",position:new _e.Pa4(32,0,0),target:new _e.Pa4(32,6,8)}];let ws=(()=>{class b{constructor(h){this.threeService=h,this.rooms=mu}ngOnInit(){const{scene:h,camera:m,renderer:v,orbit_controls:E,clock:V}=this.threeService.init();this.scene=h,this.camera=m,this.renderer=v,this.orbit_controls=E,this.clock=V,this.updaetScene(),this.renderer.render(this.scene,this.camera),this.orbit_controls.update(),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()})}updaetScene(){var h;const m=new _e.dpR,v=new _e.xo$(16,50,50),E=new _e.vBJ({map:m.load("assets/map/map_living_room.jpg"),side:_e._Li}),V=new _e.Kj0(v,E);V.position.set(0,0,0),V.rotation.y=Math.PI/2,this.scene.add(V);const j=new _e.xo$(16,50,50),q=new _e.vBJ({map:m.load("assets/map/map_bed_room.jpg"),side:_e._Li}),de=new _e.Kj0(j,q);de.position.set(-32,0,0),de.rotation.y=3*Math.PI/5,this.scene.add(de);const be=new _e.xo$(16,50,50),ge=new _e.vBJ({map:m.load("assets/map/map_study_room.jpg"),side:_e._Li}),$e=new _e.Kj0(be,ge);$e.position.set(32,0,0),$e.rotation.y=4*Math.PI/5,this.scene.add($e),this.camera.position.x=-5,this.camera.lookAt(new _e.Pa4(1,0,0)),this.orbit_controls.enablePan=!1,this.orbit_controls.maxDistance=10,this.camera.updateProjectionMatrix(),null===(h=document.getElementById("room-sphere"))||void 0===h||h.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(this.animation.bind(this))}animation(){this.orbit_controls&&this.orbit_controls.update(),(0,ja.Vx)(),this.renderer.render(this.scene,this.camera)}handleSwitchButtonClick(h){const{x:m,y:v,z:E}=h.position,V=new _e.Pa4(m,v,2),j=new _e.Pa4(m,v,E);((b,u,h,m,v=2e3,E)=>{const V=new ja.kX({x1:b.position.x,y1:b.position.y,z1:b.position.z,x2:u.target.x,y2:u.target.y,z2:u.target.z});V.to({x1:h.x,y1:h.y,z1:h.z,x2:m.x,y2:m.y,z2:m.z},v),V.onUpdate(function(j){b.position.x=j.x1,b.position.y=j.y1,b.position.z=j.z1,u.target.x=j.x2,u.target.y=j.y2,u.target.z=j.z2,u.update()}),V.onComplete(function(){u.enabled=!0,u.update(),E()}),V.easing(ja.oY.Cubic.InOut),V.start()})(this.camera,this.orbit_controls,V,j,1600,()=>{console.log(this.orbit_controls.target)}),this.orbit_controls.update()}sort(){for(let h=0;h<100;h++);}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(Cs.d))},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-room"]],decls:3,vars:1,consts:[[1,"switch"],["class","button",3,"click",4,"ngFor","ngForOf"],["id","room-sphere"],[1,"button",3,"click"],[1,"text"],[1,"icon"]],template:function(h,m){1&h&&(F.TgZ(0,"div",0),F.YNc(1,Bl,4,1,"span",1),F.qZA(),F._UZ(2,"div",2)),2&h&&(F.xp6(1),F.Q6J("ngForOf",m.rooms))},directives:[N.sg],styles:[".switch[_ngcontent-%COMP%]{position:fixed;right:.5rem;top:40%;z-index:11;animation:slideInRight 1s .3s;animation-fill-mode:both}.switch[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{display:block;background:rgba(27,25,24,.5);border-radius:.5rem;display:flex;align-items:center;padding:.5rem .3rem .5rem 1rem;-webkit-backdrop-filter:blur(4px);-moz-backdrop-filter:blur(4px);backdrop-filter:blur(4px);cursor:pointer;transition:all .25s ease-in-out}.switch[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{color:#fff;font-size:1rem;font-weight:600}.switch[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]:not(last-child){margin-bottom:2rem}.switch[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:inline-block;height:30px;width:1rem;background-size:100% 100%;transform:rotate(180deg);margin-left:8px}.switch[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]:hover{background:rgba(27,25,24,.2);box-shadow:1px 1px 2px #0003}"]}),b})();var go=ye(5861),jo=ye(6497);const $a={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class $o{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const gl=new _e.iKG(-1,1,1,-1,0,1),ia=new _e.u9r;ia.setAttribute("position",new _e.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),ia.setAttribute("uv",new _e.a$l([0,2,0,0,2,0],2));class Fh{constructor(u){this._mesh=new _e.Kj0(ia,u)}dispose(){this._mesh.geometry.dispose()}render(u){u.render(this._mesh,gl)}get material(){return this._mesh.material}set material(u){this._mesh.material=u}}class Wu extends $o{constructor(u,h){super(),this.textureID=void 0!==h?h:"tDiffuse",u instanceof _e.jyz?(this.uniforms=u.uniforms,this.material=u):u&&(this.uniforms=_e.rDY.clone(u.uniforms),this.material=new _e.jyz({name:void 0!==u.name?u.name:"unspecified",defines:Object.assign({},u.defines),uniforms:this.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader})),this.fsQuad=new Fh(this.material)}render(u,h,m){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=m.texture),this.fsQuad.material=this.material,this.renderToScreen?(u.setRenderTarget(null),this.fsQuad.render(u)):(u.setRenderTarget(h),this.clear&&u.clear(u.autoClearColor,u.autoClearDepth,u.autoClearStencil),this.fsQuad.render(u))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class qr extends $o{constructor(u,h){super(),this.scene=u,this.camera=h,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(u,h,m){const v=u.getContext(),E=u.state;let V,j;E.buffers.color.setMask(!1),E.buffers.depth.setMask(!1),E.buffers.color.setLocked(!0),E.buffers.depth.setLocked(!0),this.inverse?(V=0,j=1):(V=1,j=0),E.buffers.stencil.setTest(!0),E.buffers.stencil.setOp(v.REPLACE,v.REPLACE,v.REPLACE),E.buffers.stencil.setFunc(v.ALWAYS,V,4294967295),E.buffers.stencil.setClear(j),E.buffers.stencil.setLocked(!0),u.setRenderTarget(m),this.clear&&u.clear(),u.render(this.scene,this.camera),u.setRenderTarget(h),this.clear&&u.clear(),u.render(this.scene,this.camera),E.buffers.color.setLocked(!1),E.buffers.depth.setLocked(!1),E.buffers.color.setMask(!0),E.buffers.depth.setMask(!0),E.buffers.stencil.setLocked(!1),E.buffers.stencil.setFunc(v.EQUAL,1,4294967295),E.buffers.stencil.setOp(v.KEEP,v.KEEP,v.KEEP),E.buffers.stencil.setLocked(!0)}}class ju extends $o{constructor(){super(),this.needsSwap=!1}render(u){u.state.buffers.stencil.setLocked(!1),u.state.buffers.stencil.setTest(!1)}}class $u{constructor(u,h){if(this.renderer=u,this._pixelRatio=u.getPixelRatio(),void 0===h){const m=u.getSize(new _e.FM8);this._width=m.width,this._height=m.height,(h=new _e.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:_e.cLu})).texture.name="EffectComposer.rt1"}else this._width=h.width,this._height=h.height;this.renderTarget1=h,this.renderTarget2=h.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Wu($a),this.copyPass.material.blending=_e.jFi,this.clock=new _e.SUY}swapBuffers(){const u=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=u}addPass(u){this.passes.push(u),u.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(u,h){this.passes.splice(h,0,u),u.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(u){const h=this.passes.indexOf(u);-1!==h&&this.passes.splice(h,1)}isLastEnabledPass(u){for(let h=u+1;h<this.passes.length;h++)if(this.passes[h].enabled)return!1;return!0}render(u){void 0===u&&(u=this.clock.getDelta());const h=this.renderer.getRenderTarget();let m=!1;for(let v=0,E=this.passes.length;v<E;v++){const V=this.passes[v];if(!1!==V.enabled){if(V.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(v),V.render(this.renderer,this.writeBuffer,this.readBuffer,u,m),V.needsSwap){if(m){const j=this.renderer.getContext(),q=this.renderer.state.buffers.stencil;q.setFunc(j.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,u),q.setFunc(j.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==qr&&(V instanceof qr?m=!0:V instanceof ju&&(m=!1))}}this.renderer.setRenderTarget(h)}reset(u){if(void 0===u){const h=this.renderer.getSize(new _e.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=h.width,this._height=h.height,(u=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=u,this.renderTarget2=u.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(u,h){this._width=u,this._height=h;const m=this._width*this._pixelRatio,v=this._height*this._pixelRatio;this.renderTarget1.setSize(m,v),this.renderTarget2.setSize(m,v);for(let E=0;E<this.passes.length;E++)this.passes[E].setSize(m,v)}setPixelRatio(u){this._pixelRatio=u,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class da extends $o{constructor(u,h,m,v,E){super(),this.scene=u,this.camera=h,this.overrideMaterial=m,this.clearColor=v,this.clearAlpha=void 0!==E?E:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new _e.Ilk}render(u,h,m){const v=u.autoClear;let E,V;u.autoClear=!1,void 0!==this.overrideMaterial&&(V=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(u.getClearColor(this._oldClearColor),E=u.getClearAlpha(),u.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&u.clearDepth(),u.setRenderTarget(this.renderToScreen?null:m),this.clear&&u.clear(u.autoClearColor,u.autoClearDepth,u.autoClearStencil),u.render(this.scene,this.camera),this.clearColor&&u.setClearColor(this._oldClearColor,E),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=V),u.autoClear=v}}const Fp={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new _e.Ilk(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class yo extends $o{constructor(u,h,m,v){super(),this.strength=void 0!==h?h:1,this.radius=m,this.threshold=v,this.resolution=void 0!==u?new _e.FM8(u.x,u.y):new _e.FM8(256,256),this.clearColor=new _e.Ilk(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let E=Math.round(this.resolution.x/2),V=Math.round(this.resolution.y/2);this.renderTargetBright=new _e.dd2(E,V,{type:_e.cLu}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let ge=0;ge<this.nMips;ge++){const $e=new _e.dd2(E,V,{type:_e.cLu});$e.texture.name="UnrealBloomPass.h"+ge,$e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push($e);const Ge=new _e.dd2(E,V,{type:_e.cLu});Ge.texture.name="UnrealBloomPass.v"+ge,Ge.texture.generateMipmaps=!1,this.renderTargetsVertical.push(Ge),E=Math.round(E/2),V=Math.round(V/2)}const j=Fp;this.highPassUniforms=_e.rDY.clone(j.uniforms),this.highPassUniforms.luminosityThreshold.value=v,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new _e.jyz({uniforms:this.highPassUniforms,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader}),this.separableBlurMaterials=[];const q=[3,5,7,9,11];E=Math.round(this.resolution.x/2),V=Math.round(this.resolution.y/2);for(let ge=0;ge<this.nMips;ge++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(q[ge])),this.separableBlurMaterials[ge].uniforms.invSize.value=new _e.FM8(1/E,1/V),E=Math.round(E/2),V=Math.round(V/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=h,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new _e.Pa4(1,1,1),new _e.Pa4(1,1,1),new _e.Pa4(1,1,1),new _e.Pa4(1,1,1),new _e.Pa4(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const be=$a;this.copyUniforms=_e.rDY.clone(be.uniforms),this.blendMaterial=new _e.jyz({uniforms:this.copyUniforms,vertexShader:be.vertexShader,fragmentShader:be.fragmentShader,blending:_e.WMw,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new _e.Ilk,this.oldClearAlpha=1,this.basic=new _e.vBJ,this.fsQuad=new Fh(null)}dispose(){for(let u=0;u<this.renderTargetsHorizontal.length;u++)this.renderTargetsHorizontal[u].dispose();for(let u=0;u<this.renderTargetsVertical.length;u++)this.renderTargetsVertical[u].dispose();this.renderTargetBright.dispose();for(let u=0;u<this.separableBlurMaterials.length;u++)this.separableBlurMaterials[u].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(u,h){let m=Math.round(u/2),v=Math.round(h/2);this.renderTargetBright.setSize(m,v);for(let E=0;E<this.nMips;E++)this.renderTargetsHorizontal[E].setSize(m,v),this.renderTargetsVertical[E].setSize(m,v),this.separableBlurMaterials[E].uniforms.invSize.value=new _e.FM8(1/m,1/v),m=Math.round(m/2),v=Math.round(v/2)}render(u,h,m,v,E){u.getClearColor(this._oldClearColor),this.oldClearAlpha=u.getClearAlpha();const V=u.autoClear;u.autoClear=!1,u.setClearColor(this.clearColor,0),E&&u.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=m.texture,u.setRenderTarget(null),u.clear(),this.fsQuad.render(u)),this.highPassUniforms.tDiffuse.value=m.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,u.setRenderTarget(this.renderTargetBright),u.clear(),this.fsQuad.render(u);let j=this.renderTargetBright;for(let q=0;q<this.nMips;q++)this.fsQuad.material=this.separableBlurMaterials[q],this.separableBlurMaterials[q].uniforms.colorTexture.value=j.texture,this.separableBlurMaterials[q].uniforms.direction.value=yo.BlurDirectionX,u.setRenderTarget(this.renderTargetsHorizontal[q]),u.clear(),this.fsQuad.render(u),this.separableBlurMaterials[q].uniforms.colorTexture.value=this.renderTargetsHorizontal[q].texture,this.separableBlurMaterials[q].uniforms.direction.value=yo.BlurDirectionY,u.setRenderTarget(this.renderTargetsVertical[q]),u.clear(),this.fsQuad.render(u),j=this.renderTargetsVertical[q];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,u.setRenderTarget(this.renderTargetsHorizontal[0]),u.clear(),this.fsQuad.render(u),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,E&&u.state.buffers.stencil.setTest(!0),this.renderToScreen?(u.setRenderTarget(null),this.fsQuad.render(u)):(u.setRenderTarget(m),this.fsQuad.render(u)),u.setClearColor(this._oldClearColor,this.oldClearAlpha),u.autoClear=V}getSeperableBlurMaterial(u){const h=[];for(let m=0;m<u;m++)h.push(.39894*Math.exp(-.5*m*m/(u*u))/u);return new _e.jyz({defines:{KERNEL_RADIUS:u},uniforms:{colorTexture:{value:null},invSize:{value:new _e.FM8(.5,.5)},direction:{value:new _e.FM8(.5,.5)},gaussianCoefficients:{value:h}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(u){return new _e.jyz({defines:{NUM_MIPS:u},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}yo.BlurDirectionX=new _e.FM8(1,0),yo.BlurDirectionY=new _e.FM8(0,1);const yl=[{path:"",component:cs,children:[{path:"star",component:Uo},{path:"cube",component:Ds},{path:"shanghai",component:Wa},{path:"room",component:ws},{path:"gltf",component:(()=>{class b{constructor(h){this.threeService=h}ngOnInit(){const{scene:h,camera:m,renderer:v,orbit_controls:E,clock:V}=this.threeService.init();this.scene=h,this.camera=m,this.renderer=v,this.orbit_controls=E,this.clock=V,this.updaetScene(),this.renderer.render(this.scene,this.camera),this.orbit_controls.update(),this.renderer.setClearColor(4386,1),this.renderer.setPixelRatio(window.devicePixelRatio),this.raycaster=new _e.iMs}updaetScene(){var h=this;return(0,go.Z)(function*(){var m;const v=new jo.E;v.load("assets/model/gltf/road.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/building_A.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/building_B.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/building_C.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/building_D.glb",q=>{const de=new _e.vBJ({color:48895,transparent:!0,opacity:.1,wireframe:!0});console.log(123,q),q.scene.traverse(be=>{-1==be.name.indexOf("camera")&&-1==be.name.indexOf("electricity")&&(be.material=de)}),h.scene.add(q.scene)}),v.load("assets/model/gltf/building_Park.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/other_building.glb",q=>{const de=q.scene.getObjectByName("\u5176\u4f59\u5efa\u7b51003");de.position.set(17,0,-30);const be=de.clone();be.position.set(-17,0,-30);const ge=de.clone();ge.position.set(40,0,-30);const $e=de.clone();$e.position.set(-40,0,-30),q.scene.add(be,ge,$e),h.scene.add(q.scene)}),v.load("assets/model/gltf/tree.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/\u8def\u706f.glb",q=>{h.scene.add(q.scene)}),v.load("assets/model/gltf/\u8f66\u4f4d\u8f66\u8f86.glb",q=>{});const E=yield(new _e.dpR).load("assets/map/snow.png"),j=(new _e.xeV({map:E,transparent:!0}),new _e.Mig(16777215,.4));h.scene.add(j),h.camera.position.set(100,50,0),h.camera.lookAt(new _e.Pa4(0,0,0)),h.orbit_controls.enablePan=!1,h.camera.updateProjectionMatrix(),null===(m=document.getElementById("park"))||void 0===m||m.appendChild(h.renderer.domElement),h.renderer.setAnimationLoop(h.animation.bind(h))})()}onPointerClick(h){const m=new _e.FM8;m.x=h.clientX/window.innerWidth*2-1,m.y=-h.clientY/window.innerHeight*2+1,console.log(m),this.raycasterFun(m)}raycasterFun(h){var m;this.raycaster.setFromCamera(h,this.camera);let v=this.raycaster.intersectObject(this.scene);const E=v.length>0?v[0]:null;E&&console.log(null===(m=E.object.parent)||void 0===m?void 0:m.name)}animation(){const h=this.scene.getObjectByName("sprite");null==h||h.children.forEach(m=>{m.position.y-=1,m.rotation.z+=.01,m.position.y<0&&(m.position.y=300)}),this.orbit_controls&&this.orbit_controls.update(),(0,ja.Vx)(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera)}initBloom(){const h=new da(this.scene,this.camera),m=new yo(new _e.FM8(window.innerWidth,window.innerHeight),1.5,.4,.85);m.threshold=.4,m.strength=1.5,m.radius=.4,this.composer=new $u(this.renderer),this.composer.addPass(h),this.composer.addPass(m)}aciveBuildA(){this.scene.traverse(h=>{if("buildingD"==h.name){console.log("look at");const m=100;new ja.kX({angle:0}).to({angle:Math.PI*(1/4)},2e3).onUpdate(E=>{this.camera.position.x=m*Math.cos(E.angle),this.camera.position.z=m*Math.sin(E.angle),this.camera.lookAt(h.position)}).start()}})}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(Cs.d))},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-gltf"]],hostBindings:function(h,m){1&h&&F.NdJ("click",function(E){return m.onPointerClick(E)},!1,F.Jf7)},decls:2,vars:0,consts:[[1,"controls-content"],["id","park"]],template:function(h,m){1&h&&F._UZ(0,"div",0)(1,"div",1)},styles:[".controls-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%);top:0;color:#fff;cursor:pointer;display:flex;width:50%;justify-content:center;padding:10px}.controls-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:0 20px}"]}),b})()},{path:"point",component:(()=>{class b{constructor(h){this.threeService=h,this.vertexShader="\n                          //vertexShader\n                          precision lowp float;\n                          varying vec2 vUv;\n                          uniform float uTime;\n                          varying vec3 vColor;\n                          attribute vec4 aShift;\n                          const float PI = 3.1415925;\n                          void main() {\n                            vec3 color1 = vec3(227., 155., 0.);\n                            vec3 color2 = vec3(100., 50., 255.);\n                            float d  = abs(position.y) / 10.0;\n                            vColor = mix(color2, color1, d) / 255.;\n                            vUv = uv;\n\n                            vec3 transformed = position;\n                            float theta = mod(aShift.x + aShift.z * uTime, PI * 2.);\n                            float phi = mod(aShift.y +aShift.z * uTime, PI * 2.);\n                            transformed += vec3(sin(phi) * cos(theta), cos(phi), sin(phi) * sin(theta)) * aShift.w;\n\n                            vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n                            gl_PointSize = 50.0 / -mvPosition.z;\n                            gl_Position = projectionMatrix * mvPosition;\n                        }",this.fragmentShader="\n                        //fragmentShader\n                        precision lowp float;\n                        varying vec2 vUv;\n                        varying vec3 vColor;\n                        void main() {\n                          float r = length(gl_PointCoord - 0.5);\n                          if(r > 0.5) discard;\n                          gl_FragColor = vec4(vColor, smoothstep(0.5, 0.1, r));\n                        }\n                      "}ngOnInit(){const{scene:h,camera:m,renderer:v,orbit_controls:E,clock:V}=this.threeService.init();this.scene=h,this.camera=m,this.renderer=v,this.orbit_controls=E,this.clock=V,this.updaetScene(),this.renderer.render(this.scene,this.camera),this.orbit_controls.update()}updaetScene(){var h;new _e.y8_(30);const v=new _e._12(5,5),E=new _e.YBo({color:16777215}),V=new _e.Kj0(v,E);V.rotation.x=-.5*Math.PI,V.position.set(0,0,0),V.receiveShadow=!0,new _e.cJO(4,6),new _e.UY4({color:16777215,size:.05});const de=new _e.u9r,be=[],ge=[];for(let En=0;En<11e4;En++){let ni=Math.random()*Math.PI*2,Qn=Math.acos(2*Math.random()-1),si=(.9*Math.random()+.1)*Math.PI*.1,oi=.9*Math.random()+.1;if(ge.push(ni,Qn,si,oi),En<1e4){const{x:Dn,y:Cr,z:ui}=(new _e.Pa4).randomDirection().multiplyScalar(.5*Math.random()+9.5);be.push(Dn,Cr,ui)}else{const ui=Math.pow(Math.random(),1.5),hi=Math.sqrt(1600*ui+10*(1-ui)*10),{x:jr,y:mr,z:Dr}=(new _e.Pa4).setFromCylindricalCoords(hi,2*Math.random()*Math.PI,2*(Math.random()-.5));be.push(jr,mr,Dr)}}de.setAttribute("position",new _e.a$l(be,3)),de.setAttribute("aShift",new _e.a$l(ge,4));const It=new _e.jyz({uniforms:{uTime:{value:0}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,depthTest:!1,transparent:!0,blending:_e.WMw}),wn=new _e.woe(de,It);wn.name="sphere",this.scene.add(wn);const Qt=new _e.Ox3(16777215);new _e.cBI(Qt,.2),Qt.position.set(-3,2,-1),Qt.target=V,Qt.castShadow=!0,this.renderer.shadowMap.enabled=!0,this.renderer.capabilities.logarithmicDepthBuffer=!1,this.camera.position.set(10,10,10),null===(h=document.getElementById("point-container"))||void 0===h||h.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(this.animation.bind(this))}animation(){this.scene.traverse(h=>{"box"===h.name&&(h.material.uniforms.uTime.value+=.02),"sphere"===h.name&&(h.material.uniforms.uTime.value+=.02,h.rotation.y+=5e-4)}),this.renderer.render(this.scene,this.camera)}}return b.\u0275fac=function(h){return new(h||b)(F.Y36(Cs.d))},b.\u0275cmp=F.Xpm({type:b,selectors:[["app-point"]],decls:2,vars:0,consts:[[1,"flex-box"],["id","point-container"]],template:function(h,m){1&h&&(F.TgZ(0,"div",0),F._UZ(1,"div",1),F.qZA())},styles:[""]}),b})()}]}];let Nh=(()=>{class b{}return b.\u0275fac=function(h){return new(h||b)},b.\u0275mod=F.oAB({type:b}),b.\u0275inj=F.cJS({imports:[[ko.Bz.forChild(yl)],ko.Bz]}),b})(),gn=(()=>{class b{}return b.\u0275fac=function(h){return new(h||b)},b.\u0275mod=F.oAB({type:b}),b.\u0275inj=F.cJS({providers:[Cs.d],imports:[[N.ez,Nh,Er,No.forRoot({loader:jt})]]}),b})()},6070:(qn,Rt,ye)=>{var N=ye(2313),F=ye(1223),Ze=ye(6324),mt=ye(6682),ut=ye(6497),sn=ye(6246),Xt=ye(2810);const Mn=[{path:"",redirectTo:"index",pathMatch:"full"},{path:"index",component:(()=>{class B{constructor(P){this.threeService=P}ngOnInit(){const{scene:P,camera:se,renderer:it,orbit_controls:Ct,clock:pr}=this.threeService.init();this.scene=P,this.camera=se,this.renderer=it,this.orbit_controls=Ct,this.clock=pr,this.updateScene(),this.renderer.render(this.scene,this.camera),this.orbit_controls.update(),this.renderer.setClearColor(14606046,1),this.renderer.setPixelRatio(window.devicePixelRatio)}updateScene(){var P;const se=new ut.E,it=new mt.dpR,Ct=it.load("assets/model/room/baked1.jpg");Ct.flipY=!1,Ct.colorSpace=mt.KI_;const pr=new mt.vBJ({map:Ct,side:mt.ehD}),Et=it.load("assets/model/room/desktop0.png");Et.colorSpace=mt.KI_,Et.offset.y=.001;const Mi=new mt.vBJ({map:Et}),ho=it.load("assets/model/room/desktop1.png");ho.colorSpace=mt.KI_;const Aa=new mt.vBJ({map:ho});se.load("assets/model/room/room.glb",ps=>{ps.scene.traverse(Lr=>{"desktop-plane-0"!==Lr.name&&"desktop-plane-1"!==Lr.name&&(Lr.material=pr),"desktop-plane-0"==Lr.name&&(Lr.material=Mi,new sn.kX({y:-.3}).delay(1e3).to({y:-.1},8e3).onUpdate(Pl=>{Lr.material.map.offset.y=Pl.y}),new sn.kX({y:0}).to({y:-.3},6e3).onUpdate(Pl=>{Lr.material.map.offset.y=Pl.y}).delay(5e3).repeat(1/0).yoyo(!0).start()),"desktop-plane-1"==Lr.name&&(Lr.material=Aa)}),this.scene.add(ps.scene)});const ea=it.load("assets/model/room/shadow-baked.jpg");ea.flipY=!1,ea.colorSpace=mt.KI_;const Wr=new mt.vBJ({map:ea,side:mt.ehD});se.load("assets/model/room/shadow-model.glb",ps=>{}),se.load("assets/model/room/shadow-model1.glb",ps=>{}),se.load("assets/model/room/shadow-model2.glb",ps=>{ps.scene.traverse(Lr=>{Lr.material=Wr}),this.scene.add(ps.scene)}),se.load("assets/model/hz/map001_buildings.068.bin",ps=>{console.log("hz",ps)});const Rs=new mt.Mig(16777215,.4);this.scene.add(Rs);const ic=new mt.Ox3(16777215,.5);this.scene.add(ic),this.camera.position.set(12,6,-9),this.camera.lookAt(new mt.Pa4(0,0,0)),this.orbit_controls.enablePan=!1,this.camera.updateProjectionMatrix(),null===(P=document.getElementById("home"))||void 0===P||P.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(this.animation.bind(this))}animation(){this.orbit_controls&&this.orbit_controls.update(),(0,sn.Vx)(),this.renderer.render(this.scene,this.camera)}}return B.\u0275fac=function(P){return new(P||B)(F.Y36(Xt.d))},B.\u0275cmp=F.Xpm({type:B,selectors:[["app-home"]],decls:1,vars:0,consts:[["id","home"]],template:function(P,se){1&P&&F._UZ(0,"div",0)},styles:[""]}),B})()},{path:"shader",loadChildren:()=>Promise.resolve().then(ye.bind(ye,7368)).then(B=>B.ShaderModule)}];let Ut=(()=>{class B{}return B.\u0275fac=function(P){return new(P||B)},B.\u0275mod=F.oAB({type:B}),B.\u0275inj=F.cJS({imports:[[Ze.Bz.forRoot(Mn,{useHash:!0})],Ze.Bz]}),B})(),lt=(()=>{class B{constructor(){this.title="docs"}ngOnInit(){}}return B.\u0275fac=function(P){return new(P||B)},B.\u0275cmp=F.Xpm({type:B,selectors:[["app-root"]],decls:1,vars:0,template:function(P,se){1&P&&F._UZ(0,"router-outlet")},directives:[Ze.lC],styles:[""]}),B})();var Ft=ye(7368),ri=ye(9808);ye(2076),ye(8306),ye(4742),ye(8421),ye(7669),ye(5403),ye(3268),ye(1810),ye(4004);let yr=(()=>{class B{}return B.\u0275fac=function(P){return new(P||B)},B.\u0275mod=F.oAB({type:B}),B.\u0275inj=F.cJS({}),B})(),ul=(()=>{class B{}return B.\u0275fac=function(P){return new(P||B)},B.\u0275mod=F.oAB({type:B}),B.\u0275inj=F.cJS({imports:[[yr]]}),B})(),tc=(()=>{class B{}return B.\u0275fac=function(P){return new(P||B)},B.\u0275mod=F.oAB({type:B}),B.\u0275inj=F.cJS({imports:[ul]}),B})(),lu=(()=>{class B{}return B.\u0275fac=function(P){return new(P||B)},B.\u0275mod=F.oAB({type:B,bootstrap:[lt]}),B.\u0275inj=F.cJS({providers:[],imports:[[N.b2,ri.ez,tc,Ut,Ft.ShaderModule]]}),B})();(0,F.G48)(),N.q6().bootstrapModule(lu).catch(B=>console.error(B))},8306:(qn,Rt,ye)=>{ye.d(Rt,{y:()=>Ut});var N=ye(2961),F=ye(727),Ze=ye(8822),mt=ye(4671);var Xt=ye(2416),_n=ye(576),Mn=ye(2806);let Ut=(()=>{class fe{constructor(gt){gt&&(this._subscribe=gt)}lift(gt){const Gn=new fe;return Gn.source=this,Gn.operator=gt,Gn}subscribe(gt,Gn,Vn){const ce=function ri(fe){return fe&&fe instanceof N.Lv||function Ft(fe){return fe&&(0,_n.m)(fe.next)&&(0,_n.m)(fe.error)&&(0,_n.m)(fe.complete)}(fe)&&(0,F.Nn)(fe)}(gt)?gt:new N.Hp(gt,Gn,Vn);return(0,Mn.x)(()=>{const{operator:ke,source:Ye}=this;ce.add(ke?ke.call(ce,Ye):Ye?this._subscribe(ce):this._trySubscribe(ce))}),ce}_trySubscribe(gt){try{return this._subscribe(gt)}catch(Gn){gt.error(Gn)}}forEach(gt,Gn){return new(Gn=lt(Gn))((Vn,ce)=>{const ke=new N.Hp({next:Ye=>{try{gt(Ye)}catch(rt){ce(rt),ke.unsubscribe()}},error:ce,complete:Vn});this.subscribe(ke)})}_subscribe(gt){var Gn;return null===(Gn=this.source)||void 0===Gn?void 0:Gn.subscribe(gt)}[Ze.L](){return this}pipe(...gt){return function sn(fe){return 0===fe.length?mt.y:1===fe.length?fe[0]:function(gt){return fe.reduce((Gn,Vn)=>Vn(Gn),gt)}}(gt)(this)}toPromise(gt){return new(gt=lt(gt))((Gn,Vn)=>{let ce;this.subscribe(ke=>ce=ke,ke=>Vn(ke),()=>Gn(ce))})}}return fe.create=bn=>new fe(bn),fe})();function lt(fe){var bn;return null!==(bn=null!=fe?fe:Xt.v.Promise)&&void 0!==bn?bn:Promise}},7579:(qn,Rt,ye)=>{ye.d(Rt,{x:()=>Xt});var N=ye(8306),F=ye(727);const mt=(0,ye(3888).d)(Mn=>function(){Mn(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ut=ye(8737),sn=ye(2806);let Xt=(()=>{class Mn extends N.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(lt){const Ft=new _n(this,this);return Ft.operator=lt,Ft}_throwIfClosed(){if(this.closed)throw new mt}next(lt){(0,sn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Ft of this.currentObservers)Ft.next(lt)}})}error(lt){(0,sn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=lt;const{observers:Ft}=this;for(;Ft.length;)Ft.shift().error(lt)}})}complete(){(0,sn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:lt}=this;for(;lt.length;)lt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var lt;return(null===(lt=this.observers)||void 0===lt?void 0:lt.length)>0}_trySubscribe(lt){return this._throwIfClosed(),super._trySubscribe(lt)}_subscribe(lt){return this._throwIfClosed(),this._checkFinalizedStatuses(lt),this._innerSubscribe(lt)}_innerSubscribe(lt){const{hasError:Ft,isStopped:ri,observers:fe}=this;return Ft||ri?F.Lc:(this.currentObservers=null,fe.push(lt),new F.w0(()=>{this.currentObservers=null,(0,ut.P)(fe,lt)}))}_checkFinalizedStatuses(lt){const{hasError:Ft,thrownError:ri,isStopped:fe}=this;Ft?lt.error(ri):fe&&lt.complete()}asObservable(){const lt=new N.y;return lt.source=this,lt}}return Mn.create=(Ut,lt)=>new _n(Ut,lt),Mn})();class _n extends Xt{constructor(Ut,lt){super(),this.destination=Ut,this.source=lt}next(Ut){var lt,Ft;null===(Ft=null===(lt=this.destination)||void 0===lt?void 0:lt.next)||void 0===Ft||Ft.call(lt,Ut)}error(Ut){var lt,Ft;null===(Ft=null===(lt=this.destination)||void 0===lt?void 0:lt.error)||void 0===Ft||Ft.call(lt,Ut)}complete(){var Ut,lt;null===(lt=null===(Ut=this.destination)||void 0===Ut?void 0:Ut.complete)||void 0===lt||lt.call(Ut)}_subscribe(Ut){var lt,Ft;return null!==(Ft=null===(lt=this.source)||void 0===lt?void 0:lt.subscribe(Ut))&&void 0!==Ft?Ft:F.Lc}}},2961:(qn,Rt,ye)=>{ye.d(Rt,{Hp:()=>gt,Lv:()=>Ft});var N=ye(576),F=ye(727),Ze=ye(2416),mt=ye(7849);function ut(){}const sn=Mn("C",void 0,void 0);function Mn(Ye,rt,nt){return{kind:Ye,value:rt,error:nt}}var Ut=ye(3410),lt=ye(2806);class Ft extends F.w0{constructor(rt){super(),this.isStopped=!1,rt?(this.destination=rt,(0,F.Nn)(rt)&&rt.add(this)):this.destination=ke}static create(rt,nt,on){return new gt(rt,nt,on)}next(rt){this.isStopped?ce(function _n(Ye){return Mn("N",Ye,void 0)}(rt),this):this._next(rt)}error(rt){this.isStopped?ce(function Xt(Ye){return Mn("E",void 0,Ye)}(rt),this):(this.isStopped=!0,this._error(rt))}complete(){this.isStopped?ce(sn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(rt){this.destination.next(rt)}_error(rt){try{this.destination.error(rt)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ri=Function.prototype.bind;function fe(Ye,rt){return ri.call(Ye,rt)}class bn{constructor(rt){this.partialObserver=rt}next(rt){const{partialObserver:nt}=this;if(nt.next)try{nt.next(rt)}catch(on){Gn(on)}}error(rt){const{partialObserver:nt}=this;if(nt.error)try{nt.error(rt)}catch(on){Gn(on)}else Gn(rt)}complete(){const{partialObserver:rt}=this;if(rt.complete)try{rt.complete()}catch(nt){Gn(nt)}}}class gt extends Ft{constructor(rt,nt,on){let Qe;if(super(),(0,N.m)(rt)||!rt)Qe={next:null!=rt?rt:void 0,error:null!=nt?nt:void 0,complete:null!=on?on:void 0};else{let Tt;this&&Ze.v.useDeprecatedNextContext?(Tt=Object.create(rt),Tt.unsubscribe=()=>this.unsubscribe(),Qe={next:rt.next&&fe(rt.next,Tt),error:rt.error&&fe(rt.error,Tt),complete:rt.complete&&fe(rt.complete,Tt)}):Qe=rt}this.destination=new bn(Qe)}}function Gn(Ye){Ze.v.useDeprecatedSynchronousErrorHandling?(0,lt.O)(Ye):(0,mt.h)(Ye)}function ce(Ye,rt){const{onStoppedNotification:nt}=Ze.v;nt&&Ut.z.setTimeout(()=>nt(Ye,rt))}const ke={closed:!0,next:ut,error:function Vn(Ye){throw Ye},complete:ut}},727:(qn,Rt,ye)=>{ye.d(Rt,{Lc:()=>sn,w0:()=>ut,Nn:()=>Xt});var N=ye(576);const Ze=(0,ye(3888).d)(Mn=>function(lt){Mn(this),this.message=lt?`${lt.length} errors occurred during unsubscription:\n${lt.map((Ft,ri)=>`${ri+1}) ${Ft.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=lt});var mt=ye(8737);class ut{constructor(Ut){this.initialTeardown=Ut,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Ut;if(!this.closed){this.closed=!0;const{_parentage:lt}=this;if(lt)if(this._parentage=null,Array.isArray(lt))for(const fe of lt)fe.remove(this);else lt.remove(this);const{initialTeardown:Ft}=this;if((0,N.m)(Ft))try{Ft()}catch(fe){Ut=fe instanceof Ze?fe.errors:[fe]}const{_finalizers:ri}=this;if(ri){this._finalizers=null;for(const fe of ri)try{_n(fe)}catch(bn){Ut=null!=Ut?Ut:[],bn instanceof Ze?Ut=[...Ut,...bn.errors]:Ut.push(bn)}}if(Ut)throw new Ze(Ut)}}add(Ut){var lt;if(Ut&&Ut!==this)if(this.closed)_n(Ut);else{if(Ut instanceof ut){if(Ut.closed||Ut._hasParent(this))return;Ut._addParent(this)}(this._finalizers=null!==(lt=this._finalizers)&&void 0!==lt?lt:[]).push(Ut)}}_hasParent(Ut){const{_parentage:lt}=this;return lt===Ut||Array.isArray(lt)&&lt.includes(Ut)}_addParent(Ut){const{_parentage:lt}=this;this._parentage=Array.isArray(lt)?(lt.push(Ut),lt):lt?[lt,Ut]:Ut}_removeParent(Ut){const{_parentage:lt}=this;lt===Ut?this._parentage=null:Array.isArray(lt)&&(0,mt.P)(lt,Ut)}remove(Ut){const{_finalizers:lt}=this;lt&&(0,mt.P)(lt,Ut),Ut instanceof ut&&Ut._removeParent(this)}}ut.EMPTY=(()=>{const Mn=new ut;return Mn.closed=!0,Mn})();const sn=ut.EMPTY;function Xt(Mn){return Mn instanceof ut||Mn&&"closed"in Mn&&(0,N.m)(Mn.remove)&&(0,N.m)(Mn.add)&&(0,N.m)(Mn.unsubscribe)}function _n(Mn){(0,N.m)(Mn)?Mn():Mn.unsubscribe()}},2416:(qn,Rt,ye)=>{ye.d(Rt,{v:()=>N});const N={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(qn,Rt,ye)=>{ye.d(Rt,{E:()=>F});const F=new(ye(8306).y)(ut=>ut.complete())},2076:(qn,Rt,ye)=>{ye.d(Rt,{D:()=>on});var N=ye(8421),F=ye(9672),Ze=ye(4482),mt=ye(5403);function ut(Qe,Tt=0){return(0,Ze.e)((Cn,kn)=>{Cn.subscribe((0,mt.x)(kn,ai=>(0,F.f)(kn,Qe,()=>kn.next(ai),Tt),()=>(0,F.f)(kn,Qe,()=>kn.complete(),Tt),ai=>(0,F.f)(kn,Qe,()=>kn.error(ai),Tt)))})}function sn(Qe,Tt=0){return(0,Ze.e)((Cn,kn)=>{kn.add(Qe.schedule(()=>Cn.subscribe(kn),Tt))})}var Mn=ye(8306),lt=ye(2202),Ft=ye(576);function fe(Qe,Tt){if(!Qe)throw new Error("Iterable cannot be null");return new Mn.y(Cn=>{(0,F.f)(Cn,Tt,()=>{const kn=Qe[Symbol.asyncIterator]();(0,F.f)(Cn,Tt,()=>{kn.next().then(ai=>{ai.done?Cn.complete():Cn.next(ai.value)})},0,!0)})})}var bn=ye(3670),gt=ye(8239),Gn=ye(1144),Vn=ye(6495),ce=ye(2206),ke=ye(4532),Ye=ye(3260);function on(Qe,Tt){return Tt?function nt(Qe,Tt){if(null!=Qe){if((0,bn.c)(Qe))return function Xt(Qe,Tt){return(0,N.Xf)(Qe).pipe(sn(Tt),ut(Tt))}(Qe,Tt);if((0,Gn.z)(Qe))return function Ut(Qe,Tt){return new Mn.y(Cn=>{let kn=0;return Tt.schedule(function(){kn===Qe.length?Cn.complete():(Cn.next(Qe[kn++]),Cn.closed||this.schedule())})})}(Qe,Tt);if((0,gt.t)(Qe))return function _n(Qe,Tt){return(0,N.Xf)(Qe).pipe(sn(Tt),ut(Tt))}(Qe,Tt);if((0,ce.D)(Qe))return fe(Qe,Tt);if((0,Vn.T)(Qe))return function ri(Qe,Tt){return new Mn.y(Cn=>{let kn;return(0,F.f)(Cn,Tt,()=>{kn=Qe[lt.h](),(0,F.f)(Cn,Tt,()=>{let ai,mn;try{({value:ai,done:mn}=kn.next())}catch(Jn){return void Cn.error(Jn)}mn?Cn.complete():Cn.next(ai)},0,!0)}),()=>(0,Ft.m)(null==kn?void 0:kn.return)&&kn.return()})}(Qe,Tt);if((0,Ye.L)(Qe))return function rt(Qe,Tt){return fe((0,Ye.Q)(Qe),Tt)}(Qe,Tt)}throw(0,ke.z)(Qe)}(Qe,Tt):(0,N.Xf)(Qe)}},8421:(qn,Rt,ye)=>{ye.d(Rt,{Xf:()=>ri});var N=ye(7582),F=ye(1144),Ze=ye(8239),mt=ye(8306),ut=ye(3670),sn=ye(2206),Xt=ye(4532),_n=ye(6495),Mn=ye(3260),Ut=ye(576),lt=ye(7849),Ft=ye(8822);function ri(Ye){if(Ye instanceof mt.y)return Ye;if(null!=Ye){if((0,ut.c)(Ye))return function fe(Ye){return new mt.y(rt=>{const nt=Ye[Ft.L]();if((0,Ut.m)(nt.subscribe))return nt.subscribe(rt);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Ye);if((0,F.z)(Ye))return function bn(Ye){return new mt.y(rt=>{for(let nt=0;nt<Ye.length&&!rt.closed;nt++)rt.next(Ye[nt]);rt.complete()})}(Ye);if((0,Ze.t)(Ye))return function gt(Ye){return new mt.y(rt=>{Ye.then(nt=>{rt.closed||(rt.next(nt),rt.complete())},nt=>rt.error(nt)).then(null,lt.h)})}(Ye);if((0,sn.D)(Ye))return Vn(Ye);if((0,_n.T)(Ye))return function Gn(Ye){return new mt.y(rt=>{for(const nt of Ye)if(rt.next(nt),rt.closed)return;rt.complete()})}(Ye);if((0,Mn.L)(Ye))return function ce(Ye){return Vn((0,Mn.Q)(Ye))}(Ye)}throw(0,Xt.z)(Ye)}function Vn(Ye){return new mt.y(rt=>{(function ke(Ye,rt){var nt,on,Qe,Tt;return(0,N.mG)(this,void 0,void 0,function*(){try{for(nt=(0,N.KL)(Ye);!(on=yield nt.next()).done;)if(rt.next(on.value),rt.closed)return}catch(Cn){Qe={error:Cn}}finally{try{on&&!on.done&&(Tt=nt.return)&&(yield Tt.call(nt))}finally{if(Qe)throw Qe.error}}rt.complete()})})(Ye,rt).catch(nt=>rt.error(nt))})}},9646:(qn,Rt,ye)=>{ye.d(Rt,{of:()=>Ze});var N=ye(7669),F=ye(2076);function Ze(...mt){const ut=(0,N.yG)(mt);return(0,F.D)(mt,ut)}},5403:(qn,Rt,ye)=>{ye.d(Rt,{x:()=>F});var N=ye(2961);function F(mt,ut,sn,Xt,_n){return new Ze(mt,ut,sn,Xt,_n)}class Ze extends N.Lv{constructor(ut,sn,Xt,_n,Mn,Ut){super(ut),this.onFinalize=Mn,this.shouldUnsubscribe=Ut,this._next=sn?function(lt){try{sn(lt)}catch(Ft){ut.error(Ft)}}:super._next,this._error=_n?function(lt){try{_n(lt)}catch(Ft){ut.error(Ft)}finally{this.unsubscribe()}}:super._error,this._complete=Xt?function(){try{Xt()}catch(lt){ut.error(lt)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ut;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:sn}=this;super.unsubscribe(),!sn&&(null===(ut=this.onFinalize)||void 0===ut||ut.call(this))}}}},4351:(qn,Rt,ye)=>{ye.d(Rt,{b:()=>Ze});var N=ye(5577),F=ye(576);function Ze(mt,ut){return(0,F.m)(ut)?(0,N.z)(mt,ut,1):(0,N.z)(mt,1)}},6590:(qn,Rt,ye)=>{ye.d(Rt,{d:()=>Ze});var N=ye(4482),F=ye(5403);function Ze(mt){return(0,N.e)((ut,sn)=>{let Xt=!1;ut.subscribe((0,F.x)(sn,_n=>{Xt=!0,sn.next(_n)},()=>{Xt||sn.next(mt),sn.complete()}))})}},9300:(qn,Rt,ye)=>{ye.d(Rt,{h:()=>Ze});var N=ye(4482),F=ye(5403);function Ze(mt,ut){return(0,N.e)((sn,Xt)=>{let _n=0;sn.subscribe((0,F.x)(Xt,Mn=>mt.call(ut,Mn,_n++)&&Xt.next(Mn)))})}},590:(qn,Rt,ye)=>{ye.d(Rt,{P:()=>Xt});var N=ye(6805),F=ye(9300),Ze=ye(5698),mt=ye(6590),ut=ye(8068),sn=ye(4671);function Xt(_n,Mn){const Ut=arguments.length>=2;return lt=>lt.pipe(_n?(0,F.h)((Ft,ri)=>_n(Ft,ri,lt)):sn.y,(0,Ze.q)(1),Ut?(0,mt.d)(Mn):(0,ut.T)(()=>new N.K))}},4004:(qn,Rt,ye)=>{ye.d(Rt,{U:()=>Ze});var N=ye(4482),F=ye(5403);function Ze(mt,ut){return(0,N.e)((sn,Xt)=>{let _n=0;sn.subscribe((0,F.x)(Xt,Mn=>{Xt.next(mt.call(ut,Mn,_n++))}))})}},8189:(qn,Rt,ye)=>{ye.d(Rt,{J:()=>Ze});var N=ye(5577),F=ye(4671);function Ze(mt=1/0){return(0,N.z)(F.y,mt)}},5577:(qn,Rt,ye)=>{ye.d(Rt,{z:()=>_n});var N=ye(4004),F=ye(8421),Ze=ye(4482),mt=ye(9672),ut=ye(5403),Xt=ye(576);function _n(Mn,Ut,lt=1/0){return(0,Xt.m)(Ut)?_n((Ft,ri)=>(0,N.U)((fe,bn)=>Ut(Ft,fe,ri,bn))((0,F.Xf)(Mn(Ft,ri))),lt):("number"==typeof Ut&&(lt=Ut),(0,Ze.e)((Ft,ri)=>function sn(Mn,Ut,lt,Ft,ri,fe,bn,gt){const Gn=[];let Vn=0,ce=0,ke=!1;const Ye=()=>{ke&&!Gn.length&&!Vn&&Ut.complete()},rt=on=>Vn<Ft?nt(on):Gn.push(on),nt=on=>{fe&&Ut.next(on),Vn++;let Qe=!1;(0,F.Xf)(lt(on,ce++)).subscribe((0,ut.x)(Ut,Tt=>{null==ri||ri(Tt),fe?rt(Tt):Ut.next(Tt)},()=>{Qe=!0},void 0,()=>{if(Qe)try{for(Vn--;Gn.length&&Vn<Ft;){const Tt=Gn.shift();bn?(0,mt.f)(Ut,bn,()=>nt(Tt)):nt(Tt)}Ye()}catch(Tt){Ut.error(Tt)}}))};return Mn.subscribe((0,ut.x)(Ut,rt,()=>{ke=!0,Ye()})),()=>{null==gt||gt()}}(Ft,ri,Mn,lt)))}},5698:(qn,Rt,ye)=>{ye.d(Rt,{q:()=>mt});var N=ye(515),F=ye(4482),Ze=ye(5403);function mt(ut){return ut<=0?()=>N.E:(0,F.e)((sn,Xt)=>{let _n=0;sn.subscribe((0,Ze.x)(Xt,Mn=>{++_n<=ut&&(Xt.next(Mn),ut<=_n&&Xt.complete())}))})}},8068:(qn,Rt,ye)=>{ye.d(Rt,{T:()=>mt});var N=ye(6805),F=ye(4482),Ze=ye(5403);function mt(sn=ut){return(0,F.e)((Xt,_n)=>{let Mn=!1;Xt.subscribe((0,Ze.x)(_n,Ut=>{Mn=!0,_n.next(Ut)},()=>Mn?_n.complete():_n.error(sn())))})}function ut(){return new N.K}},3410:(qn,Rt,ye)=>{ye.d(Rt,{z:()=>N});const N={setTimeout(F,Ze,...mt){const{delegate:ut}=N;return(null==ut?void 0:ut.setTimeout)?ut.setTimeout(F,Ze,...mt):setTimeout(F,Ze,...mt)},clearTimeout(F){const{delegate:Ze}=N;return((null==Ze?void 0:Ze.clearTimeout)||clearTimeout)(F)},delegate:void 0}},2202:(qn,Rt,ye)=>{ye.d(Rt,{h:()=>F});const F=function N(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(qn,Rt,ye)=>{ye.d(Rt,{L:()=>N});const N="function"==typeof Symbol&&Symbol.observable||"@@observable"},6805:(qn,Rt,ye)=>{ye.d(Rt,{K:()=>F});const F=(0,ye(3888).d)(Ze=>function(){Ze(this),this.name="EmptyError",this.message="no elements in sequence"})},7669:(qn,Rt,ye)=>{ye.d(Rt,{_6:()=>sn,jO:()=>mt,yG:()=>ut});var N=ye(576);function Ze(Xt){return Xt[Xt.length-1]}function mt(Xt){return(0,N.m)(Ze(Xt))?Xt.pop():void 0}function ut(Xt){return function F(Xt){return Xt&&(0,N.m)(Xt.schedule)}(Ze(Xt))?Xt.pop():void 0}function sn(Xt,_n){return"number"==typeof Ze(Xt)?Xt.pop():_n}},4742:(qn,Rt,ye)=>{ye.d(Rt,{D:()=>ut});const{isArray:N}=Array,{getPrototypeOf:F,prototype:Ze,keys:mt}=Object;function ut(Xt){if(1===Xt.length){const _n=Xt[0];if(N(_n))return{args:_n,keys:null};if(function sn(Xt){return Xt&&"object"==typeof Xt&&F(Xt)===Ze}(_n)){const Mn=mt(_n);return{args:Mn.map(Ut=>_n[Ut]),keys:Mn}}}return{args:Xt,keys:null}}},8737:(qn,Rt,ye)=>{function N(F,Ze){if(F){const mt=F.indexOf(Ze);0<=mt&&F.splice(mt,1)}}ye.d(Rt,{P:()=>N})},3888:(qn,Rt,ye)=>{function N(F){const mt=F(ut=>{Error.call(ut),ut.stack=(new Error).stack});return mt.prototype=Object.create(Error.prototype),mt.prototype.constructor=mt,mt}ye.d(Rt,{d:()=>N})},1810:(qn,Rt,ye)=>{function N(F,Ze){return F.reduce((mt,ut,sn)=>(mt[ut]=Ze[sn],mt),{})}ye.d(Rt,{n:()=>N})},2806:(qn,Rt,ye)=>{ye.d(Rt,{O:()=>mt,x:()=>Ze});var N=ye(2416);let F=null;function Ze(ut){if(N.v.useDeprecatedSynchronousErrorHandling){const sn=!F;if(sn&&(F={errorThrown:!1,error:null}),ut(),sn){const{errorThrown:Xt,error:_n}=F;if(F=null,Xt)throw _n}}else ut()}function mt(ut){N.v.useDeprecatedSynchronousErrorHandling&&F&&(F.errorThrown=!0,F.error=ut)}},9672:(qn,Rt,ye)=>{function N(F,Ze,mt,ut=0,sn=!1){const Xt=Ze.schedule(function(){mt(),sn?F.add(this.schedule(null,ut)):this.unsubscribe()},ut);if(F.add(Xt),!sn)return Xt}ye.d(Rt,{f:()=>N})},4671:(qn,Rt,ye)=>{function N(F){return F}ye.d(Rt,{y:()=>N})},1144:(qn,Rt,ye)=>{ye.d(Rt,{z:()=>N});const N=F=>F&&"number"==typeof F.length&&"function"!=typeof F},2206:(qn,Rt,ye)=>{ye.d(Rt,{D:()=>F});var N=ye(576);function F(Ze){return Symbol.asyncIterator&&(0,N.m)(null==Ze?void 0:Ze[Symbol.asyncIterator])}},576:(qn,Rt,ye)=>{function N(F){return"function"==typeof F}ye.d(Rt,{m:()=>N})},3670:(qn,Rt,ye)=>{ye.d(Rt,{c:()=>Ze});var N=ye(8822),F=ye(576);function Ze(mt){return(0,F.m)(mt[N.L])}},6495:(qn,Rt,ye)=>{ye.d(Rt,{T:()=>Ze});var N=ye(2202),F=ye(576);function Ze(mt){return(0,F.m)(null==mt?void 0:mt[N.h])}},8239:(qn,Rt,ye)=>{ye.d(Rt,{t:()=>F});var N=ye(576);function F(Ze){return(0,N.m)(null==Ze?void 0:Ze.then)}},3260:(qn,Rt,ye)=>{ye.d(Rt,{L:()=>mt,Q:()=>Ze});var N=ye(7582),F=ye(576);function Ze(ut){return(0,N.FC)(this,arguments,function*(){const Xt=ut.getReader();try{for(;;){const{value:_n,done:Mn}=yield(0,N.qq)(Xt.read());if(Mn)return yield(0,N.qq)(void 0);yield yield(0,N.qq)(_n)}}finally{Xt.releaseLock()}})}function mt(ut){return(0,F.m)(null==ut?void 0:ut.getReader)}},4482:(qn,Rt,ye)=>{ye.d(Rt,{A:()=>F,e:()=>Ze});var N=ye(576);function F(mt){return(0,N.m)(null==mt?void 0:mt.lift)}function Ze(mt){return ut=>{if(F(ut))return ut.lift(function(sn){try{return mt(sn,this)}catch(Xt){this.error(Xt)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(qn,Rt,ye)=>{ye.d(Rt,{Z:()=>mt});var N=ye(4004);const{isArray:F}=Array;function mt(ut){return(0,N.U)(sn=>function Ze(ut,sn){return F(sn)?ut(...sn):ut(sn)}(ut,sn))}},7849:(qn,Rt,ye)=>{ye.d(Rt,{h:()=>Ze});var N=ye(2416),F=ye(3410);function Ze(mt){F.z.setTimeout(()=>{const{onUnhandledError:ut}=N.v;if(!ut)throw mt;ut(mt)})}},4532:(qn,Rt,ye)=>{function N(F){return new TypeError(`You provided ${null!==F&&"object"==typeof F?"an invalid object":`'${F}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}ye.d(Rt,{z:()=>N})},9808:(qn,Rt,ye)=>{ye.d(Rt,{Do:()=>Ye,EM:()=>ga,HT:()=>ut,JF:()=>Ea,K0:()=>Xt,Mx:()=>Hr,NF:()=>uo,S$:()=>Gn,V_:()=>Ut,Ye:()=>rt,b0:()=>ke,bD:()=>Bs,ez:()=>cl,lw:()=>_n,mr:()=>ce,q:()=>Ze,sg:()=>gr,w_:()=>sn});var N=ye(1223);let F=null;function Ze(){return F}function ut(H){F||(F=H)}class sn{}const Xt=new N.OlP("DocumentToken");let _n=(()=>{class H{historyGo(G){throw new Error("Not implemented")}}return H.\u0275fac=function(G){return new(G||H)},H.\u0275prov=N.Yz7({token:H,factory:function(){return function Mn(){return(0,N.LFG)(lt)}()},providedIn:"platform"}),H})();const Ut=new N.OlP("Location Initialized");let lt=(()=>{class H extends _n{constructor(G){super(),this._doc=G,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ze().getBaseHref(this._doc)}onPopState(G){const oe=Ze().getGlobalEventTarget(this._doc,"window");return oe.addEventListener("popstate",G,!1),()=>oe.removeEventListener("popstate",G)}onHashChange(G){const oe=Ze().getGlobalEventTarget(this._doc,"window");return oe.addEventListener("hashchange",G,!1),()=>oe.removeEventListener("hashchange",G)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(G){this.location.pathname=G}pushState(G,oe,Be){Ft()?this._history.pushState(G,oe,Be):this.location.hash=Be}replaceState(G,oe,Be){Ft()?this._history.replaceState(G,oe,Be):this.location.hash=Be}forward(){this._history.forward()}back(){this._history.back()}historyGo(G=0){this._history.go(G)}getState(){return this._history.state}}return H.\u0275fac=function(G){return new(G||H)(N.LFG(Xt))},H.\u0275prov=N.Yz7({token:H,factory:function(){return function ri(){return new lt((0,N.LFG)(Xt))}()},providedIn:"platform"}),H})();function Ft(){return!!window.history.pushState}function fe(H,re){if(0==H.length)return re;if(0==re.length)return H;let G=0;return H.endsWith("/")&&G++,re.startsWith("/")&&G++,2==G?H+re.substring(1):1==G?H+re:H+"/"+re}function bn(H){const re=H.match(/#|\?|$/),G=re&&re.index||H.length;return H.slice(0,G-("/"===H[G-1]?1:0))+H.slice(G)}function gt(H){return H&&"?"!==H[0]?"?"+H:H}let Gn=(()=>{class H{historyGo(G){throw new Error("Not implemented")}}return H.\u0275fac=function(G){return new(G||H)},H.\u0275prov=N.Yz7({token:H,factory:function(){return function Vn(H){const re=(0,N.LFG)(Xt).location;return new ke((0,N.LFG)(_n),re&&re.origin||"")}()},providedIn:"root"}),H})();const ce=new N.OlP("appBaseHref");let ke=(()=>{class H extends Gn{constructor(G,oe){if(super(),this._platformLocation=G,this._removeListenerFns=[],null==oe&&(oe=this._platformLocation.getBaseHrefFromDOM()),null==oe)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=oe}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(G){this._removeListenerFns.push(this._platformLocation.onPopState(G),this._platformLocation.onHashChange(G))}getBaseHref(){return this._baseHref}prepareExternalUrl(G){return fe(this._baseHref,G)}path(G=!1){const oe=this._platformLocation.pathname+gt(this._platformLocation.search),Be=this._platformLocation.hash;return Be&&G?`${oe}${Be}`:oe}pushState(G,oe,Be,pt){const zt=this.prepareExternalUrl(Be+gt(pt));this._platformLocation.pushState(G,oe,zt)}replaceState(G,oe,Be,pt){const zt=this.prepareExternalUrl(Be+gt(pt));this._platformLocation.replaceState(G,oe,zt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(G=0){var oe,Be;null===(Be=(oe=this._platformLocation).historyGo)||void 0===Be||Be.call(oe,G)}}return H.\u0275fac=function(G){return new(G||H)(N.LFG(_n),N.LFG(ce,8))},H.\u0275prov=N.Yz7({token:H,factory:H.\u0275fac}),H})(),Ye=(()=>{class H extends Gn{constructor(G,oe){super(),this._platformLocation=G,this._baseHref="",this._removeListenerFns=[],null!=oe&&(this._baseHref=oe)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(G){this._removeListenerFns.push(this._platformLocation.onPopState(G),this._platformLocation.onHashChange(G))}getBaseHref(){return this._baseHref}path(G=!1){let oe=this._platformLocation.hash;return null==oe&&(oe="#"),oe.length>0?oe.substring(1):oe}prepareExternalUrl(G){const oe=fe(this._baseHref,G);return oe.length>0?"#"+oe:oe}pushState(G,oe,Be,pt){let zt=this.prepareExternalUrl(Be+gt(pt));0==zt.length&&(zt=this._platformLocation.pathname),this._platformLocation.pushState(G,oe,zt)}replaceState(G,oe,Be,pt){let zt=this.prepareExternalUrl(Be+gt(pt));0==zt.length&&(zt=this._platformLocation.pathname),this._platformLocation.replaceState(G,oe,zt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(G=0){var oe,Be;null===(Be=(oe=this._platformLocation).historyGo)||void 0===Be||Be.call(oe,G)}}return H.\u0275fac=function(G){return new(G||H)(N.LFG(_n),N.LFG(ce,8))},H.\u0275prov=N.Yz7({token:H,factory:H.\u0275fac}),H})(),rt=(()=>{class H{constructor(G,oe){this._subject=new N.vpe,this._urlChangeListeners=[],this._platformStrategy=G;const Be=this._platformStrategy.getBaseHref();this._platformLocation=oe,this._baseHref=bn(Qe(Be)),this._platformStrategy.onPopState(pt=>{this._subject.emit({url:this.path(!0),pop:!0,state:pt.state,type:pt.type})})}path(G=!1){return this.normalize(this._platformStrategy.path(G))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(G,oe=""){return this.path()==this.normalize(G+gt(oe))}normalize(G){return H.stripTrailingSlash(function on(H,re){return H&&re.startsWith(H)?re.substring(H.length):re}(this._baseHref,Qe(G)))}prepareExternalUrl(G){return G&&"/"!==G[0]&&(G="/"+G),this._platformStrategy.prepareExternalUrl(G)}go(G,oe="",Be=null){this._platformStrategy.pushState(Be,"",G,oe),this._notifyUrlChangeListeners(this.prepareExternalUrl(G+gt(oe)),Be)}replaceState(G,oe="",Be=null){this._platformStrategy.replaceState(Be,"",G,oe),this._notifyUrlChangeListeners(this.prepareExternalUrl(G+gt(oe)),Be)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(G=0){var oe,Be;null===(Be=(oe=this._platformStrategy).historyGo)||void 0===Be||Be.call(oe,G)}onUrlChange(G){this._urlChangeListeners.push(G),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(oe=>{this._notifyUrlChangeListeners(oe.url,oe.state)}))}_notifyUrlChangeListeners(G="",oe){this._urlChangeListeners.forEach(Be=>Be(G,oe))}subscribe(G,oe,Be){return this._subject.subscribe({next:G,error:oe,complete:Be})}}return H.normalizeQueryParams=gt,H.joinWithSlash=fe,H.stripTrailingSlash=bn,H.\u0275fac=function(G){return new(G||H)(N.LFG(Gn),N.LFG(_n))},H.\u0275prov=N.Yz7({token:H,factory:function(){return function nt(){return new rt((0,N.LFG)(Gn),(0,N.LFG)(_n))}()},providedIn:"root"}),H})();function Qe(H){return H.replace(/\/index.html$/,"")}function Hr(H,re){re=encodeURIComponent(re);for(const G of H.split(";")){const oe=G.indexOf("="),[Be,pt]=-1==oe?[G,""]:[G.slice(0,oe),G.slice(oe+1)];if(Be.trim()===re)return decodeURIComponent(pt)}return null}class as{constructor(re,G,oe,Be){this.$implicit=re,this.ngForOf=G,this.index=oe,this.count=Be}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let gr=(()=>{class H{constructor(G,oe,Be){this._viewContainer=G,this._template=oe,this._differs=Be,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(G){this._ngForOf=G,this._ngForOfDirty=!0}set ngForTrackBy(G){this._trackByFn=G}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(G){G&&(this._template=G)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const G=this._ngForOf;!this._differ&&G&&(this._differ=this._differs.find(G).create(this.ngForTrackBy))}if(this._differ){const G=this._differ.diff(this._ngForOf);G&&this._applyChanges(G)}}_applyChanges(G){const oe=this._viewContainer;G.forEachOperation((Be,pt,zt)=>{if(null==Be.previousIndex)oe.createEmbeddedView(this._template,new as(Be.item,this._ngForOf,-1,-1),null===zt?void 0:zt);else if(null==zt)oe.remove(null===pt?void 0:pt);else if(null!==pt){const ln=oe.get(pt);oe.move(ln,zt),Ks(ln,Be)}});for(let Be=0,pt=oe.length;Be<pt;Be++){const ln=oe.get(Be).context;ln.index=Be,ln.count=pt,ln.ngForOf=this._ngForOf}G.forEachIdentityChange(Be=>{Ks(oe.get(Be.currentIndex),Be)})}static ngTemplateContextGuard(G,oe){return!0}}return H.\u0275fac=function(G){return new(G||H)(N.Y36(N.s_b),N.Y36(N.Rgc),N.Y36(N.ZZ4))},H.\u0275dir=N.lG2({type:H,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),H})();function Ks(H,re){H.context.$implicit=re.item}let cl=(()=>{class H{}return H.\u0275fac=function(G){return new(G||H)},H.\u0275mod=N.oAB({type:H}),H.\u0275inj=N.cJS({}),H})();const Bs="browser";function uo(H){return H===Bs}let ga=(()=>{class H{}return H.\u0275prov=(0,N.Yz7)({token:H,providedIn:"root",factory:()=>new Co((0,N.LFG)(Xt),window)}),H})();class Co{constructor(re,G){this.document=re,this.window=G,this.offset=()=>[0,0]}setOffset(re){this.offset=Array.isArray(re)?()=>re:re}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(re){this.supportsScrolling()&&this.window.scrollTo(re[0],re[1])}scrollToAnchor(re){if(!this.supportsScrolling())return;const G=function us(H,re){const G=H.getElementById(re)||H.getElementsByName(re)[0];if(G)return G;if("function"==typeof H.createTreeWalker&&H.body&&(H.body.createShadowRoot||H.body.attachShadow)){const oe=H.createTreeWalker(H.body,NodeFilter.SHOW_ELEMENT);let Be=oe.currentNode;for(;Be;){const pt=Be.shadowRoot;if(pt){const zt=pt.getElementById(re)||pt.querySelector(`[name="${re}"]`);if(zt)return zt}Be=oe.nextNode()}}return null}(this.document,re);G&&(this.scrollToElement(G),G.focus())}setHistoryScrollRestoration(re){if(this.supportScrollRestoration()){const G=this.window.history;G&&G.scrollRestoration&&(G.scrollRestoration=re)}}scrollToElement(re){const G=re.getBoundingClientRect(),oe=G.left+this.window.pageXOffset,Be=G.top+this.window.pageYOffset,pt=this.offset();this.window.scrollTo(oe-pt[0],Be-pt[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const re=no(this.window.history)||no(Object.getPrototypeOf(this.window.history));return!(!re||!re.writable&&!re.set)}catch(re){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(re){return!1}}}function no(H){return Object.getOwnPropertyDescriptor(H,"scrollRestoration")}class Ea{}},1223:(qn,Rt,ye)=>{ye.d(Rt,{deG:()=>ju,tb:()=>wM,AFp:()=>xM,ip1:()=>_M,CZH:()=>__,hGG:()=>Aw,z2F:()=>T_,sBO:()=>uw,Sil:()=>Gb,_Vd:()=>Vr,EJc:()=>zb,SBq:()=>_t,qLn:()=>Fc,vpe:()=>Sc,tBr:()=>_a,XFs:()=>Bn,OlP:()=>qr,zs3:()=>Sl,ZZ4:()=>L_,aQg:()=>O_,soG:()=>M_,YKP:()=>St,h0i:()=>Ke,PXZ:()=>nw,R0b:()=>Ql,FiY:()=>vl,Lbi:()=>Ub,g9A:()=>bM,Qsj:()=>ys,FYo:()=>xr,JOm:()=>qa,q3G:()=>Ws,tp0:()=>Xu,Rgc:()=>Lp,dDg:()=>AM,GfV:()=>sl,s_b:()=>cy,ifc:()=>he,eFA:()=>DM,G48:()=>cw,Gpc:()=>ce,_c5:()=>Sw,VLi:()=>Qb,c2e:()=>Bb,zSh:()=>Ff,wAp:()=>pi,vHH:()=>nt,EiD:()=>uv,mCW:()=>jh,qzn:()=>yu,JVY:()=>Yy,pB0:()=>Jy,eBb:()=>Zy,L6k:()=>qy,LAX:()=>Ky,cg1:()=>wp,kL8:()=>Ep,yhl:()=>fm,dqk:()=>we,sIi:()=>ch,CqO:()=>op,QGY:()=>ql,F4k:()=>wd,RDi:()=>Be,AaK:()=>gt,z3N:()=>Vl,qOj:()=>ah,TTD:()=>ca,_Bn:()=>Mt,xp6:()=>Bc,uIk:()=>dd,ekj:()=>Td,Suo:()=>Jx,Xpm:()=>Ae,lG2:()=>Jr,Yz7:()=>Vi,cJS:()=>Tr,oAB:()=>Pn,Yjl:()=>Yr,Y36:()=>xh,_UZ:()=>Md,qZA:()=>Mh,TgZ:()=>Fu,EpF:()=>ba,n5z:()=>Oh,LFG:()=>_r,$8M:()=>ws,$Z:()=>ip,NdJ:()=>bh,CRH:()=>Qx,oxw:()=>Dg,ALo:()=>Ip,xi3:()=>jx,Hsn:()=>tl,F$t:()=>Ig,Q6J:()=>xd,iGM:()=>Kx,Jf7:()=>Uc,CHM:()=>k,LSH:()=>_m,YNc:()=>Lu,_uU:()=>O0,Oqu:()=>Gg});var N=ye(7579),F=ye(727),Ze=ye(8306),mt=ye(8189),ut=ye(8421),sn=ye(515),Xt=ye(7669),_n=ye(2076),Ut=ye(2961),lt=ye(4482);function ri(n,i,...s){if(!0===i)return void n();if(!1===i)return;const a=new Ut.Hp({next:()=>{a.unsubscribe(),n()}});return i(...s).subscribe(a)}function fe(n){for(let i in n)if(n[i]===fe)return i;throw Error("Could not find renamed property on target object.")}function bn(n,i){for(const s in i)i.hasOwnProperty(s)&&!n.hasOwnProperty(s)&&(n[s]=i[s])}function gt(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(gt).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const i=n.toString();if(null==i)return""+i;const s=i.indexOf("\n");return-1===s?i:i.substring(0,s)}function Gn(n,i){return null==n||""===n?null===i?"":i:null==i||""===i?n:n+" "+i}const Vn=fe({__forward_ref__:fe});function ce(n){return n.__forward_ref__=ce,n.toString=function(){return gt(this())},n}function ke(n){return Ye(n)?n():n}function Ye(n){return"function"==typeof n&&n.hasOwnProperty(Vn)&&n.__forward_ref__===ce}class nt extends Error{constructor(i,s){super(function on(n,i){return`NG0${Math.abs(n)}${i?": "+i:""}`}(i,s)),this.code=i}}function Qe(n){return"string"==typeof n?n:null==n?"":String(n)}function Tt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Qe(n)}function mn(n,i){const s=i?` in ${i}`:"";throw new nt(-201,`No provider for ${Tt(n)} found${s}`)}function Zn(n,i){null==n&&function Yt(n,i,s,a){throw new Error(`ASSERTION ERROR: ${n}`+(null==a?"":` [Expected=> ${s} ${a} ${i} <=Actual]`))}(i,n,null,"!=")}function Vi(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Tr(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ir(n){return xs(n,ar)||xs(n,Ts)}function xs(n,i){return n.hasOwnProperty(i)?n[i]:null}function zr(n){return n&&(n.hasOwnProperty(ts)||n.hasOwnProperty(Zs))?n[ts]:null}const ar=fe({\u0275prov:fe}),ts=fe({\u0275inj:fe}),Ts=fe({ngInjectableDef:fe}),Zs=fe({ngInjectorDef:fe});var Bn=(()=>((Bn=Bn||{})[Bn.Default=0]="Default",Bn[Bn.Host=1]="Host",Bn[Bn.Self=2]="Self",Bn[Bn.SkipSelf=4]="SkipSelf",Bn[Bn.Optional=8]="Optional",Bn))();let lr;function On(n){const i=lr;return lr=n,i}function Lt(n,i,s){const a=Ir(n);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:s&Bn.Optional?null:void 0!==i?i:void mn(gt(n),"Injector")}function Pi(n){return{toString:n}.toString()}var Le=(()=>((Le=Le||{})[Le.OnPush=0]="OnPush",Le[Le.Default=1]="Default",Le))(),he=(()=>{return(n=he||(he={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",he;var n})();const ne="undefined"!=typeof globalThis&&globalThis,ue="undefined"!=typeof window&&window,ie="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,we=ne||"undefined"!=typeof global&&global||ue||ie,Q={},Ve=[],st=fe({\u0275cmp:fe}),kt=fe({\u0275dir:fe}),Kt=fe({\u0275pipe:fe}),an=fe({\u0275mod:fe}),jt=fe({\u0275fac:fe}),jn=fe({__NG_ELEMENT_ID__:fe});let Oe=0;function Ae(n){return Pi(()=>{const s={},a={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:s,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Le.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||Ve,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||he.Emulated,id:"c",styles:n.styles||Ve,_:null,setInput:null,schemas:n.schemas||null,tView:null},d=n.directives,g=n.features,x=n.pipes;return a.id+=Oe++,a.inputs=Ki(n.inputs,s),a.outputs=Ki(n.outputs),g&&g.forEach(A=>A(a)),a.directiveDefs=d?()=>("function"==typeof d?d():d).map(He):null,a.pipeDefs=x?()=>("function"==typeof x?x():x).map(je):null,a})}function He(n){return Gi(n)||function Pr(n){return n[kt]||null}(n)}function je(n){return function br(n){return n[Kt]||null}(n)}const Ht={};function Pn(n){return Pi(()=>{const i={type:n.type,bootstrap:n.bootstrap||Ve,declarations:n.declarations||Ve,imports:n.imports||Ve,exports:n.exports||Ve,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Ht[n.id]=n.type),i})}function Ki(n,i){if(null==n)return Q;const s={};for(const a in n)if(n.hasOwnProperty(a)){let d=n[a],g=d;Array.isArray(d)&&(g=d[1],d=d[0]),s[d]=a,i&&(i[d]=g)}return s}const Jr=Ae;function Yr(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function Gi(n){return n[st]||null}function Qr(n,i){const s=n[an]||null;if(!s&&!0===i)throw new Error(`Type ${gt(n)} does not have '\u0275mod' property.`);return s}function Ds(n){return Array.isArray(n)&&"object"==typeof n[1]}function er(n){return Array.isArray(n)&&!0===n[1]}function Ms(n){return 0!=(8&n.flags)}function bs(n){return 2==(2&n.flags)}function qo(n){return 1==(1&n.flags)}function Oi(n){return null!==n.template}function is(n){return 0!=(512&n[2])}function rs(n,i){return n.hasOwnProperty(jt)?n[jt]:null}class eo{constructor(i,s,a){this.previousValue=i,this.currentValue=s,this.firstChange=a}isFirstChange(){return this.firstChange}}function ca(){return uo}function uo(n){return n.type.prototype.ngOnChanges&&(n.setInput=To),Va}function Va(){const n=Bo(this),i=null==n?void 0:n.current;if(i){const s=n.previous;if(s===Q)n.previous=i;else for(let a in i)s[a]=i[a];n.current=null,this.ngOnChanges(i)}}function To(n,i,s,a){const d=Bo(n)||function ga(n,i){return n[to]=i}(n,{previous:Q,current:null}),g=d.current||(d.current={}),x=d.previous,A=this.declaredInputs[s],I=x[A];g[A]=new eo(I&&I.currentValue,i,x===Q),n[a]=i}ca.ngInherit=!0;const to="__ngSimpleChanges__";function Bo(n){return n[to]||null}const H="math";let oe;function Be(n){oe=n}function ln(n){return!!n.listen}const cr={createRenderer:(n,i)=>function pt(){return void 0!==oe?oe:"undefined"!=typeof document?document:void 0}()};function vi(n){for(;Array.isArray(n);)n=n[0];return n}function Qi(n,i){return vi(i[n])}function zi(n,i){return vi(i[n.index])}function io(n,i){return n.data[i]}function fr(n,i){const s=i[n];return Ds(s)?s:s[0]}function kr(n){return 4==(4&n[2])}function vr(n){return 128==(128&n[2])}function hs(n,i){return null==i?null:n[i]}function ss(n){n[18]=0}function Vo(n,i){n[5]+=i;let s=n,a=n[3];for(;null!==a&&(1===i&&1===s[5]||-1===i&&0===s[5]);)a[5]+=i,s=a,a=a[3]}const zn={lFrame:sc(null),bindingsEnabled:!0};function nc(){return zn.bindingsEnabled}function Gt(){return zn.lFrame.lView}function B(){return zn.lFrame.tView}function k(n){return zn.lFrame.contextLView=n,n[8]}function P(){let n=se();for(;null!==n&&64===n.type;)n=n.parent;return n}function se(){return zn.lFrame.currentTNode}function Ct(n,i){const s=zn.lFrame;s.currentTNode=n,s.isParent=i}function pr(){return zn.lFrame.isParent}function Et(){zn.lFrame.isParent=!1}function ps(){return zn.lFrame.bindingIndex++}function Pl(n,i){const s=zn.lFrame;s.bindingIndex=s.bindingRootIndex=n,za(i)}function za(n){zn.lFrame.currentDirectiveIndex=n}function Hu(){return zn.lFrame.currentQueryIndex}function zo(n){zn.lFrame.currentQueryIndex=n}function Ll(n){const i=n[1];return 2===i.type?i.declTNode:1===i.type?n[6]:null}function dl(n,i,s){if(s&Bn.SkipSelf){let d=i,g=n;for(;!(d=d.parent,null!==d||s&Bn.Host||(d=Ll(g),null===d||(g=g[15],10&d.type))););if(null===d)return!1;i=d,n=g}const a=zn.lFrame=ta();return a.currentTNode=i,a.lView=n,!0}function Ol(n){const i=ta(),s=n[1];zn.lFrame=i,i.currentTNode=s.firstChild,i.lView=n,i.tView=s,i.contextLView=n,i.bindingIndex=s.bindingStartIndex,i.inI18n=!1}function ta(){const n=zn.lFrame,i=null===n?null:n.child;return null===i?sc(n):i}function sc(n){const i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=i),i}function hu(){const n=zn.lFrame;return zn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const ua=hu;function tr(){const n=hu();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Vs(){return zn.lFrame.selectedIndex}function Ca(n){zn.lFrame.selectedIndex=n}function Ur(){const n=zn.lFrame;return io(n.tView,n.selectedIndex)}function fo(n,i){for(let s=i.directiveStart,a=i.directiveEnd;s<a;s++){const g=n.data[s].type.prototype,{ngAfterContentInit:x,ngAfterContentChecked:A,ngAfterViewInit:I,ngAfterViewChecked:Y,ngOnDestroy:K}=g;x&&(n.contentHooks||(n.contentHooks=[])).push(-s,x),A&&((n.contentHooks||(n.contentHooks=[])).push(s,A),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(s,A)),I&&(n.viewHooks||(n.viewHooks=[])).push(-s,I),Y&&((n.viewHooks||(n.viewHooks=[])).push(s,Y),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(s,Y)),null!=K&&(n.destroyHooks||(n.destroyHooks=[])).push(s,K)}}function Do(n,i,s){fl(n,i,3,s)}function zs(n,i,s,a){(3&n[2])===s&&fl(n,i,s,a)}function Ha(n,i){let s=n[2];(3&s)===i&&(s&=2047,s+=1,n[2]=s)}function fl(n,i,s,a){const g=null!=a?a:-1,x=i.length-1;let A=0;for(let I=void 0!==a?65535&n[18]:0;I<x;I++)if("number"==typeof i[I+1]){if(A=i[I],null!=a&&A>=a)break}else i[I]<0&&(n[18]+=65536),(A<g||-1==g)&&(pl(n,s,i,I),n[18]=(4294901760&n[18])+I+2),I++}function pl(n,i,s,a){const d=s[a]<0,g=s[a+1],A=n[d?-s[a]:s[a]];if(d){if(n[2]>>11<n[18]>>16&&(3&n[2])===i){n[2]+=2048;try{g.call(A)}finally{}}}else try{g.call(A)}finally{}}class Go{constructor(i,s,a){this.factory=i,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=a}}function Ia(n,i,s){const a=ln(n);let d=0;for(;d<s.length;){const g=s[d];if("number"==typeof g){if(0!==g)break;d++;const x=s[d++],A=s[d++],I=s[d++];a?n.setAttribute(i,A,I,x):i.setAttributeNS(x,A,I)}else{const x=g,A=s[++d];Wo(x)?a&&n.setProperty(i,x,A):a?n.setAttribute(i,x,A):i.setAttribute(x,A),d++}}return d}function ac(n){return 3===n||4===n||6===n}function Wo(n){return 64===n.charCodeAt(0)}function Ro(n,i){if(null!==i&&0!==i.length)if(null===n||0===n.length)n=i.slice();else{let s=-1;for(let a=0;a<i.length;a++){const d=i[a];"number"==typeof d?s=d:0===s||Hi(n,s,d,null,-1===s||2===s?i[++a]:null)}}return n}function Hi(n,i,s,a,d){let g=0,x=n.length;if(-1===i)x=-1;else for(;g<n.length;){const A=n[g++];if("number"==typeof A){if(A===i){x=-1;break}if(A>i){x=g-1;break}}}for(;g<n.length;){const A=n[g];if("number"==typeof A)break;if(A===s){if(null===a)return void(null!==d&&(n[g+1]=d));if(a===n[g+1])return void(n[g+2]=d)}g++,null!==a&&g++,null!==d&&g++}-1!==x&&(n.splice(x,0,i),g=x+1),n.splice(g++,0,s),null!==a&&n.splice(g++,0,a),null!==d&&n.splice(g++,0,d)}function Br(n){return-1!==n}function Or(n){return 32767&n}function va(n,i){let s=function kl(n){return n>>16}(n),a=i;for(;s>0;)a=a[15],s--;return a}let Ul=!0;function ha(n){const i=Ul;return Ul=n,i}let S=0;function O(n,i){const s=ee(n,i);if(-1!==s)return s;const a=i[1];a.firstCreatePass&&(n.injectorIndex=i.length,W(a.data,n),W(i,null),W(a.blueprint,null));const d=Ee(n,i),g=n.injectorIndex;if(Br(d)){const x=Or(d),A=va(d,i),I=A[1].data;for(let Y=0;Y<8;Y++)i[g+Y]=A[x+Y]|I[x+Y]}return i[g+8]=d,g}function W(n,i){n.push(0,0,0,0,0,0,0,0,i)}function ee(n,i){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===i[n.injectorIndex+8]?-1:n.injectorIndex}function Ee(n,i){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let s=0,a=null,d=i;for(;null!==d;){const g=d[1],x=g.type;if(a=2===x?g.declTNode:1===x?d[6]:null,null===a)return-1;if(s++,d=d[15],-1!==a.injectorIndex)return a.injectorIndex|s<<16}return-1}function Pe(n,i,s){!function M(n,i,s){let a;"string"==typeof s?a=s.charCodeAt(0)||0:s.hasOwnProperty(jn)&&(a=s[jn]),null==a&&(a=s[jn]=S++);const d=255&a;i.data[n+(d>>5)]|=1<<d}(n,i,s)}function cn(n,i,s){if(s&Bn.Optional)return n;mn(i,"NodeInjector")}function Ti(n,i,s,a){if(s&Bn.Optional&&void 0===a&&(a=null),0==(s&(Bn.Self|Bn.Host))){const d=n[9],g=On(void 0);try{return d?d.get(i,a,s&Bn.Optional):Lt(i,a,s&Bn.Optional)}finally{On(g)}}return cn(a,i,s)}function Hn(n,i,s,a=Bn.Default,d){if(null!==n){const g=function Cc(n){if("string"==typeof n)return n.charCodeAt(0)||0;const i=n.hasOwnProperty(jn)?n[jn]:void 0;return"number"==typeof i?i>=0?255&i:Wi:i}(s);if("function"==typeof g){if(!dl(i,n,a))return a&Bn.Host?cn(d,s,a):Ti(i,s,a,d);try{const x=g(a);if(null!=x||a&Bn.Optional)return x;mn(s)}finally{ua()}}else if("number"==typeof g){let x=null,A=ee(n,i),I=-1,Y=a&Bn.Host?i[16][6]:null;for((-1===A||a&Bn.SkipSelf)&&(I=-1===A?Ee(n,i):i[A+8],-1!==I&&ja(a,!1)?(x=i[1],A=Or(I),i=va(I,i)):A=-1);-1!==A;){const K=i[1];if(Wa(g,A,K.data)){const xe=Io(A,i,s,x,a,Y);if(xe!==Xi)return xe}I=i[A+8],-1!==I&&ja(a,i[1].data[A+8]===Y)&&Wa(g,A,i)?(x=K,A=Or(I),i=va(I,i)):A=-1}}}return Ti(i,s,a,d)}const Xi={};function Wi(){return new Bl(P(),Gt())}function Io(n,i,s,a,d,g){const x=i[1],A=x.data[n+8],K=mo(A,x,s,null==a?bs(A)&&Ul:a!=x&&0!=(3&A.type),d&Bn.Host&&g===A);return null!==K?Pa(i,x,K,A):Xi}function mo(n,i,s,a,d){const g=n.providerIndexes,x=i.data,A=1048575&g,I=n.directiveStart,K=g>>20,Ne=d?A+K:n.directiveEnd;for(let qe=a?A:A+K;qe<Ne;qe++){const At=x[qe];if(qe<I&&s===At||qe>=I&&At.type===s)return qe}if(d){const qe=x[I];if(qe&&Oi(qe)&&qe.type===s)return I}return null}function Pa(n,i,s,a){let d=n[s];const g=i.data;if(function Da(n){return n instanceof Go}(d)){const x=d;x.resolving&&function Cn(n,i){const s=i?`. Dependency path: ${i.join(" > ")} > ${n}`:"";throw new nt(-200,`Circular dependency in DI detected for ${n}${s}`)}(Tt(g[s]));const A=ha(x.canSeeViewProviders);x.resolving=!0;const I=x.injectImpl?On(x.injectImpl):null;dl(n,a,Bn.Default);try{d=n[s]=x.factory(void 0,g,n,a),i.firstCreatePass&&s>=a.directiveStart&&function fu(n,i,s){const{ngOnChanges:a,ngOnInit:d,ngDoCheck:g}=i.type.prototype;if(a){const x=uo(i);(s.preOrderHooks||(s.preOrderHooks=[])).push(n,x),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(n,x)}d&&(s.preOrderHooks||(s.preOrderHooks=[])).push(0-n,d),g&&((s.preOrderHooks||(s.preOrderHooks=[])).push(n,g),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(n,g))}(s,g[s],i)}finally{null!==I&&On(I),ha(A),x.resolving=!1,ua()}}return d}function Wa(n,i,s){return!!(s[i+(n>>5)]&1<<n)}function ja(n,i){return!(n&Bn.Self||n&Bn.Host&&i)}class Bl{constructor(i,s){this._tNode=i,this._lView=s}get(i,s,a){return Hn(this._tNode,this._lView,i,a,s)}}function Oh(n){return Pi(()=>{const i=n.prototype.constructor,s=i[jt]||mu(i),a=Object.prototype;let d=Object.getPrototypeOf(n.prototype).constructor;for(;d&&d!==a;){const g=d[jt]||mu(d);if(g&&g!==s)return g;d=Object.getPrototypeOf(d)}return g=>new g})}function mu(n){return Ye(n)?()=>{const i=mu(ke(n));return i&&i()}:rs(n)}function ws(n){return function et(n,i){if("class"===i)return n.classes;if("style"===i)return n.styles;const s=n.attrs;if(s){const a=s.length;let d=0;for(;d<a;){const g=s[d];if(ac(g))break;if(0===g)d+=2;else if("number"==typeof g)for(d++;d<a&&"string"==typeof s[d];)d++;else{if(g===i)return s[d+1];d+=2}}}return null}(P(),n)}const jo="__parameters__";function ia(n,i,s){return Pi(()=>{const a=function gl(n){return function(...s){if(n){const a=n(...s);for(const d in a)this[d]=a[d]}}}(i);function d(...g){if(this instanceof d)return a.apply(this,g),this;const x=new d(...g);return A.annotation=x,A;function A(I,Y,K){const xe=I.hasOwnProperty(jo)?I[jo]:Object.defineProperty(I,jo,{value:[]})[jo];for(;xe.length<=K;)xe.push(null);return(xe[K]=xe[K]||[]).push(x),I}}return s&&(d.prototype=Object.create(s.prototype)),d.prototype.ngMetadataName=n,d.annotationCls=d,d})}class qr{constructor(i,s){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=Vi({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ju=new qr("AnalyzeForEntryComponents");function v(n,i){void 0===i&&(i=n);for(let s=0;s<n.length;s++){let a=n[s];Array.isArray(a)?(i===n&&(i=n.slice(0,s)),v(a,i)):i!==n&&i.push(a)}return i}function E(n,i){n.forEach(s=>Array.isArray(s)?E(s,i):i(s))}function V(n,i,s){i>=n.length?n.push(s):n.splice(i,0,s)}function j(n,i){return i>=n.length-1?n.pop():n.splice(i,1)[0]}function q(n,i){const s=[];for(let a=0;a<n;a++)s.push(i);return s}function It(n,i,s){let a=Qt(n,i);return a>=0?n[1|a]=s:(a=~a,function ge(n,i,s,a){let d=n.length;if(d==i)n.push(s,a);else if(1===d)n.push(a,n[0]),n[0]=s;else{for(d--,n.push(n[d-1],n[d]);d>i;)n[d]=n[d-2],d--;n[i]=s,n[i+1]=a}}(n,a,i,s)),a}function wn(n,i){const s=Qt(n,i);if(s>=0)return n[1|s]}function Qt(n,i){return function En(n,i,s){let a=0,d=n.length>>s;for(;d!==a;){const g=a+(d-a>>1),x=n[g<<s];if(i===x)return g<<s;x>i?d=g:a=g+1}return~(d<<s)}(n,i,1)}const mr={},Dr="__NG_DI_FLAG__",ds="ngTempTokenPath",Zr=/\n/gm,vo="__source",Xo=fe({provide:String,useValue:fe});let ms;function Po(n){const i=ms;return ms=n,i}function ra(n,i=Bn.Default){if(void 0===ms)throw new nt(203,"");return null===ms?Lt(n,void 0,i):ms.get(n,i&Bn.Optional?null:void 0,i)}function _r(n,i=Bn.Default){return(function fi(){return lr}()||ra)(ke(n),i)}const Dc=_r;function La(n){const i=[];for(let s=0;s<n.length;s++){const a=ke(n[s]);if(Array.isArray(a)){if(0===a.length)throw new nt(900,"");let d,g=Bn.Default;for(let x=0;x<a.length;x++){const A=a[x],I=_o(A);"number"==typeof I?-1===I?d=A.token:g|=I:d=A}i.push(_r(d,g))}else i.push(_r(a))}return i}function sa(n,i){return n[Dr]=i,n.prototype[Dr]=i,n}function _o(n){return n[Dr]}const _a=sa(ia("Inject",n=>({token:n})),-1),vl=sa(ia("Optional"),8),Xu=sa(ia("SkipSelf"),4);var qa=(()=>((qa=qa||{})[qa.Important=1]="Important",qa[qa.DashCase=2]="DashCase",qa))();const Hp="__ngContext__";function Yo(n,i){n[Hp]=i}function Gd(n){const i=function qu(n){return n[Hp]||null}(n);return i?Array.isArray(i)?i:i.lView:null}function jd(n,i){return undefined(n,i)}function Zu(n){const i=n[3];return er(i)?i[3]:i}function $d(n){return qp(n[13])}function Xd(n){return qp(n[4])}function qp(n){for(;null!==n&&!er(n);)n=n[4];return n}function gu(n,i,s,a,d){if(null!=a){let g,x=!1;er(a)?g=a:Ds(a)&&(x=!0,a=a[0]);const A=vi(a);0===n&&null!==s?null==d?tm(i,s,A):Pc(i,s,A,d||null,!0):1===n&&null!==s?Pc(i,s,A,d||null,!0):2===n?function ef(n,i,s){const a=Vh(n,i);a&&function Fy(n,i,s,a){ln(n)?n.removeChild(i,s,a):i.removeChild(s)}(n,a,i,s)}(i,A,x):3===n&&i.destroyNode(A),null!=g&&function Uy(n,i,s,a,d){const g=s[7];g!==vi(s)&&gu(i,n,a,g,d);for(let A=10;A<s.length;A++){const I=s[A];Ku(I[1],I,n,i,a,g)}}(i,n,g,s,d)}}function qd(n,i,s){if(ln(n))return n.createElement(i,s);{const a=null!==s?function G(n){const i=n.toLowerCase();return"svg"===i?"http://www.w3.org/2000/svg":i===H?"http://www.w3.org/1998/MathML/":null}(s):null;return null===a?n.createElement(i):n.createElementNS(a,i)}}function Kp(n,i){const s=n[9],a=s.indexOf(i),d=i[3];1024&i[2]&&(i[2]&=-1025,Vo(d,-1)),s.splice(a,1)}function Zd(n,i){if(n.length<=10)return;const s=10+i,a=n[s];if(a){const d=a[17];null!==d&&d!==n&&Kp(d,a),i>0&&(n[s-1][4]=a[4]);const g=j(n,10+i);!function Ty(n,i){Ku(n,i,i[11],2,null,null),i[0]=null,i[6]=null}(a[1],a);const x=g[19];null!==x&&x.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function Jp(n,i){if(!(256&i[2])){const s=i[11];ln(s)&&s.destroyNode&&Ku(n,i,s,3,null,null),function Ry(n){let i=n[13];if(!i)return Kd(n[1],n);for(;i;){let s=null;if(Ds(i))s=i[13];else{const a=i[10];a&&(s=a)}if(!s){for(;i&&!i[4]&&i!==n;)Ds(i)&&Kd(i[1],i),i=i[3];null===i&&(i=n),Ds(i)&&Kd(i[1],i),s=i&&i[4]}i=s}}(i)}}function Kd(n,i){if(!(256&i[2])){i[2]&=-129,i[2]|=256,function Oy(n,i){let s;if(null!=n&&null!=(s=n.destroyHooks))for(let a=0;a<s.length;a+=2){const d=i[s[a]];if(!(d instanceof Go)){const g=s[a+1];if(Array.isArray(g))for(let x=0;x<g.length;x+=2){const A=d[g[x]],I=g[x+1];try{I.call(A)}finally{}}else try{g.call(d)}finally{}}}}(n,i),function Ly(n,i){const s=n.cleanup,a=i[7];let d=-1;if(null!==s)for(let g=0;g<s.length-1;g+=2)if("string"==typeof s[g]){const x=s[g+1],A="function"==typeof x?x(i):vi(i[x]),I=a[d=s[g+2]],Y=s[g+3];"boolean"==typeof Y?A.removeEventListener(s[g],I,Y):Y>=0?a[d=Y]():a[d=-Y].unsubscribe(),g+=2}else{const x=a[d=s[g+1]];s[g].call(x)}if(null!==a){for(let g=d+1;g<a.length;g++)a[g]();i[7]=null}}(n,i),1===i[1].type&&ln(i[11])&&i[11].destroy();const s=i[17];if(null!==s&&er(i[3])){s!==i[3]&&Kp(s,i);const a=i[19];null!==a&&a.detachView(n)}}}function Qp(n,i,s){return function em(n,i,s){let a=i;for(;null!==a&&40&a.type;)a=(i=a).parent;if(null===a)return s[0];if(2&a.flags){const d=n.data[a.directiveStart].encapsulation;if(d===he.None||d===he.Emulated)return null}return zi(a,s)}(n,i.parent,s)}function Pc(n,i,s,a,d){ln(n)?n.insertBefore(i,s,a,d):i.insertBefore(s,a,d)}function tm(n,i,s){ln(n)?n.appendChild(i,s):i.appendChild(s)}function nm(n,i,s,a,d){null!==a?Pc(n,i,s,a,d):tm(n,i,s)}function Vh(n,i){return ln(n)?n.parentNode(i):i.parentNode}function im(n,i,s){return sm(n,i,s)}let Gh,sm=function rm(n,i,s){return 40&n.type?zi(n,s):null};function zh(n,i,s,a){const d=Qp(n,a,i),g=i[11],A=im(a.parent||i[6],a,i);if(null!=d)if(Array.isArray(s))for(let I=0;I<s.length;I++)nm(g,d,s[I],A,!1);else nm(g,d,s,A,!1)}function Hh(n,i){if(null!==i){const s=i.type;if(3&s)return zi(i,n);if(4&s)return Qd(-1,n[i.index]);if(8&s){const a=i.child;if(null!==a)return Hh(n,a);{const d=n[i.index];return er(d)?Qd(-1,d):vi(d)}}if(32&s)return jd(i,n)()||vi(n[i.index]);{const a=am(n,i);return null!==a?Array.isArray(a)?a[0]:Hh(Zu(n[16]),a):Hh(n,i.next)}}return null}function am(n,i){return null!==i?n[16][6].projection[i.projection]:null}function Qd(n,i){const s=10+n+1;if(s<i.length){const a=i[s],d=a[1].firstChild;if(null!==d)return Hh(a,d)}return i[7]}function tf(n,i,s,a,d,g,x){for(;null!=s;){const A=a[s.index],I=s.type;if(x&&0===i&&(A&&Yo(vi(A),a),s.flags|=4),64!=(64&s.flags))if(8&I)tf(n,i,s.child,a,d,g,!1),gu(i,n,d,A,g);else if(32&I){const Y=jd(s,a);let K;for(;K=Y();)gu(i,n,d,K,g);gu(i,n,d,A,g)}else 16&I?lm(n,i,a,s,d,g):gu(i,n,d,A,g);s=x?s.projectionNext:s.next}}function Ku(n,i,s,a,d,g){tf(s,a,n.firstChild,i,d,g,!1)}function lm(n,i,s,a,d,g){const x=s[16],I=x[6].projection[a.projection];if(Array.isArray(I))for(let Y=0;Y<I.length;Y++)gu(i,n,d,I[Y],g);else tf(n,i,I,x[3],d,g,!0)}function cm(n,i,s){ln(n)?n.setAttribute(i,"style",s):i.style.cssText=s}function nf(n,i,s){ln(n)?""===s?n.removeAttribute(i,"class"):n.setAttribute(i,"class",s):i.className=s}function Lc(n){var i;return(null===(i=function rf(){if(void 0===Gh&&(Gh=null,we.trustedTypes))try{Gh=we.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Gh}())||void 0===i?void 0:i.createHTML(n))||n}class Oc{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Gy extends Oc{getTypeName(){return"HTML"}}class Wy extends Oc{getTypeName(){return"Style"}}class jy extends Oc{getTypeName(){return"Script"}}class $y extends Oc{getTypeName(){return"URL"}}class Xy extends Oc{getTypeName(){return"ResourceURL"}}function Vl(n){return n instanceof Oc?n.changingThisBreaksApplicationSecurity:n}function yu(n,i){const s=fm(n);if(null!=s&&s!==i){if("ResourceURL"===s&&"URL"===i)return!0;throw new Error(`Required a safe ${i}, got a ${s} (see https://g.co/ng/security#xss)`)}return s===i}function fm(n){return n instanceof Oc&&n.getTypeName()||null}function Yy(n){return new Gy(n)}function qy(n){return new Wy(n)}function Zy(n){return new jy(n)}function Ky(n){return new $y(n)}function Jy(n){return new Xy(n)}class Qy{constructor(i){this.inertDocumentHelper=i}getInertBodyElement(i){i="<body><remove></remove>"+i;try{const s=(new window.DOMParser).parseFromString(Lc(i),"text/html").body;return null===s?this.inertDocumentHelper.getInertBodyElement(i):(s.removeChild(s.firstChild),s)}catch(s){return null}}}class ev{constructor(i){if(this.defaultDoc=i,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const s=this.inertDocument.createElement("html");this.inertDocument.appendChild(s);const a=this.inertDocument.createElement("body");s.appendChild(a)}}getInertBodyElement(i){const s=this.inertDocument.createElement("template");if("content"in s)return s.innerHTML=Lc(i),s;const a=this.inertDocument.createElement("body");return a.innerHTML=Lc(i),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(a),a}stripCustomNsAttrs(i){const s=i.attributes;for(let d=s.length-1;0<d;d--){const x=s.item(d).name;("xmlns:ns1"===x||0===x.indexOf("ns1:"))&&i.removeAttribute(x)}let a=i.firstChild;for(;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}const nv=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,iv=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function jh(n){return(n=String(n)).match(nv)||n.match(iv)?n:"unsafe:"+n}function zl(n){const i={};for(const s of n.split(","))i[s]=!0;return i}function $h(...n){const i={};for(const s of n)for(const a in s)s.hasOwnProperty(a)&&(i[a]=!0);return i}const sv=zl("area,br,col,hr,img,wbr"),ov=zl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),av=zl("rp,rt"),mm=$h(sv,$h(ov,zl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),$h(av,zl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),$h(av,ov)),gm=zl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ym=zl("srcset"),lv=$h(gm,ym,zl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),zl("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),q_=zl("script,style,template");class Z_{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(i){let s=i.firstChild,a=!0;for(;s;)if(s.nodeType===Node.ELEMENT_NODE?a=this.startElement(s):s.nodeType===Node.TEXT_NODE?this.chars(s.nodeValue):this.sanitizedSomething=!0,a&&s.firstChild)s=s.firstChild;else for(;s;){s.nodeType===Node.ELEMENT_NODE&&this.endElement(s);let d=this.checkClobberedElement(s,s.nextSibling);if(d){s=d;break}s=this.checkClobberedElement(s,s.parentNode)}return this.buf.join("")}startElement(i){const s=i.nodeName.toLowerCase();if(!mm.hasOwnProperty(s))return this.sanitizedSomething=!0,!q_.hasOwnProperty(s);this.buf.push("<"),this.buf.push(s);const a=i.attributes;for(let d=0;d<a.length;d++){const g=a.item(d),x=g.name,A=x.toLowerCase();if(!lv.hasOwnProperty(A)){this.sanitizedSomething=!0;continue}let I=g.value;gm[A]&&(I=jh(I)),ym[A]&&(n=I,I=(n=String(n)).split(",").map(i=>jh(i.trim())).join(", ")),this.buf.push(" ",x,'="',cv(I),'"')}var n;return this.buf.push(">"),!0}endElement(i){const s=i.nodeName.toLowerCase();mm.hasOwnProperty(s)&&!sv.hasOwnProperty(s)&&(this.buf.push("</"),this.buf.push(s),this.buf.push(">"))}chars(i){this.buf.push(cv(i))}checkClobberedElement(i,s){if(s&&(i.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${i.outerHTML}`);return s}}const K_=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,J_=/([^\#-~ |!])/g;function cv(n){return n.replace(/&/g,"&amp;").replace(K_,function(i){return"&#"+(1024*(i.charCodeAt(0)-55296)+(i.charCodeAt(1)-56320)+65536)+";"}).replace(J_,function(i){return"&#"+i.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let of;function uv(n,i){let s=null;try{of=of||function pm(n){const i=new ev(n);return function tv(){try{return!!(new window.DOMParser).parseFromString(Lc(""),"text/html")}catch(n){return!1}}()?new Qy(i):i}(n);let a=i?String(i):"";s=of.getInertBodyElement(a);let d=5,g=a;do{if(0===d)throw new Error("Failed to sanitize html because the input is unstable");d--,a=g,g=s.innerHTML,s=of.getInertBodyElement(a)}while(a!==g);return Lc((new Z_).sanitizeChildren(vm(s)||s))}finally{if(s){const a=vm(s)||s;for(;a.firstChild;)a.removeChild(a.firstChild)}}}function vm(n){return"content"in n&&function Q_(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Ws=(()=>((Ws=Ws||{})[Ws.NONE=0]="NONE",Ws[Ws.HTML=1]="HTML",Ws[Ws.STYLE=2]="STYLE",Ws[Ws.SCRIPT=3]="SCRIPT",Ws[Ws.URL=4]="URL",Ws[Ws.RESOURCE_URL=5]="RESOURCE_URL",Ws))();function _m(n){const i=function cc(){const n=Gt();return n&&n[12]}();return i?i.sanitize(Ws.URL,n)||"":yu(n,"URL")?Vl(n):jh(Qe(n))}function lf(n){return n.ngOriginalError}function mv(n,...i){n.error(...i)}class Fc{constructor(){this._console=console}handleError(i){const s=this._findOriginalError(i),a=function pv(n){return n&&n.ngErrorLogger||mv}(i);a(this._console,"ERROR",i),s&&a(this._console,"ORIGINAL ERROR",s)}_findOriginalError(i){let s=i&&lf(i);for(;s&&lf(s);)s=lf(s);return s||null}}const kc=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(we))();function Uc(n){return n.ownerDocument.defaultView}function Za(n){return n instanceof Function?n():n}function Xh(n,i,s){let a=n.length;for(;;){const d=n.indexOf(i,s);if(-1===d)return d;if(0===d||n.charCodeAt(d-1)<=32){const g=i.length;if(d+g===a||n.charCodeAt(d+g)<=32)return d}s=d+1}}const Em="ng-template";function yv(n,i,s){let a=0;for(;a<n.length;){let d=n[a++];if(s&&"class"===d){if(d=n[a],-1!==Xh(d.toLowerCase(),i,0))return!0}else if(1===d){for(;a<n.length&&"string"==typeof(d=n[a++]);)if(d.toLowerCase()===i)return!0;return!1}}return!1}function Sm(n){return 4===n.type&&n.value!==Em}function vv(n,i,s){return i===(4!==n.type||s?n.value:Em)}function _v(n,i,s){let a=4;const d=n.attrs||[],g=function Cm(n){for(let i=0;i<n.length;i++)if(ac(n[i]))return i;return n.length}(d);let x=!1;for(let A=0;A<i.length;A++){const I=i[A];if("number"!=typeof I){if(!x)if(4&a){if(a=2|1&a,""!==I&&!vv(n,I,s)||""===I&&1===i.length){if(Ka(a))return!1;x=!0}}else{const Y=8&a?I:i[++A];if(8&a&&null!==n.attrs){if(!yv(n.attrs,Y,s)){if(Ka(a))return!1;x=!0}continue}const xe=xv(8&a?"class":I,d,Sm(n),s);if(-1===xe){if(Ka(a))return!1;x=!0;continue}if(""!==Y){let Ne;Ne=xe>g?"":d[xe+1].toLowerCase();const qe=8&a?Ne:null;if(qe&&-1!==Xh(qe,Y,0)||2&a&&Y!==Ne){if(Ka(a))return!1;x=!0}}}}else{if(!x&&!Ka(a)&&!Ka(I))return!1;if(x&&Ka(I))continue;x=!1,a=I|1&a}}return Ka(a)||x}function Ka(n){return 0==(1&n)}function xv(n,i,s,a){if(null===i)return-1;let d=0;if(a||!s){let g=!1;for(;d<i.length;){const x=i[d];if(x===n)return d;if(3===x||6===x)g=!0;else{if(1===x||2===x){let A=i[++d];for(;"string"==typeof A;)A=i[++d];continue}if(4===x)break;if(0===x){d+=4;continue}}d+=g?1:2}return-1}return function Dm(n,i){let s=n.indexOf(4);if(s>-1)for(s++;s<n.length;){const a=n[s];if("number"==typeof a)return-1;if(a===i)return s;s++}return-1}(i,n)}function Am(n,i,s=!1){for(let a=0;a<i.length;a++)if(_v(n,i[a],s))return!0;return!1}function Rm(n,i){e:for(let s=0;s<i.length;s++){const a=i[s];if(n.length===a.length){for(let d=0;d<n.length;d++)if(n[d]!==a[d])continue e;return!0}}return!1}function ff(n,i){return n?":not("+i.trim()+")":i}function Im(n){let i=n[0],s=1,a=2,d="",g=!1;for(;s<n.length;){let x=n[s];if("string"==typeof x)if(2&a){const A=n[++s];d+="["+x+(A.length>0?'="'+A+'"':"")+"]"}else 8&a?d+="."+x:4&a&&(d+=" "+x);else""!==d&&!Ka(x)&&(i+=ff(g,d),d=""),a=x,g=g||!Ka(a);s++}return""!==d&&(i+=ff(g,d)),i}const Ui={};function Bc(n){js(B(),Gt(),Vs()+n,!1)}function js(n,i,s,a){if(!a)if(3==(3&i[2])){const g=n.preOrderCheckHooks;null!==g&&Do(i,g,s)}else{const g=n.preOrderHooks;null!==g&&zs(i,g,0,s)}Ca(s)}function Vc(n,i){return n<<17|i<<2}function Ja(n){return n>>17&32767}function pf(n){return 2|n}function Gl(n){return(131068&n)>>2}function mf(n,i){return-131069&n|i<<2}function gf(n){return 1|n}function Gm(n,i){const s=n.contentQueries;if(null!==s)for(let a=0;a<s.length;a+=2){const d=s[a],g=s[a+1];if(-1!==g){const x=n.data[g];zo(d),x.contentQueries(2,i[g],g)}}}function Qu(n,i,s,a,d,g,x,A,I,Y){const K=i.blueprint.slice();return K[0]=d,K[2]=140|a,ss(K),K[3]=K[15]=n,K[8]=s,K[10]=x||n&&n[10],K[11]=A||n&&n[11],K[12]=I||n&&n[12]||null,K[9]=Y||n&&n[9]||null,K[6]=g,K[16]=2==i.type?n[16]:K,K}function xu(n,i,s,a,d){let g=n.data[i];if(null===g)g=function zc(n,i,s,a,d){const g=se(),x=pr(),I=n.data[i]=function Lv(n,i,s,a,d,g){return{type:s,index:a,insertBeforeIndex:null,injectorIndex:i?i.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:d,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,x?g:g&&g.parent,s,i,a,d);return null===n.firstChild&&(n.firstChild=I),null!==g&&(x?null==g.child&&null!==I.parent&&(g.child=I):null===g.next&&(g.next=I)),I}(n,i,s,a,d),function rc(){return zn.lFrame.inI18n}()&&(g.flags|=64);else if(64&g.type){g.type=s,g.value=a,g.attrs=d;const x=function it(){const n=zn.lFrame,i=n.currentTNode;return n.isParent?i:i.parent}();g.injectorIndex=null===x?-1:x.injectorIndex}return Ct(g,!0),g}function Hc(n,i,s,a){if(0===s)return-1;const d=i.length;for(let g=0;g<s;g++)i.push(a),n.blueprint.push(a),n.data.push(null);return d}function Mu(n,i,s){Ol(i);try{const a=n.viewQuery;null!==a&&dc(1,a,s);const d=n.template;null!==d&&Wm(n,i,d,1,s),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Gm(n,i),n.staticViewQueries&&dc(2,n.viewQuery,s);const g=n.components;null!==g&&function Iv(n,i){for(let s=0;s<i.length;s++)Zv(n,i[s])}(i,g)}catch(a){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),a}finally{i[2]&=-5,tr()}}function bu(n,i,s,a){const d=i[2];if(256!=(256&d)){Ol(i);try{ss(i),function ic(n){return zn.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==s&&Wm(n,i,s,2,a);const x=3==(3&d);if(x){const Y=n.preOrderCheckHooks;null!==Y&&Do(i,Y,null)}else{const Y=n.preOrderHooks;null!==Y&&zs(i,Y,0,null),Ha(i,0)}if(function Yv(n){for(let i=$d(n);null!==i;i=Xd(i)){if(!i[2])continue;const s=i[9];for(let a=0;a<s.length;a++){const d=s[a],g=d[3];0==(1024&d[2])&&Vo(g,1),d[2]|=1024}}}(i),function Xv(n){for(let i=$d(n);null!==i;i=Xd(i))for(let s=10;s<i.length;s++){const a=i[s],d=a[1];vr(a)&&bu(d,a,d.template,a[8])}}(i),null!==n.contentQueries&&Gm(n,i),x){const Y=n.contentCheckHooks;null!==Y&&Do(i,Y)}else{const Y=n.contentHooks;null!==Y&&zs(i,Y,1),Ha(i,1)}!function Hm(n,i){const s=n.hostBindingOpCodes;if(null!==s)try{for(let a=0;a<s.length;a++){const d=s[a];if(d<0)Ca(~d);else{const g=d,x=s[++a],A=s[++a];Pl(x,g),A(2,i[g])}}}finally{Ca(-1)}}(n,i);const A=n.components;null!==A&&function Rv(n,i){for(let s=0;s<i.length;s++)qv(n,i[s])}(i,A);const I=n.viewQuery;if(null!==I&&dc(2,I,a),x){const Y=n.viewCheckHooks;null!==Y&&Do(i,Y)}else{const Y=n.viewHooks;null!==Y&&zs(i,Y,2),Ha(i,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),i[2]&=-73,1024&i[2]&&(i[2]&=-1025,Vo(i[3],-1))}finally{tr()}}}function Sf(n,i,s,a){const d=i[10],x=kr(i);try{!x&&d.begin&&d.begin(),x&&Mu(n,i,a),bu(n,i,s,a)}finally{!x&&d.end&&d.end()}}function Wm(n,i,s,a,d){const g=Vs(),x=2&a;try{Ca(-1),x&&i.length>20&&js(n,i,20,!1),s(a,d)}finally{Ca(g)}}function Af(n,i,s){!nc()||(function Qm(n,i,s,a){const d=s.directiveStart,g=s.directiveEnd;n.firstCreatePass||O(s,i),Yo(a,i);const x=s.initialInputs;for(let A=d;A<g;A++){const I=n.data[A],Y=Oi(I);Y&&jv(i,s,I);const K=Pa(i,n,A,s);Yo(K,i),null!==x&&$v(0,A-d,K,I,0,x),Y&&(fr(s.index,i)[8]=K)}}(n,i,s,zi(s,i)),128==(128&s.flags)&&function Hv(n,i,s){const a=s.directiveStart,d=s.directiveEnd,x=s.index,A=function cu(){return zn.lFrame.currentDirectiveIndex}();try{Ca(x);for(let I=a;I<d;I++){const Y=n.data[I],K=i[I];za(I),(null!==Y.hostBindings||0!==Y.hostVars||null!==Y.hostAttrs)&&Cf(Y,K)}}finally{Ca(-1),za(A)}}(n,i,s))}function Kh(n,i,s=zi){const a=i.localNames;if(null!==a){let d=i.index+1;for(let g=0;g<a.length;g+=2){const x=a[g+1],A=-1===x?s(i,n):n[x];n[d++]=A}}}function $m(n){const i=n.tView;return null===i||i.incompleteFirstPass?n.tView=eh(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):i}function eh(n,i,s,a,d,g,x,A,I,Y){const K=20+a,xe=K+d,Ne=function Pv(n,i){const s=[];for(let a=0;a<i;a++)s.push(a<n?null:Ui);return s}(K,xe),qe="function"==typeof Y?Y():Y;return Ne[1]={type:n,blueprint:Ne,template:s,queries:null,viewQuery:A,declTNode:i,data:Ne.slice().fill(null,K),bindingStartIndex:K,expandoStartIndex:xe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof x?x():x,firstChild:null,schemas:I,consts:qe,incompleteFirstPass:!1}}function qm(n,i,s,a){const d=Su(i);null===s?d.push(a):(d.push(s),n.firstCreatePass&&Pf(n).push(a,d.length-1))}function Zm(n,i,s){for(let a in n)if(n.hasOwnProperty(a)){const d=n[a];(s=null===s?{}:s).hasOwnProperty(a)?s[a].push(i,d):s[a]=[i,d]}return s}function Tf(n,i,s,a){let d=!1;if(nc()){const g=function eg(n,i,s){const a=n.directiveRegistry;let d=null;if(a)for(let g=0;g<a.length;g++){const x=a[g];Am(s,x.selectors,!1)&&(d||(d=[]),Pe(O(s,i),n,x.type),Oi(x)?(tg(n,s),d.unshift(x)):d.push(x))}return d}(n,i,s),x=null===a?null:{"":-1};if(null!==g){d=!0,ng(s,n.data.length,g.length);for(let K=0;K<g.length;K++){const xe=g[K];xe.providersResolver&&xe.providersResolver(xe)}let A=!1,I=!1,Y=Hc(n,i,g.length,null);for(let K=0;K<g.length;K++){const xe=g[K];s.mergedAttrs=Ro(s.mergedAttrs,xe.hostAttrs),ig(n,s,i,Y,xe),Wv(Y,xe,x),null!==xe.contentQueries&&(s.flags|=8),(null!==xe.hostBindings||null!==xe.hostAttrs||0!==xe.hostVars)&&(s.flags|=128);const Ne=xe.type.prototype;!A&&(Ne.ngOnChanges||Ne.ngOnInit||Ne.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(s.index),A=!0),!I&&(Ne.ngOnChanges||Ne.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(s.index),I=!0),Y++}!function Ov(n,i){const a=i.directiveEnd,d=n.data,g=i.attrs,x=[];let A=null,I=null;for(let Y=i.directiveStart;Y<a;Y++){const K=d[Y],xe=K.inputs,Ne=null===g||Sm(i)?null:Df(xe,g);x.push(Ne),A=Zm(xe,Y,A),I=Zm(K.outputs,Y,I)}null!==A&&(A.hasOwnProperty("class")&&(i.flags|=16),A.hasOwnProperty("style")&&(i.flags|=32)),i.initialInputs=x,i.inputs=A,i.outputs=I}(n,s)}x&&function Gv(n,i,s){if(i){const a=n.localNames=[];for(let d=0;d<i.length;d+=2){const g=s[i[d+1]];if(null==g)throw new nt(-301,!1);a.push(i[d],g)}}}(s,a,x)}return s.mergedAttrs=Ro(s.mergedAttrs,s.attrs),d}function Jm(n,i,s,a,d,g){const x=g.hostBindings;if(x){let A=n.hostBindingOpCodes;null===A&&(A=n.hostBindingOpCodes=[]);const I=~i.index;(function zv(n){let i=n.length;for(;i>0;){const s=n[--i];if("number"==typeof s&&s<0)return s}return 0})(A)!=I&&A.push(I),A.push(a,d,x)}}function Cf(n,i){null!==n.hostBindings&&n.hostBindings(1,i)}function tg(n,i){i.flags|=2,(n.components||(n.components=[])).push(i.index)}function Wv(n,i,s){if(s){if(i.exportAs)for(let a=0;a<i.exportAs.length;a++)s[i.exportAs[a]]=n;Oi(i)&&(s[""]=n)}}function ng(n,i,s){n.flags|=1,n.directiveStart=i,n.directiveEnd=i+s,n.providerIndexes=i}function ig(n,i,s,a,d){n.data[a]=d;const g=d.factory||(d.factory=rs(d.type)),x=new Go(g,Oi(d),null);n.blueprint[a]=x,s[a]=x,Jm(n,i,0,a,Hc(n,s,d.hostVars,Ui),d)}function jv(n,i,s){const a=zi(i,n),d=$m(s),g=n[10],x=wu(n,Qu(n,d,null,s.onPush?64:16,a,i,g,g.createRenderer(a,s),null,null));n[i.index]=x}function Ml(n,i,s,a,d,g){const x=zi(n,i);!function hc(n,i,s,a,d,g,x){if(null==g)ln(n)?n.removeAttribute(i,d,s):i.removeAttribute(d);else{const A=null==x?Qe(g):x(g,a||"",d);ln(n)?n.setAttribute(i,d,A,s):s?i.setAttributeNS(s,d,A):i.setAttribute(d,A)}}(i[11],x,g,n.value,s,a,d)}function $v(n,i,s,a,d,g){const x=g[i];if(null!==x){const A=a.setInput;for(let I=0;I<x.length;){const Y=x[I++],K=x[I++],xe=x[I++];null!==A?a.setInput(s,xe,Y,K):s[K]=xe}}}function Df(n,i){let s=null,a=0;for(;a<i.length;){const d=i[a];if(0!==d)if(5!==d){if("number"==typeof d)break;n.hasOwnProperty(d)&&(null===s&&(s=[]),s.push(d,n[d],i[a+1])),a+=2}else a+=2;else a+=4}return s}function rg(n,i,s,a){return new Array(n,!0,!1,i,null,0,a,s,null,null)}function qv(n,i){const s=fr(i,n);if(vr(s)){const a=s[1];80&s[2]?bu(a,s,a.template,s[8]):s[5]>0&&Jh(s)}}function Jh(n){for(let a=$d(n);null!==a;a=Xd(a))for(let d=10;d<a.length;d++){const g=a[d];if(1024&g[2]){const x=g[1];bu(x,g,x.template,g[8])}else g[5]>0&&Jh(g)}const s=n[1].components;if(null!==s)for(let a=0;a<s.length;a++){const d=fr(s[a],n);vr(d)&&d[5]>0&&Jh(d)}}function Zv(n,i){const s=fr(i,n),a=s[1];(function Rf(n,i){for(let s=i.length;s<n.blueprint.length;s++)i.push(n.blueprint[s])})(a,s),Mu(a,s,s[8])}function wu(n,i){return n[13]?n[14][4]=i:n[13]=i,n[14]=i,i}function Qh(n){for(;n;){n[2]|=64;const i=Zu(n);if(is(n)&&!i)return n;n=i}return null}function ed(n){!function Oo(n){for(let i=0;i<n.components.length;i++){const s=n.components[i],a=Gd(s),d=a[1];Sf(d,a,d.template,s)}}(n[8])}function dc(n,i,s){zo(0),i(n,s)}const Eu=(()=>Promise.resolve(null))();function Su(n){return n[7]||(n[7]=[])}function Pf(n){return n.cleanup||(n.cleanup=[])}function Au(n,i){const s=n[9],a=s?s.get(Fc,null):null;a&&a.handleError(i)}function rh(n,i,s,a,d){for(let g=0;g<s.length;){const x=s[g++],A=s[g++],I=i[x],Y=n.data[x];null!==Y.setInput?Y.setInput(I,d,a,A):I[A]=d}}function bl(n,i,s){const a=Qi(i,n);!function Zp(n,i,s){ln(n)?n.setValue(i,s):i.textContent=s}(n[11],a,s)}function Tu(n,i,s){let a=s?n.styles:null,d=s?n.classes:null,g=0;if(null!==i)for(let x=0;x<i.length;x++){const A=i[x];"number"==typeof A?g=A:1==g?d=Gn(d,A):2==g&&(a=Gn(a,A+": "+i[++x]+";"))}s?n.styles=a:n.stylesWithoutHost=a,s?n.classes=d:n.classesWithoutHost=d}const Cu=new qr("INJECTOR",-1);class Of{get(i,s=mr){if(s===mr){const a=new Error(`NullInjectorError: No provider for ${gt(i)}!`);throw a.name="NullInjectorError",a}return s}}const Ff=new qr("Set Injector scope."),Du={},og={};let nd;function ag(){return void 0===nd&&(nd=new Of),nd}function Nf(n,i=null,s=null,a){const d=Gc(n,i,s,a);return d._resolveInjectorDefTypes(),d}function Gc(n,i=null,s=null,a){return new kf(n,s,i||ag(),a)}class kf{constructor(i,s,a,d=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];s&&E(s,A=>this.processProvider(A,i,s)),E([i],A=>this.processInjectorType(A,[],g)),this.records.set(Cu,wl(void 0,this));const x=this.records.get(Ff);this.scope=null!=x?x.value:null,this.source=d||("object"==typeof i?null:gt(i))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(i=>i.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(i,s=mr,a=Bn.Default){this.assertNotDestroyed();const d=Po(this),g=On(void 0);try{if(!(a&Bn.SkipSelf)){let A=this.records.get(i);if(void 0===A){const I=function ug(n){return"function"==typeof n||"object"==typeof n&&n instanceof qr}(i)&&Ir(i);A=I&&this.injectableDefInScope(I)?wl(id(i),Du):null,this.records.set(i,A)}if(null!=A)return this.hydrate(i,A)}return(a&Bn.Self?ag():this.parent).get(i,s=a&Bn.Optional&&s===mr?null:s)}catch(x){if("NullInjectorError"===x.name){if((x[ds]=x[ds]||[]).unshift(gt(i)),d)throw x;return function kh(n,i,s,a){const d=n[ds];throw i[vo]&&d.unshift(i[vo]),n.message=function Rc(n,i,s,a=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let d=gt(i);if(Array.isArray(i))d=i.map(gt).join(" -> ");else if("object"==typeof i){let g=[];for(let x in i)if(i.hasOwnProperty(x)){let A=i[x];g.push(x+":"+("string"==typeof A?JSON.stringify(A):gt(A)))}d=`{${g.join(", ")}}`}return`${s}${a?"("+a+")":""}[${d}]: ${n.replace(Zr,"\n  ")}`}("\n"+n.message,d,s,a),n.ngTokenPath=d,n[ds]=null,n}(x,i,"R3InjectorError",this.source)}throw x}finally{On(g),Po(d)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(i=>this.get(i))}toString(){const i=[];return this.records.forEach((a,d)=>i.push(gt(d))),`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new nt(205,!1)}processInjectorType(i,s,a){if(!(i=ke(i)))return!1;let d=zr(i);const g=null==d&&i.ngModule||void 0,x=void 0===g?i:g,A=-1!==a.indexOf(x);if(void 0!==g&&(d=zr(g)),null==d)return!1;if(null!=d.imports&&!A){let K;a.push(x);try{E(d.imports,xe=>{this.processInjectorType(xe,s,a)&&(void 0===K&&(K=[]),K.push(xe))})}finally{}if(void 0!==K)for(let xe=0;xe<K.length;xe++){const{ngModule:Ne,providers:qe}=K[xe];E(qe,At=>this.processProvider(At,Ne,qe||Ve))}}this.injectorDefTypes.add(x);const I=rs(x)||(()=>new x);this.records.set(x,wl(I,Du));const Y=d.providers;if(null!=Y&&!A){const K=i;E(Y,xe=>this.processProvider(xe,K,Y))}return void 0!==g&&void 0!==i.providers}processProvider(i,s,a){let d=El(i=ke(i))?i:ke(i&&i.provide);const g=function lg(n,i,s){return Bf(n)?wl(void 0,n.useValue):wl(rd(n),Du)}(i);if(El(i)||!0!==i.multi)this.records.get(d);else{let x=this.records.get(d);x||(x=wl(void 0,Du,!0),x.factory=()=>La(x.multi),this.records.set(d,x)),d=i,x.multi.push(i)}this.records.set(d,g)}hydrate(i,s){return s.value===Du&&(s.value=og,s.value=s.factory()),"object"==typeof s.value&&s.value&&function od(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(s.value)&&this.onDestroy.add(s.value),s.value}injectableDefInScope(i){if(!i.providedIn)return!1;const s=ke(i.providedIn);return"string"==typeof s?"any"===s||s===this.scope:this.injectorDefTypes.has(s)}}function id(n){const i=Ir(n),s=null!==i?i.factory:rs(n);if(null!==s)return s;if(n instanceof qr)throw new nt(204,!1);if(n instanceof Function)return function Uf(n){const i=n.length;if(i>0)throw q(i,"?"),new nt(204,!1);const s=function Fo(n){const i=n&&(n[ar]||n[Ts]);if(i){const s=function Mr(n){if(n.hasOwnProperty("name"))return n.name;const i=(""+n).match(/^function\s*([^\s(]+)/);return null===i?"":i[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${s}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${s}" class.`),i}return null}(n);return null!==s?()=>s.factory(n):()=>new n}(n);throw new nt(204,!1)}function rd(n,i,s){let a;if(El(n)){const d=ke(n);return rs(d)||id(d)}if(Bf(n))a=()=>ke(n.useValue);else if(function sd(n){return!(!n||!n.useFactory)}(n))a=()=>n.useFactory(...La(n.deps||[]));else if(function Jv(n){return!(!n||!n.useExisting)}(n))a=()=>_r(ke(n.useExisting));else{const d=ke(n&&(n.useClass||n.provide));if(!function cg(n){return!!n.deps}(n))return rs(d)||id(d);a=()=>new d(...La(n.deps))}return a}function wl(n,i,s=!1){return{factory:n,value:i,multi:s?[]:void 0}}function Bf(n){return null!==n&&"object"==typeof n&&Xo in n}function El(n){return"function"==typeof n}let Sl=(()=>{class n{static create(s,a){var d;if(Array.isArray(s))return Nf({name:""},a,s,"");{const g=null!==(d=s.name)&&void 0!==d?d:"";return Nf({name:g},s.parent,s.providers,g)}}}return n.THROW_IF_NOT_FOUND=mr,n.NULL=new Of,n.\u0275prov=Vi({token:n,providedIn:"any",factory:()=>_r(Cu)}),n.__NG_ELEMENT_ID__=-1,n})();function Qa(n,i){fo(Gd(n)[1],P())}function ah(n){let i=function gg(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),s=!0;const a=[n];for(;i;){let d;if(Oi(n))d=i.\u0275cmp||i.\u0275dir;else{if(i.\u0275cmp)throw new nt(903,"");d=i.\u0275dir}if(d){if(s){a.push(d);const x=n;x.inputs=lh(n.inputs),x.declaredInputs=lh(n.declaredInputs),x.outputs=lh(n.outputs);const A=d.hostBindings;A&&o0(n,A);const I=d.viewQuery,Y=d.contentQueries;if(I&&jf(n,I),Y&&$f(n,Y),bn(n.inputs,d.inputs),bn(n.declaredInputs,d.declaredInputs),bn(n.outputs,d.outputs),Oi(d)&&d.data.animation){const K=n.data;K.animation=(K.animation||[]).concat(d.data.animation)}}const g=d.features;if(g)for(let x=0;x<g.length;x++){const A=g[x];A&&A.ngInherit&&A(n),A===ah&&(s=!1)}}i=Object.getPrototypeOf(i)}!function ud(n){let i=0,s=null;for(let a=n.length-1;a>=0;a--){const d=n[a];d.hostVars=i+=d.hostVars,d.hostAttrs=Ro(d.hostAttrs,s=Ro(s,d.hostAttrs))}}(a)}function lh(n){return n===Q?{}:n===Ve?[]:n}function jf(n,i){const s=n.viewQuery;n.viewQuery=s?(a,d)=>{i(a,d),s(a,d)}:i}function $f(n,i){const s=n.contentQueries;n.contentQueries=s?(a,d,g)=>{i(a,d,g),s(a,d,g)}:i}function o0(n,i){const s=n.hostBindings;n.hostBindings=s?(a,d)=>{i(a,d),s(a,d)}:i}let hd=null;function Tl(){if(!hd){const n=we.Symbol;if(n&&n.iterator)hd=n.iterator;else{const i=Object.getOwnPropertyNames(Map.prototype);for(let s=0;s<i.length;++s){const a=i[s];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(hd=a)}}}return hd}function ch(n){return!!jc(n)&&(Array.isArray(n)||!(n instanceof Map)&&Tl()in n)}function jc(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function xo(n,i,s){return!Object.is(n[i],s)&&(n[i]=s,!0)}function dd(n,i,s,a){const d=Gt();return xo(d,ps(),i)&&(B(),Ml(Ur(),d,n,i,s,a)),dd}function Lu(n,i,s,a,d,g,x,A){const I=Gt(),Y=B(),K=n+20,xe=Y.firstCreatePass?function Yc(n,i,s,a,d,g,x,A,I){const Y=i.consts,K=xu(i,n,4,x||null,hs(Y,A));Tf(i,s,K,hs(Y,I)),fo(i,K);const xe=K.tViews=eh(2,K,a,d,g,i.directiveRegistry,i.pipeRegistry,null,i.schemas,Y);return null!==i.queries&&(i.queries.template(i,K),xe.queries=i.queries.embeddedTView(K)),K}(K,Y,I,i,s,a,d,g,x):Y.data[K];Ct(xe,!1);const Ne=I[11].createComment("");zh(Y,I,Ne,xe),Yo(Ne,I),wu(I,I[K]=rg(Ne,I,Ne,xe)),qo(xe)&&Af(Y,I,xe),null!=x&&Kh(I,xe,A)}function xh(n,i=Bn.Default){const s=Gt();return null===s?_r(n,i):Hn(P(),s,ke(n),i)}function ip(){throw new Error("invalid")}function xd(n,i,s){const a=Gt();return xo(a,ps(),i)&&function xa(n,i,s,a,d,g,x,A){const I=zi(i,s);let K,Y=i.inputs;!A&&null!=Y&&(K=Y[a])?(rh(n,s,K,a,d),bs(i)&&function Nv(n,i){const s=fr(i,n);16&s[2]||(s[2]|=64)}(s,i.index)):3&i.type&&(a=function Fv(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(a),d=null!=x?x(d,i.value||"",a):d,ln(g)?g.setProperty(I,a,d):Wo(a)||(I.setProperty?I.setProperty(a,d):I[a]=d))}(B(),Ur(),a,n,i,a[11],s,!1),xd}function rp(n,i,s,a,d){const x=d?"class":"style";rh(n,s,i.inputs[x],x,a)}function Fu(n,i,s,a){const d=Gt(),g=B(),x=20+n,A=d[11],I=d[x]=qd(A,i,function du(){return zn.lFrame.currentNamespace}()),Y=g.firstCreatePass?function w0(n,i,s,a,d,g,x){const A=i.consts,Y=xu(i,n,2,d,hs(A,g));return Tf(i,s,Y,hs(A,x)),null!==Y.attrs&&Tu(Y,Y.attrs,!1),null!==Y.mergedAttrs&&Tu(Y,Y.mergedAttrs,!0),null!==i.queries&&i.queries.elementStart(i,Y),Y}(x,g,d,0,i,s,a):g.data[x];Ct(Y,!0);const K=Y.mergedAttrs;null!==K&&Ia(A,I,K);const xe=Y.classes;null!==xe&&nf(A,I,xe);const Ne=Y.styles;return null!==Ne&&cm(A,I,Ne),64!=(64&Y.flags)&&zh(g,d,I,Y),0===function tc(){return zn.lFrame.elementDepthCount}()&&Yo(I,d),function Ac(){zn.lFrame.elementDepthCount++}(),qo(Y)&&(Af(g,d,Y),function jm(n,i,s){if(Ms(i)){const d=i.directiveEnd;for(let g=i.directiveStart;g<d;g++){const x=n.data[g];x.contentQueries&&x.contentQueries(1,s[g],g)}}}(g,Y,d)),null!==a&&Kh(d,Y),Fu}function Mh(){let n=P();pr()?Et():(n=n.parent,Ct(n,!1));const i=n;!function hl(){zn.lFrame.elementDepthCount--}();const s=B();return s.firstCreatePass&&(fo(s,n),Ms(n)&&s.queries.elementEnd(n)),null!=i.classesWithoutHost&&function Nl(n){return 0!=(16&n.flags)}(i)&&rp(s,i,Gt(),i.classesWithoutHost,!0),null!=i.stylesWithoutHost&&function Ga(n){return 0!=(32&n.flags)}(i)&&rp(s,i,Gt(),i.stylesWithoutHost,!1),Mh}function Md(n,i,s,a){return Fu(n,i,s,a),Mh(),Md}function ba(){return Gt()}function ql(n){return!!n&&"function"==typeof n.then}function wd(n){return!!n&&"function"==typeof n.subscribe}const op=wd;function bh(n,i,s,a){const d=Gt(),g=B(),x=P();return function Cg(n,i,s,a,d,g,x,A){const I=qo(a),K=n.firstCreatePass&&Pf(n),xe=i[8],Ne=Su(i);let qe=!0;if(3&a.type||A){const Tn=zi(a,i),Xn=A?A(Tn):Tn,Ot=Ne.length,xi=A?dr=>A(vi(dr[a.index])):a.index;if(ln(s)){let dr=null;if(!A&&I&&(dr=function S0(n,i,s,a){const d=n.cleanup;if(null!=d)for(let g=0;g<d.length-1;g+=2){const x=d[g];if(x===s&&d[g+1]===a){const A=i[7],I=d[g+2];return A.length>I?A[I]:null}"string"==typeof x&&(g+=2)}return null}(n,i,d,a.index)),null!==dr)(dr.__ngLastListenerFn__||dr).__ngNextListenerFn__=g,dr.__ngLastListenerFn__=g,qe=!1;else{g=Zc(a,i,xe,g,!1);const $r=s.listen(Xn,d,g);Ne.push(g,$r),K&&K.push(d,xi,Ot,Ot+1)}}else g=Zc(a,i,xe,g,!0),Xn.addEventListener(d,g,x),Ne.push(g),K&&K.push(d,xi,Ot,x)}else g=Zc(a,i,xe,g,!1);const At=a.outputs;let un;if(qe&&null!==At&&(un=At[d])){const Tn=un.length;if(Tn)for(let Xn=0;Xn<Tn;Xn+=2){const ol=i[un[Xn]][un[Xn+1]].subscribe(g),Ph=Ne.length;Ne.push(g,ol),K&&K.push(d,a.index,Ph,-(Ph+1))}}}(g,d,d[11],x,n,i,!!s,a),bh}function A0(n,i,s,a){try{return!1!==s(a)}catch(d){return Au(n,d),!1}}function Zc(n,i,s,a,d){return function g(x){if(x===Function)return a;const A=2&n.flags?fr(n.index,i):i;0==(32&i[2])&&Qh(A);let I=A0(i,0,a,x),Y=g.__ngNextListenerFn__;for(;Y;)I=A0(i,0,Y,x)&&I,Y=Y.__ngNextListenerFn__;return d&&!1===I&&(x.preventDefault(),x.returnValue=!1),I}}function Dg(n=1){return function Fl(n){return(zn.lFrame.contextLView=function Ta(n,i){for(;n>0;)i=i[15],n--;return i}(n,zn.lFrame.contextLView))[8]}(n)}function Rg(n,i){let s=null;const a=function Tm(n){const i=n.attrs;if(null!=i){const s=i.indexOf(5);if(0==(1&s))return i[s+1]}return null}(n);for(let d=0;d<i.length;d++){const g=i[d];if("*"!==g){if(null===a?Am(n,g,!0):Rm(a,g))return d}else s=d}return s}function Ig(n){const i=Gt()[16][6];if(!i.projection){const a=i.projection=q(n?n.length:1,null),d=a.slice();let g=i.child;for(;null!==g;){const x=n?Rg(g,n):0;null!==x&&(d[x]?d[x].projectionNext=g:a[x]=g,d[x]=g),g=g.next}}}function tl(n,i=0,s){const a=Gt(),d=B(),g=xu(d,20+n,16,null,s||null);null===g.projection&&(g.projection=i),Et(),64!=(64&g.flags)&&function ky(n,i,s){lm(i[11],0,i,s,Qp(n,s,i),im(s.parent||i[6],s,i))}(d,a,g)}function Bu(n,i,s,a,d){const g=n[s+1],x=null===i;let A=a?Ja(g):Gl(g),I=!1;for(;0!==A&&(!1===I||x);){const K=n[A+1];Zl(n[A],i)&&(I=!0,n[A+1]=a?gf(K):pf(K)),A=a?Ja(K):Gl(K)}I&&(n[s+1]=a?pf(g):gf(g))}function Zl(n,i){return null===n||null==i||(Array.isArray(n)?n[1]:n)===i||!(!Array.isArray(n)||"string"!=typeof i)&&Qt(n,i)>=0}function Td(n,i){return function il(n,i,s,a){const d=Gt(),g=B(),x=function Lr(n){const i=zn.lFrame,s=i.bindingIndex;return i.bindingIndex=i.bindingIndex+n,s}(2);g.firstUpdatePass&&function Ug(n,i,s,a){const d=n.data;if(null===d[s+1]){const g=d[Vs()],x=function hp(n,i){return i>=n.expandoStartIndex}(n,s);(function L0(n,i){return 0!=(n.flags&(i?16:32))})(g,a)&&null===i&&!x&&(i=!1),i=function I0(n,i,s,a){const d=function uu(n){const i=zn.lFrame.currentDirectiveIndex;return-1===i?null:n[i]}(n);let g=a?i.residualClasses:i.residualStyles;if(null===d)0===(a?i.classBindings:i.styleBindings)&&(s=Sh(s=pp(null,n,i,s,a),i.attrs,a),g=null);else{const x=i.directiveStylingLast;if(-1===x||n[x]!==d)if(s=pp(d,n,i,s,a),null===g){let I=function P0(n,i,s){const a=s?i.classBindings:i.styleBindings;if(0!==Gl(a))return n[Ja(a)]}(n,i,a);void 0!==I&&Array.isArray(I)&&(I=pp(null,n,i,I[1],a),I=Sh(I,i.attrs,a),function dp(n,i,s,a){n[Ja(s?i.classBindings:i.styleBindings)]=a}(n,i,a,I))}else g=function fp(n,i,s){let a;const d=i.directiveEnd;for(let g=1+i.directiveStylingLast;g<d;g++)a=Sh(a,n[g].hostAttrs,s);return Sh(a,i.attrs,s)}(n,i,a)}return void 0!==g&&(a?i.residualClasses=g:i.residualStyles=g),s}(d,g,i,a),function Fg(n,i,s,a,d,g){let x=g?i.classBindings:i.styleBindings,A=Ja(x),I=Gl(x);n[a]=s;let K,Y=!1;if(Array.isArray(s)){const xe=s;K=xe[1],(null===K||Qt(xe,K)>0)&&(Y=!0)}else K=s;if(d)if(0!==I){const Ne=Ja(n[A+1]);n[a+1]=Vc(Ne,A),0!==Ne&&(n[Ne+1]=mf(n[Ne+1],a)),n[A+1]=function Mv(n,i){return 131071&n|i<<17}(n[A+1],a)}else n[a+1]=Vc(A,0),0!==A&&(n[A+1]=mf(n[A+1],a)),A=a;else n[a+1]=Vc(I,0),0===A?A=a:n[I+1]=mf(n[I+1],a),I=a;Y&&(n[a+1]=pf(n[a+1])),Bu(n,K,a,!0),Bu(n,K,a,!1),function T0(n,i,s,a,d){const g=d?n.residualClasses:n.residualStyles;null!=g&&"string"==typeof i&&Qt(g,i)>=0&&(s[a+1]=gf(s[a+1]))}(i,K,n,a,g),x=Vc(A,I),g?i.classBindings=x:i.styleBindings=x}(d,g,i,s,x,a)}}(g,n,x,a),i!==Ui&&xo(d,x,i)&&function mp(n,i,s,a,d,g,x,A){if(!(3&i.type))return;const I=n.data,Y=I[A+1];eu(function Fm(n){return 1==(1&n)}(Y)?zg(I,i,s,d,Gl(Y),x):void 0)||(eu(g)||function Om(n){return 2==(2&n)}(Y)&&(g=zg(I,null,s,d,A,x)),function By(n,i,s,a,d){const g=ln(n);if(i)d?g?n.addClass(s,a):s.classList.add(a):g?n.removeClass(s,a):s.classList.remove(a);else{let x=-1===a.indexOf("-")?void 0:qa.DashCase;if(null==d)g?n.removeStyle(s,a,x):s.style.removeProperty(a);else{const A="string"==typeof d&&d.endsWith("!important");A&&(d=d.slice(0,-10),x|=qa.Important),g?n.setStyle(s,a,d,x):s.style.setProperty(a,d,A?"important":"")}}}(a,x,Qi(Vs(),s),d,g))}(g,g.data[Vs()],d,d[11],n,d[x+1]=function Hg(n,i){return null==n||("string"==typeof i?n+=i:"object"==typeof n&&(n=gt(Vl(n)))),n}(i,s),a,x)}(n,i,null,!0),Td}function pp(n,i,s,a,d){let g=null;const x=s.directiveEnd;let A=s.directiveStylingLast;for(-1===A?A=s.directiveStart:A++;A<x&&(g=i[A],a=Sh(a,g.hostAttrs,d),g!==n);)A++;return null!==n&&(s.directiveStylingLast=A),a}function Sh(n,i,s){const a=s?1:2;let d=-1;if(null!==i)for(let g=0;g<i.length;g++){const x=i[g];"number"==typeof x?d=x:d===a&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),It(n,x,!!s||i[++g]))}return void 0===n?null:n}function zg(n,i,s,a,d,g){const x=null===i;let A;for(;d>0;){const I=n[d],Y=Array.isArray(I),K=Y?I[1]:I,xe=null===K;let Ne=s[d+1];Ne===Ui&&(Ne=xe?Ve:void 0);let qe=xe?wn(Ne,a):K===a?Ne:void 0;if(Y&&!eu(qe)&&(qe=wn(I,a)),eu(qe)&&(A=qe,x))return A;const At=n[d+1];d=x?Ja(At):Gl(At)}if(null!==i){let I=g?i.residualClasses:i.residualStyles;null!=I&&(A=wn(I,a))}return A}function eu(n){return void 0!==n}function O0(n,i=""){const s=Gt(),a=B(),d=n+20,g=a.firstCreatePass?xu(a,d,1,i,null):a.data[d],x=s[d]=function Yd(n,i){return ln(n)?n.createText(i):n.createTextNode(i)}(s[11],i);zh(a,s,x,g),Ct(g,!1)}function Gg(n){return Cd("",n,""),Gg}function Cd(n,i,s){const a=Gt(),d=function Pu(n,i,s,a){return xo(n,ps(),s)?i+Qe(s)+a:Ui}(a,n,i,s);return d!==Ui&&bl(a,Vs(),d),Cd}const Vu=void 0;var X0=["en",[["a","p"],["AM","PM"],Vu],[["AM","PM"],Vu,Vu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Vu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Vu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Vu,"{1} 'at' {0}",Vu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Bx(n){const s=Math.floor(Math.abs(n)),a=n.toString().replace(/^[^.]*\.?/,"").length;return 1===s&&0===a?1:5}];let ru={};function wp(n){const i=function Vx(n){return n.toLowerCase().replace(/_/g,"-")}(n);let s=Y0(i);if(s)return s;const a=i.split("-")[0];if(s=Y0(a),s)return s;if("en"===a)return X0;throw new Error(`Missing locale data for the locale "${n}".`)}function Ep(n){return wp(n)[pi.PluralCase]}function Y0(n){return n in ru||(ru[n]=we.ng&&we.ng.common&&we.ng.common.locales&&we.ng.common.locales[n]),ru[n]}var pi=(()=>((pi=pi||{})[pi.LocaleId=0]="LocaleId",pi[pi.DayPeriodsFormat=1]="DayPeriodsFormat",pi[pi.DayPeriodsStandalone=2]="DayPeriodsStandalone",pi[pi.DaysFormat=3]="DaysFormat",pi[pi.DaysStandalone=4]="DaysStandalone",pi[pi.MonthsFormat=5]="MonthsFormat",pi[pi.MonthsStandalone=6]="MonthsStandalone",pi[pi.Eras=7]="Eras",pi[pi.FirstDayOfWeek=8]="FirstDayOfWeek",pi[pi.WeekendRange=9]="WeekendRange",pi[pi.DateFormat=10]="DateFormat",pi[pi.TimeFormat=11]="TimeFormat",pi[pi.DateTimeFormat=12]="DateTimeFormat",pi[pi.NumberSymbols=13]="NumberSymbols",pi[pi.NumberFormats=14]="NumberFormats",pi[pi.CurrencyCode=15]="CurrencyCode",pi[pi.CurrencySymbol=16]="CurrencySymbol",pi[pi.CurrencyName=17]="CurrencyName",pi[pi.Currencies=18]="Currencies",pi[pi.Directionality=19]="Directionality",pi[pi.PluralCase=20]="PluralCase",pi[pi.ExtraData=21]="ExtraData",pi))();const rl="en-US";let ey=rl;function Re(n,i,s,a,d){if(n=ke(n),Array.isArray(n))for(let g=0;g<n.length;g++)Re(n[g],i,s,a,d);else{const g=B(),x=Gt();let A=El(n)?n:ke(n.provide),I=rd(n);const Y=P(),K=1048575&Y.providerIndexes,xe=Y.directiveStart,Ne=Y.providerIndexes>>20;if(El(n)||!n.multi){const qe=new Go(I,d,xh),At=pn(A,i,d?K:K+Ne,xe);-1===At?(Pe(O(Y,x),g,A),pe(g,n,i.length),i.push(A),Y.directiveStart++,Y.directiveEnd++,d&&(Y.providerIndexes+=1048576),s.push(qe),x.push(qe)):(s[At]=qe,x[At]=qe)}else{const qe=pn(A,i,K+Ne,xe),At=pn(A,i,K,K+Ne),un=qe>=0&&s[qe],Tn=At>=0&&s[At];if(d&&!Tn||!d&&!un){Pe(O(Y,x),g,A);const Xn=function xn(n,i,s,a,d){const g=new Go(n,s,xh);return g.multi=[],g.index=i,g.componentProviders=0,ft(g,d,a&&!s),g}(d?vn:dn,s.length,d,a,I);!d&&Tn&&(s[At].providerFactory=Xn),pe(g,n,i.length,0),i.push(A),Y.directiveStart++,Y.directiveEnd++,d&&(Y.providerIndexes+=1048576),s.push(Xn),x.push(Xn)}else pe(g,n,qe>-1?qe:At,ft(s[d?At:qe],I,!d&&a));!d&&a&&Tn&&s[At].componentProviders++}}}function pe(n,i,s,a){const d=El(i),g=function Ru(n){return!!n.useClass}(i);if(d||g){const I=(g?ke(i.useClass):i).prototype.ngOnDestroy;if(I){const Y=n.destroyHooks||(n.destroyHooks=[]);if(!d&&i.multi){const K=Y.indexOf(s);-1===K?Y.push(s,[a,I]):Y[K+1].push(a,I)}else Y.push(s,I)}}}function ft(n,i,s){return s&&n.componentProviders++,n.multi.push(i)-1}function pn(n,i,s,a){for(let d=s;d<a;d++)if(i[d]===n)return d;return-1}function dn(n,i,s,a){return di(this.multi,[])}function vn(n,i,s,a){const d=this.multi;let g;if(this.providerFactory){const x=this.providerFactory.componentProviders,A=Pa(s,s[1],this.providerFactory.index,a);g=A.slice(0,x),di(d,g);for(let I=x;I<A.length;I++)g.push(A[I])}else g=[],di(d,g);return g}function di(n,i){for(let s=0;s<n.length;s++)i.push((0,n[s])());return i}function Mt(n,i=[]){return s=>{s.providersResolver=(a,d)=>function As(n,i,s){const a=B();if(a.firstCreatePass){const d=Oi(n);Re(s,a.data,a.blueprint,d,!0),Re(i,a.data,a.blueprint,d,!1)}}(a,d?d(n):n,i)}}class yi{}class nr{resolveComponentFactory(i){throw function wi(n){const i=Error(`No component factory found for ${gt(n)}. Did you add it to @NgModule.entryComponents?`);return i.ngComponent=n,i}(i)}}let Vr=(()=>{class n{}return n.NULL=new nr,n})();function Xe(){return Ln(P(),Gt())}function Ln(n,i){return new _t(zi(n,i))}let _t=(()=>{class n{constructor(s){this.nativeElement=s}}return n.__NG_ELEMENT_ID__=Xe,n})();function An(n){return n instanceof _t?n.nativeElement:n}class xr{}let ys=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function wc(){const n=Gt(),s=fr(P().index,n);return function Xs(n){return n[11]}(Ds(s)?s:n)}(),n})(),os=(()=>{class n{}return n.\u0275prov=Vi({token:n,providedIn:"root",factory:()=>null}),n})();class sl{constructor(i){this.full=i,this.major=i.split(".")[0],this.minor=i.split(".")[1],this.patch=i.split(".").slice(2).join(".")}}const la=new sl("13.3.12"),Id={};function Ah(n,i,s,a,d=!1){for(;null!==s;){const g=i[s.index];if(null!==g&&a.push(vi(g)),er(g))for(let A=10;A<g.length;A++){const I=g[A],Y=I[1].firstChild;null!==Y&&Ah(I[1],I,Y,a)}const x=s.type;if(8&x)Ah(n,i,s.child,a);else if(32&x){const A=jd(s,i);let I;for(;I=A();)a.push(I)}else if(16&x){const A=am(i,s);if(Array.isArray(A))a.push(...A);else{const I=Zu(i[16]);Ah(I[1],I,A,a,!0)}}s=d?s.projectionNext:s.next}return a}class Th{constructor(i,s){this._lView=i,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const i=this._lView,s=i[1];return Ah(s,i,s.firstChild,[])}get context(){return this._lView[8]}set context(i){this._lView[8]=i}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const i=this._lView[3];if(er(i)){const s=i[8],a=s?s.indexOf(this):-1;a>-1&&(Zd(i,a),j(s,a))}this._attachedToViewContainer=!1}Jp(this._lView[1],this._lView)}onDestroy(i){qm(this._lView[1],this._lView,null,i)}markForCheck(){Qh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function jl(n,i,s){const a=i[10];a.begin&&a.begin();try{bu(n,i,n.template,s)}catch(d){throw Au(i,d),d}finally{a.end&&a.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new nt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Dy(n,i){Ku(n,i,i[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new nt(902,"");this._appRef=i}}class Pd extends Th{constructor(i){super(i),this._view=i}detectChanges(){ed(this._view)}checkNoChanges(){}get context(){return null}}class Tp extends Vr{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){const s=Gi(i);return new Cp(s,this.ngModule)}}function Ch(n){const i=[];for(let s in n)n.hasOwnProperty(s)&&i.push({propName:n[s],templateName:s});return i}class Cp extends yi{constructor(i,s){super(),this.componentDef=i,this.ngModule=s,this.componentType=i.type,this.selector=function Pm(n){return n.map(Im).join(",")}(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!s}get inputs(){return Ch(this.componentDef.inputs)}get outputs(){return Ch(this.componentDef.outputs)}create(i,s,a,d){const g=(d=d||this.ngModule)?function r_(n,i){return{get:(s,a,d)=>{const g=n.get(s,Id,d);return g!==Id||a===Id?g:i.get(s,a,d)}}}(i,d.injector):i,x=g.get(xr,cr),A=g.get(os,null),I=x.createRenderer(null,this.componentDef),Y=this.componentDef.selectors[0][0]||"div",K=a?function Ym(n,i,s){if(ln(n))return n.selectRootElement(i,s===he.ShadowDom);let a="string"==typeof i?n.querySelector(i):i;return a.textContent="",a}(I,a,this.componentDef.encapsulation):qd(x.createRenderer(null,this.componentDef),Y,function sy(n){const i=n.toLowerCase();return"svg"===i?"svg":"math"===i?H:null}(Y)),xe=this.componentDef.onPush?576:528,Ne=function s0(n,i){return{components:[],scheduler:n||kc,clean:Eu,playerHandler:i||null,flags:0}}(),qe=eh(0,null,null,1,0,null,null,null,null,null),At=Qu(null,qe,Ne,xe,null,null,x,I,A,g);let un,Tn;Ol(At);try{const Xn=function n0(n,i,s,a,d,g){const x=s[1];s[20]=n;const I=xu(x,20,2,"#host",null),Y=I.mergedAttrs=i.hostAttrs;null!==Y&&(Tu(I,Y,!0),null!==n&&(Ia(d,n,Y),null!==I.classes&&nf(d,n,I.classes),null!==I.styles&&cm(d,n,I.styles)));const K=a.createRenderer(n,i),xe=Qu(s,$m(i),null,i.onPush?64:16,s[20],I,a,K,g||null,null);return x.firstCreatePass&&(Pe(O(I,s),x,i.type),tg(x,I),ng(I,s.length,1)),wu(s,xe),s[20]=xe}(K,this.componentDef,At,x,I);if(K)if(a)Ia(I,K,["ng-version",la.full]);else{const{attrs:Ot,classes:xi}=function Lm(n){const i=[],s=[];let a=1,d=2;for(;a<n.length;){let g=n[a];if("string"==typeof g)2===d?""!==g&&i.push(g,n[++a]):8===d&&s.push(g);else{if(!Ka(d))break;d=g}a++}return{attrs:i,classes:s}}(this.componentDef.selectors[0]);Ot&&Ia(I,K,Ot),xi&&xi.length>0&&nf(I,K,xi.join(" "))}if(Tn=io(qe,20),void 0!==s){const Ot=Tn.projection=[];for(let xi=0;xi<this.ngContentSelectors.length;xi++){const dr=s[xi];Ot.push(null!=dr?Array.from(dr):null)}}un=function r0(n,i,s,a,d){const g=s[1],x=function Vv(n,i,s){const a=P();n.firstCreatePass&&(s.providersResolver&&s.providersResolver(s),ig(n,a,i,Hc(n,i,1,null),s));const d=Pa(i,n,a.directiveStart,a);Yo(d,i);const g=zi(a,i);return g&&Yo(g,i),d}(g,s,i);if(a.components.push(x),n[8]=x,d&&d.forEach(I=>I(x,i)),i.contentQueries){const I=P();i.contentQueries(1,x,I.directiveStart)}const A=P();return!g.firstCreatePass||null===i.hostBindings&&null===i.hostAttrs||(Ca(A.index),Jm(s[1],A,0,A.directiveStart,A.directiveEnd,i),Cf(i,x)),x}(Xn,this.componentDef,At,Ne,[Qa]),Mu(qe,At,null)}finally{tr()}return new ot(this.componentType,un,Ln(Tn,At),At,Tn)}}class ot extends class Ci{}{constructor(i,s,a,d,g){super(),this.location=a,this._rootLView=d,this._tNode=g,this.instance=s,this.hostView=this.changeDetectorRef=new Pd(d),this.componentType=i}get injector(){return new Bl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}}class Ke{}class St{}const Yn=new Map;class vs extends Ke{constructor(i,s){super(),this._parent=s,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Tp(this);const a=Qr(i);this._bootstrapComponents=Za(a.bootstrap),this._r3Injector=Gc(i,s,[{provide:Ke,useValue:this},{provide:Vr,useValue:this.componentFactoryResolver}],gt(i)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(i)}get(i,s=Sl.THROW_IF_NOT_FOUND,a=Bn.Default){return i===Sl||i===Ke||i===Cu?this:this._r3Injector.get(i,s,a)}destroy(){const i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}}class _s extends St{constructor(i){super(),this.moduleType=i,null!==Qr(i)&&function Bi(n){const i=new Set;!function s(a){const d=Qr(a,!0),g=d.id;null!==g&&(function Ni(n,i,s){if(i&&i!==s)throw new Error(`Duplicate module registered for ${n} - ${gt(i)} vs ${gt(i.name)}`)}(g,Yn.get(g),a),Yn.set(g,a));const x=Za(d.imports);for(const A of x)i.has(A)||(i.add(A),s(A))}(n)}(i)}create(i){return new vs(this.moduleType,i)}}function Ld(n,i,s,a,d,g,x){const A=i+s;return function $c(n,i,s,a){const d=xo(n,i,s);return xo(n,i+1,a)||d}(n,A,d,g)?function el(n,i,s){return n[i]=s}(n,A+2,x?a.call(x,d,g):a(d,g)):function so(n,i){const s=n[i];return s===Ui?void 0:s}(n,A+2)}function Ip(n,i){const s=B();let a;const d=n+20;s.firstCreatePass?(a=function eb(n,i){if(i)for(let s=i.length-1;s>=0;s--){const a=i[s];if(n===a.name)return a}}(i,s.pipeRegistry),s.data[d]=a,a.onDestroy&&(s.destroyHooks||(s.destroyHooks=[])).push(d,a.onDestroy)):a=s.data[d];const g=a.factory||(a.factory=rs(a.type)),x=On(xh);try{const A=ha(!1),I=g();return ha(A),function d0(n,i,s,a){s>=n.data.length&&(n.data[s]=null,n.blueprint[s]=null),i[s]=a}(s,Gt(),d,I),I}finally{On(x)}}function jx(n,i,s,a){const d=n+20,g=Gt(),x=function ur(n,i){return n[i]}(g,d);return function Pp(n,i){return n[1].data[i].pure}(g,d)?Ld(g,function Wr(){const n=zn.lFrame;let i=n.bindingRootIndex;return-1===i&&(i=n.bindingRootIndex=n.tView.bindingStartIndex),i}(),i,x.transform,s,a,x):x.transform(s,a)}function o_(n){return i=>{setTimeout(n,void 0,i)}}const Sc=class sb extends N.x{constructor(i=!1){super(),this.__isAsync=i}emit(i){super.next(i)}subscribe(i,s,a){var d,g,x;let A=i,I=s||(()=>null),Y=a;if(i&&"object"==typeof i){const xe=i;A=null===(d=xe.next)||void 0===d?void 0:d.bind(xe),I=null===(g=xe.error)||void 0===g?void 0:g.bind(xe),Y=null===(x=xe.complete)||void 0===x?void 0:x.bind(xe)}this.__isAsync&&(I=o_(I),A&&(A=o_(A)),Y&&(Y=o_(Y)));const K=super.subscribe({next:A,error:I,complete:Y});return i instanceof F.w0&&i.add(K),K}};function ob(){return this._results[Tl()]()}class a_{constructor(i=!1){this._emitDistinctChangesOnly=i,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const s=Tl(),a=a_.prototype;a[s]||(a[s]=ob)}get changes(){return this._changes||(this._changes=new Sc)}get(i){return this._results[i]}map(i){return this._results.map(i)}filter(i){return this._results.filter(i)}find(i){return this._results.find(i)}reduce(i,s){return this._results.reduce(i,s)}forEach(i){this._results.forEach(i)}some(i){return this._results.some(i)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(i,s){const a=this;a.dirty=!1;const d=v(i);(this._changesDetected=!function m(n,i,s){if(n.length!==i.length)return!1;for(let a=0;a<n.length;a++){let d=n[a],g=i[a];if(s&&(d=s(d),g=s(g)),g!==d)return!1}return!0}(a._results,d,s))&&(a._results=d,a.length=d.length,a.last=d[this.length-1],a.first=d[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Lp=(()=>{class n{}return n.__NG_ELEMENT_ID__=cb,n})();const ab=Lp,lb=class extends ab{constructor(i,s,a){super(),this._declarationLView=i,this._declarationTContainer=s,this.elementRef=a}createEmbeddedView(i){const s=this._declarationTContainer.tViews,a=Qu(this._declarationLView,s,i,16,null,s.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(s)),Mu(s,a,i),new Th(a)}};function cb(){return ly(P(),Gt())}function ly(n,i){return 4&n.type?new lb(i,n,Ln(n,i)):null}let cy=(()=>{class n{}return n.__NG_ELEMENT_ID__=ub,n})();function ub(){return Yx(P(),Gt())}const hb=cy,$x=class extends hb{constructor(i,s,a){super(),this._lContainer=i,this._hostTNode=s,this._hostLView=a}get element(){return Ln(this._hostTNode,this._hostLView)}get injector(){return new Bl(this._hostTNode,this._hostLView)}get parentInjector(){const i=Ee(this._hostTNode,this._hostLView);if(Br(i)){const s=va(i,this._hostLView),a=Or(i);return new Bl(s[1].data[a+8],s)}return new Bl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){const s=Xx(this._lContainer);return null!==s&&s[i]||null}get length(){return this._lContainer.length-10}createEmbeddedView(i,s,a){const d=i.createEmbeddedView(s||{});return this.insert(d,a),d}createComponent(i,s,a,d,g){const x=i&&!function u(n){return"function"==typeof n}(i);let A;if(x)A=s;else{const xe=s||{};A=xe.index,a=xe.injector,d=xe.projectableNodes,g=xe.ngModuleRef}const I=x?i:new Cp(Gi(i)),Y=a||this.parentInjector;if(!g&&null==I.ngModule){const Ne=(x?Y:this.parentInjector).get(Ke,null);Ne&&(g=Ne)}const K=I.create(Y,d,void 0,g);return this.insert(K.hostView,A),K}insert(i,s){const a=i._lView,d=a[1];if(function Sa(n){return er(n[3])}(a)){const K=this.indexOf(i);if(-1!==K)this.detach(K);else{const xe=a[3],Ne=new $x(xe,xe[6],xe[3]);Ne.detach(Ne.indexOf(i))}}const g=this._adjustIndex(s),x=this._lContainer;!function Iy(n,i,s,a){const d=10+a,g=s.length;a>0&&(s[d-1][4]=i),a<g-10?(i[4]=s[d],V(s,10+a,i)):(s.push(i),i[4]=null),i[3]=s;const x=i[17];null!==x&&s!==x&&function Py(n,i){const s=n[9];i[16]!==i[3][3][16]&&(n[2]=!0),null===s?n[9]=[i]:s.push(i)}(x,i);const A=i[19];null!==A&&A.insertView(n),i[2]|=128}(d,a,x,g);const A=Qd(g,x),I=a[11],Y=Vh(I,x[7]);return null!==Y&&function Cy(n,i,s,a,d,g){a[0]=d,a[6]=i,Ku(n,a,s,1,d,g)}(d,x[6],I,a,Y,A),i.attachToViewContainerRef(),V(l_(x),g,i),i}move(i,s){return this.insert(i,s)}indexOf(i){const s=Xx(this._lContainer);return null!==s?s.indexOf(i):-1}remove(i){const s=this._adjustIndex(i,-1),a=Zd(this._lContainer,s);a&&(j(l_(this._lContainer),s),Jp(a[1],a))}detach(i){const s=this._adjustIndex(i,-1),a=Zd(this._lContainer,s);return a&&null!=j(l_(this._lContainer),s)?new Th(a):null}_adjustIndex(i,s=0){return null==i?this.length+s:i}};function Xx(n){return n[8]}function l_(n){return n[8]||(n[8]=[])}function Yx(n,i){let s;const a=i[n.index];if(er(a))s=a;else{let d;if(8&n.type)d=vi(a);else{const g=i[11];d=g.createComment("");const x=zi(n,i);Pc(g,Vh(g,x),d,function Ny(n,i){return ln(n)?n.nextSibling(i):i.nextSibling}(g,x),!1)}i[n.index]=s=rg(a,i,d,n),wu(i,s)}return new $x(s,n,i)}class c_{constructor(i){this.queryList=i,this.matches=null}clone(){return new c_(this.queryList)}setDirty(){this.queryList.setDirty()}}class u_{constructor(i=[]){this.queries=i}createEmbeddedView(i){const s=i.queries;if(null!==s){const a=null!==i.contentQueries?i.contentQueries[0]:s.length,d=[];for(let g=0;g<a;g++){const x=s.getByIndex(g);d.push(this.queries[x.indexInDeclarationView].clone())}return new u_(d)}return null}insertView(i){this.dirtyQueriesWithMatches(i)}detachView(i){this.dirtyQueriesWithMatches(i)}dirtyQueriesWithMatches(i){for(let s=0;s<this.queries.length;s++)null!==nM(i,s).matches&&this.queries[s].setDirty()}}class qx{constructor(i,s,a=null){this.predicate=i,this.flags=s,this.read=a}}class h_{constructor(i=[]){this.queries=i}elementStart(i,s){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(i,s)}elementEnd(i){for(let s=0;s<this.queries.length;s++)this.queries[s].elementEnd(i)}embeddedTView(i){let s=null;for(let a=0;a<this.length;a++){const d=null!==s?s.length:0,g=this.getByIndex(a).embeddedTView(i,d);g&&(g.indexInDeclarationView=a,null!==s?s.push(g):s=[g])}return null!==s?new h_(s):null}template(i,s){for(let a=0;a<this.queries.length;a++)this.queries[a].template(i,s)}getByIndex(i){return this.queries[i]}get length(){return this.queries.length}track(i){this.queries.push(i)}}class d_{constructor(i,s=-1){this.metadata=i,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=s}elementStart(i,s){this.isApplyingToNode(s)&&this.matchTNode(i,s)}elementEnd(i){this._declarationNodeIndex===i.index&&(this._appliesToNextNode=!1)}template(i,s){this.elementStart(i,s)}embeddedTView(i,s){return this.isApplyingToNode(i)?(this.crossesNgTemplate=!0,this.addMatch(-i.index,s),new d_(this.metadata)):null}isApplyingToNode(i){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const s=this._declarationNodeIndex;let a=i.parent;for(;null!==a&&8&a.type&&a.index!==s;)a=a.parent;return s===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(i,s){const a=this.metadata.predicate;if(Array.isArray(a))for(let d=0;d<a.length;d++){const g=a[d];this.matchTNodeWithReadOption(i,s,pb(s,g)),this.matchTNodeWithReadOption(i,s,mo(s,i,g,!1,!1))}else a===Lp?4&s.type&&this.matchTNodeWithReadOption(i,s,-1):this.matchTNodeWithReadOption(i,s,mo(s,i,a,!1,!1))}matchTNodeWithReadOption(i,s,a){if(null!==a){const d=this.metadata.read;if(null!==d)if(d===_t||d===cy||d===Lp&&4&s.type)this.addMatch(s.index,-2);else{const g=mo(s,i,d,!1,!1);null!==g&&this.addMatch(s.index,g)}else this.addMatch(s.index,a)}}addMatch(i,s){null===this.matches?this.matches=[i,s]:this.matches.push(i,s)}}function pb(n,i){const s=n.localNames;if(null!==s)for(let a=0;a<s.length;a+=2)if(s[a]===i)return s[a+1];return null}function gb(n,i,s,a){return-1===s?function mb(n,i){return 11&n.type?Ln(n,i):4&n.type?ly(n,i):null}(i,n):-2===s?function yb(n,i,s){return s===_t?Ln(i,n):s===Lp?ly(i,n):s===cy?Yx(i,n):void 0}(n,i,a):Pa(n,n[1],s,i)}function Zx(n,i,s,a){const d=i[19].queries[a];if(null===d.matches){const g=n.data,x=s.matches,A=[];for(let I=0;I<x.length;I+=2){const Y=x[I];A.push(Y<0?null:gb(i,g[Y],x[I+1],s.metadata.read))}d.matches=A}return d.matches}function f_(n,i,s,a){const d=n.queries.getByIndex(s),g=d.matches;if(null!==g){const x=Zx(n,i,d,s);for(let A=0;A<g.length;A+=2){const I=g[A];if(I>0)a.push(x[A/2]);else{const Y=g[A+1],K=i[-I];for(let xe=10;xe<K.length;xe++){const Ne=K[xe];Ne[17]===Ne[3]&&f_(Ne[1],Ne,Y,a)}if(null!==K[9]){const xe=K[9];for(let Ne=0;Ne<xe.length;Ne++){const qe=xe[Ne];f_(qe[1],qe,Y,a)}}}}}return a}function Kx(n){const i=Gt(),s=B(),a=Hu();zo(a+1);const d=nM(s,a);if(n.dirty&&kr(i)===(2==(2&d.metadata.flags))){if(null===d.matches)n.reset([]);else{const g=d.crossesNgTemplate?f_(s,i,a,[]):Zx(s,i,d,a);n.reset(g,An),n.notifyOnChanges()}return!0}return!1}function Jx(n,i,s,a){const d=B();if(d.firstCreatePass){const g=P();(function tM(n,i,s){null===n.queries&&(n.queries=new h_),n.queries.track(new d_(i,s))})(d,new qx(i,s,a),g.index),function xb(n,i){const s=n.contentQueries||(n.contentQueries=[]);i!==(s.length?s[s.length-1]:-1)&&s.push(n.queries.length-1,i)}(d,n),2==(2&s)&&(d.staticContentQueries=!0)}!function eM(n,i,s){const a=new a_(4==(4&s));qm(n,i,a,a.destroy),null===i[19]&&(i[19]=new u_),i[19].queries.push(new c_(a))}(d,Gt(),s)}function Qx(){return function _b(n,i){return n[19].queries[i].queryList}(Gt(),Hu())}function nM(n,i){return n.queries.getByIndex(i)}function dy(...n){}const _M=new qr("Application Initializer");let __=(()=>{class n{constructor(s){this.appInits=s,this.resolve=dy,this.reject=dy,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,d)=>{this.resolve=a,this.reject=d})}runInitializers(){if(this.initialized)return;const s=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let d=0;d<this.appInits.length;d++){const g=this.appInits[d]();if(ql(g))s.push(g);else if(op(g)){const x=new Promise((A,I)=>{g.subscribe({complete:A,error:I})});s.push(x)}}Promise.all(s).then(()=>{a()}).catch(d=>{this.reject(d)}),0===s.length&&a(),this.initialized=!0}}return n.\u0275fac=function(s){return new(s||n)(_r(_M,8))},n.\u0275prov=Vi({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const xM=new qr("AppId",{providedIn:"root",factory:function MM(){return`${x_()}${x_()}${x_()}`}});function x_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const bM=new qr("Platform Initializer"),Ub=new qr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),wM=new qr("appBootstrapListener");let Bb=(()=>{class n{log(s){console.log(s)}warn(s){console.warn(s)}}return n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=Vi({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const M_=new qr("LocaleId",{providedIn:"root",factory:()=>Dc(M_,Bn.Optional|Bn.SkipSelf)||function Vb(){return"undefined"!=typeof $localize&&$localize.locale||rl}()}),zb=new qr("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class Hb{constructor(i,s){this.ngModuleFactory=i,this.componentFactories=s}}let Gb=(()=>{class n{compileModuleSync(s){return new _s(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const a=this.compileModuleSync(s),g=Za(Qr(s).declarations).reduce((x,A)=>{const I=Gi(A);return I&&x.push(new Cp(I)),x},[]);return new Hb(a,g)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}}return n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=Vi({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const jb=(()=>Promise.resolve(0))();function b_(n){"undefined"==typeof Zone?jb.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Ql{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Sc(!1),this.onMicrotaskEmpty=new Sc(!1),this.onStable=new Sc(!1),this.onError=new Sc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const d=this;d._nesting=0,d._outer=d._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(d._inner=d._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(d._inner=d._inner.fork(Zone.longStackTraceZoneSpec)),d.shouldCoalesceEventChangeDetection=!a&&s,d.shouldCoalesceRunChangeDetection=a,d.lastRequestAnimationFrameId=-1,d.nativeRequestAnimationFrame=function $b(){let n=we.requestAnimationFrame,i=we.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&i){const s=n[Zone.__symbol__("OriginalDelegate")];s&&(n=s);const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function qb(n){const i=()=>{!function Yb(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(we,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,E_(n),n.isCheckStableRunning=!0,w_(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),E_(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,a,d,g,x,A)=>{try{return EM(n),s.invokeTask(d,g,x,A)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||n.shouldCoalesceRunChangeDetection)&&i(),SM(n)}},onInvoke:(s,a,d,g,x,A,I)=>{try{return EM(n),s.invoke(d,g,x,A,I)}finally{n.shouldCoalesceRunChangeDetection&&i(),SM(n)}},onHasTask:(s,a,d,g)=>{s.hasTask(d,g),a===d&&("microTask"==g.change?(n._hasPendingMicrotasks=g.microTask,E_(n),w_(n)):"macroTask"==g.change&&(n.hasPendingMacrotasks=g.macroTask))},onHandleError:(s,a,d,g)=>(s.handleError(d,g),n.runOutsideAngular(()=>n.onError.emit(g)),!1)})}(d)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ql.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ql.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(i,s,a){return this._inner.run(i,s,a)}runTask(i,s,a,d){const g=this._inner,x=g.scheduleEventTask("NgZoneEvent: "+d,i,Xb,dy,dy);try{return g.runTask(x,s,a)}finally{g.cancelTask(x)}}runGuarded(i,s,a){return this._inner.runGuarded(i,s,a)}runOutsideAngular(i){return this._outer.run(i)}}const Xb={};function w_(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function E_(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function EM(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function SM(n){n._nesting--,w_(n)}class Zb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Sc,this.onMicrotaskEmpty=new Sc,this.onStable=new Sc,this.onError=new Sc}run(i,s,a){return i.apply(s,a)}runGuarded(i,s,a){return i.apply(s,a)}runOutsideAngular(i){return i()}runTask(i,s,a,d){return i.apply(s,a)}}let AM=(()=>{class n{constructor(s){this._ngZone=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ql.assertNotInAngularZone(),b_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())b_(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(s)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,a,d){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(x=>x.timeoutId!==g),s(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:s,timeoutId:g,updateCb:d})}whenStable(s,a,d){if(d&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,a,d),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(s,a,d){return[]}}return n.\u0275fac=function(s){return new(s||n)(_r(Ql))},n.\u0275prov=Vi({token:n,factory:n.\u0275fac}),n})(),Kb=(()=>{class n{constructor(){this._applications=new Map,S_.addToWindow(this)}registerApplication(s,a){this._applications.set(s,a)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,a=!0){return S_.findTestabilityInTree(this,s,a)}}return n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=Vi({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();class Jb{addToWindow(i){}findTestabilityInTree(i,s,a){return null}}function Qb(n){S_=n}let S_=new Jb,Rh=null;const TM=new qr("AllowMultipleToken"),CM=new qr("PlatformOnDestroy");class nw{constructor(i,s){this.name=i,this.token=s}}function DM(n,i,s=[]){const a=`Platform: ${i}`,d=new qr(a);return(g=[])=>{let x=A_();if(!x||x.injector.get(TM,!1)){const A=[...s,...g,{provide:d,useValue:!0}];n?n(A):function iw(n){if(Rh&&!Rh.get(TM,!1))throw new nt(400,"");Rh=n;const i=n.get(RM),s=n.get(bM,null);s&&s.forEach(a=>a())}(function sw(n=[],i){return Sl.create({name:i,providers:[{provide:Ff,useValue:"platform"},{provide:CM,useValue:()=>Rh=null},...n]})}(A,a))}return function rw(n){const i=A_();if(!i)throw new nt(401,"");return i}()}}function A_(){var n;return null!==(n=null==Rh?void 0:Rh.get(RM))&&void 0!==n?n:null}let RM=(()=>{class n{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,a){const A=function ow(n,i){let s;return s="noop"===n?new Zb:("zone.js"===n?void 0:n)||new Ql({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==i?void 0:i.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==i?void 0:i.ngZoneRunCoalescing)}),s}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),I=[{provide:Ql,useValue:A}];return A.run(()=>{const Y=Sl.create({providers:I,parent:this.injector,name:s.moduleType.name}),K=s.create(Y),xe=K.injector.get(Fc,null);if(!xe)throw new nt(402,"");return A.runOutsideAngular(()=>{const Ne=A.onError.subscribe({next:qe=>{xe.handleError(qe)}});K.onDestroy(()=>{C_(this._modules,K),Ne.unsubscribe()})}),function aw(n,i,s){try{const a=s();return ql(a)?a.catch(d=>{throw i.runOutsideAngular(()=>n.handleError(d)),d}):a}catch(a){throw i.runOutsideAngular(()=>n.handleError(a)),a}}(xe,A,()=>{const Ne=K.injector.get(__);return Ne.runInitializers(),Ne.donePromise.then(()=>(function ty(n){Zn(n,"Expected localeId to be defined"),"string"==typeof n&&(ey=n.toLowerCase().replace(/_/g,"-"))}(K.injector.get(M_,rl)||rl),this._moduleDoBootstrap(K),K))})})}bootstrapModule(s,a=[]){const d=IM({},a);return function ew(n,i,s){const a=new _s(s);return Promise.resolve(a)}(0,0,s).then(g=>this.bootstrapModuleFactory(g,d))}_moduleDoBootstrap(s){const a=s.injector.get(T_);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(d=>a.bootstrap(d));else{if(!s.instance.ngDoBootstrap)throw new nt(403,"");s.instance.ngDoBootstrap(a)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new nt(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const s=this._injector.get(CM,null);null==s||s(),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(s){return new(s||n)(_r(Sl))},n.\u0275prov=Vi({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function IM(n,i){return Array.isArray(i)?i.reduce(IM,n):Object.assign(Object.assign({},n),i)}let T_=(()=>{class n{constructor(s,a,d,g){this._zone=s,this._injector=a,this._exceptionHandler=d,this._initStatus=g,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const x=new Ze.y(I=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{I.next(this._stable),I.complete()})}),A=new Ze.y(I=>{let Y;this._zone.runOutsideAngular(()=>{Y=this._zone.onStable.subscribe(()=>{Ql.assertNotInAngularZone(),b_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,I.next(!0))})})});const K=this._zone.onUnstable.subscribe(()=>{Ql.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{I.next(!1)}))});return()=>{Y.unsubscribe(),K.unsubscribe()}});this.isStable=function Mn(...n){const i=(0,Xt.yG)(n),s=(0,Xt._6)(n,1/0),a=n;return a.length?1===a.length?(0,ut.Xf)(a[0]):(0,mt.J)(s)((0,_n.D)(a,i)):sn.E}(x,A.pipe(function Ft(n={}){const{connector:i=(()=>new N.x),resetOnError:s=!0,resetOnComplete:a=!0,resetOnRefCountZero:d=!0}=n;return g=>{let x,A,I,Y=0,K=!1,xe=!1;const Ne=()=>{null==A||A.unsubscribe(),A=void 0},qe=()=>{Ne(),x=I=void 0,K=xe=!1},At=()=>{const un=x;qe(),null==un||un.unsubscribe()};return(0,lt.e)((un,Tn)=>{Y++,!xe&&!K&&Ne();const Xn=I=null!=I?I:i();Tn.add(()=>{Y--,0===Y&&!xe&&!K&&(A=ri(At,d))}),Xn.subscribe(Tn),!x&&Y>0&&(x=new Ut.Hp({next:Ot=>Xn.next(Ot),error:Ot=>{xe=!0,Ne(),A=ri(qe,s,Ot),Xn.error(Ot)},complete:()=>{K=!0,Ne(),A=ri(qe,a),Xn.complete()}}),(0,ut.Xf)(un).subscribe(x))})(g)}}()))}bootstrap(s,a){if(!this._initStatus.done)throw new nt(405,"");let d;d=s instanceof yi?s:this._injector.get(Vr).resolveComponentFactory(s),this.componentTypes.push(d.componentType);const g=function tw(n){return n.isBoundToModule}(d)?void 0:this._injector.get(Ke),A=d.create(Sl.NULL,[],a||d.selector,g),I=A.location.nativeElement,Y=A.injector.get(AM,null),K=Y&&A.injector.get(Kb);return Y&&K&&K.registerApplication(I,Y),A.onDestroy(()=>{this.detachView(A.hostView),C_(this.components,A),K&&K.unregisterApplication(I)}),this._loadComponent(A),A}tick(){if(this._runningTick)throw new nt(101,"");try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(s))}finally{this._runningTick=!1}}attachView(s){const a=s;this._views.push(a),a.attachToAppRef(this)}detachView(s){const a=s;C_(this._views,a),a.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s),this._injector.get(wM,[]).concat(this._bootstrapListeners).forEach(d=>d(s))}ngOnDestroy(){this._views.slice().forEach(s=>s.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(s){return new(s||n)(_r(Ql),_r(Sl),_r(Fc),_r(__))},n.\u0275prov=Vi({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function C_(n,i){const s=n.indexOf(i);s>-1&&n.splice(s,1)}let LM=!0;function cw(){LM=!1}let uw=(()=>{class n{}return n.__NG_ELEMENT_ID__=hw,n})();function hw(n){return function dw(n,i,s){if(bs(n)&&!s){const a=fr(n.index,i);return new Th(a,a)}return 47&n.type?new Th(i[16],i):null}(P(),Gt(),16==(16&n))}class UM{constructor(){}supports(i){return ch(i)}create(i){return new vw(i)}}const yw=(n,i)=>i;class vw{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||yw}forEachItem(i){let s;for(s=this._itHead;null!==s;s=s._next)i(s)}forEachOperation(i){let s=this._itHead,a=this._removalsHead,d=0,g=null;for(;s||a;){const x=!a||s&&s.currentIndex<VM(a,d,g)?s:a,A=VM(x,d,g),I=x.currentIndex;if(x===a)d--,a=a._nextRemoved;else if(s=s._next,null==x.previousIndex)d++;else{g||(g=[]);const Y=A-d,K=I-d;if(Y!=K){for(let Ne=0;Ne<Y;Ne++){const qe=Ne<g.length?g[Ne]:g[Ne]=0,At=qe+Ne;K<=At&&At<Y&&(g[Ne]=qe+1)}g[x.previousIndex]=K-Y}}A!==I&&i(x,A,I)}}forEachPreviousItem(i){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)i(s)}forEachAddedItem(i){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)i(s)}forEachMovedItem(i){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)i(s)}forEachRemovedItem(i){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)i(s)}forEachIdentityChange(i){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)i(s)}diff(i){if(null==i&&(i=[]),!ch(i))throw new nt(900,"");return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let d,g,x,s=this._itHead,a=!1;if(Array.isArray(i)){this.length=i.length;for(let A=0;A<this.length;A++)g=i[A],x=this._trackByFn(A,g),null!==s&&Object.is(s.trackById,x)?(a&&(s=this._verifyReinsertion(s,g,x,A)),Object.is(s.item,g)||this._addIdentityChange(s,g)):(s=this._mismatch(s,g,x,A),a=!0),s=s._next}else d=0,function h0(n,i){if(Array.isArray(n))for(let s=0;s<n.length;s++)i(n[s]);else{const s=n[Tl()]();let a;for(;!(a=s.next()).done;)i(a.value)}}(i,A=>{x=this._trackByFn(d,A),null!==s&&Object.is(s.trackById,x)?(a&&(s=this._verifyReinsertion(s,A,x,d)),Object.is(s.item,A)||this._addIdentityChange(s,A)):(s=this._mismatch(s,A,x,d),a=!0),s=s._next,d++}),this.length=d;return this._truncate(s),this.collection=i,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;null!==i;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;null!==i;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,s,a,d){let g;return null===i?g=this._itTail:(g=i._prev,this._remove(i)),null!==(i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(i.item,s)||this._addIdentityChange(i,s),this._reinsertAfter(i,g,d)):null!==(i=null===this._linkedRecords?null:this._linkedRecords.get(a,d))?(Object.is(i.item,s)||this._addIdentityChange(i,s),this._moveAfter(i,g,d)):i=this._addAfter(new _w(s,a),g,d),i}_verifyReinsertion(i,s,a,d){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?i=this._reinsertAfter(g,i._prev,d):i.currentIndex!=d&&(i.currentIndex=d,this._addToMoves(i,d)),i}_truncate(i){for(;null!==i;){const s=i._next;this._addToRemovals(this._unlink(i)),i=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,s,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(i);const d=i._prevRemoved,g=i._nextRemoved;return null===d?this._removalsHead=g:d._nextRemoved=g,null===g?this._removalsTail=d:g._prevRemoved=d,this._insertAfter(i,s,a),this._addToMoves(i,a),i}_moveAfter(i,s,a){return this._unlink(i),this._insertAfter(i,s,a),this._addToMoves(i,a),i}_addAfter(i,s,a){return this._insertAfter(i,s,a),this._additionsTail=null===this._additionsTail?this._additionsHead=i:this._additionsTail._nextAdded=i,i}_insertAfter(i,s,a){const d=null===s?this._itHead:s._next;return i._next=d,i._prev=s,null===d?this._itTail=i:d._prev=i,null===s?this._itHead=i:s._next=i,null===this._linkedRecords&&(this._linkedRecords=new BM),this._linkedRecords.put(i),i.currentIndex=a,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){null!==this._linkedRecords&&this._linkedRecords.remove(i);const s=i._prev,a=i._next;return null===s?this._itHead=a:s._next=a,null===a?this._itTail=s:a._prev=s,i}_addToMoves(i,s){return i.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=i:this._movesTail._nextMoved=i),i}_addToRemovals(i){return null===this._unlinkedRecords&&(this._unlinkedRecords=new BM),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,s){return i.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=i:this._identityChangesTail._nextIdentityChange=i,i}}class _w{constructor(i,s){this.item=i,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class xw{constructor(){this._head=null,this._tail=null}add(i){null===this._head?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,s){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===s||s<=a.currentIndex)&&Object.is(a.trackById,i))return a;return null}remove(i){const s=i._prevDup,a=i._nextDup;return null===s?this._head=a:s._nextDup=a,null===a?this._tail=s:a._prevDup=s,null===this._head}}class BM{constructor(){this.map=new Map}put(i){const s=i.trackById;let a=this.map.get(s);a||(a=new xw,this.map.set(s,a)),a.add(i)}get(i,s){const d=this.map.get(i);return d?d.get(i,s):null}remove(i){const s=i.trackById;return this.map.get(s).remove(i)&&this.map.delete(s),i}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function VM(n,i,s){const a=n.previousIndex;if(null===a)return a;let d=0;return s&&a<s.length&&(d=s[a]),a+i+d}class zM{constructor(){}supports(i){return i instanceof Map||jc(i)}create(){return new Mw}}class Mw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(i){let s;for(s=this._mapHead;null!==s;s=s._next)i(s)}forEachPreviousItem(i){let s;for(s=this._previousMapHead;null!==s;s=s._nextPrevious)i(s)}forEachChangedItem(i){let s;for(s=this._changesHead;null!==s;s=s._nextChanged)i(s)}forEachAddedItem(i){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)i(s)}forEachRemovedItem(i){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)i(s)}diff(i){if(i){if(!(i instanceof Map||jc(i)))throw new nt(900,"")}else i=new Map;return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let s=this._mapHead;if(this._appendAfter=null,this._forEach(i,(a,d)=>{if(s&&s.key===d)this._maybeAddToChanges(s,a),this._appendAfter=s,s=s._next;else{const g=this._getOrCreateRecordForKey(d,a);s=this._insertBeforeOrAppend(s,g)}}),s){s._prev&&(s._prev._next=null),this._removalsHead=s;for(let a=s;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(i,s){if(i){const a=i._prev;return s._next=i,s._prev=a,i._prev=s,a&&(a._next=s),i===this._mapHead&&(this._mapHead=s),this._appendAfter=i,i}return this._appendAfter?(this._appendAfter._next=s,s._prev=this._appendAfter):this._mapHead=s,this._appendAfter=s,null}_getOrCreateRecordForKey(i,s){if(this._records.has(i)){const d=this._records.get(i);this._maybeAddToChanges(d,s);const g=d._prev,x=d._next;return g&&(g._next=x),x&&(x._prev=g),d._next=null,d._prev=null,d}const a=new bw(i);return this._records.set(i,a),a.currentValue=s,this._addToAdditions(a),a}_reset(){if(this.isDirty){let i;for(this._previousMapHead=this._mapHead,i=this._previousMapHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._changesHead;null!==i;i=i._nextChanged)i.previousValue=i.currentValue;for(i=this._additionsHead;null!=i;i=i._nextAdded)i.previousValue=i.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(i,s){Object.is(s,i.currentValue)||(i.previousValue=i.currentValue,i.currentValue=s,this._addToChanges(i))}_addToAdditions(i){null===this._additionsHead?this._additionsHead=this._additionsTail=i:(this._additionsTail._nextAdded=i,this._additionsTail=i)}_addToChanges(i){null===this._changesHead?this._changesHead=this._changesTail=i:(this._changesTail._nextChanged=i,this._changesTail=i)}_forEach(i,s){i instanceof Map?i.forEach(s):Object.keys(i).forEach(a=>s(i[a],a))}}class bw{constructor(i){this.key=i,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function HM(){return new L_([new UM])}let L_=(()=>{class n{constructor(s){this.factories=s}static create(s,a){if(null!=a){const d=a.factories.slice();s=s.concat(d)}return new n(s)}static extend(s){return{provide:n,useFactory:a=>n.create(s,a||HM()),deps:[[n,new Xu,new vl]]}}find(s){const a=this.factories.find(d=>d.supports(s));if(null!=a)return a;throw new nt(901,"")}}return n.\u0275prov=Vi({token:n,providedIn:"root",factory:HM}),n})();function GM(){return new O_([new zM])}let O_=(()=>{class n{constructor(s){this.factories=s}static create(s,a){if(a){const d=a.factories.slice();s=s.concat(d)}return new n(s)}static extend(s){return{provide:n,useFactory:a=>n.create(s,a||GM()),deps:[[n,new Xu,new vl]]}}find(s){const a=this.factories.find(g=>g.supports(s));if(a)return a;throw new nt(901,"")}}return n.\u0275prov=Vi({token:n,providedIn:"root",factory:GM}),n})();const Sw=DM(null,"core",[]);let Aw=(()=>{class n{constructor(s){}}return n.\u0275fac=function(s){return new(s||n)(_r(T_))},n.\u0275mod=Pn({type:n}),n.\u0275inj=Tr({}),n})()},2313:(qn,Rt,ye)=>{ye.d(Rt,{H7:()=>Kt,b2:()=>Tr,q6:()=>Vi});var N=ye(9808),F=ye(1223);class Ze extends N.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class mt extends Ze{static makeCurrent(){(0,N.HT)(new mt)}onAndCancel(Ae,me,He){return Ae.addEventListener(me,He,!1),()=>{Ae.removeEventListener(me,He,!1)}}dispatchEvent(Ae,me){Ae.dispatchEvent(me)}remove(Ae){Ae.parentNode&&Ae.parentNode.removeChild(Ae)}createElement(Ae,me){return(me=me||this.getDefaultDocument()).createElement(Ae)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Ae){return Ae.nodeType===Node.ELEMENT_NODE}isShadowRoot(Ae){return Ae instanceof DocumentFragment}getGlobalEventTarget(Ae,me){return"window"===me?window:"document"===me?Ae:"body"===me?Ae.body:null}getBaseHref(Ae){const me=function sn(){return ut=ut||document.querySelector("base"),ut?ut.getAttribute("href"):null}();return null==me?null:function _n(Oe){Xt=Xt||document.createElement("a"),Xt.setAttribute("href",Oe);const Ae=Xt.pathname;return"/"===Ae.charAt(0)?Ae:`/${Ae}`}(me)}resetBaseElement(){ut=null}getUserAgent(){return window.navigator.userAgent}getCookie(Ae){return(0,N.Mx)(document.cookie,Ae)}}let Xt,ut=null;const Mn=new F.OlP("TRANSITION_ID"),lt=[{provide:F.ip1,useFactory:function Ut(Oe,Ae,me){return()=>{me.get(F.CZH).donePromise.then(()=>{const He=(0,N.q)(),je=Ae.querySelectorAll(`style[ng-transition="${Oe}"]`);for(let Ht=0;Ht<je.length;Ht++)He.remove(je[Ht])})}},deps:[Mn,N.K0,F.zs3],multi:!0}];class Ft{static init(){(0,F.VLi)(new Ft)}addToWindow(Ae){F.dqk.getAngularTestability=(He,je=!0)=>{const Ht=Ae.findTestabilityInTree(He,je);if(null==Ht)throw new Error("Could not find testability for element.");return Ht},F.dqk.getAllAngularTestabilities=()=>Ae.getAllTestabilities(),F.dqk.getAllAngularRootElements=()=>Ae.getAllRootElements(),F.dqk.frameworkStabilizers||(F.dqk.frameworkStabilizers=[]),F.dqk.frameworkStabilizers.push(He=>{const je=F.dqk.getAllAngularTestabilities();let Ht=je.length,Pn=!1;const Ei=function(Ki){Pn=Pn||Ki,Ht--,0==Ht&&He(Pn)};je.forEach(function(Ki){Ki.whenStable(Ei)})})}findTestabilityInTree(Ae,me,He){if(null==me)return null;const je=Ae.getTestability(me);return null!=je?je:He?(0,N.q)().isShadowRoot(me)?this.findTestabilityInTree(Ae,me.host,!0):this.findTestabilityInTree(Ae,me.parentElement,!0):null}}let ri=(()=>{class Oe{build(){return new XMLHttpRequest}}return Oe.\u0275fac=function(me){return new(me||Oe)},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();const fe=new F.OlP("EventManagerPlugins");let bn=(()=>{class Oe{constructor(me,He){this._zone=He,this._eventNameToPlugin=new Map,me.forEach(je=>je.manager=this),this._plugins=me.slice().reverse()}addEventListener(me,He,je){return this._findPluginFor(He).addEventListener(me,He,je)}addGlobalEventListener(me,He,je){return this._findPluginFor(He).addGlobalEventListener(me,He,je)}getZone(){return this._zone}_findPluginFor(me){const He=this._eventNameToPlugin.get(me);if(He)return He;const je=this._plugins;for(let Ht=0;Ht<je.length;Ht++){const Pn=je[Ht];if(Pn.supports(me))return this._eventNameToPlugin.set(me,Pn),Pn}throw new Error(`No event manager plugin found for event ${me}`)}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(fe),F.LFG(F.R0b))},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();class gt{constructor(Ae){this._doc=Ae}addGlobalEventListener(Ae,me,He){const je=(0,N.q)().getGlobalEventTarget(this._doc,Ae);if(!je)throw new Error(`Unsupported event target ${je} for event ${me}`);return this.addEventListener(je,me,He)}}let Gn=(()=>{class Oe{constructor(){this._stylesSet=new Set}addStyles(me){const He=new Set;me.forEach(je=>{this._stylesSet.has(je)||(this._stylesSet.add(je),He.add(je))}),this.onStylesAdded(He)}onStylesAdded(me){}getAllStyles(){return Array.from(this._stylesSet)}}return Oe.\u0275fac=function(me){return new(me||Oe)},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})(),Vn=(()=>{class Oe extends Gn{constructor(me){super(),this._doc=me,this._hostNodes=new Map,this._hostNodes.set(me.head,[])}_addStylesToHost(me,He,je){me.forEach(Ht=>{const Pn=this._doc.createElement("style");Pn.textContent=Ht,je.push(He.appendChild(Pn))})}addHost(me){const He=[];this._addStylesToHost(this._stylesSet,me,He),this._hostNodes.set(me,He)}removeHost(me){const He=this._hostNodes.get(me);He&&He.forEach(ce),this._hostNodes.delete(me)}onStylesAdded(me){this._hostNodes.forEach((He,je)=>{this._addStylesToHost(me,je,He)})}ngOnDestroy(){this._hostNodes.forEach(me=>me.forEach(ce))}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(N.K0))},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();function ce(Oe){(0,N.q)().remove(Oe)}const ke={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ye=/%COMP%/g;function kn(Oe,Ae,me){for(let He=0;He<Ae.length;He++){let je=Ae[He];Array.isArray(je)?kn(Oe,je,me):(je=je.replace(Ye,Oe),me.push(je))}return me}function ai(Oe){return Ae=>{if("__ngUnwrap__"===Ae)return Oe;!1===Oe(Ae)&&(Ae.preventDefault(),Ae.returnValue=!1)}}let Jn=(()=>{class Oe{constructor(me,He,je){this.eventManager=me,this.sharedStylesHost=He,this.appId=je,this.rendererByCompId=new Map,this.defaultRenderer=new Rn(me)}createRenderer(me,He){if(!me||!He)return this.defaultRenderer;switch(He.encapsulation){case F.ifc.Emulated:{let je=this.rendererByCompId.get(He.id);return je||(je=new Wt(this.eventManager,this.sharedStylesHost,He,this.appId),this.rendererByCompId.set(He.id,je)),je.applyToHost(me),je}case 1:case F.ifc.ShadowDom:return new Je(this.eventManager,this.sharedStylesHost,me,He);default:if(!this.rendererByCompId.has(He.id)){const je=kn(He.id,He.styles,[]);this.sharedStylesHost.addStyles(je),this.rendererByCompId.set(He.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(bn),F.LFG(Vn),F.LFG(F.AFp))},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();class Rn{constructor(Ae){this.eventManager=Ae,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(Ae,me){return me?document.createElementNS(ke[me]||me,Ae):document.createElement(Ae)}createComment(Ae){return document.createComment(Ae)}createText(Ae){return document.createTextNode(Ae)}appendChild(Ae,me){Ae.appendChild(me)}insertBefore(Ae,me,He){Ae&&Ae.insertBefore(me,He)}removeChild(Ae,me){Ae&&Ae.removeChild(me)}selectRootElement(Ae,me){let He="string"==typeof Ae?document.querySelector(Ae):Ae;if(!He)throw new Error(`The selector "${Ae}" did not match any elements`);return me||(He.textContent=""),He}parentNode(Ae){return Ae.parentNode}nextSibling(Ae){return Ae.nextSibling}setAttribute(Ae,me,He,je){if(je){me=je+":"+me;const Ht=ke[je];Ht?Ae.setAttributeNS(Ht,me,He):Ae.setAttribute(me,He)}else Ae.setAttribute(me,He)}removeAttribute(Ae,me,He){if(He){const je=ke[He];je?Ae.removeAttributeNS(je,me):Ae.removeAttribute(`${He}:${me}`)}else Ae.removeAttribute(me)}addClass(Ae,me){Ae.classList.add(me)}removeClass(Ae,me){Ae.classList.remove(me)}setStyle(Ae,me,He,je){je&(F.JOm.DashCase|F.JOm.Important)?Ae.style.setProperty(me,He,je&F.JOm.Important?"important":""):Ae.style[me]=He}removeStyle(Ae,me,He){He&F.JOm.DashCase?Ae.style.removeProperty(me):Ae.style[me]=""}setProperty(Ae,me,He){Ae[me]=He}setValue(Ae,me){Ae.nodeValue=me}listen(Ae,me,He){return"string"==typeof Ae?this.eventManager.addGlobalEventListener(Ae,me,ai(He)):this.eventManager.addEventListener(Ae,me,ai(He))}}class Wt extends Rn{constructor(Ae,me,He,je){super(Ae),this.component=He;const Ht=kn(je+"-"+He.id,He.styles,[]);me.addStyles(Ht),this.contentAttr=function Tt(Oe){return"_ngcontent-%COMP%".replace(Ye,Oe)}(je+"-"+He.id),this.hostAttr=function Cn(Oe){return"_nghost-%COMP%".replace(Ye,Oe)}(je+"-"+He.id)}applyToHost(Ae){super.setAttribute(Ae,this.hostAttr,"")}createElement(Ae,me){const He=super.createElement(Ae,me);return super.setAttribute(He,this.contentAttr,""),He}}class Je extends Rn{constructor(Ae,me,He,je){super(Ae),this.sharedStylesHost=me,this.hostEl=He,this.shadowRoot=He.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Ht=kn(je.id,je.styles,[]);for(let Pn=0;Pn<Ht.length;Pn++){const Ei=document.createElement("style");Ei.textContent=Ht[Pn],this.shadowRoot.appendChild(Ei)}}nodeOrShadowRoot(Ae){return Ae===this.hostEl?this.shadowRoot:Ae}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(Ae,me){return super.appendChild(this.nodeOrShadowRoot(Ae),me)}insertBefore(Ae,me,He){return super.insertBefore(this.nodeOrShadowRoot(Ae),me,He)}removeChild(Ae,me){return super.removeChild(this.nodeOrShadowRoot(Ae),me)}parentNode(Ae){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Ae)))}}let tt=(()=>{class Oe extends gt{constructor(me){super(me)}supports(me){return!0}addEventListener(me,He,je){return me.addEventListener(He,je,!1),()=>this.removeEventListener(me,He,je)}removeEventListener(me,He,je){return me.removeEventListener(He,je)}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(N.K0))},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();const ht=["alt","control","meta","shift"],hn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},$t={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},In={alt:Oe=>Oe.altKey,control:Oe=>Oe.ctrlKey,meta:Oe=>Oe.metaKey,shift:Oe=>Oe.shiftKey};let ci=(()=>{class Oe extends gt{constructor(me){super(me)}supports(me){return null!=Oe.parseEventName(me)}addEventListener(me,He,je){const Ht=Oe.parseEventName(He),Pn=Oe.eventCallback(Ht.fullKey,je,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,N.q)().onAndCancel(me,Ht.domEventName,Pn))}static parseEventName(me){const He=me.toLowerCase().split("."),je=He.shift();if(0===He.length||"keydown"!==je&&"keyup"!==je)return null;const Ht=Oe._normalizeKey(He.pop());let Pn="";if(ht.forEach(Ki=>{const Jr=He.indexOf(Ki);Jr>-1&&(He.splice(Jr,1),Pn+=Ki+".")}),Pn+=Ht,0!=He.length||0===Ht.length)return null;const Ei={};return Ei.domEventName=je,Ei.fullKey=Pn,Ei}static getEventFullKey(me){let He="",je=function Zn(Oe){let Ae=Oe.key;if(null==Ae){if(Ae=Oe.keyIdentifier,null==Ae)return"Unidentified";Ae.startsWith("U+")&&(Ae=String.fromCharCode(parseInt(Ae.substring(2),16)),3===Oe.location&&$t.hasOwnProperty(Ae)&&(Ae=$t[Ae]))}return hn[Ae]||Ae}(me);return je=je.toLowerCase()," "===je?je="space":"."===je&&(je="dot"),ht.forEach(Ht=>{Ht!=je&&In[Ht](me)&&(He+=Ht+".")}),He+=je,He}static eventCallback(me,He,je){return Ht=>{Oe.getEventFullKey(Ht)===me&&je.runGuarded(()=>He(Ht))}}static _normalizeKey(me){return"esc"===me?"escape":me}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(N.K0))},Oe.\u0275prov=F.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();const Vi=(0,F.eFA)(F._c5,"browser",[{provide:F.Lbi,useValue:N.bD},{provide:F.g9A,useValue:function Yt(){mt.makeCurrent(),Ft.init()},multi:!0},{provide:N.K0,useFactory:function Di(){return(0,F.RDi)(document),document},deps:[]}]),ir=[{provide:F.zSh,useValue:"root"},{provide:F.qLn,useFactory:function tn(){return new F.qLn},deps:[]},{provide:fe,useClass:tt,multi:!0,deps:[N.K0,F.R0b,F.Lbi]},{provide:fe,useClass:ci,multi:!0,deps:[N.K0]},{provide:Jn,useClass:Jn,deps:[bn,Vn,F.AFp]},{provide:F.FYo,useExisting:Jn},{provide:Gn,useExisting:Vn},{provide:Vn,useClass:Vn,deps:[N.K0]},{provide:F.dDg,useClass:F.dDg,deps:[F.R0b]},{provide:bn,useClass:bn,deps:[fe,F.R0b]},{provide:N.JF,useClass:ri,deps:[]}];let Tr=(()=>{class Oe{constructor(me){if(me)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(me){return{ngModule:Oe,providers:[{provide:F.AFp,useValue:me.appId},{provide:Mn,useExisting:F.AFp},lt]}}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(Oe,12))},Oe.\u0275mod=F.oAB({type:Oe}),Oe.\u0275inj=F.cJS({providers:ir,imports:[N.ez,F.hGG]}),Oe})();"undefined"!=typeof window&&window;let Kt=(()=>{class Oe{}return Oe.\u0275fac=function(me){return new(me||Oe)},Oe.\u0275prov=F.Yz7({token:Oe,factory:function(me){let He=null;return He=me?new(me||Oe):F.LFG(jt),He},providedIn:"root"}),Oe})(),jt=(()=>{class Oe extends Kt{constructor(me){super(),this._doc=me}sanitize(me,He){if(null==He)return null;switch(me){case F.q3G.NONE:return He;case F.q3G.HTML:return(0,F.qzn)(He,"HTML")?(0,F.z3N)(He):(0,F.EiD)(this._doc,String(He)).toString();case F.q3G.STYLE:return(0,F.qzn)(He,"Style")?(0,F.z3N)(He):He;case F.q3G.SCRIPT:if((0,F.qzn)(He,"Script"))return(0,F.z3N)(He);throw new Error("unsafe value used in a script context");case F.q3G.URL:return(0,F.yhl)(He),(0,F.qzn)(He,"URL")?(0,F.z3N)(He):(0,F.mCW)(String(He));case F.q3G.RESOURCE_URL:if((0,F.qzn)(He,"ResourceURL"))return(0,F.z3N)(He);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${me} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(me){return(0,F.JVY)(me)}bypassSecurityTrustStyle(me){return(0,F.L6k)(me)}bypassSecurityTrustScript(me){return(0,F.eBb)(me)}bypassSecurityTrustUrl(me){return(0,F.LAX)(me)}bypassSecurityTrustResourceUrl(me){return(0,F.pB0)(me)}}return Oe.\u0275fac=function(me){return new(me||Oe)(F.LFG(N.K0))},Oe.\u0275prov=F.Yz7({token:Oe,factory:function(me){let He=null;return He=me?new me:function an(Oe){return new jt(Oe.get(N.K0))}(F.LFG(F.zs3)),He},providedIn:"root"}),Oe})()},6324:(qn,Rt,ye)=>{ye.d(Rt,{Bz:()=>Lh,lC:()=>no});var N=ye(1223),F=ye(2076),Ze=ye(9646),mt=ye(7579);class ut extends mt.x{constructor(S){super(),this._value=S}get value(){return this.getValue()}_subscribe(S){const M=super._subscribe(S);return!M.closed&&S.next(this._value),M}getValue(){const{hasError:S,thrownError:M,_value:O}=this;if(S)throw M;return this._throwIfClosed(),O}next(S){super.next(this._value=S)}}var sn=ye(8306),Xt=ye(4742),_n=ye(4671),Mn=ye(3268),Ut=ye(7669),lt=ye(1810),Ft=ye(5403),ri=ye(9672);function gt(D,S,M){D?(0,ri.f)(M,D,S):S()}var Gn=ye(576);function Vn(D,S){const M=(0,Gn.m)(D)?D:()=>D,O=W=>W.error(M());return new sn.y(S?W=>S.schedule(O,0,W):O)}var ce=ye(6805),ke=ye(8189);function rt(...D){return function Ye(){return(0,ke.J)(1)}()((0,F.D)(D,(0,Ut.yG)(D)))}var nt=ye(8421);function on(D){return new sn.y(S=>{(0,nt.Xf)(D()).subscribe(S)})}var Qe=ye(515),Tt=ye(727),Cn=ye(4482);function kn(){return(0,Cn.e)((D,S)=>{let M=null;D._refCount++;const O=(0,Ft.x)(S,void 0,void 0,void 0,()=>{if(!D||D._refCount<=0||0<--D._refCount)return void(M=null);const W=D._connection,ee=M;M=null,W&&(!ee||W===ee)&&W.unsubscribe(),S.unsubscribe()});D.subscribe(O),O.closed||(M=D.connect())})}class ai extends sn.y{constructor(S,M){super(),this.source=S,this.subjectFactory=M,this._subject=null,this._refCount=0,this._connection=null,(0,Cn.A)(S)&&(this.lift=S.lift)}_subscribe(S){return this.getSubject().subscribe(S)}getSubject(){const S=this._subject;return(!S||S.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:S}=this;this._subject=this._connection=null,null==S||S.unsubscribe()}connect(){let S=this._connection;if(!S){S=this._connection=new Tt.w0;const M=this.getSubject();S.add(this.source.subscribe((0,Ft.x)(M,void 0,()=>{this._teardown(),M.complete()},O=>{this._teardown(),M.error(O)},()=>this._teardown()))),S.closed&&(this._connection=null,S=Tt.w0.EMPTY)}return S}refCount(){return kn()(this)}}var mn=ye(4004);function Jn(D,S){return(0,Cn.e)((M,O)=>{let W=null,ee=0,Ee=!1;const Pe=()=>Ee&&!W&&O.complete();M.subscribe((0,Ft.x)(O,et=>{null==W||W.unsubscribe();let cn=0;const Ti=ee++;(0,nt.Xf)(D(et,Ti)).subscribe(W=(0,Ft.x)(O,Hn=>O.next(S?S(et,Hn,Ti,cn++):Hn),()=>{W=null,Pe()}))},()=>{Ee=!0,Pe()}))})}var Rn=ye(5698);function rn(D,S,M,O,W){return(ee,Ee)=>{let Pe=M,et=S,cn=0;ee.subscribe((0,Ft.x)(Ee,Ti=>{const Hn=cn++;et=Pe?D(et,Ti,Hn):(Pe=!0,Ti),O&&Ee.next(et)},W&&(()=>{Pe&&Ee.next(et),Ee.complete()})))}}function Wt(D,S){return(0,Cn.e)(rn(D,S,arguments.length>=2,!0))}var Je=ye(9300);function tt(D){return(0,Cn.e)((S,M)=>{let ee,O=null,W=!1;O=S.subscribe((0,Ft.x)(M,void 0,void 0,Ee=>{ee=(0,nt.Xf)(D(Ee,tt(D)(S))),O?(O.unsubscribe(),O=null,ee.subscribe(M)):W=!0})),W&&(O.unsubscribe(),O=null,ee.subscribe(M))})}var ht=ye(4351);function yt(D){return D<=0?()=>Qe.E:(0,Cn.e)((S,M)=>{let O=[];S.subscribe((0,Ft.x)(M,W=>{O.push(W),D<O.length&&O.shift()},()=>{for(const W of O)M.next(W);M.complete()},void 0,()=>{O=null}))})}var hn=ye(8068),$t=ye(6590),ci=ye(590),Zn=ye(5577);function Yt(D,S,M){const O=(0,Gn.m)(D)||S||M?{next:D,error:S,complete:M}:D;return O?(0,Cn.e)((W,ee)=>{var Ee;null===(Ee=O.subscribe)||void 0===Ee||Ee.call(O);let Pe=!0;W.subscribe((0,Ft.x)(ee,et=>{var cn;null===(cn=O.next)||void 0===cn||cn.call(O,et),ee.next(et)},()=>{var et;Pe=!1,null===(et=O.complete)||void 0===et||et.call(O),ee.complete()},et=>{var cn;Pe=!1,null===(cn=O.error)||void 0===cn||cn.call(O,et),ee.error(et)},()=>{var et,cn;Pe&&(null===(et=O.unsubscribe)||void 0===et||et.call(O)),null===(cn=O.finalize)||void 0===cn||cn.call(O)}))}):_n.y}var Di=ye(9808);class $i{constructor(S,M){this.id=S,this.url=M}}class Vi extends $i{constructor(S,M,O="imperative",W=null){super(S,M),this.navigationTrigger=O,this.restoredState=W}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ir extends $i{constructor(S,M,O){super(S,M),this.urlAfterRedirects=O}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Tr extends $i{constructor(S,M,O){super(S,M),this.reason=O}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Ir extends $i{constructor(S,M,O){super(S,M),this.error=O}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class xs extends $i{constructor(S,M,O,W){super(S,M),this.urlAfterRedirects=O,this.state=W}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Fo extends $i{constructor(S,M,O,W){super(S,M),this.urlAfterRedirects=O,this.state=W}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mr extends $i{constructor(S,M,O,W,ee){super(S,M),this.urlAfterRedirects=O,this.state=W,this.shouldActivate=ee}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class zr extends $i{constructor(S,M,O,W){super(S,M),this.urlAfterRedirects=O,this.state=W}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ar extends $i{constructor(S,M,O,W){super(S,M),this.urlAfterRedirects=O,this.state=W}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ts{constructor(S){this.route=S}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ts{constructor(S){this.route=S}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Zs{constructor(S){this.snapshot=S}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bn{constructor(S){this.snapshot=S}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class lr{constructor(S){this.snapshot=S}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fi{constructor(S){this.snapshot=S}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class On{constructor(S,M,O){this.routerEvent=S,this.position=M,this.anchor=O}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Lt="primary";class Xr{constructor(S){this.params=S||{}}has(S){return Object.prototype.hasOwnProperty.call(this.params,S)}get(S){if(this.has(S)){const M=this.params[S];return Array.isArray(M)?M[0]:M}return null}getAll(S){if(this.has(S)){const M=this.params[S];return Array.isArray(M)?M:[M]}return[]}get keys(){return Object.keys(this.params)}}function Pi(D){return new Xr(D)}const Le="ngNavigationCancelingError";function J(D){const S=Error("NavigationCancelingError: "+D);return S[Le]=!0,S}function he(D,S,M){const O=M.path.split("/");if(O.length>D.length||"full"===M.pathMatch&&(S.hasChildren()||O.length<D.length))return null;const W={};for(let ee=0;ee<O.length;ee++){const Ee=O[ee],Pe=D[ee];if(Ee.startsWith(":"))W[Ee.substring(1)]=Pe;else if(Ee!==Pe.path)return null}return{consumed:D.slice(0,O.length),posParams:W}}function ue(D,S){const M=D?Object.keys(D):void 0,O=S?Object.keys(S):void 0;if(!M||!O||M.length!=O.length)return!1;let W;for(let ee=0;ee<M.length;ee++)if(W=M[ee],!ie(D[W],S[W]))return!1;return!0}function ie(D,S){if(Array.isArray(D)&&Array.isArray(S)){if(D.length!==S.length)return!1;const M=[...D].sort(),O=[...S].sort();return M.every((W,ee)=>O[ee]===W)}return D===S}function Ie(D){return Array.prototype.concat.apply([],D)}function we(D){return D.length>0?D[D.length-1]:null}function Fe(D,S){for(const M in D)D.hasOwnProperty(M)&&S(D[M],M)}function Q(D){return(0,N.CqO)(D)?D:(0,N.QGY)(D)?(0,F.D)(Promise.resolve(D)):(0,Ze.of)(D)}const st={exact:function jt(D,S,M){if(!Ei(D.segments,S.segments)||!me(D.segments,S.segments,M)||D.numberOfChildren!==S.numberOfChildren)return!1;for(const O in S.children)if(!D.children[O]||!jt(D.children[O],S.children[O],M))return!1;return!0},subset:Oe},kt={exact:function an(D,S){return ue(D,S)},subset:function jn(D,S){return Object.keys(S).length<=Object.keys(D).length&&Object.keys(S).every(M=>ie(D[M],S[M]))},ignored:()=>!0};function Kt(D,S,M){return st[M.paths](D.root,S.root,M.matrixParams)&&kt[M.queryParams](D.queryParams,S.queryParams)&&!("exact"===M.fragment&&D.fragment!==S.fragment)}function Oe(D,S,M){return Ae(D,S,S.segments,M)}function Ae(D,S,M,O){if(D.segments.length>M.length){const W=D.segments.slice(0,M.length);return!(!Ei(W,M)||S.hasChildren()||!me(W,M,O))}if(D.segments.length===M.length){if(!Ei(D.segments,M)||!me(D.segments,M,O))return!1;for(const W in S.children)if(!D.children[W]||!Oe(D.children[W],S.children[W],O))return!1;return!0}{const W=M.slice(0,D.segments.length),ee=M.slice(D.segments.length);return!!(Ei(D.segments,W)&&me(D.segments,W,O)&&D.children[Lt])&&Ae(D.children[Lt],S,ee,O)}}function me(D,S,M){return S.every((O,W)=>kt[M](D[W].parameters,O.parameters))}class He{constructor(S,M,O){this.root=S,this.queryParams=M,this.fragment=O}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Pi(this.queryParams)),this._queryParamMap}toString(){return Gi.serialize(this)}}class je{constructor(S,M){this.segments=S,this.children=M,this.parent=null,Fe(M,(O,W)=>O.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Pr(this)}}class Ht{constructor(S,M){this.path=S,this.parameters=M}get parameterMap(){return this._parameterMap||(this._parameterMap=Pi(this.parameters)),this._parameterMap}toString(){return wr(this)}}function Ei(D,S){return D.length===S.length&&D.every((M,O)=>M.path===S[O].path)}class Jr{}class Yr{parse(S){const M=new as(S);return new He(M.parseRootSegment(),M.parseQueryParams(),M.parseFragment())}serialize(S){const M=`/${br(S.root,!0)}`,O=function Er(D){const S=Object.keys(D).map(M=>{const O=D[M];return Array.isArray(O)?O.map(W=>`${oo(M)}=${oo(W)}`).join("&"):`${oo(M)}=${oo(O)}`}).filter(M=>!!M);return S.length?`?${S.join("&")}`:""}(S.queryParams);return`${M}${O}${"string"==typeof S.fragment?`#${function ao(D){return encodeURI(D)}(S.fragment)}`:""}`}}const Gi=new Yr;function Pr(D){return D.segments.map(S=>wr(S)).join("/")}function br(D,S){if(!D.hasChildren())return Pr(D);if(S){const M=D.children[Lt]?br(D.children[Lt],!1):"",O=[];return Fe(D.children,(W,ee)=>{ee!==Lt&&O.push(`${ee}:${br(W,!1)}`)}),O.length>0?`${M}(${O.join("//")})`:M}{const M=function Ki(D,S){let M=[];return Fe(D.children,(O,W)=>{W===Lt&&(M=M.concat(S(O,W)))}),Fe(D.children,(O,W)=>{W!==Lt&&(M=M.concat(S(O,W)))}),M}(D,(O,W)=>W===Lt?[br(D.children[Lt],!1)]:[`${W}:${br(O,!1)}`]);return 1===Object.keys(D.children).length&&null!=D.children[Lt]?`${Pr(D)}/${M[0]}`:`${Pr(D)}/(${M.join("//")})`}}function Qr(D){return encodeURIComponent(D).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function oo(D){return Qr(D).replace(/%3B/gi,";")}function ns(D){return Qr(D).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function lo(D){return decodeURIComponent(D)}function Os(D){return lo(D.replace(/\+/g,"%20"))}function wr(D){return`${ns(D.path)}${function Fs(D){return Object.keys(D).map(S=>`;${ns(S)}=${ns(D[S])}`).join("")}(D.parameters)}`}const fn=/^[^\/()?;=#]+/;function Si(D){const S=D.match(fn);return S?S[0]:""}const Yi=/^[^=?&#]+/,es=/^[^&#]+/;class as{constructor(S){this.url=S,this.remaining=S}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new je([],{}):new je([],this.parseChildren())}parseQueryParams(){const S={};if(this.consumeOptional("?"))do{this.parseQueryParam(S)}while(this.consumeOptional("&"));return S}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const S=[];for(this.peekStartsWith("(")||S.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),S.push(this.parseSegment());let M={};this.peekStartsWith("/(")&&(this.capture("/"),M=this.parseParens(!0));let O={};return this.peekStartsWith("(")&&(O=this.parseParens(!1)),(S.length>0||Object.keys(M).length>0)&&(O[Lt]=new je(S,M)),O}parseSegment(){const S=Si(this.remaining);if(""===S&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(S),new Ht(lo(S),this.parseMatrixParams())}parseMatrixParams(){const S={};for(;this.consumeOptional(";");)this.parseParam(S);return S}parseParam(S){const M=Si(this.remaining);if(!M)return;this.capture(M);let O="";if(this.consumeOptional("=")){const W=Si(this.remaining);W&&(O=W,this.capture(O))}S[lo(M)]=lo(O)}parseQueryParam(S){const M=function Hr(D){const S=D.match(Yi);return S?S[0]:""}(this.remaining);if(!M)return;this.capture(M);let O="";if(this.consumeOptional("=")){const Ee=function Ji(D){const S=D.match(es);return S?S[0]:""}(this.remaining);Ee&&(O=Ee,this.capture(O))}const W=Os(M),ee=Os(O);if(S.hasOwnProperty(W)){let Ee=S[W];Array.isArray(Ee)||(Ee=[Ee],S[W]=Ee),Ee.push(ee)}else S[W]=ee}parseParens(S){const M={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const O=Si(this.remaining),W=this.remaining[O.length];if("/"!==W&&")"!==W&&";"!==W)throw new Error(`Cannot parse url '${this.url}'`);let ee;O.indexOf(":")>-1?(ee=O.substr(0,O.indexOf(":")),this.capture(ee),this.capture(":")):S&&(ee=Lt);const Ee=this.parseChildren();M[ee]=1===Object.keys(Ee).length?Ee[Lt]:new je([],Ee),this.consumeOptional("//")}return M}peekStartsWith(S){return this.remaining.startsWith(S)}consumeOptional(S){return!!this.peekStartsWith(S)&&(this.remaining=this.remaining.substring(S.length),!0)}capture(S){if(!this.consumeOptional(S))throw new Error(`Expected "${S}".`)}}class gr{constructor(S){this._root=S}get root(){return this._root.value}parent(S){const M=this.pathFromRoot(S);return M.length>1?M[M.length-2]:null}children(S){const M=Ks(S,this._root);return M?M.children.map(O=>O.value):[]}firstChild(S){const M=Ks(S,this._root);return M&&M.children.length>0?M.children[0].value:null}siblings(S){const M=Mo(S,this._root);return M.length<2?[]:M[M.length-2].children.map(W=>W.value).filter(W=>W!==S)}pathFromRoot(S){return Mo(S,this._root).map(M=>M.value)}}function Ks(D,S){if(D===S.value)return S;for(const M of S.children){const O=Ks(D,M);if(O)return O}return null}function Mo(D,S){if(D===S.value)return[S];for(const M of S.children){const O=Mo(D,M);if(O.length)return O.unshift(S),O}return[]}class ti{constructor(S,M){this.value=S,this.children=M}toString(){return`TreeNode(${this.value})`}}function Ns(D){const S={};return D&&D.children.forEach(M=>S[M.value.outlet]=M),S}class ls extends gr{constructor(S,M){super(S),this.snapshot=M,Uo(this,S)}toString(){return this.snapshot.toString()}}function bo(D,S){const M=function co(D,S){const Ee=new cs([],{},{},"",{},Lt,S,null,D.root,-1,{});return new _e("",new ti(Ee,[]))}(D,S),O=new ut([new Ht("",{})]),W=new ut({}),ee=new ut({}),Ee=new ut({}),Pe=new ut(""),et=new Gr(O,W,Ee,Pe,ee,Lt,S,M.root);return et.snapshot=M.root,new ls(new ti(et,[]),M)}class Gr{constructor(S,M,O,W,ee,Ee,Pe,et){this.url=S,this.params=M,this.queryParams=O,this.fragment=W,this.data=ee,this.outlet=Ee,this.component=Pe,this._futureSnapshot=et}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,mn.U)(S=>Pi(S)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,mn.U)(S=>Pi(S)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function No(D,S="emptyOnly"){const M=D.pathFromRoot;let O=0;if("always"!==S)for(O=M.length-1;O>=1;){const W=M[O],ee=M[O-1];if(W.routeConfig&&""===W.routeConfig.path)O--;else{if(ee.component)break;O--}}return function ko(D){return D.reduce((S,M)=>({params:Object.assign(Object.assign({},S.params),M.params),data:Object.assign(Object.assign({},S.data),M.data),resolve:Object.assign(Object.assign({},S.resolve),M._resolvedData)}),{params:{},data:{},resolve:{}})}(M.slice(O))}class cs{constructor(S,M,O,W,ee,Ee,Pe,et,cn,Ti,Hn){this.url=S,this.params=M,this.queryParams=O,this.fragment=W,this.data=ee,this.outlet=Ee,this.component=Pe,this.routeConfig=et,this._urlSegment=cn,this._lastPathIndex=Ti,this._resolve=Hn}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Pi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Pi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(O=>O.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class _e extends gr{constructor(S,M){super(M),this.url=S,Uo(this,M)}toString(){return Cs(this._root)}}function Uo(D,S){S.value._routerState=D,S.children.forEach(M=>Uo(D,M))}function Cs(D){const S=D.children.length>0?` { ${D.children.map(Cs).join(", ")} } `:"";return`${D.value}${S}`}function Ds(D){if(D.snapshot){const S=D.snapshot,M=D._futureSnapshot;D.snapshot=M,ue(S.queryParams,M.queryParams)||D.queryParams.next(M.queryParams),S.fragment!==M.fragment&&D.fragment.next(M.fragment),ue(S.params,M.params)||D.params.next(M.params),function ne(D,S){if(D.length!==S.length)return!1;for(let M=0;M<D.length;++M)if(!ue(D[M],S[M]))return!1;return!0}(S.url,M.url)||D.url.next(M.url),ue(S.data,M.data)||D.data.next(M.data)}else D.snapshot=D._futureSnapshot,D.data.next(D._futureSnapshot.data)}function er(D,S){const M=ue(D.params,S.params)&&function Pn(D,S){return Ei(D,S)&&D.every((M,O)=>ue(M.parameters,S[O].parameters))}(D.url,S.url);return M&&!(!D.parent!=!S.parent)&&(!D.parent||er(D.parent,S.parent))}function bs(D,S,M){if(M&&D.shouldReuseRoute(S.value,M.value.snapshot)){const O=M.value;O._futureSnapshot=S.value;const W=function qo(D,S,M){return S.children.map(O=>{for(const W of M.children)if(D.shouldReuseRoute(O.value,W.value.snapshot))return bs(D,O,W);return bs(D,O)})}(D,S,M);return new ti(O,W)}{if(D.shouldAttach(S.value)){const ee=D.retrieve(S.value);if(null!==ee){const Ee=ee.route;return Ee.value._futureSnapshot=S.value,Ee.children=S.children.map(Pe=>bs(D,Pe)),Ee}}const O=function Oi(D){return new Gr(new ut(D.url),new ut(D.params),new ut(D.queryParams),new ut(D.fragment),new ut(D.data),D.outlet,D.component,D)}(S.value),W=S.children.map(ee=>bs(D,ee));return new ti(O,W)}}function wo(D){return"object"==typeof D&&null!=D&&!D.outlets&&!D.segmentPath}function Eo(D){return"object"==typeof D&&null!=D&&D.outlets}function So(D,S,M,O,W){let ee={};if(O&&Fe(O,(Pe,et)=>{ee[et]=Array.isArray(Pe)?Pe.map(cn=>`${cn}`):`${Pe}`}),D===S)return new He(M,ee,W);const Ee=ks(D,S,M);return new He(Ee,ee,W)}function ks(D,S,M){const O={};return Fe(D.children,(W,ee)=>{O[ee]=W===S?M:ks(W,S,M)}),new je(D.segments,O)}class al{constructor(S,M,O){if(this.isAbsolute=S,this.numberOfDoubleDots=M,this.commands=O,S&&O.length>0&&wo(O[0]))throw new Error("Root segment cannot have matrix parameters");const W=O.find(Eo);if(W&&W!==we(O))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Js{constructor(S,M,O){this.segmentGroup=S,this.processChildren=M,this.index=O}}function Us(D,S,M){if(D||(D=new je([],{})),0===D.segments.length&&D.hasChildren())return Ko(D,S,M);const O=function yr(D,S,M){let O=0,W=S;const ee={match:!1,pathIndex:0,commandIndex:0};for(;W<D.segments.length;){if(O>=M.length)return ee;const Ee=D.segments[W],Pe=M[O];if(Eo(Pe))break;const et=`${Pe}`,cn=O<M.length-1?M[O+1]:null;if(W>0&&void 0===et)break;if(et&&cn&&"object"==typeof cn&&void 0===cn.outlets){if(!Qo(et,cn,Ee))return ee;O+=2}else{if(!Qo(et,{},Ee))return ee;O++}W++}return{match:!0,pathIndex:W,commandIndex:O}}(D,S,M),W=M.slice(O.commandIndex);if(O.match&&O.pathIndex<D.segments.length){const ee=new je(D.segments.slice(0,O.pathIndex),{});return ee.children[Lt]=new je(D.segments.slice(O.pathIndex),D.children),Ko(ee,0,W)}return O.match&&0===W.length?new je(D.segments,{}):O.match&&!D.hasChildren()?Qs(D,S,M):O.match?Ko(D,0,W):Qs(D,S,M)}function Ko(D,S,M){if(0===M.length)return new je(D.segments,{});{const O=function Ai(D){return Eo(D[0])?D[0].outlets:{[Lt]:D}}(M),W={};return Fe(O,(ee,Ee)=>{"string"==typeof ee&&(ee=[ee]),null!==ee&&(W[Ee]=Us(D.children[Ee],S,ee))}),Fe(D.children,(ee,Ee)=>{void 0===O[Ee]&&(W[Ee]=ee)}),new je(D.segments,W)}}function Qs(D,S,M){const O=D.segments.slice(0,S);let W=0;for(;W<M.length;){const ee=M[W];if(Eo(ee)){const et=Ao(ee.outlets);return new je(O,et)}if(0===W&&wo(M[0])){O.push(new Ht(D.segments[S].path,Jo(M[0]))),W++;continue}const Ee=Eo(ee)?ee.outlets[Lt]:`${ee}`,Pe=W<M.length-1?M[W+1]:null;Ee&&Pe&&wo(Pe)?(O.push(new Ht(Ee,Jo(Pe))),W+=2):(O.push(new Ht(Ee,{})),W++)}return new je(O,{})}function Ao(D){const S={};return Fe(D,(M,O)=>{"string"==typeof M&&(M=[M]),null!==M&&(S[O]=Qs(new je([],{}),0,M))}),S}function Jo(D){const S={};return Fe(D,(M,O)=>S[O]=`${M}`),S}function Qo(D,S,M){return D==M.path&&ue(S,M.parameters)}class Ba{constructor(S,M,O,W){this.routeReuseStrategy=S,this.futureState=M,this.currState=O,this.forwardEvent=W}activate(S){const M=this.futureState._root,O=this.currState?this.currState._root:null;this.deactivateChildRoutes(M,O,S),Ds(this.futureState.root),this.activateChildRoutes(M,O,S)}deactivateChildRoutes(S,M,O){const W=Ns(M);S.children.forEach(ee=>{const Ee=ee.value.outlet;this.deactivateRoutes(ee,W[Ee],O),delete W[Ee]}),Fe(W,(ee,Ee)=>{this.deactivateRouteAndItsChildren(ee,O)})}deactivateRoutes(S,M,O){const W=S.value,ee=M?M.value:null;if(W===ee)if(W.component){const Ee=O.getContext(W.outlet);Ee&&this.deactivateChildRoutes(S,M,Ee.children)}else this.deactivateChildRoutes(S,M,O);else ee&&this.deactivateRouteAndItsChildren(M,O)}deactivateRouteAndItsChildren(S,M){S.value.component&&this.routeReuseStrategy.shouldDetach(S.value.snapshot)?this.detachAndStoreRouteSubtree(S,M):this.deactivateRouteAndOutlet(S,M)}detachAndStoreRouteSubtree(S,M){const O=M.getContext(S.value.outlet),W=O&&S.value.component?O.children:M,ee=Ns(S);for(const Ee of Object.keys(ee))this.deactivateRouteAndItsChildren(ee[Ee],W);if(O&&O.outlet){const Ee=O.outlet.detach(),Pe=O.children.onOutletDeactivated();this.routeReuseStrategy.store(S.value.snapshot,{componentRef:Ee,route:S,contexts:Pe})}}deactivateRouteAndOutlet(S,M){const O=M.getContext(S.value.outlet),W=O&&S.value.component?O.children:M,ee=Ns(S);for(const Ee of Object.keys(ee))this.deactivateRouteAndItsChildren(ee[Ee],W);O&&O.outlet&&(O.outlet.deactivate(),O.children.onOutletDeactivated(),O.attachRef=null,O.resolver=null,O.route=null)}activateChildRoutes(S,M,O){const W=Ns(M);S.children.forEach(ee=>{this.activateRoutes(ee,W[ee.value.outlet],O),this.forwardEvent(new fi(ee.value.snapshot))}),S.children.length&&this.forwardEvent(new Bn(S.value.snapshot))}activateRoutes(S,M,O){const W=S.value,ee=M?M.value:null;if(Ds(W),W===ee)if(W.component){const Ee=O.getOrCreateContext(W.outlet);this.activateChildRoutes(S,M,Ee.children)}else this.activateChildRoutes(S,M,O);else if(W.component){const Ee=O.getOrCreateContext(W.outlet);if(this.routeReuseStrategy.shouldAttach(W.snapshot)){const Pe=this.routeReuseStrategy.retrieve(W.snapshot);this.routeReuseStrategy.store(W.snapshot,null),Ee.children.onOutletReAttached(Pe.contexts),Ee.attachRef=Pe.componentRef,Ee.route=Pe.route.value,Ee.outlet&&Ee.outlet.attach(Pe.componentRef,Pe.route.value),Ds(Pe.route.value),this.activateChildRoutes(S,null,Ee.children)}else{const Pe=function ec(D){for(let S=D.parent;S;S=S.parent){const M=S.routeConfig;if(M&&M._loadedConfig)return M._loadedConfig;if(M&&M.component)return null}return null}(W.snapshot),et=Pe?Pe.module.componentFactoryResolver:null;Ee.attachRef=null,Ee.route=W,Ee.resolver=et,Ee.outlet&&Ee.outlet.activateWith(W,et),this.activateChildRoutes(S,null,Ee.children)}}else this.activateChildRoutes(S,null,O)}}class cl{constructor(S,M){this.routes=S,this.module=M}}function Bs(D){return"function"==typeof D}function eo(D){return D instanceof He}const to=Symbol("INITIAL_VALUE");function Bo(){return Jn(D=>function fe(...D){const S=(0,Ut.yG)(D),M=(0,Ut.jO)(D),{args:O,keys:W}=(0,Xt.D)(D);if(0===O.length)return(0,F.D)([],S);const ee=new sn.y(function bn(D,S,M=_n.y){return O=>{gt(S,()=>{const{length:W}=D,ee=new Array(W);let Ee=W,Pe=W;for(let et=0;et<W;et++)gt(S,()=>{const cn=(0,F.D)(D[et],S);let Ti=!1;cn.subscribe((0,Ft.x)(O,Hn=>{ee[et]=Hn,Ti||(Ti=!0,Pe--),Pe||O.next(M(ee.slice()))},()=>{--Ee||O.complete()}))},O)},O)}}(O,S,W?Ee=>(0,lt.n)(W,Ee):_n.y));return M?ee.pipe((0,Mn.Z)(M)):ee}(D.map(S=>S.pipe((0,Rn.q)(1),function Nr(...D){const S=(0,Ut.yG)(D);return(0,Cn.e)((M,O)=>{(S?rt(D,M,S):rt(D,M)).subscribe(O)})}(to)))).pipe(Wt((S,M)=>{let O=!1;return M.reduce((W,ee,Ee)=>W!==to?W:(ee===to&&(O=!0),O||!1!==ee&&Ee!==M.length-1&&!eo(ee)?W:ee),S)},to),(0,Je.h)(S=>S!==to),(0,mn.U)(S=>eo(S)?S:!0===S),(0,Rn.q)(1)))}class ga{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Co,this.attachRef=null}}class Co{constructor(){this.contexts=new Map}onChildOutletCreated(S,M){const O=this.getOrCreateContext(S);O.outlet=M,this.contexts.set(S,O)}onChildOutletDestroyed(S){const M=this.getContext(S);M&&(M.outlet=null,M.attachRef=null)}onOutletDeactivated(){const S=this.contexts;return this.contexts=new Map,S}onOutletReAttached(S){this.contexts=S}getOrCreateContext(S){let M=this.getContext(S);return M||(M=new ga,this.contexts.set(S,M)),M}getContext(S){return this.contexts.get(S)||null}}let no=(()=>{class D{constructor(M,O,W,ee,Ee){this.parentContexts=M,this.location=O,this.resolver=W,this.changeDetector=Ee,this.activated=null,this._activatedRoute=null,this.activateEvents=new N.vpe,this.deactivateEvents=new N.vpe,this.attachEvents=new N.vpe,this.detachEvents=new N.vpe,this.name=ee||Lt,M.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const M=this.parentContexts.getContext(this.name);M&&M.route&&(M.attachRef?this.attach(M.attachRef,M.route):this.activateWith(M.route,M.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const M=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(M.instance),M}attach(M,O){this.activated=M,this._activatedRoute=O,this.location.insert(M.hostView),this.attachEvents.emit(M.instance)}deactivate(){if(this.activated){const M=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(M)}}activateWith(M,O){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=M;const Ee=(O=O||this.resolver).resolveComponentFactory(M._futureSnapshot.routeConfig.component),Pe=this.parentContexts.getOrCreateContext(this.name).children,et=new us(M,Pe,this.location.injector);this.activated=this.location.createComponent(Ee,this.location.length,et),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return D.\u0275fac=function(M){return new(M||D)(N.Y36(Co),N.Y36(N.s_b),N.Y36(N._Vd),N.$8M("name"),N.Y36(N.sBO))},D.\u0275dir=N.lG2({type:D,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),D})();class us{constructor(S,M,O){this.route=S,this.childContexts=M,this.parent=O}get(S,M){return S===Gr?this.route:S===Co?this.childContexts:this.parent.get(S,M)}}let ya=(()=>{class D{}return D.\u0275fac=function(M){return new(M||D)},D.\u0275cmp=N.Xpm({type:D,selectors:[["ng-component"]],decls:1,vars:0,template:function(M,O){1&M&&N._UZ(0,"router-outlet")},directives:[no],encapsulation:2}),D})();function Ea(D,S=""){for(let M=0;M<D.length;M++){const O=D[M];H(O,re(S,O))}}function H(D,S){D.children&&Ea(D.children,S)}function re(D,S){return S?D||S.path?D&&!S.path?`${D}/`:!D&&S.path?S.path:`${D}/${S.path}`:"":D}function G(D){const S=D.children&&D.children.map(G),M=S?Object.assign(Object.assign({},D),{children:S}):Object.assign({},D);return!M.component&&(S||M.loadChildren)&&M.outlet&&M.outlet!==Lt&&(M.component=ya),M}function oe(D){return D.outlet||Lt}function Be(D,S){const M=D.filter(O=>oe(O)===S);return M.push(...D.filter(O=>oe(O)!==S)),M}const pt={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function zt(D,S,M){var O;if(""===S.path)return"full"===S.pathMatch&&(D.hasChildren()||M.length>0)?Object.assign({},pt):{matched:!0,consumedSegments:[],remainingSegments:M,parameters:{},positionalParamSegments:{}};const ee=(S.matcher||he)(M,D,S);if(!ee)return Object.assign({},pt);const Ee={};Fe(ee.posParams,(et,cn)=>{Ee[cn]=et.path});const Pe=ee.consumed.length>0?Object.assign(Object.assign({},Ee),ee.consumed[ee.consumed.length-1].parameters):Ee;return{matched:!0,consumedSegments:ee.consumed,remainingSegments:M.slice(ee.consumed.length),parameters:Pe,positionalParamSegments:null!==(O=ee.posParams)&&void 0!==O?O:{}}}function ln(D,S,M,O,W="corrected"){if(M.length>0&&function vi(D,S,M){return M.some(O=>rr(D,S,O)&&oe(O)!==Lt)}(D,M,O)){const Ee=new je(S,function Sr(D,S,M,O){const W={};W[Lt]=O,O._sourceSegment=D,O._segmentIndexShift=S.length;for(const ee of M)if(""===ee.path&&oe(ee)!==Lt){const Ee=new je([],{});Ee._sourceSegment=D,Ee._segmentIndexShift=S.length,W[oe(ee)]=Ee}return W}(D,S,O,new je(M,D.children)));return Ee._sourceSegment=D,Ee._segmentIndexShift=S.length,{segmentGroup:Ee,slicedSegments:[]}}if(0===M.length&&function ki(D,S,M){return M.some(O=>rr(D,S,O))}(D,M,O)){const Ee=new je(D.segments,function cr(D,S,M,O,W,ee){const Ee={};for(const Pe of O)if(rr(D,M,Pe)&&!W[oe(Pe)]){const et=new je([],{});et._sourceSegment=D,et._segmentIndexShift="legacy"===ee?D.segments.length:S.length,Ee[oe(Pe)]=et}return Object.assign(Object.assign({},W),Ee)}(D,S,M,O,D.children,W));return Ee._sourceSegment=D,Ee._segmentIndexShift=S.length,{segmentGroup:Ee,slicedSegments:M}}const ee=new je(D.segments,D.children);return ee._sourceSegment=D,ee._segmentIndexShift=S.length,{segmentGroup:ee,slicedSegments:M}}function rr(D,S,M){return(!(D.hasChildren()||S.length>0)||"full"!==M.pathMatch)&&""===M.path}function Qi(D,S,M,O){return!!(oe(D)===O||O!==Lt&&rr(S,M,D))&&("**"===D.path||zt(S,D,M).matched)}function zi(D,S,M){return 0===S.length&&!D.children[M]}class Ar{constructor(S){this.segmentGroup=S||null}}class io{constructor(S){this.urlTree=S}}function ur(D){return Vn(new Ar(D))}function fr(D){return Vn(new io(D))}class hs{constructor(S,M,O,W,ee){this.configLoader=M,this.urlSerializer=O,this.urlTree=W,this.config=ee,this.allowRedirects=!0,this.ngModule=S.get(N.h0i)}apply(){const S=ln(this.urlTree.root,[],[],this.config).segmentGroup,M=new je(S.segments,S.children);return this.expandSegmentGroup(this.ngModule,this.config,M,Lt).pipe((0,mn.U)(ee=>this.createUrlTree(Vo(ee),this.urlTree.queryParams,this.urlTree.fragment))).pipe(tt(ee=>{if(ee instanceof io)return this.allowRedirects=!1,this.match(ee.urlTree);throw ee instanceof Ar?this.noMatchError(ee):ee}))}match(S){return this.expandSegmentGroup(this.ngModule,this.config,S.root,Lt).pipe((0,mn.U)(W=>this.createUrlTree(Vo(W),S.queryParams,S.fragment))).pipe(tt(W=>{throw W instanceof Ar?this.noMatchError(W):W}))}noMatchError(S){return new Error(`Cannot match any routes. URL Segment: '${S.segmentGroup}'`)}createUrlTree(S,M,O){const W=S.segments.length>0?new je([],{[Lt]:S}):S;return new He(W,M,O)}expandSegmentGroup(S,M,O,W){return 0===O.segments.length&&O.hasChildren()?this.expandChildren(S,M,O).pipe((0,mn.U)(ee=>new je([],ee))):this.expandSegment(S,O,M,O.segments,W,!0)}expandChildren(S,M,O){const W=[];for(const ee of Object.keys(O.children))"primary"===ee?W.unshift(ee):W.push(ee);return(0,F.D)(W).pipe((0,ht.b)(ee=>{const Ee=O.children[ee],Pe=Be(M,ee);return this.expandSegmentGroup(S,Pe,Ee,ee).pipe((0,mn.U)(et=>({segment:et,outlet:ee})))}),Wt((ee,Ee)=>(ee[Ee.outlet]=Ee.segment,ee),{}),function In(D,S){const M=arguments.length>=2;return O=>O.pipe(D?(0,Je.h)((W,ee)=>D(W,ee,O)):_n.y,yt(1),M?(0,$t.d)(S):(0,hn.T)(()=>new ce.K))}())}expandSegment(S,M,O,W,ee,Ee){return(0,F.D)(O).pipe((0,ht.b)(Pe=>this.expandSegmentAgainstRoute(S,M,O,Pe,W,ee,Ee).pipe(tt(cn=>{if(cn instanceof Ar)return(0,Ze.of)(null);throw cn}))),(0,ci.P)(Pe=>!!Pe),tt((Pe,et)=>{if(Pe instanceof ce.K||"EmptyError"===Pe.name)return zi(M,W,ee)?(0,Ze.of)(new je([],{})):ur(M);throw Pe}))}expandSegmentAgainstRoute(S,M,O,W,ee,Ee,Pe){return Qi(W,M,ee,Ee)?void 0===W.redirectTo?this.matchSegmentAgainstRoute(S,M,W,ee,Ee):Pe&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(S,M,O,W,ee,Ee):ur(M):ur(M)}expandSegmentAgainstRouteUsingRedirect(S,M,O,W,ee,Ee){return"**"===W.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(S,O,W,Ee):this.expandRegularSegmentAgainstRouteUsingRedirect(S,M,O,W,ee,Ee)}expandWildCardWithParamsAgainstRouteUsingRedirect(S,M,O,W){const ee=this.applyRedirectCommands([],O.redirectTo,{});return O.redirectTo.startsWith("/")?fr(ee):this.lineralizeSegments(O,ee).pipe((0,Zn.z)(Ee=>{const Pe=new je(Ee,{});return this.expandSegment(S,Pe,M,Ee,W,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(S,M,O,W,ee,Ee){const{matched:Pe,consumedSegments:et,remainingSegments:cn,positionalParamSegments:Ti}=zt(M,W,ee);if(!Pe)return ur(M);const Hn=this.applyRedirectCommands(et,W.redirectTo,Ti);return W.redirectTo.startsWith("/")?fr(Hn):this.lineralizeSegments(W,Hn).pipe((0,Zn.z)(Xi=>this.expandSegment(S,M,O,Xi.concat(cn),Ee,!1)))}matchSegmentAgainstRoute(S,M,O,W,ee){if("**"===O.path)return O.loadChildren?(O._loadedConfig?(0,Ze.of)(O._loadedConfig):this.configLoader.load(S.injector,O)).pipe((0,mn.U)(Hn=>(O._loadedConfig=Hn,new je(W,{})))):(0,Ze.of)(new je(W,{}));const{matched:Ee,consumedSegments:Pe,remainingSegments:et}=zt(M,O,W);return Ee?this.getChildConfig(S,O,W).pipe((0,Zn.z)(Ti=>{const Hn=Ti.module,Xi=Ti.routes,{segmentGroup:Wi,slicedSegments:Io}=ln(M,Pe,et,Xi),mo=new je(Wi.segments,Wi.children);if(0===Io.length&&mo.hasChildren())return this.expandChildren(Hn,Xi,mo).pipe((0,mn.U)(ja=>new je(Pe,ja)));if(0===Xi.length&&0===Io.length)return(0,Ze.of)(new je(Pe,{}));const Pa=oe(O)===ee;return this.expandSegment(Hn,mo,Xi,Io,Pa?Lt:ee,!0).pipe((0,mn.U)(Wa=>new je(Pe.concat(Wa.segments),Wa.children)))})):ur(M)}getChildConfig(S,M,O){return M.children?(0,Ze.of)(new cl(M.children,S)):M.loadChildren?void 0!==M._loadedConfig?(0,Ze.of)(M._loadedConfig):this.runCanLoadGuards(S.injector,M,O).pipe((0,Zn.z)(W=>W?this.configLoader.load(S.injector,M).pipe((0,mn.U)(ee=>(M._loadedConfig=ee,ee))):function vr(D){return Vn(J(`Cannot load children because the guard of the route "path: '${D.path}'" returned false`))}(M))):(0,Ze.of)(new cl([],S))}runCanLoadGuards(S,M,O){const W=M.canLoad;if(!W||0===W.length)return(0,Ze.of)(!0);const ee=W.map(Ee=>{const Pe=S.get(Ee);let et;if(function ca(D){return D&&Bs(D.canLoad)}(Pe))et=Pe.canLoad(M,O);else{if(!Bs(Pe))throw new Error("Invalid CanLoad guard");et=Pe(M,O)}return Q(et)});return(0,Ze.of)(ee).pipe(Bo(),Yt(Ee=>{if(!eo(Ee))return;const Pe=J(`Redirecting to "${this.urlSerializer.serialize(Ee)}"`);throw Pe.url=Ee,Pe}),(0,mn.U)(Ee=>!0===Ee))}lineralizeSegments(S,M){let O=[],W=M.root;for(;;){if(O=O.concat(W.segments),0===W.numberOfChildren)return(0,Ze.of)(O);if(W.numberOfChildren>1||!W.children[Lt])return Vn(new Error(`Only absolute redirects can have named outlets. redirectTo: '${S.redirectTo}'`));W=W.children[Lt]}}applyRedirectCommands(S,M,O){return this.applyRedirectCreatreUrlTree(M,this.urlSerializer.parse(M),S,O)}applyRedirectCreatreUrlTree(S,M,O,W){const ee=this.createSegmentGroup(S,M.root,O,W);return new He(ee,this.createQueryParams(M.queryParams,this.urlTree.queryParams),M.fragment)}createQueryParams(S,M){const O={};return Fe(S,(W,ee)=>{if("string"==typeof W&&W.startsWith(":")){const Pe=W.substring(1);O[ee]=M[Pe]}else O[ee]=W}),O}createSegmentGroup(S,M,O,W){const ee=this.createSegments(S,M.segments,O,W);let Ee={};return Fe(M.children,(Pe,et)=>{Ee[et]=this.createSegmentGroup(S,Pe,O,W)}),new je(ee,Ee)}createSegments(S,M,O,W){return M.map(ee=>ee.path.startsWith(":")?this.findPosParam(S,ee,W):this.findOrReturn(ee,O))}findPosParam(S,M,O){const W=O[M.path.substring(1)];if(!W)throw new Error(`Cannot redirect to '${S}'. Cannot find '${M.path}'.`);return W}findOrReturn(S,M){let O=0;for(const W of M){if(W.path===S.path)return M.splice(O),W;O++}return S}}function Vo(D){const S={};for(const O of Object.keys(D.children)){const ee=Vo(D.children[O]);(ee.segments.length>0||ee.hasChildren())&&(S[O]=ee)}return function ss(D){if(1===D.numberOfChildren&&D.children[Lt]){const S=D.children[Lt];return new je(D.segments.concat(S.segments),S.children)}return D}(new je(D.segments,S))}class Rl{constructor(S){this.path=S,this.route=this.path[this.path.length-1]}}class ul{constructor(S,M){this.component=S,this.route=M}}function tc(D,S,M){const O=D._root;return Il(O,S?S._root:null,M,[O.value])}function hl(D,S,M){const O=function nc(D){if(!D)return null;for(let S=D.parent;S;S=S.parent){const M=S.routeConfig;if(M&&M._loadedConfig)return M._loadedConfig}return null}(S);return(O?O.module.injector:M).get(D)}function Il(D,S,M,O,W={canDeactivateChecks:[],canActivateChecks:[]}){const ee=Ns(S);return D.children.forEach(Ee=>{(function lu(D,S,M,O,W={canDeactivateChecks:[],canActivateChecks:[]}){const ee=D.value,Ee=S?S.value:null,Pe=M?M.getContext(D.value.outlet):null;if(Ee&&ee.routeConfig===Ee.routeConfig){const et=function Gt(D,S,M){if("function"==typeof M)return M(D,S);switch(M){case"pathParamsChange":return!Ei(D.url,S.url);case"pathParamsOrQueryParamsChange":return!Ei(D.url,S.url)||!ue(D.queryParams,S.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!er(D,S)||!ue(D.queryParams,S.queryParams);default:return!er(D,S)}}(Ee,ee,ee.routeConfig.runGuardsAndResolvers);et?W.canActivateChecks.push(new Rl(O)):(ee.data=Ee.data,ee._resolvedData=Ee._resolvedData),Il(D,S,ee.component?Pe?Pe.children:null:M,O,W),et&&Pe&&Pe.outlet&&Pe.outlet.isActivated&&W.canDeactivateChecks.push(new ul(Pe.outlet.component,Ee))}else Ee&&B(S,Pe,W),W.canActivateChecks.push(new Rl(O)),Il(D,null,ee.component?Pe?Pe.children:null:M,O,W)})(Ee,ee[Ee.value.outlet],M,O.concat([Ee.value]),W),delete ee[Ee.value.outlet]}),Fe(ee,(Ee,Pe)=>B(Ee,M.getContext(Pe),W)),W}function B(D,S,M){const O=Ns(D),W=D.value;Fe(O,(ee,Ee)=>{B(ee,W.component?S?S.children.getContext(Ee):null:S,M)}),M.canDeactivateChecks.push(new ul(W.component&&S&&S.outlet&&S.outlet.isActivated?S.outlet.component:null,W))}class ho{}function Aa(D){return new sn.y(S=>S.error(D))}class Wr{constructor(S,M,O,W,ee,Ee){this.rootComponentType=S,this.config=M,this.urlTree=O,this.url=W,this.paramsInheritanceStrategy=ee,this.relativeLinkResolution=Ee}recognize(){const S=ln(this.urlTree.root,[],[],this.config.filter(Ee=>void 0===Ee.redirectTo),this.relativeLinkResolution).segmentGroup,M=this.processSegmentGroup(this.config,S,Lt);if(null===M)return null;const O=new cs([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Lt,this.rootComponentType,null,this.urlTree.root,-1,{}),W=new ti(O,M),ee=new _e(this.url,W);return this.inheritParamsAndData(ee._root),ee}inheritParamsAndData(S){const M=S.value,O=No(M,this.paramsInheritanceStrategy);M.params=Object.freeze(O.params),M.data=Object.freeze(O.data),S.children.forEach(W=>this.inheritParamsAndData(W))}processSegmentGroup(S,M,O){return 0===M.segments.length&&M.hasChildren()?this.processChildren(S,M):this.processSegment(S,M,M.segments,O)}processChildren(S,M){const O=[];for(const ee of Object.keys(M.children)){const Ee=M.children[ee],Pe=Be(S,ee),et=this.processSegmentGroup(Pe,Ee,ee);if(null===et)return null;O.push(...et)}const W=Lr(O);return function Rs(D){D.sort((S,M)=>S.value.outlet===Lt?-1:M.value.outlet===Lt?1:S.value.outlet.localeCompare(M.value.outlet))}(W),W}processSegment(S,M,O,W){for(const ee of S){const Ee=this.processSegmentAgainstRoute(ee,M,O,W);if(null!==Ee)return Ee}return zi(M,O,W)?[]:null}processSegmentAgainstRoute(S,M,O,W){if(S.redirectTo||!Qi(S,M,O,W))return null;let ee,Ee=[],Pe=[];if("**"===S.path){const Wi=O.length>0?we(O).parameters:{};ee=new cs(O,Wi,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,cu(S),oe(S),S.component,S,Tc(M),Pl(M)+O.length,za(S))}else{const Wi=zt(M,S,O);if(!Wi.matched)return null;Ee=Wi.consumedSegments,Pe=Wi.remainingSegments,ee=new cs(Ee,Wi.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,cu(S),oe(S),S.component,S,Tc(M),Pl(M)+Ee.length,za(S))}const et=function ic(D){return D.children?D.children:D.loadChildren?D._loadedConfig.routes:[]}(S),{segmentGroup:cn,slicedSegments:Ti}=ln(M,Ee,Pe,et.filter(Wi=>void 0===Wi.redirectTo),this.relativeLinkResolution);if(0===Ti.length&&cn.hasChildren()){const Wi=this.processChildren(et,cn);return null===Wi?null:[new ti(ee,Wi)]}if(0===et.length&&0===Ti.length)return[new ti(ee,[])];const Hn=oe(S)===W,Xi=this.processSegment(et,cn,Ti,Hn?Lt:W);return null===Xi?null:[new ti(ee,Xi)]}}function ps(D){const S=D.value.routeConfig;return S&&""===S.path&&void 0===S.redirectTo}function Lr(D){const S=[],M=new Set;for(const O of D){if(!ps(O)){S.push(O);continue}const W=S.find(ee=>O.value.routeConfig===ee.value.routeConfig);void 0!==W?(W.children.push(...O.children),M.add(W)):S.push(O)}for(const O of M){const W=Lr(O.children);S.push(new ti(O.value,W))}return S.filter(O=>!M.has(O))}function Tc(D){let S=D;for(;S._sourceSegment;)S=S._sourceSegment;return S}function Pl(D){let S=D,M=S._segmentIndexShift?S._segmentIndexShift:0;for(;S._sourceSegment;)S=S._sourceSegment,M+=S._segmentIndexShift?S._segmentIndexShift:0;return M-1}function cu(D){return D.data||{}}function za(D){return D.resolve||{}}function dl(D){return[...Object.keys(D),...Object.getOwnPropertySymbols(D)]}function ta(D){return Jn(S=>{const M=D(S);return M?(0,F.D)(M).pipe((0,mn.U)(()=>S)):(0,Ze.of)(S)})}class ua extends class hu{shouldDetach(S){return!1}store(S,M){}shouldAttach(S){return!1}retrieve(S){return null}shouldReuseRoute(S,M){return S.routeConfig===M.routeConfig}}{}const tr=new N.OlP("ROUTES");class Fl{constructor(S,M,O,W){this.injector=S,this.compiler=M,this.onLoadStartListener=O,this.onLoadEndListener=W}load(S,M){if(M._loader$)return M._loader$;this.onLoadStartListener&&this.onLoadStartListener(M);const W=this.loadModuleFactory(M.loadChildren).pipe((0,mn.U)(ee=>{this.onLoadEndListener&&this.onLoadEndListener(M);const Ee=ee.create(S);return new cl(Ie(Ee.injector.get(tr,void 0,N.XFs.Self|N.XFs.Optional)).map(G),Ee)}),tt(ee=>{throw M._loader$=void 0,ee}));return M._loader$=new ai(W,()=>new mt.x).pipe(kn()),M._loader$}loadModuleFactory(S){return Q(S()).pipe((0,Zn.z)(M=>M instanceof N.YKP?(0,Ze.of)(M):(0,F.D)(this.compiler.compileModuleAsync(M))))}}class Vs{shouldProcessUrl(S){return!0}extract(S){return S}merge(S,M){return S}}function Ca(D){throw D}function Ur(D,S,M){return S.parse("/")}function Gu(D,S){return(0,Ze.of)(null)}const oc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Is={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Me=(()=>{class D{constructor(M,O,W,ee,Ee,Pe,et){this.rootComponentType=M,this.urlSerializer=O,this.rootContexts=W,this.location=ee,this.config=et,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new mt.x,this.errorHandler=Ca,this.malformedUriErrorHandler=Ur,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Gu,afterPreactivation:Gu},this.urlHandlingStrategy=new Vs,this.routeReuseStrategy=new ua,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=Ee.get(N.h0i),this.console=Ee.get(N.c2e);const Hn=Ee.get(N.R0b);this.isNgZoneEnabled=Hn instanceof N.R0b&&N.R0b.isInAngularZone(),this.resetConfig(et),this.currentUrlTree=function Ve(){return new He(new je([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Fl(Ee,Pe,Xi=>this.triggerEvent(new ts(Xi)),Xi=>this.triggerEvent(new Ts(Xi))),this.routerState=bo(this.currentUrlTree,this.rootComponentType),this.transitions=new ut({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var M;return null===(M=this.location.getState())||void 0===M?void 0:M.\u0275routerPageId}setupNavigations(M){const O=this.events;return M.pipe((0,Je.h)(W=>0!==W.id),(0,mn.U)(W=>Object.assign(Object.assign({},W),{extractedUrl:this.urlHandlingStrategy.extract(W.rawUrl)})),Jn(W=>{let ee=!1,Ee=!1;return(0,Ze.of)(W).pipe(Yt(Pe=>{this.currentNavigation={id:Pe.id,initialUrl:Pe.currentRawUrl,extractedUrl:Pe.extractedUrl,trigger:Pe.source,extras:Pe.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Jn(Pe=>{const et=this.browserUrlTree.toString(),cn=!this.navigated||Pe.extractedUrl.toString()!==et||et!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||cn)&&this.urlHandlingStrategy.shouldProcessUrl(Pe.rawUrl))return fu(Pe.source)&&(this.browserUrlTree=Pe.extractedUrl),(0,Ze.of)(Pe).pipe(Jn(Hn=>{const Xi=this.transitions.getValue();return O.next(new Vi(Hn.id,this.serializeUrl(Hn.extractedUrl),Hn.source,Hn.restoredState)),Xi!==this.transitions.getValue()?Qe.E:Promise.resolve(Hn)}),function zn(D,S,M,O){return Jn(W=>function Sa(D,S,M,O,W){return new hs(D,S,M,O,W).apply()}(D,S,M,W.extractedUrl,O).pipe((0,mn.U)(ee=>Object.assign(Object.assign({},W),{urlAfterRedirects:ee}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Yt(Hn=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:Hn.urlAfterRedirects})}),function uu(D,S,M,O,W){return(0,Zn.z)(ee=>function ea(D,S,M,O,W="emptyOnly",ee="legacy"){try{const Ee=new Wr(D,S,M,O,W,ee).recognize();return null===Ee?Aa(new ho):(0,Ze.of)(Ee)}catch(Ee){return Aa(Ee)}}(D,S,ee.urlAfterRedirects,M(ee.urlAfterRedirects),O,W).pipe((0,mn.U)(Ee=>Object.assign(Object.assign({},ee),{targetSnapshot:Ee}))))}(this.rootComponentType,this.config,Hn=>this.serializeUrl(Hn),this.paramsInheritanceStrategy,this.relativeLinkResolution),Yt(Hn=>{if("eager"===this.urlUpdateStrategy){if(!Hn.extras.skipLocationChange){const Wi=this.urlHandlingStrategy.merge(Hn.urlAfterRedirects,Hn.rawUrl);this.setBrowserUrl(Wi,Hn)}this.browserUrlTree=Hn.urlAfterRedirects}const Xi=new xs(Hn.id,this.serializeUrl(Hn.extractedUrl),this.serializeUrl(Hn.urlAfterRedirects),Hn.targetSnapshot);O.next(Xi)}));if(cn&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Xi,extractedUrl:Wi,source:Io,restoredState:mo,extras:Pa}=Pe,Cc=new Vi(Xi,this.serializeUrl(Wi),Io,mo);O.next(Cc);const Wa=bo(Wi,this.rootComponentType).snapshot;return(0,Ze.of)(Object.assign(Object.assign({},Pe),{targetSnapshot:Wa,urlAfterRedirects:Wi,extras:Object.assign(Object.assign({},Pa),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=Pe.rawUrl,Pe.resolve(null),Qe.E}),ta(Pe=>{const{targetSnapshot:et,id:cn,extractedUrl:Ti,rawUrl:Hn,extras:{skipLocationChange:Xi,replaceUrl:Wi}}=Pe;return this.hooks.beforePreactivation(et,{navigationId:cn,appliedUrlTree:Ti,rawUrlTree:Hn,skipLocationChange:!!Xi,replaceUrl:!!Wi})}),Yt(Pe=>{const et=new Fo(Pe.id,this.serializeUrl(Pe.extractedUrl),this.serializeUrl(Pe.urlAfterRedirects),Pe.targetSnapshot);this.triggerEvent(et)}),(0,mn.U)(Pe=>Object.assign(Object.assign({},Pe),{guards:tc(Pe.targetSnapshot,Pe.currentSnapshot,this.rootContexts)})),function k(D,S){return(0,Zn.z)(M=>{const{targetSnapshot:O,currentSnapshot:W,guards:{canActivateChecks:ee,canDeactivateChecks:Ee}}=M;return 0===Ee.length&&0===ee.length?(0,Ze.of)(Object.assign(Object.assign({},M),{guardsResult:!0})):function P(D,S,M,O){return(0,F.D)(D).pipe((0,Zn.z)(W=>function Mi(D,S,M,O,W){const ee=S&&S.routeConfig?S.routeConfig.canDeactivate:null;if(!ee||0===ee.length)return(0,Ze.of)(!0);const Ee=ee.map(Pe=>{const et=hl(Pe,S,W);let cn;if(function To(D){return D&&Bs(D.canDeactivate)}(et))cn=Q(et.canDeactivate(D,S,M,O));else{if(!Bs(et))throw new Error("Invalid CanDeactivate guard");cn=Q(et(D,S,M,O))}return cn.pipe((0,ci.P)())});return(0,Ze.of)(Ee).pipe(Bo())}(W.component,W.route,M,S,O)),(0,ci.P)(W=>!0!==W,!0))}(Ee,O,W,D).pipe((0,Zn.z)(Pe=>Pe&&function rs(D){return"boolean"==typeof D}(Pe)?function se(D,S,M,O){return(0,F.D)(S).pipe((0,ht.b)(W=>rt(function Ct(D,S){return null!==D&&S&&S(new Zs(D)),(0,Ze.of)(!0)}(W.route.parent,O),function it(D,S){return null!==D&&S&&S(new lr(D)),(0,Ze.of)(!0)}(W.route,O),function Et(D,S,M){const O=S[S.length-1],ee=S.slice(0,S.length-1).reverse().map(Ee=>function Ac(D){const S=D.routeConfig?D.routeConfig.canActivateChild:null;return S&&0!==S.length?{node:D,guards:S}:null}(Ee)).filter(Ee=>null!==Ee).map(Ee=>on(()=>{const Pe=Ee.guards.map(et=>{const cn=hl(et,Ee.node,M);let Ti;if(function Va(D){return D&&Bs(D.canActivateChild)}(cn))Ti=Q(cn.canActivateChild(O,D));else{if(!Bs(cn))throw new Error("Invalid CanActivateChild guard");Ti=Q(cn(O,D))}return Ti.pipe((0,ci.P)())});return(0,Ze.of)(Pe).pipe(Bo())}));return(0,Ze.of)(ee).pipe(Bo())}(D,W.path,M),function pr(D,S,M){const O=S.routeConfig?S.routeConfig.canActivate:null;if(!O||0===O.length)return(0,Ze.of)(!0);const W=O.map(ee=>on(()=>{const Ee=hl(ee,S,M);let Pe;if(function uo(D){return D&&Bs(D.canActivate)}(Ee))Pe=Q(Ee.canActivate(S,D));else{if(!Bs(Ee))throw new Error("Invalid CanActivate guard");Pe=Q(Ee(S,D))}return Pe.pipe((0,ci.P)())}));return(0,Ze.of)(W).pipe(Bo())}(D,W.route,M))),(0,ci.P)(W=>!0!==W,!0))}(O,ee,D,S):(0,Ze.of)(Pe)),(0,mn.U)(Pe=>Object.assign(Object.assign({},M),{guardsResult:Pe})))})}(this.ngModule.injector,Pe=>this.triggerEvent(Pe)),Yt(Pe=>{if(eo(Pe.guardsResult)){const cn=J(`Redirecting to "${this.serializeUrl(Pe.guardsResult)}"`);throw cn.url=Pe.guardsResult,cn}const et=new Mr(Pe.id,this.serializeUrl(Pe.extractedUrl),this.serializeUrl(Pe.urlAfterRedirects),Pe.targetSnapshot,!!Pe.guardsResult);this.triggerEvent(et)}),(0,Je.h)(Pe=>!!Pe.guardsResult||(this.restoreHistory(Pe),this.cancelNavigationTransition(Pe,""),!1)),ta(Pe=>{if(Pe.guards.canActivateChecks.length)return(0,Ze.of)(Pe).pipe(Yt(et=>{const cn=new zr(et.id,this.serializeUrl(et.extractedUrl),this.serializeUrl(et.urlAfterRedirects),et.targetSnapshot);this.triggerEvent(cn)}),Jn(et=>{let cn=!1;return(0,Ze.of)(et).pipe(function Hu(D,S){return(0,Zn.z)(M=>{const{targetSnapshot:O,guards:{canActivateChecks:W}}=M;if(!W.length)return(0,Ze.of)(M);let ee=0;return(0,F.D)(W).pipe((0,ht.b)(Ee=>function zo(D,S,M,O){return function Ll(D,S,M,O){const W=dl(D);if(0===W.length)return(0,Ze.of)({});const ee={};return(0,F.D)(W).pipe((0,Zn.z)(Ee=>function Ol(D,S,M,O){const W=hl(D,S,O);return Q(W.resolve?W.resolve(S,M):W(S,M))}(D[Ee],S,M,O).pipe(Yt(Pe=>{ee[Ee]=Pe}))),yt(1),(0,Zn.z)(()=>dl(ee).length===W.length?(0,Ze.of)(ee):Qe.E))}(D._resolve,D,S,O).pipe((0,mn.U)(ee=>(D._resolvedData=ee,D.data=Object.assign(Object.assign({},D.data),No(D,M).resolve),null)))}(Ee.route,O,D,S)),Yt(()=>ee++),yt(1),(0,Zn.z)(Ee=>ee===W.length?(0,Ze.of)(M):Qe.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Yt({next:()=>cn=!0,complete:()=>{cn||(this.restoreHistory(et),this.cancelNavigationTransition(et,"At least one route resolver didn't emit any value."))}}))}),Yt(et=>{const cn=new ar(et.id,this.serializeUrl(et.extractedUrl),this.serializeUrl(et.urlAfterRedirects),et.targetSnapshot);this.triggerEvent(cn)}))}),ta(Pe=>{const{targetSnapshot:et,id:cn,extractedUrl:Ti,rawUrl:Hn,extras:{skipLocationChange:Xi,replaceUrl:Wi}}=Pe;return this.hooks.afterPreactivation(et,{navigationId:cn,appliedUrlTree:Ti,rawUrlTree:Hn,skipLocationChange:!!Xi,replaceUrl:!!Wi})}),(0,mn.U)(Pe=>{const et=function Ms(D,S,M){const O=bs(D,S._root,M?M._root:void 0);return new ls(O,S)}(this.routeReuseStrategy,Pe.targetSnapshot,Pe.currentRouterState);return Object.assign(Object.assign({},Pe),{targetRouterState:et})}),Yt(Pe=>{this.currentUrlTree=Pe.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(Pe.urlAfterRedirects,Pe.rawUrl),this.routerState=Pe.targetRouterState,"deferred"===this.urlUpdateStrategy&&(Pe.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,Pe),this.browserUrlTree=Pe.urlAfterRedirects)}),((D,S,M)=>(0,mn.U)(O=>(new Ba(S,O.targetRouterState,O.currentRouterState,M).activate(D),O)))(this.rootContexts,this.routeReuseStrategy,Pe=>this.triggerEvent(Pe)),Yt({next(){ee=!0},complete(){ee=!0}}),function tn(D){return(0,Cn.e)((S,M)=>{try{S.subscribe(M)}finally{M.add(D)}})}(()=>{var Pe;ee||Ee||this.cancelNavigationTransition(W,`Navigation ID ${W.id} is not equal to the current navigation id ${this.navigationId}`),(null===(Pe=this.currentNavigation)||void 0===Pe?void 0:Pe.id)===W.id&&(this.currentNavigation=null)}),tt(Pe=>{if(Ee=!0,function Z(D){return D&&D[Le]}(Pe)){const et=eo(Pe.url);et||(this.navigated=!0,this.restoreHistory(W,!0));const cn=new Tr(W.id,this.serializeUrl(W.extractedUrl),Pe.message);O.next(cn),et?setTimeout(()=>{const Ti=this.urlHandlingStrategy.merge(Pe.url,this.rawUrlTree),Hn={skipLocationChange:W.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||fu(W.source)};this.scheduleNavigation(Ti,"imperative",null,Hn,{resolve:W.resolve,reject:W.reject,promise:W.promise})},0):W.resolve(!1)}else{this.restoreHistory(W,!0);const et=new Ir(W.id,this.serializeUrl(W.extractedUrl),Pe);O.next(et);try{W.resolve(this.errorHandler(Pe))}catch(cn){W.reject(cn)}}return Qe.E}))}))}resetRootComponentType(M){this.rootComponentType=M,this.routerState.root.component=this.rootComponentType}setTransition(M){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),M))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(M=>{const O="popstate"===M.type?"popstate":"hashchange";"popstate"===O&&setTimeout(()=>{var W;const ee={replaceUrl:!0},Ee=(null===(W=M.state)||void 0===W?void 0:W.navigationId)?M.state:null;if(Ee){const et=Object.assign({},Ee);delete et.navigationId,delete et.\u0275routerPageId,0!==Object.keys(et).length&&(ee.state=et)}const Pe=this.parseUrl(M.url);this.scheduleNavigation(Pe,O,Ee,ee)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(M){this.events.next(M)}resetConfig(M){Ea(M),this.config=M.map(G),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(M,O={}){const{relativeTo:W,queryParams:ee,fragment:Ee,queryParamsHandling:Pe,preserveFragment:et}=O,cn=W||this.routerState.root,Ti=et?this.currentUrlTree.fragment:Ee;let Hn=null;switch(Pe){case"merge":Hn=Object.assign(Object.assign({},this.currentUrlTree.queryParams),ee);break;case"preserve":Hn=this.currentUrlTree.queryParams;break;default:Hn=ee||null}return null!==Hn&&(Hn=this.removeEmptyProps(Hn)),function is(D,S,M,O,W){if(0===M.length)return So(S.root,S.root,S.root,O,W);const ee=function ll(D){if("string"==typeof D[0]&&1===D.length&&"/"===D[0])return new al(!0,0,D);let S=0,M=!1;const O=D.reduce((W,ee,Ee)=>{if("object"==typeof ee&&null!=ee){if(ee.outlets){const Pe={};return Fe(ee.outlets,(et,cn)=>{Pe[cn]="string"==typeof et?et.split("/"):et}),[...W,{outlets:Pe}]}if(ee.segmentPath)return[...W,ee.segmentPath]}return"string"!=typeof ee?[...W,ee]:0===Ee?(ee.split("/").forEach((Pe,et)=>{0==et&&"."===Pe||(0==et&&""===Pe?M=!0:".."===Pe?S++:""!=Pe&&W.push(Pe))}),W):[...W,ee]},[]);return new al(M,S,O)}(M);if(ee.toRoot())return So(S.root,S.root,new je([],{}),O,W);const Ee=function Ua(D,S,M){if(D.isAbsolute)return new Js(S.root,!0,0);if(-1===M.snapshot._lastPathIndex){const ee=M.snapshot._urlSegment;return new Js(ee,ee===S.root,0)}const O=wo(D.commands[0])?0:1;return function Zo(D,S,M){let O=D,W=S,ee=M;for(;ee>W;){if(ee-=W,O=O.parent,!O)throw new Error("Invalid number of '../'");W=O.segments.length}return new Js(O,!1,W-ee)}(M.snapshot._urlSegment,M.snapshot._lastPathIndex+O,D.numberOfDoubleDots)}(ee,S,D),Pe=Ee.processChildren?Ko(Ee.segmentGroup,Ee.index,ee.commands):Us(Ee.segmentGroup,Ee.index,ee.commands);return So(S.root,Ee.segmentGroup,Pe,O,W)}(cn,this.currentUrlTree,M,Hn,null!=Ti?Ti:null)}navigateByUrl(M,O={skipLocationChange:!1}){const W=eo(M)?M:this.parseUrl(M),ee=this.urlHandlingStrategy.merge(W,this.rawUrlTree);return this.scheduleNavigation(ee,"imperative",null,O)}navigate(M,O={skipLocationChange:!1}){return function du(D){for(let S=0;S<D.length;S++){const M=D[S];if(null==M)throw new Error(`The requested path contains ${M} segment at index ${S}`)}}(M),this.navigateByUrl(this.createUrlTree(M,O),O)}serializeUrl(M){return this.urlSerializer.serialize(M)}parseUrl(M){let O;try{O=this.urlSerializer.parse(M)}catch(W){O=this.malformedUriErrorHandler(W,this.urlSerializer,M)}return O}isActive(M,O){let W;if(W=!0===O?Object.assign({},oc):!1===O?Object.assign({},Is):O,eo(M))return Kt(this.currentUrlTree,M,W);const ee=this.parseUrl(M);return Kt(this.currentUrlTree,ee,W)}removeEmptyProps(M){return Object.keys(M).reduce((O,W)=>{const ee=M[W];return null!=ee&&(O[W]=ee),O},{})}processNavigations(){this.navigations.subscribe(M=>{this.navigated=!0,this.lastSuccessfulId=M.id,this.currentPageId=M.targetPageId,this.events.next(new ir(M.id,this.serializeUrl(M.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,M.resolve(!0)},M=>{this.console.warn(`Unhandled Navigation Error: ${M}`)})}scheduleNavigation(M,O,W,ee,Ee){var Pe,et;if(this.disposed)return Promise.resolve(!1);let cn,Ti,Hn;Ee?(cn=Ee.resolve,Ti=Ee.reject,Hn=Ee.promise):Hn=new Promise((Io,mo)=>{cn=Io,Ti=mo});const Xi=++this.navigationId;let Wi;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(W=this.location.getState()),Wi=W&&W.\u0275routerPageId?W.\u0275routerPageId:ee.replaceUrl||ee.skipLocationChange?null!==(Pe=this.browserPageId)&&void 0!==Pe?Pe:0:(null!==(et=this.browserPageId)&&void 0!==et?et:0)+1):Wi=0,this.setTransition({id:Xi,targetPageId:Wi,source:O,restoredState:W,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:M,extras:ee,resolve:cn,reject:Ti,promise:Hn,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Hn.catch(Io=>Promise.reject(Io))}setBrowserUrl(M,O){const W=this.urlSerializer.serialize(M),ee=Object.assign(Object.assign({},O.extras.state),this.generateNgRouterState(O.id,O.targetPageId));this.location.isCurrentPathEqualTo(W)||O.extras.replaceUrl?this.location.replaceState(W,"",ee):this.location.go(W,"",ee)}restoreHistory(M,O=!1){var W,ee;if("computed"===this.canceledNavigationResolution){const Ee=this.currentPageId-M.targetPageId;"popstate"!==M.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(W=this.currentNavigation)||void 0===W?void 0:W.finalUrl)||0===Ee?this.currentUrlTree===(null===(ee=this.currentNavigation)||void 0===ee?void 0:ee.finalUrl)&&0===Ee&&(this.resetState(M),this.browserUrlTree=M.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(Ee)}else"replace"===this.canceledNavigationResolution&&(O&&this.resetState(M),this.resetUrlToCurrentUrlTree())}resetState(M){this.routerState=M.currentRouterState,this.currentUrlTree=M.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,M.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(M,O){const W=new Tr(M.id,this.serializeUrl(M.extractedUrl),O);this.triggerEvent(W),M.resolve(!1)}generateNgRouterState(M,O){return"computed"===this.canceledNavigationResolution?{navigationId:M,\u0275routerPageId:O}:{navigationId:M}}}return D.\u0275fac=function(M){N.$Z()},D.\u0275prov=N.Yz7({token:D,factory:D.\u0275fac}),D})();function fu(D){return"imperative"!==D}class pl{}class Go{preload(S,M){return(0,Ze.of)(null)}}let Da=(()=>{class D{constructor(M,O,W,ee){this.router=M,this.injector=W,this.preloadingStrategy=ee,this.loader=new Fl(W,O,et=>M.triggerEvent(new ts(et)),et=>M.triggerEvent(new Ts(et)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,Je.h)(M=>M instanceof ir),(0,ht.b)(()=>this.preload())).subscribe(()=>{})}preload(){const M=this.injector.get(N.h0i);return this.processRoutes(M,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(M,O){const W=[];for(const ee of O)if(ee.loadChildren&&!ee.canLoad&&ee._loadedConfig){const Ee=ee._loadedConfig;W.push(this.processRoutes(Ee.module,Ee.routes))}else ee.loadChildren&&!ee.canLoad?W.push(this.preloadConfig(M,ee)):ee.children&&W.push(this.processRoutes(M,ee.children));return(0,F.D)(W).pipe((0,ke.J)(),(0,mn.U)(ee=>{}))}preloadConfig(M,O){return this.preloadingStrategy.preload(O,()=>(O._loadedConfig?(0,Ze.of)(O._loadedConfig):this.loader.load(M.injector,O)).pipe((0,Zn.z)(ee=>(O._loadedConfig=ee,this.processRoutes(ee.module,ee.routes)))))}}return D.\u0275fac=function(M){return new(M||D)(N.LFG(Me),N.LFG(N.Sil),N.LFG(N.zs3),N.LFG(pl))},D.\u0275prov=N.Yz7({token:D,factory:D.\u0275fac}),D})(),Ra=(()=>{class D{constructor(M,O,W={}){this.router=M,this.viewportScroller=O,this.options=W,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},W.scrollPositionRestoration=W.scrollPositionRestoration||"disabled",W.anchorScrolling=W.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(M=>{M instanceof Vi?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=M.navigationTrigger,this.restoredId=M.restoredState?M.restoredState.navigationId:0):M instanceof ir&&(this.lastId=M.id,this.scheduleScrollEvent(M,this.router.parseUrl(M.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(M=>{M instanceof On&&(M.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(M.position):M.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(M.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(M,O){this.router.triggerEvent(new On(M,"popstate"===this.lastSource?this.store[this.restoredId]:null,O))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return D.\u0275fac=function(M){N.$Z()},D.\u0275prov=N.Yz7({token:D,factory:D.\u0275fac}),D})();const po=new N.OlP("ROUTER_CONFIGURATION"),Nl=new N.OlP("ROUTER_FORROOT_GUARD"),Ga=[Di.Ye,{provide:Jr,useClass:Yr},{provide:Me,useFactory:function Hi(D,S,M,O,W,ee,Ee={},Pe,et){const cn=new Me(null,D,S,M,O,W,Ie(ee));return Pe&&(cn.urlHandlingStrategy=Pe),et&&(cn.routeReuseStrategy=et),function Br(D,S){D.errorHandler&&(S.errorHandler=D.errorHandler),D.malformedUriErrorHandler&&(S.malformedUriErrorHandler=D.malformedUriErrorHandler),D.onSameUrlNavigation&&(S.onSameUrlNavigation=D.onSameUrlNavigation),D.paramsInheritanceStrategy&&(S.paramsInheritanceStrategy=D.paramsInheritanceStrategy),D.relativeLinkResolution&&(S.relativeLinkResolution=D.relativeLinkResolution),D.urlUpdateStrategy&&(S.urlUpdateStrategy=D.urlUpdateStrategy),D.canceledNavigationResolution&&(S.canceledNavigationResolution=D.canceledNavigationResolution)}(Ee,cn),Ee.enableTracing&&cn.events.subscribe(Ti=>{var Hn,Xi;null===(Hn=console.group)||void 0===Hn||Hn.call(console,`Router Event: ${Ti.constructor.name}`),console.log(Ti.toString()),console.log(Ti),null===(Xi=console.groupEnd)||void 0===Xi||Xi.call(console)}),cn},deps:[Jr,Co,Di.Ye,N.zs3,N.Sil,tr,po,[class Ta{},new N.FiY],[class sc{},new N.FiY]]},Co,{provide:Gr,useFactory:function Or(D){return D.routerState.root},deps:[Me]},Da,Go,class Ho{preload(S,M){return M().pipe(tt(()=>(0,Ze.of)(null)))}},{provide:po,useValue:{enableTracing:!1}}];function pu(){return new N.PXZ("Router",Me)}let Lh=(()=>{class D{constructor(M,O){}static forRoot(M,O){return{ngModule:D,providers:[Ga,Ro(M),{provide:Nl,useFactory:Wo,deps:[[Me,new N.FiY,new N.tp0]]},{provide:po,useValue:O||{}},{provide:Di.S$,useFactory:ac,deps:[Di.lw,[new N.tBr(Di.mr),new N.FiY],po]},{provide:Ra,useFactory:Ia,deps:[Me,Di.EM,po]},{provide:pl,useExisting:O&&O.preloadingStrategy?O.preloadingStrategy:Go},{provide:N.PXZ,multi:!0,useFactory:pu},[kl,{provide:N.ip1,multi:!0,useFactory:va,deps:[kl]},{provide:ha,useFactory:Ul,deps:[kl]},{provide:N.tb,multi:!0,useExisting:ha}]]}}static forChild(M){return{ngModule:D,providers:[Ro(M)]}}}return D.\u0275fac=function(M){return new(M||D)(N.LFG(Nl,8),N.LFG(Me,8))},D.\u0275mod=N.oAB({type:D}),D.\u0275inj=N.cJS({}),D})();function Ia(D,S,M){return M.scrollOffset&&S.setOffset(M.scrollOffset),new Ra(D,S,M)}function ac(D,S,M={}){return M.useHash?new Di.Do(D,S):new Di.b0(D,S)}function Wo(D){return"guarded"}function Ro(D){return[{provide:N.deG,multi:!0,useValue:D},{provide:tr,multi:!0,useValue:D}]}let kl=(()=>{class D{constructor(M){this.injector=M,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new mt.x}appInitializer(){return this.injector.get(Di.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let O=null;const W=new Promise(Pe=>O=Pe),ee=this.injector.get(Me),Ee=this.injector.get(po);return"disabled"===Ee.initialNavigation?(ee.setUpLocationChangeListener(),O(!0)):"enabled"===Ee.initialNavigation||"enabledBlocking"===Ee.initialNavigation?(ee.hooks.afterPreactivation=()=>this.initNavigation?(0,Ze.of)(null):(this.initNavigation=!0,O(!0),this.resultOfPreactivationDone),ee.initialNavigation()):O(!0),W})}bootstrapListener(M){const O=this.injector.get(po),W=this.injector.get(Da),ee=this.injector.get(Ra),Ee=this.injector.get(Me),Pe=this.injector.get(N.z2F);M===Pe.components[0]&&(("enabledNonBlocking"===O.initialNavigation||void 0===O.initialNavigation)&&Ee.initialNavigation(),W.setUpPreloading(),ee.init(),Ee.resetRootComponentType(Pe.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return D.\u0275fac=function(M){return new(M||D)(N.LFG(N.zs3))},D.\u0275prov=N.Yz7({token:D,factory:D.\u0275fac}),D})();function va(D){return D.appInitializer.bind(D)}function Ul(D){return D.bootstrapListener.bind(D)}const ha=new N.OlP("Router Initializer")},6682:(qn,Rt,ye)=>{ye.d(Rt,{$V:()=>wp,CP7:()=>Jh,D1R:()=>ue,DvJ:()=>_a,EJi:()=>Mh,F5T:()=>yo,FM8:()=>Et,Hyl:()=>Qa,Ilk:()=>gn,JOQ:()=>lc,KI_:()=>Ai,Kj0:()=>_o,LY2:()=>Fo,Ltg:()=>tr,M8C:()=>pr,Mig:()=>hp,N$j:()=>rd,NMF:()=>Cs,OdW:()=>sd,OoA:()=>On,Ox3:()=>Fa,PMe:()=>cp,Pa4:()=>Me,QRU:()=>zg,QmN:()=>mt,RsA:()=>Ze,SPe:()=>Vf,SUY:()=>yp,Syv:()=>Uo,TOt:()=>Xf,TUv:()=>lg,TlE:()=>de,Tme:()=>ws,TyD:()=>Lt,USm:()=>et,UY4:()=>pg,UlW:()=>wo,Vkp:()=>Mi,WMw:()=>ce,Wid:()=>Fu,Wl3:()=>ri,WwZ:()=>is,YBo:()=>bd,YLQ:()=>Xr,ZAu:()=>hc,Zp0:()=>fp,ZzF:()=>fo,_12:()=>Yu,_C8:()=>Zc,_Li:()=>fe,_fP:()=>Is,a$l:()=>vt,aH4:()=>Le,aLr:()=>Wo,aNw:()=>Bu,blk:()=>fg,cBI:()=>Q0,cJO:()=>vd,cLu:()=>kt,cPb:()=>Lo,cek:()=>nl,dSO:()=>Ts,dUE:()=>Nu,dd2:()=>Ta,dpR:()=>Ng,ehD:()=>bn,ejS:()=>ld,hH6:()=>Dl,iKG:()=>Fc,iLg:()=>Jc,iMs:()=>X0,iUV:()=>Kr,jFi:()=>Gn,jyz:()=>_l,kB5:()=>jl,m7l:()=>Uu,nls:()=>aa,pBf:()=>zi,qlB:()=>wt,qyh:()=>he,rDY:()=>kd,rpg:()=>lr,u9r:()=>hi,uWy:()=>fi,vBJ:()=>u,vpT:()=>If,wem:()=>Z,woe:()=>Wf,x12:()=>fc,xEZ:()=>ua,xeV:()=>ed,xo$:()=>qc,xoR:()=>Md,xsS:()=>Qh,y8_:()=>i_,yC1:()=>ku,yGw:()=>Fi,z$h:()=>Eo,zHn:()=>ha});var N=ye(5861);const Ze={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},mt={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ri=0,fe=1,bn=2,Gn=0,ce=2,Fo=4,Ts=303,lr=1e3,fi=1001,On=1002,Lt=1003,Xr=1004,Le=1005,Z=1006,he=1007,ue=1008,Ie=1009,Ve=1014,st=1015,kt=1016,jt=1020,Oe=1023,He=1026,je=1027,Uo=2300,Cs=2301,is=0,wo=1,Eo=2,ks=3001,Ai="srgb",Us="srgb-linear",Ko="display-p3",H=35044,rr=2e3;class zi{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const o=this._listeners[e];if(void 0!==o){const l=o.indexOf(t);-1!==l&&o.splice(l,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const r=this._listeners[e.type];if(void 0!==r){e.target=this;const o=r.slice(0);for(let l=0,f=o.length;l<f;l++)o[l].call(this,e);e.target=null}}}const Ar=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let io=1234567;const ur=Math.PI/180,fr=180/Math.PI;function kr(){const c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ar[255&c]+Ar[c>>8&255]+Ar[c>>16&255]+Ar[c>>24&255]+"-"+Ar[255&e]+Ar[e>>8&255]+"-"+Ar[e>>16&15|64]+Ar[e>>24&255]+"-"+Ar[63&t|128]+Ar[t>>8&255]+"-"+Ar[t>>16&255]+Ar[t>>24&255]+Ar[255&r]+Ar[r>>8&255]+Ar[r>>16&255]+Ar[r>>24&255]).toLowerCase()}function vr(c,e,t){return Math.max(e,Math.min(t,c))}function Sa(c,e){return(c%e+e)%e}function Vo(c,e,t){return(1-t)*c+t*e}function B(c){return 0==(c&c-1)&&0!==c}function k(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function P(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}function it(c,e){switch(e.constructor){case Float32Array:return c;case Uint32Array:return c/4294967295;case Uint16Array:return c/65535;case Uint8Array:return c/255;case Int32Array:return Math.max(c/2147483647,-1);case Int16Array:return Math.max(c/32767,-1);case Int8Array:return Math.max(c/127,-1);default:throw new Error("Invalid component type.")}}function Ct(c,e){switch(e.constructor){case Float32Array:return c;case Uint32Array:return Math.round(4294967295*c);case Uint16Array:return Math.round(65535*c);case Uint8Array:return Math.round(255*c);case Int32Array:return Math.round(2147483647*c);case Int16Array:return Math.round(32767*c);case Int8Array:return Math.round(127*c);default:throw new Error("Invalid component type.")}}const pr={DEG2RAD:ur,RAD2DEG:fr,generateUUID:kr,clamp:vr,euclideanModulo:Sa,mapLinear:function hs(c,e,t,r,o){return r+(c-e)*(o-r)/(t-e)},inverseLerp:function ss(c,e,t){return c!==e?(t-c)/(e-c):0},lerp:Vo,damp:function zn(c,e,t,r){return Vo(c,e,1-Math.exp(-t*r))},pingpong:function Rl(c,e=1){return e-Math.abs(Sa(c,2*e)-e)},smoothstep:function ul(c,e,t){return c<=e?0:c>=t?1:(c=(c-e)/(t-e))*c*(3-2*c)},smootherstep:function tc(c,e,t){return c<=e?0:c>=t?1:(c=(c-e)/(t-e))*c*c*(c*(6*c-15)+10)},randInt:function Ac(c,e){return c+Math.floor(Math.random()*(e-c+1))},randFloat:function hl(c,e){return c+Math.random()*(e-c)},randFloatSpread:function nc(c){return c*(.5-Math.random())},seededRandom:function Il(c){void 0!==c&&(io=c);let e=io+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function lu(c){return c*ur},radToDeg:function Gt(c){return c*fr},isPowerOfTwo:B,ceilPowerOfTwo:k,floorPowerOfTwo:P,setQuaternionFromProperEuler:function se(c,e,t,r,o){const l=Math.cos,f=Math.sin,p=l(t/2),y=f(t/2),_=l((e+r)/2),w=f((e+r)/2),T=l((e-r)/2),C=f((e-r)/2),R=l((r-e)/2),U=f((r-e)/2);switch(o){case"XYX":c.set(p*w,y*T,y*C,p*_);break;case"YZY":c.set(y*C,p*w,y*T,p*_);break;case"ZXZ":c.set(y*T,y*C,p*w,p*_);break;case"XZX":c.set(p*w,y*U,y*R,p*_);break;case"YXY":c.set(y*R,p*w,y*U,p*_);break;case"ZYZ":c.set(y*U,y*R,p*w,p*_);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}},normalize:Ct,denormalize:it};class Et{constructor(e=0,t=0){Et.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6],this.y=o[1]*t+o[4]*r+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(vr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),o=Math.sin(t),l=this.x-e.x,f=this.y-e.y;return this.x=l*r-f*o+e.x,this.y=l*o+f*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Mi{constructor(e,t,r,o,l,f,p,y,_){Mi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,o,l,f,p,y,_)}set(e,t,r,o,l,f,p,y,_){const w=this.elements;return w[0]=e,w[1]=o,w[2]=p,w[3]=t,w[4]=l,w[5]=y,w[6]=r,w[7]=f,w[8]=_,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,o=t.elements,l=this.elements,f=r[0],p=r[3],y=r[6],_=r[1],w=r[4],T=r[7],C=r[2],R=r[5],U=r[8],$=o[0],z=o[3],L=o[6],te=o[1],X=o[4],ae=o[7],ve=o[2],Te=o[5],De=o[8];return l[0]=f*$+p*te+y*ve,l[3]=f*z+p*X+y*Te,l[6]=f*L+p*ae+y*De,l[1]=_*$+w*te+T*ve,l[4]=_*z+w*X+T*Te,l[7]=_*L+w*ae+T*De,l[2]=C*$+R*te+U*ve,l[5]=C*z+R*X+U*Te,l[8]=C*L+R*ae+U*De,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],o=e[2],l=e[3],f=e[4],p=e[5],y=e[6],_=e[7],w=e[8];return t*f*w-t*p*_-r*l*w+r*p*y+o*l*_-o*f*y}invert(){const e=this.elements,t=e[0],r=e[1],o=e[2],l=e[3],f=e[4],p=e[5],y=e[6],_=e[7],w=e[8],T=w*f-p*_,C=p*y-w*l,R=_*l-f*y,U=t*T+r*C+o*R;if(0===U)return this.set(0,0,0,0,0,0,0,0,0);const $=1/U;return e[0]=T*$,e[1]=(o*_-w*r)*$,e[2]=(p*r-o*f)*$,e[3]=C*$,e[4]=(w*t-o*y)*$,e[5]=(o*l-p*t)*$,e[6]=R*$,e[7]=(r*y-_*t)*$,e[8]=(f*t-r*l)*$,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,o,l,f,p){const y=Math.cos(l),_=Math.sin(l);return this.set(r*y,r*_,-r*(y*f+_*p)+f+e,-o*_,o*y,-o*(-_*f+y*p)+p+t,0,0,1),this}scale(e,t){return this.premultiply(ho.makeScale(e,t)),this}rotate(e){return this.premultiply(ho.makeRotation(-e)),this}translate(e,t){return this.premultiply(ho.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let o=0;o<9;o++)if(t[o]!==r[o])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const ho=new Mi;function Aa(c){for(let e=c.length-1;e>=0;--e)if(c[e]>=65535)return!0;return!1}function Rs(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const ic={};function ps(c){c in ic||(ic[c]=!0,console.warn(c))}function Lr(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function rc(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}const Tc=(new Mi).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Pl=(new Mi).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),uu={[Us]:c=>c,[Ai]:c=>c.convertSRGBToLinear(),[Ko]:function cu(c){return c.convertSRGBToLinear().applyMatrix3(Pl)}},Hu={[Us]:c=>c,[Ai]:c=>c.convertLinearToSRGB(),[Ko]:function za(c){return c.applyMatrix3(Tc).convertLinearToSRGB()}},zo={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(c){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!c},get workingColorSpace(){return Us},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,e,t){if(!1===this.enabled||e===t||!e||!t)return c;const r=uu[e],o=Hu[t];if(void 0===r||void 0===o)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return o(r(c))},fromWorkingColorSpace:function(c,e){return this.convert(c,this.workingColorSpace,e)},toWorkingColorSpace:function(c,e){return this.convert(c,e,this.workingColorSpace)}};let Ll;class dl{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ll&&(Ll=Rs("canvas")),Ll.width=e.width,Ll.height=e.height;const r=Ll.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Ll}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Rs("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const o=r.getImageData(0,0,e.width,e.height),l=o.data;for(let f=0;f<l.length;f++)l[f]=255*Lr(l[f]/255);return r.putImageData(o,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t[r]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Lr(t[r]/255)):Lr(t[r]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Ol=0;class ta{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ol++}),this.uuid=kr(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},o=this.data;if(null!==o){let l;if(Array.isArray(o)){l=[];for(let f=0,p=o.length;f<p;f++)l.push(sc(o[f].isDataTexture?o[f].image:o[f]))}else l=sc(o);r.url=l}return t||(e.images[this.uuid]=r),r}}function sc(c){return"undefined"!=typeof HTMLImageElement&&c instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&c instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&c instanceof ImageBitmap?dl.getDataURL(c):c.data?{data:Array.from(c.data),width:c.width,height:c.height,type:c.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let hu=0,ua=(()=>{class c extends zi{constructor(t=c.DEFAULT_IMAGE,r=c.DEFAULT_MAPPING,o=fi,l=fi,f=Z,p=ue,y=Oe,_=Ie,w=c.DEFAULT_ANISOTROPY,T=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hu++}),this.uuid=kr(),this.name="",this.source=new ta(t),this.mipmaps=[],this.mapping=r,this.channel=0,this.wrapS=o,this.wrapT=l,this.magFilter=f,this.minFilter=p,this.anisotropy=w,this.format=y,this.internalFormat=null,this.type=_,this.offset=new Et(0,0),this.repeat=new Et(1,1),this.center=new Et(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Mi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof T?this.colorSpace=T:(ps("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=T===ks?Ai:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const r=void 0===t||"string"==typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const o={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(o.userData=this.userData),r||(t.textures[this.uuid]=o),o}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case lr:t.x=t.x-Math.floor(t.x);break;case fi:t.x=t.x<0?0:1;break;case On:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case lr:t.y=t.y-Math.floor(t.y);break;case fi:t.y=t.y<0?0:1;break;case On:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ps("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Ai?ks:3e3}set encoding(t){ps("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===ks?Ai:""}}return c.DEFAULT_IMAGE=null,c.DEFAULT_MAPPING=300,c.DEFAULT_ANISOTROPY=1,c})();class tr{constructor(e=0,t=0,r=0,o=1){tr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,o){return this.x=e,this.y=t,this.z=r,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,o=this.z,l=this.w,f=e.elements;return this.x=f[0]*t+f[4]*r+f[8]*o+f[12]*l,this.y=f[1]*t+f[5]*r+f[9]*o+f[13]*l,this.z=f[2]*t+f[6]*r+f[10]*o+f[14]*l,this.w=f[3]*t+f[7]*r+f[11]*o+f[15]*l,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,o,l;const y=e.elements,_=y[0],w=y[4],T=y[8],C=y[1],R=y[5],U=y[9],$=y[2],z=y[6],L=y[10];if(Math.abs(w-C)<.01&&Math.abs(T-$)<.01&&Math.abs(U-z)<.01){if(Math.abs(w+C)<.1&&Math.abs(T+$)<.1&&Math.abs(U+z)<.1&&Math.abs(_+R+L-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const X=(_+1)/2,ae=(R+1)/2,ve=(L+1)/2,Te=(w+C)/4,De=(T+$)/4,We=(U+z)/4;return X>ae&&X>ve?X<.01?(r=0,o=.707106781,l=.707106781):(r=Math.sqrt(X),o=Te/r,l=De/r):ae>ve?ae<.01?(r=.707106781,o=0,l=.707106781):(o=Math.sqrt(ae),r=Te/o,l=We/o):ve<.01?(r=.707106781,o=.707106781,l=0):(l=Math.sqrt(ve),r=De/l,o=We/l),this.set(r,o,l,t),this}let te=Math.sqrt((z-U)*(z-U)+(T-$)*(T-$)+(C-w)*(C-w));return Math.abs(te)<.001&&(te=1),this.x=(z-U)/te,this.y=(T-$)/te,this.z=(C-w)/te,this.w=Math.acos((_+R+L-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Fl extends zi{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new tr(0,0,e,t),this.scissorTest=!1,this.viewport=new tr(0,0,e,t);const o={width:e,height:t,depth:1};void 0!==r.encoding&&(ps("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===ks?Ai:""),this.texture=new ua(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:Z,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,this.samples=void 0!==r.samples?r.samples:0}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ta(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ta extends Fl{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class Vs extends ua{constructor(e=null,t=1,r=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:o},this.magFilter=Lt,this.minFilter=Lt,this.wrapR=fi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ur extends ua{constructor(e=null,t=1,r=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:o},this.magFilter=Lt,this.minFilter=Lt,this.wrapR=fi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Is{constructor(e=0,t=0,r=0,o=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=o}static slerpFlat(e,t,r,o,l,f,p){let y=r[o+0],_=r[o+1],w=r[o+2],T=r[o+3];const C=l[f+0],R=l[f+1],U=l[f+2],$=l[f+3];if(0===p)return e[t+0]=y,e[t+1]=_,e[t+2]=w,void(e[t+3]=T);if(1===p)return e[t+0]=C,e[t+1]=R,e[t+2]=U,void(e[t+3]=$);if(T!==$||y!==C||_!==R||w!==U){let z=1-p;const L=y*C+_*R+w*U+T*$,te=L>=0?1:-1,X=1-L*L;if(X>Number.EPSILON){const ve=Math.sqrt(X),Te=Math.atan2(ve,L*te);z=Math.sin(z*Te)/ve,p=Math.sin(p*Te)/ve}const ae=p*te;if(y=y*z+C*ae,_=_*z+R*ae,w=w*z+U*ae,T=T*z+$*ae,z===1-p){const ve=1/Math.sqrt(y*y+_*_+w*w+T*T);y*=ve,_*=ve,w*=ve,T*=ve}}e[t]=y,e[t+1]=_,e[t+2]=w,e[t+3]=T}static multiplyQuaternionsFlat(e,t,r,o,l,f){const p=r[o],y=r[o+1],_=r[o+2],w=r[o+3],T=l[f],C=l[f+1],R=l[f+2],U=l[f+3];return e[t]=p*U+w*T+y*R-_*C,e[t+1]=y*U+w*C+_*T-p*R,e[t+2]=_*U+w*R+p*C-y*T,e[t+3]=w*U-p*T-y*C-_*R,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,o){return this._x=e,this._y=t,this._z=r,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,o=e._y,l=e._z,f=e._order,p=Math.cos,y=Math.sin,_=p(r/2),w=p(o/2),T=p(l/2),C=y(r/2),R=y(o/2),U=y(l/2);switch(f){case"XYZ":this._x=C*w*T+_*R*U,this._y=_*R*T-C*w*U,this._z=_*w*U+C*R*T,this._w=_*w*T-C*R*U;break;case"YXZ":this._x=C*w*T+_*R*U,this._y=_*R*T-C*w*U,this._z=_*w*U-C*R*T,this._w=_*w*T+C*R*U;break;case"ZXY":this._x=C*w*T-_*R*U,this._y=_*R*T+C*w*U,this._z=_*w*U+C*R*T,this._w=_*w*T-C*R*U;break;case"ZYX":this._x=C*w*T-_*R*U,this._y=_*R*T+C*w*U,this._z=_*w*U-C*R*T,this._w=_*w*T+C*R*U;break;case"YZX":this._x=C*w*T+_*R*U,this._y=_*R*T+C*w*U,this._z=_*w*U-C*R*T,this._w=_*w*T-C*R*U;break;case"XZY":this._x=C*w*T-_*R*U,this._y=_*R*T-C*w*U,this._z=_*w*U+C*R*T,this._w=_*w*T+C*R*U;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,o=Math.sin(r);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],o=t[4],l=t[8],f=t[1],p=t[5],y=t[9],_=t[2],w=t[6],T=t[10],C=r+p+T;if(C>0){const R=.5/Math.sqrt(C+1);this._w=.25/R,this._x=(w-y)*R,this._y=(l-_)*R,this._z=(f-o)*R}else if(r>p&&r>T){const R=2*Math.sqrt(1+r-p-T);this._w=(w-y)/R,this._x=.25*R,this._y=(o+f)/R,this._z=(l+_)/R}else if(p>T){const R=2*Math.sqrt(1+p-r-T);this._w=(l-_)/R,this._x=(o+f)/R,this._y=.25*R,this._z=(y+w)/R}else{const R=2*Math.sqrt(1+T-r-p);this._w=(f-o)/R,this._x=(l+_)/R,this._y=(y+w)/R,this._z=.25*R}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(vr(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const o=Math.min(1,t/r);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,o=e._y,l=e._z,f=e._w,p=t._x,y=t._y,_=t._z,w=t._w;return this._x=r*w+f*p+o*_-l*y,this._y=o*w+f*y+l*p-r*_,this._z=l*w+f*_+r*y-o*p,this._w=f*w-r*p-o*y-l*_,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,o=this._y,l=this._z,f=this._w;let p=f*e._w+r*e._x+o*e._y+l*e._z;if(p<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,p=-p):this.copy(e),p>=1)return this._w=f,this._x=r,this._y=o,this._z=l,this;const y=1-p*p;if(y<=Number.EPSILON){const R=1-t;return this._w=R*f+t*this._w,this._x=R*r+t*this._x,this._y=R*o+t*this._y,this._z=R*l+t*this._z,this.normalize(),this._onChangeCallback(),this}const _=Math.sqrt(y),w=Math.atan2(_,p),T=Math.sin((1-t)*w)/_,C=Math.sin(t*w)/_;return this._w=f*T+this._w*C,this._x=r*T+this._x*C,this._y=o*T+this._y*C,this._z=l*T+this._z*C,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),o=2*Math.PI*Math.random(),l=2*Math.PI*Math.random();return this.set(t*Math.cos(o),r*Math.sin(l),r*Math.cos(l),t*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Me{constructor(e=0,t=0,r=0){Me.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(fu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(fu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,o=this.z,l=e.elements;return this.x=l[0]*t+l[3]*r+l[6]*o,this.y=l[1]*t+l[4]*r+l[7]*o,this.z=l[2]*t+l[5]*r+l[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,o=this.z,l=e.elements,f=1/(l[3]*t+l[7]*r+l[11]*o+l[15]);return this.x=(l[0]*t+l[4]*r+l[8]*o+l[12])*f,this.y=(l[1]*t+l[5]*r+l[9]*o+l[13])*f,this.z=(l[2]*t+l[6]*r+l[10]*o+l[14])*f,this}applyQuaternion(e){const t=this.x,r=this.y,o=this.z,l=e.x,f=e.y,p=e.z,y=e.w,_=y*t+f*o-p*r,w=y*r+p*t-l*o,T=y*o+l*r-f*t,C=-l*t-f*r-p*o;return this.x=_*y+C*-l+w*-p-T*-f,this.y=w*y+C*-f+T*-l-_*-p,this.z=T*y+C*-p+_*-f-w*-l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,o=this.z,l=e.elements;return this.x=l[0]*t+l[4]*r+l[8]*o,this.y=l[1]*t+l[5]*r+l[9]*o,this.z=l[2]*t+l[6]*r+l[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,o=e.y,l=e.z,f=t.x,p=t.y,y=t.z;return this.x=o*y-l*p,this.y=l*f-r*y,this.z=r*p-o*f,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return du.copy(this).projectOnVector(e),this.sub(du)}reflect(e){return this.sub(du.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(vr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,o=this.z-e.z;return t*t+r*r+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const o=Math.sin(t)*e;return this.x=o*Math.sin(r),this.y=Math.cos(t)*e,this.z=o*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const du=new Me,fu=new Is;class fo{constructor(e=new Me(1/0,1/0,1/0),t=new Me(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(zs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(zs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=zs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Ha.copy(e.boundingBox),Ha.applyMatrix4(e.matrixWorld),this.union(Ha);else{const o=e.geometry;if(void 0!==o)if(t&&void 0!==o.attributes&&void 0!==o.attributes.position){const l=o.attributes.position;for(let f=0,p=l.count;f<p;f++)zs.fromBufferAttribute(l,f).applyMatrix4(e.matrixWorld),this.expandByPoint(zs)}else null===o.boundingBox&&o.computeBoundingBox(),Ha.copy(o.boundingBox),Ha.applyMatrix4(e.matrixWorld),this.union(Ha)}const r=e.children;for(let o=0,l=r.length;o<l;o++)this.expandByObject(r[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,zs),zs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(na),po.subVectors(this.max,na),fl.subVectors(e.a,na),pl.subVectors(e.b,na),Ho.subVectors(e.c,na),Go.subVectors(pl,fl),Da.subVectors(Ho,pl),Ra.subVectors(fl,Ho);let t=[0,-Go.z,Go.y,0,-Da.z,Da.y,0,-Ra.z,Ra.y,Go.z,0,-Go.x,Da.z,0,-Da.x,Ra.z,0,-Ra.x,-Go.y,Go.x,0,-Da.y,Da.x,0,-Ra.y,Ra.x,0];return!(!pu(t,fl,pl,Ho,po)||(t=[1,0,0,0,1,0,0,0,1],!pu(t,fl,pl,Ho,po)))&&(Nl.crossVectors(Go,Da),t=[Nl.x,Nl.y,Nl.z],pu(t,fl,pl,Ho,po))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,zs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(zs).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Do[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Do[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Do[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Do[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Do[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Do[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Do[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Do[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Do)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Do=[new Me,new Me,new Me,new Me,new Me,new Me,new Me,new Me],zs=new Me,Ha=new fo,fl=new Me,pl=new Me,Ho=new Me,Go=new Me,Da=new Me,Ra=new Me,na=new Me,po=new Me,Nl=new Me,Ga=new Me;function pu(c,e,t,r,o){for(let l=0,f=c.length-3;l<=f;l+=3){Ga.fromArray(c,l);const p=o.x*Math.abs(Ga.x)+o.y*Math.abs(Ga.y)+o.z*Math.abs(Ga.z),y=e.dot(Ga),_=t.dot(Ga),w=r.dot(Ga);if(Math.max(-Math.max(y,_,w),Math.min(y,_,w))>p)return!1}return!0}const Lh=new fo,Ia=new Me,ac=new Me;class Wo{constructor(e=new Me,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):Lh.setFromPoints(e).getCenter(r);let o=0;for(let l=0,f=e.length;l<f;l++)o=Math.max(o,r.distanceToSquared(e[l]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ia.subVectors(e,this.center);const t=Ia.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),o=.5*(r-this.radius);this.center.addScaledVector(Ia,o/r),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(ac.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ia.copy(e.center).add(ac)),this.expandByPoint(Ia.copy(e.center).sub(ac))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ro=new Me,Hi=new Me,Br=new Me,Or=new Me,kl=new Me,va=new Me,Ul=new Me;class ha{constructor(e=new Me,t=new Me(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ro)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ro.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ro.copy(this.origin).addScaledVector(this.direction,t),Ro.distanceToSquared(e))}distanceSqToSegment(e,t,r,o){Hi.copy(e).add(t).multiplyScalar(.5),Br.copy(t).sub(e).normalize(),Or.copy(this.origin).sub(Hi);const l=.5*e.distanceTo(t),f=-this.direction.dot(Br),p=Or.dot(this.direction),y=-Or.dot(Br),_=Or.lengthSq(),w=Math.abs(1-f*f);let T,C,R,U;if(w>0)if(T=f*y-p,C=f*p-y,U=l*w,T>=0)if(C>=-U)if(C<=U){const $=1/w;T*=$,C*=$,R=T*(T+f*C+2*p)+C*(f*T+C+2*y)+_}else C=l,T=Math.max(0,-(f*C+p)),R=-T*T+C*(C+2*y)+_;else C=-l,T=Math.max(0,-(f*C+p)),R=-T*T+C*(C+2*y)+_;else C<=-U?(T=Math.max(0,-(-f*l+p)),C=T>0?-l:Math.min(Math.max(-l,-y),l),R=-T*T+C*(C+2*y)+_):C<=U?(T=0,C=Math.min(Math.max(-l,-y),l),R=C*(C+2*y)+_):(T=Math.max(0,-(f*l+p)),C=T>0?l:Math.min(Math.max(-l,-y),l),R=-T*T+C*(C+2*y)+_);else C=f>0?-l:l,T=Math.max(0,-(f*C+p)),R=-T*T+C*(C+2*y)+_;return r&&r.copy(this.origin).addScaledVector(this.direction,T),o&&o.copy(Hi).addScaledVector(Br,C),R}intersectSphere(e,t){Ro.subVectors(e.center,this.origin);const r=Ro.dot(this.direction),o=Ro.dot(Ro)-r*r,l=e.radius*e.radius;if(o>l)return null;const f=Math.sqrt(l-o),p=r-f,y=r+f;return y<0?null:this.at(p<0?y:p,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,o,l,f,p,y;const _=1/this.direction.x,w=1/this.direction.y,T=1/this.direction.z,C=this.origin;return _>=0?(r=(e.min.x-C.x)*_,o=(e.max.x-C.x)*_):(r=(e.max.x-C.x)*_,o=(e.min.x-C.x)*_),w>=0?(l=(e.min.y-C.y)*w,f=(e.max.y-C.y)*w):(l=(e.max.y-C.y)*w,f=(e.min.y-C.y)*w),r>f||l>o||((l>r||isNaN(r))&&(r=l),(f<o||isNaN(o))&&(o=f),T>=0?(p=(e.min.z-C.z)*T,y=(e.max.z-C.z)*T):(p=(e.max.z-C.z)*T,y=(e.min.z-C.z)*T),r>y||p>o)||((p>r||r!=r)&&(r=p),(y<o||o!=o)&&(o=y),o<0)?null:this.at(r>=0?r:o,t)}intersectsBox(e){return null!==this.intersectBox(e,Ro)}intersectTriangle(e,t,r,o,l){kl.subVectors(t,e),va.subVectors(r,e),Ul.crossVectors(kl,va);let p,f=this.direction.dot(Ul);if(f>0){if(o)return null;p=1}else{if(!(f<0))return null;p=-1,f=-f}Or.subVectors(this.origin,e);const y=p*this.direction.dot(va.crossVectors(Or,va));if(y<0)return null;const _=p*this.direction.dot(kl.cross(Or));if(_<0||y+_>f)return null;const w=-p*Or.dot(Ul);return w<0?null:this.at(w/f,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Fi{constructor(e,t,r,o,l,f,p,y,_,w,T,C,R,U,$,z){Fi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,o,l,f,p,y,_,w,T,C,R,U,$,z)}set(e,t,r,o,l,f,p,y,_,w,T,C,R,U,$,z){const L=this.elements;return L[0]=e,L[4]=t,L[8]=r,L[12]=o,L[1]=l,L[5]=f,L[9]=p,L[13]=y,L[2]=_,L[6]=w,L[10]=T,L[14]=C,L[3]=R,L[7]=U,L[11]=$,L[15]=z,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Fi).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,o=1/ml.setFromMatrixColumn(e,0).length(),l=1/ml.setFromMatrixColumn(e,1).length(),f=1/ml.setFromMatrixColumn(e,2).length();return t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=0,t[4]=r[4]*l,t[5]=r[5]*l,t[6]=r[6]*l,t[7]=0,t[8]=r[8]*f,t[9]=r[9]*f,t[10]=r[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,o=e.y,l=e.z,f=Math.cos(r),p=Math.sin(r),y=Math.cos(o),_=Math.sin(o),w=Math.cos(l),T=Math.sin(l);if("XYZ"===e.order){const C=f*w,R=f*T,U=p*w,$=p*T;t[0]=y*w,t[4]=-y*T,t[8]=_,t[1]=R+U*_,t[5]=C-$*_,t[9]=-p*y,t[2]=$-C*_,t[6]=U+R*_,t[10]=f*y}else if("YXZ"===e.order){const C=y*w,R=y*T,U=_*w,$=_*T;t[0]=C+$*p,t[4]=U*p-R,t[8]=f*_,t[1]=f*T,t[5]=f*w,t[9]=-p,t[2]=R*p-U,t[6]=$+C*p,t[10]=f*y}else if("ZXY"===e.order){const C=y*w,R=y*T,U=_*w,$=_*T;t[0]=C-$*p,t[4]=-f*T,t[8]=U+R*p,t[1]=R+U*p,t[5]=f*w,t[9]=$-C*p,t[2]=-f*_,t[6]=p,t[10]=f*y}else if("ZYX"===e.order){const C=f*w,R=f*T,U=p*w,$=p*T;t[0]=y*w,t[4]=U*_-R,t[8]=C*_+$,t[1]=y*T,t[5]=$*_+C,t[9]=R*_-U,t[2]=-_,t[6]=p*y,t[10]=f*y}else if("YZX"===e.order){const C=f*y,R=f*_,U=p*y,$=p*_;t[0]=y*w,t[4]=$-C*T,t[8]=U*T+R,t[1]=T,t[5]=f*w,t[9]=-p*w,t[2]=-_*w,t[6]=R*T+U,t[10]=C-$*T}else if("XZY"===e.order){const C=f*y,R=f*_,U=p*y,$=p*_;t[0]=y*w,t[4]=-T,t[8]=_*w,t[1]=C*T+$,t[5]=f*w,t[9]=R*T-U,t[2]=U*T-R,t[6]=p*w,t[10]=$*T+C}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(S,e,M)}lookAt(e,t,r){const o=this.elements;return ee.subVectors(e,t),0===ee.lengthSq()&&(ee.z=1),ee.normalize(),O.crossVectors(r,ee),0===O.lengthSq()&&(1===Math.abs(r.z)?ee.x+=1e-4:ee.z+=1e-4,ee.normalize(),O.crossVectors(r,ee)),O.normalize(),W.crossVectors(ee,O),o[0]=O.x,o[4]=W.x,o[8]=ee.x,o[1]=O.y,o[5]=W.y,o[9]=ee.y,o[2]=O.z,o[6]=W.z,o[10]=ee.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,o=t.elements,l=this.elements,f=r[0],p=r[4],y=r[8],_=r[12],w=r[1],T=r[5],C=r[9],R=r[13],U=r[2],$=r[6],z=r[10],L=r[14],te=r[3],X=r[7],ae=r[11],ve=r[15],Te=o[0],De=o[4],We=o[8],le=o[12],Se=o[1],bt=o[5],qt=o[9],ct=o[13],dt=o[2],xt=o[6],Zt=o[10],Pt=o[14],Bt=o[3],en=o[7],nn=o[11],at=o[15];return l[0]=f*Te+p*Se+y*dt+_*Bt,l[4]=f*De+p*bt+y*xt+_*en,l[8]=f*We+p*qt+y*Zt+_*nn,l[12]=f*le+p*ct+y*Pt+_*at,l[1]=w*Te+T*Se+C*dt+R*Bt,l[5]=w*De+T*bt+C*xt+R*en,l[9]=w*We+T*qt+C*Zt+R*nn,l[13]=w*le+T*ct+C*Pt+R*at,l[2]=U*Te+$*Se+z*dt+L*Bt,l[6]=U*De+$*bt+z*xt+L*en,l[10]=U*We+$*qt+z*Zt+L*nn,l[14]=U*le+$*ct+z*Pt+L*at,l[3]=te*Te+X*Se+ae*dt+ve*Bt,l[7]=te*De+X*bt+ae*xt+ve*en,l[11]=te*We+X*qt+ae*Zt+ve*nn,l[15]=te*le+X*ct+ae*Pt+ve*at,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],o=e[8],l=e[12],f=e[1],p=e[5],y=e[9],_=e[13],w=e[2],T=e[6],C=e[10],R=e[14];return e[3]*(+l*y*T-o*_*T-l*p*C+r*_*C+o*p*R-r*y*R)+e[7]*(+t*y*R-t*_*C+l*f*C-o*f*R+o*_*w-l*y*w)+e[11]*(+t*_*T-t*p*R-l*f*T+r*f*R+l*p*w-r*_*w)+e[15]*(-o*p*w-t*y*T+t*p*C+o*f*T-r*f*C+r*y*w)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],o=e[2],l=e[3],f=e[4],p=e[5],y=e[6],_=e[7],w=e[8],T=e[9],C=e[10],R=e[11],U=e[12],$=e[13],z=e[14],L=e[15],te=T*z*_-$*C*_+$*y*R-p*z*R-T*y*L+p*C*L,X=U*C*_-w*z*_-U*y*R+f*z*R+w*y*L-f*C*L,ae=w*$*_-U*T*_+U*p*R-f*$*R-w*p*L+f*T*L,ve=U*T*y-w*$*y-U*p*C+f*$*C+w*p*z-f*T*z,Te=t*te+r*X+o*ae+l*ve;if(0===Te)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const De=1/Te;return e[0]=te*De,e[1]=($*C*l-T*z*l-$*o*R+r*z*R+T*o*L-r*C*L)*De,e[2]=(p*z*l-$*y*l+$*o*_-r*z*_-p*o*L+r*y*L)*De,e[3]=(T*y*l-p*C*l-T*o*_+r*C*_+p*o*R-r*y*R)*De,e[4]=X*De,e[5]=(w*z*l-U*C*l+U*o*R-t*z*R-w*o*L+t*C*L)*De,e[6]=(U*y*l-f*z*l-U*o*_+t*z*_+f*o*L-t*y*L)*De,e[7]=(f*C*l-w*y*l+w*o*_-t*C*_-f*o*R+t*y*R)*De,e[8]=ae*De,e[9]=(U*T*l-w*$*l-U*r*R+t*$*R+w*r*L-t*T*L)*De,e[10]=(f*$*l-U*p*l+U*r*_-t*$*_-f*r*L+t*p*L)*De,e[11]=(w*p*l-f*T*l-w*r*_+t*T*_+f*r*R-t*p*R)*De,e[12]=ve*De,e[13]=(w*$*o-U*T*o+U*r*C-t*$*C-w*r*z+t*T*z)*De,e[14]=(U*p*o-f*$*o-U*r*y+t*$*y+f*r*z-t*p*z)*De,e[15]=(f*T*o-w*p*o+w*r*y-t*T*y-f*r*C+t*p*C)*De,this}scale(e){const t=this.elements,r=e.x,o=e.y,l=e.z;return t[0]*=r,t[4]*=o,t[8]*=l,t[1]*=r,t[5]*=o,t[9]*=l,t[2]*=r,t[6]*=o,t[10]*=l,t[3]*=r,t[7]*=o,t[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),o=Math.sin(t),l=1-r,f=e.x,p=e.y,y=e.z,_=l*f,w=l*p;return this.set(_*f+r,_*p-o*y,_*y+o*p,0,_*p+o*y,w*p+r,w*y-o*f,0,_*y-o*p,w*y+o*f,l*y*y+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,o,l,f){return this.set(1,r,l,0,e,1,f,0,t,o,1,0,0,0,0,1),this}compose(e,t,r){const o=this.elements,l=t._x,f=t._y,p=t._z,y=t._w,_=l+l,w=f+f,T=p+p,C=l*_,R=l*w,U=l*T,$=f*w,z=f*T,L=p*T,te=y*_,X=y*w,ae=y*T,ve=r.x,Te=r.y,De=r.z;return o[0]=(1-($+L))*ve,o[1]=(R+ae)*ve,o[2]=(U-X)*ve,o[3]=0,o[4]=(R-ae)*Te,o[5]=(1-(C+L))*Te,o[6]=(z+te)*Te,o[7]=0,o[8]=(U+X)*De,o[9]=(z-te)*De,o[10]=(1-(C+$))*De,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,r){const o=this.elements;let l=ml.set(o[0],o[1],o[2]).length();const f=ml.set(o[4],o[5],o[6]).length(),p=ml.set(o[8],o[9],o[10]).length();this.determinant()<0&&(l=-l),e.x=o[12],e.y=o[13],e.z=o[14],D.copy(this);const _=1/l,w=1/f,T=1/p;return D.elements[0]*=_,D.elements[1]*=_,D.elements[2]*=_,D.elements[4]*=w,D.elements[5]*=w,D.elements[6]*=w,D.elements[8]*=T,D.elements[9]*=T,D.elements[10]*=T,t.setFromRotationMatrix(D),r.x=l,r.y=f,r.z=p,this}makePerspective(e,t,r,o,l,f,p=rr){const y=this.elements,_=2*l/(t-e),w=2*l/(r-o),T=(t+e)/(t-e),C=(r+o)/(r-o);let R,U;if(p===rr)R=-(f+l)/(f-l),U=-2*f*l/(f-l);else{if(2001!==p)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+p);R=-f/(f-l),U=-f*l/(f-l)}return y[0]=_,y[4]=0,y[8]=T,y[12]=0,y[1]=0,y[5]=w,y[9]=C,y[13]=0,y[2]=0,y[6]=0,y[10]=R,y[14]=U,y[3]=0,y[7]=0,y[11]=-1,y[15]=0,this}makeOrthographic(e,t,r,o,l,f,p=rr){const y=this.elements,_=1/(t-e),w=1/(r-o),T=1/(f-l),C=(t+e)*_,R=(r+o)*w;let U,$;if(p===rr)U=(f+l)*T,$=-2*T;else{if(2001!==p)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+p);U=l*T,$=-1*T}return y[0]=2*_,y[4]=0,y[8]=0,y[12]=-C,y[1]=0,y[5]=2*w,y[9]=0,y[13]=-R,y[2]=0,y[6]=0,y[10]=$,y[14]=-U,y[3]=0,y[7]=0,y[11]=0,y[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let o=0;o<16;o++)if(t[o]!==r[o])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const ml=new Me,D=new Fi,S=new Me(0,0,0),M=new Me(1,1,1),O=new Me,W=new Me,ee=new Me,Ee=new Fi,Pe=new Is;let et=(()=>{class c{constructor(t=0,r=0,o=0,l=c.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=r,this._z=o,this._order=l}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,r,o,l=this._order){return this._x=t,this._y=r,this._z=o,this._order=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,r=this._order,o=!0){const l=t.elements,f=l[0],p=l[4],y=l[8],_=l[1],w=l[5],T=l[9],C=l[2],R=l[6],U=l[10];switch(r){case"XYZ":this._y=Math.asin(vr(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(-T,U),this._z=Math.atan2(-p,f)):(this._x=Math.atan2(R,w),this._z=0);break;case"YXZ":this._x=Math.asin(-vr(T,-1,1)),Math.abs(T)<.9999999?(this._y=Math.atan2(y,U),this._z=Math.atan2(_,w)):(this._y=Math.atan2(-C,f),this._z=0);break;case"ZXY":this._x=Math.asin(vr(R,-1,1)),Math.abs(R)<.9999999?(this._y=Math.atan2(-C,U),this._z=Math.atan2(-p,w)):(this._y=0,this._z=Math.atan2(_,f));break;case"ZYX":this._y=Math.asin(-vr(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(R,U),this._z=Math.atan2(_,f)):(this._x=0,this._z=Math.atan2(-p,w));break;case"YZX":this._z=Math.asin(vr(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-T,w),this._y=Math.atan2(-C,f)):(this._x=0,this._y=Math.atan2(y,U));break;case"XZY":this._z=Math.asin(-vr(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(R,w),this._y=Math.atan2(y,f)):(this._x=Math.atan2(-T,U),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+r)}return this._order=r,!0===o&&this._onChangeCallback(),this}setFromQuaternion(t,r,o){return Ee.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ee,r,o)}setFromVector3(t,r=this._order){return this.set(t.x,t.y,t.z,r)}reorder(t){return Pe.setFromEuler(this),this.setFromQuaternion(Pe,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],r=0){return t[r]=this._x,t[r+1]=this._y,t[r+2]=this._z,t[r+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return c.DEFAULT_ORDER="XYZ",c})();class cn{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Ti=0;const Hn=new Me,Xi=new Is,Wi=new Fi,Io=new Me,mo=new Me,Pa=new Me,Cc=new Is,Wa=new Me(1,0,0),ja=new Me(0,1,0),Bl=new Me(0,0,1),Oh={type:"added"},mu={type:"removed"};let ws=(()=>{class c extends zi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ti++}),this.uuid=kr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=c.DEFAULT_UP.clone();const t=new Me,r=new et,o=new Is,l=new Me(1,1,1);r._onChange(function f(){o.setFromEuler(r,!1)}),o._onChange(function p(){r.setFromQuaternion(o,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:l},modelViewMatrix:{value:new Fi},normalMatrix:{value:new Mi}}),this.matrix=new Fi,this.matrixWorld=new Fi,this.matrixAutoUpdate=c.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=c.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new cn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,r){this.quaternion.setFromAxisAngle(t,r)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,r){return Xi.setFromAxisAngle(t,r),this.quaternion.multiply(Xi),this}rotateOnWorldAxis(t,r){return Xi.setFromAxisAngle(t,r),this.quaternion.premultiply(Xi),this}rotateX(t){return this.rotateOnAxis(Wa,t)}rotateY(t){return this.rotateOnAxis(ja,t)}rotateZ(t){return this.rotateOnAxis(Bl,t)}translateOnAxis(t,r){return Hn.copy(t).applyQuaternion(this.quaternion),this.position.add(Hn.multiplyScalar(r)),this}translateX(t){return this.translateOnAxis(Wa,t)}translateY(t){return this.translateOnAxis(ja,t)}translateZ(t){return this.translateOnAxis(Bl,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Wi.copy(this.matrixWorld).invert())}lookAt(t,r,o){t.isVector3?Io.copy(t):Io.set(t,r,o);const l=this.parent;this.updateWorldMatrix(!0,!1),mo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Wi.lookAt(mo,Io,this.up):Wi.lookAt(Io,mo,this.up),this.quaternion.setFromRotationMatrix(Wi),l&&(Wi.extractRotation(l.matrixWorld),Xi.setFromRotationMatrix(Wi),this.quaternion.premultiply(Xi.invert()))}add(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Oh)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.remove(arguments[o]);return this}const r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(mu)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const r=this.children[t];r.parent=null,r.dispatchEvent(mu)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Wi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Wi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Wi),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,r){if(this[t]===r)return this;for(let o=0,l=this.children.length;o<l;o++){const p=this.children[o].getObjectByProperty(t,r);if(void 0!==p)return p}}getObjectsByProperty(t,r){let o=[];this[t]===r&&o.push(this);for(let l=0,f=this.children.length;l<f;l++){const p=this.children[l].getObjectsByProperty(t,r);p.length>0&&(o=o.concat(p))}return o}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mo,t,Pa),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mo,Cc,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return t.set(r[8],r[9],r[10]).normalize()}raycast(){}traverse(t){t(this);const r=this.children;for(let o=0,l=r.length;o<l;o++)r[o].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const r=this.children;for(let o=0,l=r.length;o<l;o++)r[o].traverseVisible(t)}traverseAncestors(t){const r=this.parent;null!==r&&(t(r),r.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const r=this.children;for(let o=0,l=r.length;o<l;o++){const f=r[o];(!0===f.matrixWorldAutoUpdate||!0===t)&&f.updateMatrixWorld(t)}}updateWorldMatrix(t,r){const o=this.parent;if(!0===t&&null!==o&&!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===r){const l=this.children;for(let f=0,p=l.length;f<p;f++){const y=l[f];!0===y.matrixWorldAutoUpdate&&y.updateWorldMatrix(!1,!0)}}}toJSON(t){const r=void 0===t||"string"==typeof t,o={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},o.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const l={};function f(y,_){return void 0===y[_.uuid]&&(y[_.uuid]=_.toJSON(t)),_.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),l.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(l.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(l.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=f(t.geometries,this.geometry);const y=this.geometry.parameters;if(void 0!==y&&void 0!==y.shapes){const _=y.shapes;if(Array.isArray(_))for(let w=0,T=_.length;w<T;w++)f(t.shapes,_[w]);else f(t.shapes,_)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(f(t.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const y=[];for(let _=0,w=this.material.length;_<w;_++)y.push(f(t.materials,this.material[_]));l.material=y}else l.material=f(t.materials,this.material);if(this.children.length>0){l.children=[];for(let y=0;y<this.children.length;y++)l.children.push(this.children[y].toJSON(t).object)}if(this.animations.length>0){l.animations=[];for(let y=0;y<this.animations.length;y++)l.animations.push(f(t.animations,this.animations[y]))}if(r){const y=p(t.geometries),_=p(t.materials),w=p(t.textures),T=p(t.images),C=p(t.shapes),R=p(t.skeletons),U=p(t.animations),$=p(t.nodes);y.length>0&&(o.geometries=y),_.length>0&&(o.materials=_),w.length>0&&(o.textures=w),T.length>0&&(o.images=T),C.length>0&&(o.shapes=C),R.length>0&&(o.skeletons=R),U.length>0&&(o.animations=U),$.length>0&&(o.nodes=$)}return o.object=l,o;function p(y){const _=[];for(const w in y){const T=y[w];delete T.metadata,_.push(T)}return _}}clone(t){return(new this.constructor).copy(this,t)}copy(t,r=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===r)for(let o=0;o<t.children.length;o++)this.add(t.children[o].clone());return this}}return c.DEFAULT_UP=new Me(0,1,0),c.DEFAULT_MATRIX_AUTO_UPDATE=!0,c.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,c})();const go=new Me,jo=new Me,$a=new Me,$o=new Me,gl=new Me,ia=new Me,Fh=new Me,Wu=new Me,qr=new Me,ju=new Me;let $u=!1;class da{constructor(e=new Me,t=new Me,r=new Me){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,o){o.subVectors(r,t),go.subVectors(e,t),o.cross(go);const l=o.lengthSq();return l>0?o.multiplyScalar(1/Math.sqrt(l)):o.set(0,0,0)}static getBarycoord(e,t,r,o,l){go.subVectors(o,t),jo.subVectors(r,t),$a.subVectors(e,t);const f=go.dot(go),p=go.dot(jo),y=go.dot($a),_=jo.dot(jo),w=jo.dot($a),T=f*_-p*p;if(0===T)return l.set(-2,-1,-1);const C=1/T,R=(_*y-p*w)*C,U=(f*w-p*y)*C;return l.set(1-R-U,U,R)}static containsPoint(e,t,r,o){return this.getBarycoord(e,t,r,o,$o),$o.x>=0&&$o.y>=0&&$o.x+$o.y<=1}static getUV(e,t,r,o,l,f,p,y){return!1===$u&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),$u=!0),this.getInterpolation(e,t,r,o,l,f,p,y)}static getInterpolation(e,t,r,o,l,f,p,y){return this.getBarycoord(e,t,r,o,$o),y.setScalar(0),y.addScaledVector(l,$o.x),y.addScaledVector(f,$o.y),y.addScaledVector(p,$o.z),y}static isFrontFacing(e,t,r,o){return go.subVectors(r,t),jo.subVectors(e,t),go.cross(jo).dot(o)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,o){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,t,r,o){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,o),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return go.subVectors(this.c,this.b),jo.subVectors(this.a,this.b),.5*go.cross(jo).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return da.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return da.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,o,l){return!1===$u&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),$u=!0),da.getInterpolation(e,this.a,this.b,this.c,t,r,o,l)}getInterpolation(e,t,r,o,l){return da.getInterpolation(e,this.a,this.b,this.c,t,r,o,l)}containsPoint(e){return da.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return da.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,o=this.b,l=this.c;let f,p;gl.subVectors(o,r),ia.subVectors(l,r),Wu.subVectors(e,r);const y=gl.dot(Wu),_=ia.dot(Wu);if(y<=0&&_<=0)return t.copy(r);qr.subVectors(e,o);const w=gl.dot(qr),T=ia.dot(qr);if(w>=0&&T<=w)return t.copy(o);const C=y*T-w*_;if(C<=0&&y>=0&&w<=0)return f=y/(y-w),t.copy(r).addScaledVector(gl,f);ju.subVectors(e,l);const R=gl.dot(ju),U=ia.dot(ju);if(U>=0&&R<=U)return t.copy(l);const $=R*_-y*U;if($<=0&&_>=0&&U<=0)return p=_/(_-U),t.copy(r).addScaledVector(ia,p);const z=w*U-R*T;if(z<=0&&T-w>=0&&R-U>=0)return Fh.subVectors(l,o),p=(T-w)/(T-w+(R-U)),t.copy(o).addScaledVector(Fh,p);const L=1/(z+$+C);return f=$*L,p=C*L,t.copy(r).addScaledVector(gl,f).addScaledVector(ia,p)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Fp=0;class yo extends zi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Fp++}),this.uuid=kr(),this.name="",this.type="Material",this.blending=1,this.side=ri,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const o=this[t];void 0!==o?o&&o.isColor?o.set(r):o&&o.isVector3&&r&&r.isVector3?o.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function o(l){const f=[];for(const p in l){const y=l[p];delete y.metadata,f.push(y)}return f}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),this.side!==ri&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(r.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const l=o(e.textures),f=o(e.images);l.length>0&&(r.textures=l),f.length>0&&(r.images=f)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const o=t.length;r=new Array(o);for(let l=0;l!==o;++l)r[l]=t[l].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const Np={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xa={h:0,s:0,l:0},yl={h:0,s:0,l:0};function Nh(c,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?c+6*(e-c)*t:t<.5?e:t<2/3?c+6*(e-c)*(2/3-t):c}class gn{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){const o=e;o&&o.isColor?this.copy(o):"number"==typeof o?this.setHex(o):"string"==typeof o&&this.setStyle(o)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ai){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,zo.toWorkingColorSpace(this,t),this}setRGB(e,t,r,o=zo.workingColorSpace){return this.r=e,this.g=t,this.b=r,zo.toWorkingColorSpace(this,o),this}setHSL(e,t,r,o=zo.workingColorSpace){if(e=Sa(e,1),t=vr(t,0,1),r=vr(r,0,1),0===t)this.r=this.g=this.b=r;else{const l=r<=.5?r*(1+t):r+t-r*t,f=2*r-l;this.r=Nh(f,l,e+1/3),this.g=Nh(f,l,e),this.b=Nh(f,l,e-1/3)}return zo.toWorkingColorSpace(this,o),this}setStyle(e,t=Ai){function r(l){void 0!==l&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let l;const p=o[2];switch(o[1]){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return r(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,t);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return r(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,t);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return r(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=o[1],f=l.length;if(3===f)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,t);if(6===f)return this.setHex(parseInt(l,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ai){const r=Np[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Lr(e.r),this.g=Lr(e.g),this.b=Lr(e.b),this}copyLinearToSRGB(e){return this.r=rc(e.r),this.g=rc(e.g),this.b=rc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ai){return zo.fromWorkingColorSpace(b.copy(this),e),65536*Math.round(vr(255*b.r,0,255))+256*Math.round(vr(255*b.g,0,255))+Math.round(vr(255*b.b,0,255))}getHexString(e=Ai){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=zo.workingColorSpace){zo.fromWorkingColorSpace(b.copy(this),t);const r=b.r,o=b.g,l=b.b,f=Math.max(r,o,l),p=Math.min(r,o,l);let y,_;const w=(p+f)/2;if(p===f)y=0,_=0;else{const T=f-p;switch(_=w<=.5?T/(f+p):T/(2-f-p),f){case r:y=(o-l)/T+(o<l?6:0);break;case o:y=(l-r)/T+2;break;case l:y=(r-o)/T+4}y/=6}return e.h=y,e.s=_,e.l=w,e}getRGB(e,t=zo.workingColorSpace){return zo.fromWorkingColorSpace(b.copy(this),t),e.r=b.r,e.g=b.g,e.b=b.b,e}getStyle(e=Ai){zo.fromWorkingColorSpace(b.copy(this),e);const t=b.r,r=b.g,o=b.b;return e!==Ai?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*o)})`}offsetHSL(e,t,r){return this.getHSL(Xa),Xa.h+=e,Xa.s+=t,Xa.l+=r,this.setHSL(Xa.h,Xa.s,Xa.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Xa),e.getHSL(yl);const r=Vo(Xa.h,yl.h,t),o=Vo(Xa.s,yl.s,t),l=Vo(Xa.l,yl.l,t);return this.setHSL(r,o,l),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,o=this.b,l=e.elements;return this.r=l[0]*t+l[3]*r+l[6]*o,this.g=l[1]*t+l[4]*r+l[7]*o,this.b=l[2]*t+l[5]*r+l[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const b=new gn;gn.NAMES=Np;class u extends yo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new gn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const j=new Me,q=new Et;class de{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=H,this.updateRange={offset:0,count:-1},this.gpuType=st,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let o=0,l=this.itemSize;o<l;o++)this.array[e+o]=t.array[r+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)q.fromBufferAttribute(this,t),q.applyMatrix3(e),this.setXY(t,q.x,q.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)j.fromBufferAttribute(this,t),j.applyMatrix3(e),this.setXYZ(t,j.x,j.y,j.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)j.fromBufferAttribute(this,t),j.applyMatrix4(e),this.setXYZ(t,j.x,j.y,j.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)j.fromBufferAttribute(this,t),j.applyNormalMatrix(e),this.setXYZ(t,j.x,j.y,j.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)j.fromBufferAttribute(this,t),j.transformDirection(e),this.setXYZ(t,j.x,j.y,j.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=it(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Ct(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=it(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ct(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=it(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ct(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=it(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ct(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=it(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ct(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Ct(t,this.array),r=Ct(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,o){return e*=this.itemSize,this.normalized&&(t=Ct(t,this.array),r=Ct(r,this.array),o=Ct(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=o,this}setXYZW(e,t,r,o,l){return e*=this.itemSize,this.normalized&&(t=Ct(t,this.array),r=Ct(r,this.array),o=Ct(o,this.array),l=Ct(l,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=o,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==H&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}class wt extends de{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class wn extends de{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class vt extends de{constructor(e,t,r){super(new Float32Array(e),t,r)}}let ni=0;const Qn=new Fi,si=new ws,oi=new Me,Dn=new fo,Cr=new fo,ui=new Me;class hi extends zi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ni++}),this.uuid=kr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(Aa(e)?wn:wt)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const l=(new Mi).getNormalMatrix(e);r.applyNormalMatrix(l),r.needsUpdate=!0}const o=this.attributes.tangent;return void 0!==o&&(o.transformDirection(e),o.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Qn.makeRotationFromQuaternion(e),this.applyMatrix4(Qn),this}rotateX(e){return Qn.makeRotationX(e),this.applyMatrix4(Qn),this}rotateY(e){return Qn.makeRotationY(e),this.applyMatrix4(Qn),this}rotateZ(e){return Qn.makeRotationZ(e),this.applyMatrix4(Qn),this}translate(e,t,r){return Qn.makeTranslation(e,t,r),this.applyMatrix4(Qn),this}scale(e,t,r){return Qn.makeScale(e,t,r),this.applyMatrix4(Qn),this}lookAt(e){return si.lookAt(e),si.updateMatrix(),this.applyMatrix4(si.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(oi).negate(),this.translate(oi.x,oi.y,oi.z),this}setFromPoints(e){const t=[];for(let r=0,o=e.length;r<o;r++){const l=e[r];t.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new vt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new fo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Me(-1/0,-1/0,-1/0),new Me(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++)Dn.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(ui.addVectors(this.boundingBox.min,Dn.min),this.boundingBox.expandByPoint(ui),ui.addVectors(this.boundingBox.max,Dn.max),this.boundingBox.expandByPoint(ui)):(this.boundingBox.expandByPoint(Dn.min),this.boundingBox.expandByPoint(Dn.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Wo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Me,1/0);if(e){const r=this.boundingSphere.center;if(Dn.setFromBufferAttribute(e),t)for(let l=0,f=t.length;l<f;l++)Cr.setFromBufferAttribute(t[l]),this.morphTargetsRelative?(ui.addVectors(Dn.min,Cr.min),Dn.expandByPoint(ui),ui.addVectors(Dn.max,Cr.max),Dn.expandByPoint(ui)):(Dn.expandByPoint(Cr.min),Dn.expandByPoint(Cr.max));Dn.getCenter(r);let o=0;for(let l=0,f=e.count;l<f;l++)ui.fromBufferAttribute(e,l),o=Math.max(o,r.distanceToSquared(ui));if(t)for(let l=0,f=t.length;l<f;l++){const p=t[l],y=this.morphTargetsRelative;for(let _=0,w=p.count;_<w;_++)ui.fromBufferAttribute(p,_),y&&(oi.fromBufferAttribute(e,_),ui.add(oi)),o=Math.max(o,r.distanceToSquared(ui))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,o=t.position.array,l=t.normal.array,f=t.uv.array,p=o.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new de(new Float32Array(4*p),4));const y=this.getAttribute("tangent").array,_=[],w=[];for(let Se=0;Se<p;Se++)_[Se]=new Me,w[Se]=new Me;const T=new Me,C=new Me,R=new Me,U=new Et,$=new Et,z=new Et,L=new Me,te=new Me;function X(Se,bt,qt){T.fromArray(o,3*Se),C.fromArray(o,3*bt),R.fromArray(o,3*qt),U.fromArray(f,2*Se),$.fromArray(f,2*bt),z.fromArray(f,2*qt),C.sub(T),R.sub(T),$.sub(U),z.sub(U);const ct=1/($.x*z.y-z.x*$.y);!isFinite(ct)||(L.copy(C).multiplyScalar(z.y).addScaledVector(R,-$.y).multiplyScalar(ct),te.copy(R).multiplyScalar($.x).addScaledVector(C,-z.x).multiplyScalar(ct),_[Se].add(L),_[bt].add(L),_[qt].add(L),w[Se].add(te),w[bt].add(te),w[qt].add(te))}let ae=this.groups;0===ae.length&&(ae=[{start:0,count:r.length}]);for(let Se=0,bt=ae.length;Se<bt;++Se){const qt=ae[Se],ct=qt.start;for(let xt=ct,Zt=ct+qt.count;xt<Zt;xt+=3)X(r[xt+0],r[xt+1],r[xt+2])}const ve=new Me,Te=new Me,De=new Me,We=new Me;function le(Se){De.fromArray(l,3*Se),We.copy(De);const bt=_[Se];ve.copy(bt),ve.sub(De.multiplyScalar(De.dot(bt))).normalize(),Te.crossVectors(We,bt);const ct=Te.dot(w[Se])<0?-1:1;y[4*Se]=ve.x,y[4*Se+1]=ve.y,y[4*Se+2]=ve.z,y[4*Se+3]=ct}for(let Se=0,bt=ae.length;Se<bt;++Se){const qt=ae[Se],ct=qt.start;for(let xt=ct,Zt=ct+qt.count;xt<Zt;xt+=3)le(r[xt+0]),le(r[xt+1]),le(r[xt+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new de(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let C=0,R=r.count;C<R;C++)r.setXYZ(C,0,0,0);const o=new Me,l=new Me,f=new Me,p=new Me,y=new Me,_=new Me,w=new Me,T=new Me;if(e)for(let C=0,R=e.count;C<R;C+=3){const U=e.getX(C+0),$=e.getX(C+1),z=e.getX(C+2);o.fromBufferAttribute(t,U),l.fromBufferAttribute(t,$),f.fromBufferAttribute(t,z),w.subVectors(f,l),T.subVectors(o,l),w.cross(T),p.fromBufferAttribute(r,U),y.fromBufferAttribute(r,$),_.fromBufferAttribute(r,z),p.add(w),y.add(w),_.add(w),r.setXYZ(U,p.x,p.y,p.z),r.setXYZ($,y.x,y.y,y.z),r.setXYZ(z,_.x,_.y,_.z)}else for(let C=0,R=t.count;C<R;C+=3)o.fromBufferAttribute(t,C+0),l.fromBufferAttribute(t,C+1),f.fromBufferAttribute(t,C+2),w.subVectors(f,l),T.subVectors(o,l),w.cross(T),r.setXYZ(C+0,w.x,w.y,w.z),r.setXYZ(C+1,w.x,w.y,w.z),r.setXYZ(C+2,w.x,w.y,w.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)ui.fromBufferAttribute(e,t),ui.normalize(),e.setXYZ(t,ui.x,ui.y,ui.z)}toNonIndexed(){function e(p,y){const _=p.array,w=p.itemSize,T=p.normalized,C=new _.constructor(y.length*w);let R=0,U=0;for(let $=0,z=y.length;$<z;$++){R=p.isInterleavedBufferAttribute?y[$]*p.data.stride+p.offset:y[$]*w;for(let L=0;L<w;L++)C[U++]=_[R++]}return new de(C,w,T)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new hi,r=this.index.array,o=this.attributes;for(const p in o){const _=e(o[p],r);t.setAttribute(p,_)}const l=this.morphAttributes;for(const p in l){const y=[],_=l[p];for(let w=0,T=_.length;w<T;w++){const R=e(_[w],r);y.push(R)}t.morphAttributes[p]=y}t.morphTargetsRelative=this.morphTargetsRelative;const f=this.groups;for(let p=0,y=f.length;p<y;p++){const _=f[p];t.addGroup(_.start,_.count,_.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const y=this.parameters;for(const _ in y)void 0!==y[_]&&(e[_]=y[_]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const y in r)e.data.attributes[y]=r[y].toJSON(e.data);const o={};let l=!1;for(const y in this.morphAttributes){const _=this.morphAttributes[y],w=[];for(let T=0,C=_.length;T<C;T++)w.push(_[T].toJSON(e.data));w.length>0&&(o[y]=w,l=!0)}l&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));const p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const o=e.attributes;for(const _ in o)this.setAttribute(_,o[_].clone(t));const l=e.morphAttributes;for(const _ in l){const w=[],T=l[_];for(let C=0,R=T.length;C<R;C++)w.push(T[C].clone(t));this.morphAttributes[_]=w}this.morphTargetsRelative=e.morphTargetsRelative;const f=e.groups;for(let _=0,w=f.length;_<w;_++){const T=f[_];this.addGroup(T.start,T.count,T.materialIndex)}const p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());const y=e.boundingSphere;return null!==y&&(this.boundingSphere=y.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const jr=new Fi,mr=new ha,Dr=new Wo,ds=new Me,Fr=new Me,Zr=new Me,Ps=new Me,vo=new Me,Xo=new Me,ms=new Et,Po=new Et,ra=new Et,_r=new Me,Hs=new Me,Dc=new Me,La=new Me,sa=new Me;class _o extends ws{constructor(e=new hi,t=new u){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const o=t[r[0]];if(void 0!==o){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=o.length;l<f;l++){const p=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=l}}}}getVertexPosition(e,t){const r=this.geometry,l=r.morphAttributes.position,f=r.morphTargetsRelative;t.fromBufferAttribute(r.attributes.position,e);const p=this.morphTargetInfluences;if(l&&p){Xo.set(0,0,0);for(let y=0,_=l.length;y<_;y++){const w=p[y],T=l[y];0!==w&&(vo.fromBufferAttribute(T,e),Xo.addScaledVector(f?vo:vo.sub(t),w))}t.add(Xo)}return t}raycast(e,t){const r=this.geometry,l=this.matrixWorld;void 0!==this.material&&(null===r.boundingSphere&&r.computeBoundingSphere(),Dr.copy(r.boundingSphere),Dr.applyMatrix4(l),mr.copy(e.ray).recast(e.near),(!1!==Dr.containsPoint(mr.origin)||!(null===mr.intersectSphere(Dr,ds)||mr.origin.distanceToSquared(ds)>(e.far-e.near)**2))&&(jr.copy(l).invert(),mr.copy(e.ray).applyMatrix4(jr),(null===r.boundingBox||!1!==mr.intersectsBox(r.boundingBox))&&this._computeIntersections(e,t,mr)))}_computeIntersections(e,t,r){let o;const l=this.geometry,f=this.material,p=l.index,y=l.attributes.position,_=l.attributes.uv,w=l.attributes.uv1,T=l.attributes.normal,C=l.groups,R=l.drawRange;if(null!==p)if(Array.isArray(f))for(let U=0,$=C.length;U<$;U++){const z=C[U],L=f[z.materialIndex];for(let ae=Math.max(z.start,R.start),ve=Math.min(p.count,Math.min(z.start+z.count,R.start+R.count));ae<ve;ae+=3)o=Rc(this,L,e,r,_,w,T,p.getX(ae),p.getX(ae+1),p.getX(ae+2)),o&&(o.faceIndex=Math.floor(ae/3),o.face.materialIndex=z.materialIndex,t.push(o))}else for(let z=Math.max(0,R.start),L=Math.min(p.count,R.start+R.count);z<L;z+=3)o=Rc(this,f,e,r,_,w,T,p.getX(z),p.getX(z+1),p.getX(z+2)),o&&(o.faceIndex=Math.floor(z/3),t.push(o));else if(void 0!==y)if(Array.isArray(f))for(let U=0,$=C.length;U<$;U++){const z=C[U],L=f[z.materialIndex];for(let ae=Math.max(z.start,R.start),ve=Math.min(y.count,Math.min(z.start+z.count,R.start+R.count));ae<ve;ae+=3)o=Rc(this,L,e,r,_,w,T,ae,ae+1,ae+2),o&&(o.faceIndex=Math.floor(ae/3),o.face.materialIndex=z.materialIndex,t.push(o))}else for(let z=Math.max(0,R.start),L=Math.min(y.count,R.start+R.count);z<L;z+=3)o=Rc(this,f,e,r,_,w,T,z,z+1,z+2),o&&(o.faceIndex=Math.floor(z/3),t.push(o))}}function Rc(c,e,t,r,o,l,f,p,y,_){c.getVertexPosition(p,Fr),c.getVertexPosition(y,Zr),c.getVertexPosition(_,Ps);const w=function kh(c,e,t,r,o,l,f,p){let y;if(y=e.side===fe?r.intersectTriangle(f,l,o,!0,p):r.intersectTriangle(o,l,f,e.side===ri,p),null===y)return null;sa.copy(p),sa.applyMatrix4(c.matrixWorld);const _=t.ray.origin.distanceTo(sa);return _<t.near||_>t.far?null:{distance:_,point:sa.clone(),object:c}}(c,e,t,r,Fr,Zr,Ps,La);if(w){o&&(ms.fromBufferAttribute(o,p),Po.fromBufferAttribute(o,y),ra.fromBufferAttribute(o,_),w.uv=da.getInterpolation(La,Fr,Zr,Ps,ms,Po,ra,new Et)),l&&(ms.fromBufferAttribute(l,p),Po.fromBufferAttribute(l,y),ra.fromBufferAttribute(l,_),w.uv1=da.getInterpolation(La,Fr,Zr,Ps,ms,Po,ra,new Et),w.uv2=w.uv1),f&&(_r.fromBufferAttribute(f,p),Hs.fromBufferAttribute(f,y),Dc.fromBufferAttribute(f,_),w.normal=da.getInterpolation(La,Fr,Zr,Ps,_r,Hs,Dc,new Me),w.normal.dot(r.direction)>0&&w.normal.multiplyScalar(-1));const T={a:p,b:y,c:_,normal:new Me,materialIndex:0};da.getNormal(Fr,Zr,Ps,T.normal),w.face=T}return w}class _a extends hi{constructor(e=1,t=1,r=1,o=1,l=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:o,heightSegments:l,depthSegments:f};const p=this;o=Math.floor(o),l=Math.floor(l),f=Math.floor(f);const y=[],_=[],w=[],T=[];let C=0,R=0;function U($,z,L,te,X,ae,ve,Te,De,We,le){const Se=ae/De,bt=ve/We,qt=ae/2,ct=ve/2,dt=Te/2,xt=De+1,Zt=We+1;let Pt=0,Bt=0;const en=new Me;for(let nn=0;nn<Zt;nn++){const at=nn*bt-ct;for(let Nt=0;Nt<xt;Nt++)en[$]=(Nt*Se-qt)*te,en[z]=at*X,en[L]=dt,_.push(en.x,en.y,en.z),en[$]=0,en[z]=0,en[L]=Te>0?1:-1,w.push(en.x,en.y,en.z),T.push(Nt/De),T.push(1-nn/We),Pt+=1}for(let nn=0;nn<We;nn++)for(let at=0;at<De;at++){const Nn=C+at+xt*(nn+1),Un=C+(at+1)+xt*(nn+1),$n=C+(at+1)+xt*nn;y.push(C+at+xt*nn,Nn,$n),y.push(Nn,Un,$n),Bt+=6}p.addGroup(R,Bt,le),R+=Bt,C+=Pt}U("z","y","x",-1,-1,r,t,e,f,l,0),U("z","y","x",1,-1,r,t,-e,f,l,1),U("x","z","y",1,1,e,r,t,o,f,2),U("x","z","y",1,-1,e,r,-t,o,f,3),U("x","y","z",1,-1,e,t,r,o,l,4),U("x","y","z",-1,-1,e,t,-r,o,l,5),this.setIndex(y),this.setAttribute("position",new vt(_,3)),this.setAttribute("normal",new vt(w,3)),this.setAttribute("uv",new vt(T,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _a(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function vl(c){const e={};for(const t in c){e[t]={};for(const r in c[t]){const o=c[t][r];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=o.clone():e[t][r]=Array.isArray(o)?o.slice():o}}return e}function Gs(c){const e={};for(let t=0;t<c.length;t++){const r=vl(c[t]);for(const o in r)e[o]=r[o]}return e}function kp(c){return null===c.getRenderTarget()?c.outputColorSpace:Us}const kd={clone:vl,merge:Gs};class _l extends yo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=vl(e.uniforms),this.uniformsGroups=function Xu(c){const e=[];for(let t=0;t<c.length;t++)e.push(c[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const o in this.uniforms){const f=this.uniforms[o].value;t.uniforms[o]=f&&f.isTexture?{type:"t",value:f.toJSON(e).uuid}:f&&f.isColor?{type:"c",value:f.getHex()}:f&&f.isVector2?{type:"v2",value:f.toArray()}:f&&f.isVector3?{type:"v3",value:f.toArray()}:f&&f.isVector4?{type:"v4",value:f.toArray()}:f&&f.isMatrix3?{type:"m3",value:f.toArray()}:f&&f.isMatrix4?{type:"m4",value:f.toArray()}:{value:f}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const o in this.extensions)!0===this.extensions[o]&&(r[o]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class Bd extends ws{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Fi,this.projectionMatrix=new Fi,this.projectionMatrixInverse=new Fi,this.coordinateSystem=rr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Lo extends Bd{constructor(e=50,t=1,r=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=o,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*fr*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ur*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*fr*Math.atan(Math.tan(.5*ur*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,o,l,f){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=o,this.view.width=l,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ur*this.fov)/this.zoom,r=2*t,o=this.aspect*r,l=-.5*o;const f=this.view;if(null!==this.view&&this.view.enabled){const y=f.fullWidth,_=f.fullHeight;l+=f.offsetX*o/y,t-=f.offsetY*r/_,o*=f.width/y,r*=f.height/_}const p=this.filmOffset;0!==p&&(l+=e*p/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+o,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class my extends ws{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null;const o=new Lo(-90,1,e,t);o.layers=this.layers,this.add(o);const l=new Lo(-90,1,e,t);l.layers=this.layers,this.add(l);const f=new Lo(-90,1,e,t);f.layers=this.layers,this.add(f);const p=new Lo(-90,1,e,t);p.layers=this.layers,this.add(p);const y=new Lo(-90,1,e,t);y.layers=this.layers,this.add(y);const _=new Lo(-90,1,e,t);_.layers=this.layers,this.add(_)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,o,l,f,p,y]=t;for(const _ of t)this.remove(_);if(e===rr)r.up.set(0,1,0),r.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),l.up.set(0,0,-1),l.lookAt(0,1,0),f.up.set(0,0,1),f.lookAt(0,-1,0),p.up.set(0,1,0),p.lookAt(0,0,1),y.up.set(0,1,0),y.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),l.up.set(0,0,1),l.lookAt(0,1,0),f.up.set(0,0,-1),f.lookAt(0,-1,0),p.up.set(0,-1,0),p.lookAt(0,0,1),y.up.set(0,-1,0),y.lookAt(0,0,-1)}for(const _ of t)this.add(_),_.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const r=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,l,f,p,y,_]=this.children,w=e.getRenderTarget(),T=e.xr.enabled;e.xr.enabled=!1;const C=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,o),e.setRenderTarget(r,1),e.render(t,l),e.setRenderTarget(r,2),e.render(t,f),e.setRenderTarget(r,3),e.render(t,p),e.setRenderTarget(r,4),e.render(t,y),r.texture.generateMipmaps=C,e.setRenderTarget(r,5),e.render(t,_),e.setRenderTarget(w),e.xr.enabled=T,r.texture.needsPMREMUpdate=!0}}class Vd extends ua{constructor(e,t,r,o,l,f,p,y,_,w){super(e=void 0!==e?e:[],t=void 0!==t?t:301,r,o,l,f,p,y,_,w),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Up extends Ta{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},o=[r,r,r,r,r,r];void 0!==t.encoding&&(ps("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ks?Ai:""),this.texture=new Vd(o,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Z}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r_uniforms={tEquirect:{value:null}},r_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new _a(5,5,5),l=new _l({name:"CubemapFromEquirect",uniforms:vl(r_uniforms),vertexShader:r_vertexShader,fragmentShader:r_fragmentShader,side:fe,blending:Gn});l.uniforms.tEquirect.value=t;const f=new _o(o,l),p=t.minFilter;return t.minFilter===ue&&(t.minFilter=Z),new my(1,10,this).update(e,f),t.minFilter=p,f.geometry.dispose(),f.material.dispose(),this}clear(e,t,r,o){const l=e.getRenderTarget();for(let f=0;f<6;f++)e.setRenderTarget(this,f),e.clear(t,r,o);e.setRenderTarget(l)}}const zd=new Me,j_=new Me,gy=new Mi;class lc{constructor(e=new Me(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,o){return this.normal.set(e,t,r),this.constant=o,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const o=zd.subVectors(r,t).cross(j_.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(zd),o=this.normal.dot(r);if(0===o)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const l=-(e.start.dot(this.normal)+this.constant)/o;return l<0||l>1?null:t.copy(e.start).addScaledVector(r,l)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||gy.getNormalMatrix(e),o=this.coplanarPoint(zd).applyMatrix4(e),l=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Ic=new Wo,Bh=new Me;class Bp{constructor(e=new lc,t=new lc,r=new lc,o=new lc,l=new lc,f=new lc){this.planes=[e,t,r,o,l,f]}set(e,t,r,o,l,f){const p=this.planes;return p[0].copy(e),p[1].copy(t),p[2].copy(r),p[3].copy(o),p[4].copy(l),p[5].copy(f),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=rr){const r=this.planes,o=e.elements,l=o[0],f=o[1],p=o[2],y=o[3],_=o[4],w=o[5],T=o[6],C=o[7],R=o[8],U=o[9],$=o[10],z=o[11],L=o[12],te=o[13],X=o[14],ae=o[15];if(r[0].setComponents(y-l,C-_,z-R,ae-L).normalize(),r[1].setComponents(y+l,C+_,z+R,ae+L).normalize(),r[2].setComponents(y+f,C+w,z+U,ae+te).normalize(),r[3].setComponents(y-f,C-w,z-U,ae-te).normalize(),r[4].setComponents(y-p,C-T,z-$,ae-X).normalize(),t===rr)r[5].setComponents(y+p,C+T,z+$,ae+X).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(p,T,$,X).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Ic.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Ic.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ic)}intersectsSprite(e){return Ic.center.set(0,0,0),Ic.radius=.7071067811865476,Ic.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ic)}intersectsSphere(e){const t=this.planes,r=e.center,o=-e.radius;for(let l=0;l<6;l++)if(t[l].distanceToPoint(r)<o)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const o=t[r];if(Bh.x=o.normal.x>0?e.max.x:e.min.x,Bh.y=o.normal.y>0?e.max.y:e.min.y,Bh.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(Bh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function qa(){let c=null,e=!1,t=null,r=null;function o(l,f){t(l,f),r=c.requestAnimationFrame(o)}return{start:function(){!0!==e&&null!==t&&(r=c.requestAnimationFrame(o),e=!0)},stop:function(){c.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(l){t=l},setContext:function(l){c=l}}}function yy(c,e){const t=e.isWebGL2,r=new WeakMap;return{get:function f(_){return _.isInterleavedBufferAttribute&&(_=_.data),r.get(_)},remove:function p(_){_.isInterleavedBufferAttribute&&(_=_.data);const w=r.get(_);w&&(c.deleteBuffer(w.buffer),r.delete(_))},update:function y(_,w){if(_.isGLBufferAttribute){const C=r.get(_);return void((!C||C.version<_.version)&&r.set(_,{buffer:_.buffer,type:_.type,bytesPerElement:_.elementSize,version:_.version}))}_.isInterleavedBufferAttribute&&(_=_.data);const T=r.get(_);void 0===T?r.set(_,function o(_,w){const T=_.array,C=_.usage,R=c.createBuffer();let U;if(c.bindBuffer(w,R),c.bufferData(w,T,C),_.onUploadCallback(),T instanceof Float32Array)U=c.FLOAT;else if(T instanceof Uint16Array)if(_.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");U=c.HALF_FLOAT}else U=c.UNSIGNED_SHORT;else if(T instanceof Int16Array)U=c.SHORT;else if(T instanceof Uint32Array)U=c.UNSIGNED_INT;else if(T instanceof Int32Array)U=c.INT;else if(T instanceof Int8Array)U=c.BYTE;else if(T instanceof Uint8Array)U=c.UNSIGNED_BYTE;else{if(!(T instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+T);U=c.UNSIGNED_BYTE}return{buffer:R,type:U,bytesPerElement:T.BYTES_PER_ELEMENT,version:_.version}}(_,w)):T.version<_.version&&(function l(_,w,T){const C=w.array,R=w.updateRange;c.bindBuffer(T,_),-1===R.count?c.bufferSubData(T,0,C):(t?c.bufferSubData(T,R.offset*C.BYTES_PER_ELEMENT,C,R.offset,R.count):c.bufferSubData(T,R.offset*C.BYTES_PER_ELEMENT,C.subarray(R.offset,R.offset+R.count)),R.count=-1),w.onUploadCallback()}(T.buffer,_,w),T.version=_.version)}}}class Yu extends hi{constructor(e=1,t=1,r=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:o};const l=e/2,f=t/2,p=Math.floor(r),y=Math.floor(o),_=p+1,w=y+1,T=e/p,C=t/y,R=[],U=[],$=[],z=[];for(let L=0;L<w;L++){const te=L*C-f;for(let X=0;X<_;X++)U.push(X*T-l,-te,0),$.push(0,0,1),z.push(X/p),z.push(1-L/y)}for(let L=0;L<y;L++)for(let te=0;te<p;te++){const ae=te+_*(L+1),ve=te+1+_*(L+1),Te=te+1+_*L;R.push(te+_*L,ae,Te),R.push(ae,ve,Te)}this.setIndex(R),this.setAttribute("position",new vt(U,3)),this.setAttribute("normal",new vt($,3)),this.setAttribute("uv",new vt(z,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yu(e.width,e.height,e.widthSegments,e.heightSegments)}}const qi={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Fn={common:{diffuse:{value:new gn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Mi},alphaMap:{value:null},alphaMapTransform:{value:new Mi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Mi}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Mi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Mi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Mi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Mi},normalScale:{value:new Et(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Mi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Mi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Mi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Mi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new gn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new gn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Mi},alphaTest:{value:0},uvTransform:{value:new Mi}},sprite:{diffuse:{value:new gn(16777215)},opacity:{value:1},center:{value:new Et(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Mi},alphaMap:{value:null},alphaMapTransform:{value:new Mi},alphaTest:{value:0}}},Hl={basic:{uniforms:Gs([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.fog]),vertexShader:qi.meshbasic_vert,fragmentShader:qi.meshbasic_frag},lambert:{uniforms:Gs([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,Fn.lights,{emissive:{value:new gn(0)}}]),vertexShader:qi.meshlambert_vert,fragmentShader:qi.meshlambert_frag},phong:{uniforms:Gs([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,Fn.lights,{emissive:{value:new gn(0)},specular:{value:new gn(1118481)},shininess:{value:30}}]),vertexShader:qi.meshphong_vert,fragmentShader:qi.meshphong_frag},standard:{uniforms:Gs([Fn.common,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.roughnessmap,Fn.metalnessmap,Fn.fog,Fn.lights,{emissive:{value:new gn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qi.meshphysical_vert,fragmentShader:qi.meshphysical_frag},toon:{uniforms:Gs([Fn.common,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.gradientmap,Fn.fog,Fn.lights,{emissive:{value:new gn(0)}}]),vertexShader:qi.meshtoon_vert,fragmentShader:qi.meshtoon_frag},matcap:{uniforms:Gs([Fn.common,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,{matcap:{value:null}}]),vertexShader:qi.meshmatcap_vert,fragmentShader:qi.meshmatcap_frag},points:{uniforms:Gs([Fn.points,Fn.fog]),vertexShader:qi.points_vert,fragmentShader:qi.points_frag},dashed:{uniforms:Gs([Fn.common,Fn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qi.linedashed_vert,fragmentShader:qi.linedashed_frag},depth:{uniforms:Gs([Fn.common,Fn.displacementmap]),vertexShader:qi.depth_vert,fragmentShader:qi.depth_frag},normal:{uniforms:Gs([Fn.common,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,{opacity:{value:1}}]),vertexShader:qi.meshnormal_vert,fragmentShader:qi.meshnormal_frag},sprite:{uniforms:Gs([Fn.sprite,Fn.fog]),vertexShader:qi.sprite_vert,fragmentShader:qi.sprite_frag},background:{uniforms:{uvTransform:{value:new Mi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qi.background_vert,fragmentShader:qi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:qi.backgroundCube_vert,fragmentShader:qi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qi.cube_vert,fragmentShader:qi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qi.equirect_vert,fragmentShader:qi.equirect_frag},distanceRGBA:{uniforms:Gs([Fn.common,Fn.displacementmap,{referencePosition:{value:new Me},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qi.distanceRGBA_vert,fragmentShader:qi.distanceRGBA_frag},shadow:{uniforms:Gs([Fn.lights,Fn.fog,{color:{value:new gn(0)},opacity:{value:1}}]),vertexShader:qi.shadow_vert,fragmentShader:qi.shadow_frag}};Hl.physical={uniforms:Gs([Hl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Mi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Mi},clearcoatNormalScale:{value:new Et(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Mi},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Mi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Mi},sheen:{value:0},sheenColor:{value:new gn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Mi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Mi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Mi},transmissionSamplerSize:{value:new Et},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Mi},attenuationDistance:{value:0},attenuationColor:{value:new gn(0)},specularColor:{value:new gn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Mi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Mi},anisotropyVector:{value:new Et},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Mi}}]),vertexShader:qi.meshphysical_vert,fragmentShader:qi.meshphysical_frag};const cc={r:0,b:0,g:0};function af(c,e,t,r,o,l,f){const p=new gn(0);let _,w,y=!0===l?0:1,T=null,C=0,R=null;function $(z,L){z.getRGB(cc,kp(c)),r.buffers.color.setClear(cc.r,cc.g,cc.b,L,f)}return{getClearColor:function(){return p},setClearColor:function(z,L=1){p.set(z),y=L,$(p,y)},getClearAlpha:function(){return y},setClearAlpha:function(z){y=z,$(p,y)},render:function U(z,L){let te=!1,X=!0===L.isScene?L.background:null;switch(X&&X.isTexture&&(X=(L.backgroundBlurriness>0?t:e).get(X)),null===X?$(p,y):X&&X.isColor&&($(X,1),te=!0),c.xr.getEnvironmentBlendMode()){case"opaque":te=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,f),te=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,f),te=!0}(c.autoClear||te)&&c.clear(c.autoClearColor,c.autoClearDepth,c.autoClearStencil),X&&(X.isCubeTexture||306===X.mapping)?(void 0===w&&(w=new _o(new _a(1,1,1),new _l({name:"BackgroundCubeMaterial",uniforms:vl(Hl.backgroundCube.uniforms),vertexShader:Hl.backgroundCube.vertexShader,fragmentShader:Hl.backgroundCube.fragmentShader,side:fe,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),w.geometry.deleteAttribute("uv"),w.onBeforeRender=function(Te,De,We){this.matrixWorld.copyPosition(We.matrixWorld)},Object.defineProperty(w.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(w)),w.material.uniforms.envMap.value=X,w.material.uniforms.flipEnvMap.value=X.isCubeTexture&&!1===X.isRenderTargetTexture?-1:1,w.material.uniforms.backgroundBlurriness.value=L.backgroundBlurriness,w.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,w.material.toneMapped=X.colorSpace!==Ai,(T!==X||C!==X.version||R!==c.toneMapping)&&(w.material.needsUpdate=!0,T=X,C=X.version,R=c.toneMapping),w.layers.enableAll(),z.unshift(w,w.geometry,w.material,0,0,null)):X&&X.isTexture&&(void 0===_&&(_=new _o(new Yu(2,2),new _l({name:"BackgroundMaterial",uniforms:vl(Hl.background.uniforms),vertexShader:Hl.background.vertexShader,fragmentShader:Hl.background.fragmentShader,side:ri,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),Object.defineProperty(_.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(_)),_.material.uniforms.t2D.value=X,_.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,_.material.toneMapped=X.colorSpace!==Ai,!0===X.matrixAutoUpdate&&X.updateMatrix(),_.material.uniforms.uvTransform.value.copy(X.matrix),(T!==X||C!==X.version||R!==c.toneMapping)&&(_.material.needsUpdate=!0,T=X,C=X.version,R=c.toneMapping),_.layers.enableAll(),z.unshift(_,_.geometry,_.material,0,0,null))}}}function dv(c,e,t,r){const o=c.getParameter(c.MAX_VERTEX_ATTRIBS),l=r.isWebGL2?null:e.get("OES_vertex_array_object"),f=r.isWebGL2||null!==l,p={},y=z(null);let _=y,w=!1;function R(dt){return r.isWebGL2?c.bindVertexArray(dt):l.bindVertexArrayOES(dt)}function U(dt){return r.isWebGL2?c.deleteVertexArray(dt):l.deleteVertexArrayOES(dt)}function z(dt){const xt=[],Zt=[],Pt=[];for(let Bt=0;Bt<o;Bt++)xt[Bt]=0,Zt[Bt]=0,Pt[Bt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:xt,enabledAttributes:Zt,attributeDivisors:Pt,object:dt,attributes:{},index:null}}function X(){const dt=_.newAttributes;for(let xt=0,Zt=dt.length;xt<Zt;xt++)dt[xt]=0}function ae(dt){ve(dt,0)}function ve(dt,xt){const Pt=_.enabledAttributes,Bt=_.attributeDivisors;_.newAttributes[dt]=1,0===Pt[dt]&&(c.enableVertexAttribArray(dt),Pt[dt]=1),Bt[dt]!==xt&&((r.isWebGL2?c:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](dt,xt),Bt[dt]=xt)}function Te(){const dt=_.newAttributes,xt=_.enabledAttributes;for(let Zt=0,Pt=xt.length;Zt<Pt;Zt++)xt[Zt]!==dt[Zt]&&(c.disableVertexAttribArray(Zt),xt[Zt]=0)}function De(dt,xt,Zt,Pt,Bt,en,nn){!0===nn?c.vertexAttribIPointer(dt,xt,Zt,Bt,en):c.vertexAttribPointer(dt,xt,Zt,Pt,Bt,en)}function qt(){ct(),w=!0,_!==y&&(_=y,R(_.object))}function ct(){y.geometry=null,y.program=null,y.wireframe=!1}return{setup:function T(dt,xt,Zt,Pt,Bt){let en=!1;if(f){const nn=function $(dt,xt,Zt){const Pt=!0===Zt.wireframe;let Bt=p[dt.id];void 0===Bt&&(Bt={},p[dt.id]=Bt);let en=Bt[xt.id];void 0===en&&(en={},Bt[xt.id]=en);let nn=en[Pt];return void 0===nn&&(nn=z(function C(){return r.isWebGL2?c.createVertexArray():l.createVertexArrayOES()}()),en[Pt]=nn),nn}(Pt,Zt,xt);_!==nn&&(_=nn,R(_.object)),en=function L(dt,xt,Zt,Pt){const Bt=_.attributes,en=xt.attributes;let nn=0;const at=Zt.getAttributes();for(const Nt in at)if(at[Nt].location>=0){const Un=Bt[Nt];let $n=en[Nt];if(void 0===$n&&("instanceMatrix"===Nt&&dt.instanceMatrix&&($n=dt.instanceMatrix),"instanceColor"===Nt&&dt.instanceColor&&($n=dt.instanceColor)),void 0===Un||Un.attribute!==$n||$n&&Un.data!==$n.data)return!0;nn++}return _.attributesNum!==nn||_.index!==Pt}(dt,Pt,Zt,Bt),en&&function te(dt,xt,Zt,Pt){const Bt={},en=xt.attributes;let nn=0;const at=Zt.getAttributes();for(const Nt in at)if(at[Nt].location>=0){let Un=en[Nt];void 0===Un&&("instanceMatrix"===Nt&&dt.instanceMatrix&&(Un=dt.instanceMatrix),"instanceColor"===Nt&&dt.instanceColor&&(Un=dt.instanceColor));const $n={};$n.attribute=Un,Un&&Un.data&&($n.data=Un.data),Bt[Nt]=$n,nn++}_.attributes=Bt,_.attributesNum=nn,_.index=Pt}(dt,Pt,Zt,Bt)}else{const nn=!0===xt.wireframe;(_.geometry!==Pt.id||_.program!==Zt.id||_.wireframe!==nn)&&(_.geometry=Pt.id,_.program=Zt.id,_.wireframe=nn,en=!0)}null!==Bt&&t.update(Bt,c.ELEMENT_ARRAY_BUFFER),(en||w)&&(w=!1,function We(dt,xt,Zt,Pt){if(!1===r.isWebGL2&&(dt.isInstancedMesh||Pt.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;X();const Bt=Pt.attributes,en=Zt.getAttributes(),nn=xt.defaultAttributeValues;for(const at in en){const Nt=en[at];if(Nt.location>=0){let Nn=Bt[at];if(void 0===Nn&&("instanceMatrix"===at&&dt.instanceMatrix&&(Nn=dt.instanceMatrix),"instanceColor"===at&&dt.instanceColor&&(Nn=dt.instanceColor)),void 0!==Nn){const Un=Nn.normalized,$n=Nn.itemSize,_i=t.get(Nn);if(void 0===_i)continue;const mi=_i.buffer,bi=_i.type,Rr=_i.bytesPerElement,fs=!0===r.isWebGL2&&(bi===c.INT||bi===c.UNSIGNED_INT||1013===Nn.gpuType);if(Nn.isInterleavedBufferAttribute){const Ii=Nn.data,ze=Ii.stride,Sn=Nn.offset;if(Ii.isInstancedInterleavedBuffer){for(let Vt=0;Vt<Nt.locationSize;Vt++)ve(Nt.location+Vt,Ii.meshPerAttribute);!0!==dt.isInstancedMesh&&void 0===Pt._maxInstanceCount&&(Pt._maxInstanceCount=Ii.meshPerAttribute*Ii.count)}else for(let Vt=0;Vt<Nt.locationSize;Vt++)ae(Nt.location+Vt);c.bindBuffer(c.ARRAY_BUFFER,mi);for(let Vt=0;Vt<Nt.locationSize;Vt++)De(Nt.location+Vt,$n/Nt.locationSize,bi,Un,ze*Rr,(Sn+$n/Nt.locationSize*Vt)*Rr,fs)}else{if(Nn.isInstancedBufferAttribute){for(let Ii=0;Ii<Nt.locationSize;Ii++)ve(Nt.location+Ii,Nn.meshPerAttribute);!0!==dt.isInstancedMesh&&void 0===Pt._maxInstanceCount&&(Pt._maxInstanceCount=Nn.meshPerAttribute*Nn.count)}else for(let Ii=0;Ii<Nt.locationSize;Ii++)ae(Nt.location+Ii);c.bindBuffer(c.ARRAY_BUFFER,mi);for(let Ii=0;Ii<Nt.locationSize;Ii++)De(Nt.location+Ii,$n/Nt.locationSize,bi,Un,$n*Rr,$n/Nt.locationSize*Ii*Rr,fs)}}else if(void 0!==nn){const Un=nn[at];if(void 0!==Un)switch(Un.length){case 2:c.vertexAttrib2fv(Nt.location,Un);break;case 3:c.vertexAttrib3fv(Nt.location,Un);break;case 4:c.vertexAttrib4fv(Nt.location,Un);break;default:c.vertexAttrib1fv(Nt.location,Un)}}}}Te()}(dt,xt,Zt,Pt),null!==Bt&&c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.get(Bt).buffer))},reset:qt,resetDefaultState:ct,dispose:function le(){qt();for(const dt in p){const xt=p[dt];for(const Zt in xt){const Pt=xt[Zt];for(const Bt in Pt)U(Pt[Bt].object),delete Pt[Bt];delete xt[Zt]}delete p[dt]}},releaseStatesOfGeometry:function Se(dt){if(void 0===p[dt.id])return;const xt=p[dt.id];for(const Zt in xt){const Pt=xt[Zt];for(const Bt in Pt)U(Pt[Bt].object),delete Pt[Bt];delete xt[Zt]}delete p[dt.id]},releaseStatesOfProgram:function bt(dt){for(const xt in p){const Zt=p[xt];if(void 0===Zt[dt.id])continue;const Pt=Zt[dt.id];for(const Bt in Pt)U(Pt[Bt].object),delete Pt[Bt];delete Zt[dt.id]}},initAttributes:X,enableAttribute:ae,disableUnusedAttributes:Te}}function fv(c,e,t,r){const o=r.isWebGL2;let l;this.setMode=function f(_){l=_},this.render=function p(_,w){c.drawArrays(l,_,w),t.update(w,l,1)},this.renderInstances=function y(_,w,T){if(0===T)return;let C,R;if(o)C=c,R="drawArraysInstanced";else if(C=e.get("ANGLE_instanced_arrays"),R="drawArraysInstancedANGLE",null===C)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");C[R](l,_,w,T),t.update(w,l,T)}}function lf(c,e,t){let r;function l(De){if("highp"===De){if(c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.HIGH_FLOAT).precision>0&&c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT).precision>0)return"highp";De="mediump"}return"mediump"===De&&c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.MEDIUM_FLOAT).precision>0&&c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const f="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===c.constructor.name;let p=void 0!==t.precision?t.precision:"highp";const y=l(p);y!==p&&(console.warn("THREE.WebGLRenderer:",p,"not supported, using",y,"instead."),p=y);const _=f||e.has("WEBGL_draw_buffers"),w=!0===t.logarithmicDepthBuffer,T=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),C=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS),R=c.getParameter(c.MAX_TEXTURE_SIZE),U=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE),$=c.getParameter(c.MAX_VERTEX_ATTRIBS),z=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS),L=c.getParameter(c.MAX_VARYING_VECTORS),te=c.getParameter(c.MAX_FRAGMENT_UNIFORM_VECTORS),X=C>0,ae=f||e.has("OES_texture_float");return{isWebGL2:f,drawBuffers:_,getMaxAnisotropy:function o(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const De=e.get("EXT_texture_filter_anisotropic");r=c.getParameter(De.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:l,precision:p,logarithmicDepthBuffer:w,maxTextures:T,maxVertexTextures:C,maxTextureSize:R,maxCubemapSize:U,maxAttributes:$,maxVertexUniforms:z,maxVaryings:L,maxFragmentUniforms:te,vertexTextures:X,floatFragmentTextures:ae,floatVertexTextures:X&&ae,maxSamples:f?c.getParameter(c.MAX_SAMPLES):0}}function pv(c){const e=this;let t=null,r=0,o=!1,l=!1;const f=new lc,p=new Mi,y={value:null,needsUpdate:!1};function w(T,C,R,U){const $=null!==T?T.length:0;let z=null;if(0!==$){if(z=y.value,!0!==U||null===z){const L=R+4*$,te=C.matrixWorldInverse;p.getNormalMatrix(te),(null===z||z.length<L)&&(z=new Float32Array(L));for(let X=0,ae=R;X!==$;++X,ae+=4)f.copy(T[X]).applyMatrix4(te,p),f.normal.toArray(z,ae),z[ae+3]=f.constant}y.value=z,y.needsUpdate=!0}return e.numPlanes=$,e.numIntersection=0,z}this.uniform=y,this.numPlanes=0,this.numIntersection=0,this.init=function(T,C){const R=0!==T.length||C||0!==r||o;return o=C,r=T.length,R},this.beginShadows=function(){l=!0,w(null)},this.endShadows=function(){l=!1},this.setGlobalState=function(T,C){t=w(T,C,0)},this.setState=function(T,C,R){const U=T.clippingPlanes,$=T.clipIntersection,z=T.clipShadows,L=c.get(T);if(!o||null===U||0===U.length||l&&!z)l?w(null):function _(){y.value!==t&&(y.value=t,y.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}();else{const te=l?0:r,X=4*te;let ae=L.clippingState||null;y.value=ae,ae=w(U,C,X,R);for(let ve=0;ve!==X;++ve)ae[ve]=t[ve];L.clippingState=ae,this.numIntersection=$?this.numPlanes:0,this.numPlanes+=te}}}function mv(c){let e=new WeakMap;function t(f,p){return p===Ts?f.mapping=301:304===p&&(f.mapping=302),f}function o(f){const p=f.target;p.removeEventListener("dispose",o);const y=e.get(p);void 0!==y&&(e.delete(p),y.dispose())}return{get:function r(f){if(f&&f.isTexture&&!1===f.isRenderTargetTexture){const p=f.mapping;if(p===Ts||304===p){if(e.has(f))return t(e.get(f).texture,f.mapping);{const y=f.image;if(y&&y.height>0){const _=new Up(y.height/2);return _.fromEquirectangularTexture(c,f),e.set(f,_),f.addEventListener("dispose",o),t(_.texture,f.mapping)}return null}}}return f},dispose:function l(){e=new WeakMap}}}class Fc extends Bd{constructor(e=-1,t=1,r=1,o=-1,l=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=o,this.near=l,this.far=f,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,o,l,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=o,this.view.width=l,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let l=r-e,f=r+e,p=o+t,y=o-t;if(null!==this.view&&this.view.enabled){const _=(this.right-this.left)/this.view.fullWidth/this.zoom,w=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=_*this.view.offsetX,f=l+_*this.view.width,p-=w*this.view.offsetY,y=p-w*this.view.height}this.projectionMatrix.makeOrthographic(l,f,p,y,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const xm=[.125,.215,.35,.446,.526,.582],cf=new Fc,Mm=new gn;let uf=null;const kc=(1+Math.sqrt(5))/2,Uc=1/kc,bm=[new Me(1,1,1),new Me(-1,1,1),new Me(1,1,-1),new Me(-1,1,-1),new Me(0,kc,Uc),new Me(0,kc,-Uc),new Me(Uc,0,kc),new Me(-Uc,0,kc),new Me(kc,Uc,0),new Me(-kc,Uc,0)];class wm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,o=100){uf=this._renderer.getRenderTarget(),this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,o,l),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=gv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=df(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(uf),e.scissorTest=!1,hf(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),uf=this._renderer.getRenderTarget();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Z,minFilter:Z,generateMipmaps:!1,type:kt,format:Oe,colorSpace:Us,depthBuffer:!1},o=Za(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Za(e,t,r);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function _u(c){const e=[],t=[],r=[];let o=c;const l=c-4+1+xm.length;for(let f=0;f<l;f++){const p=Math.pow(2,o);t.push(p);let y=1/p;f>c-4?y=xm[f-c+4-1]:0===f&&(y=0),r.push(y);const _=1/(p-2),w=-_,T=1+_,C=[w,w,T,w,T,T,w,w,T,T,w,T],R=6,U=6,$=3,z=2,L=1,te=new Float32Array($*U*R),X=new Float32Array(z*U*R),ae=new Float32Array(L*U*R);for(let Te=0;Te<R;Te++){const De=Te%3*2/3-1,We=Te>2?0:-1;te.set([De,We,0,De+2/3,We,0,De+2/3,We+1,0,De,We,0,De+2/3,We+1,0,De,We+1,0],$*U*Te),X.set(C,z*U*Te),ae.set([Te,Te,Te,Te,Te,Te],L*U*Te)}const ve=new hi;ve.setAttribute("position",new de(te,$)),ve.setAttribute("uv",new de(X,z)),ve.setAttribute("faceIndex",new de(ae,L)),e.push(ve),o>4&&o--}return{lodPlanes:e,sizeLods:t,sigmas:r}}(l)),this._blurMaterial=function ox(c,e,t){const r=new Float32Array(20),o=new Me(0,1,0);return new _l({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${c}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Gn,depthTest:!1,depthWrite:!1})}(l,e,t)}return o}_compileMaterial(e){const t=new _o(this._lodPlanes[0],e);this._renderer.compile(t,cf)}_sceneToCubeUV(e,t,r,o){const p=new Lo(90,1,t,r),y=[1,-1,1,1,1,1],_=[1,1,1,-1,-1,-1],w=this._renderer,T=w.autoClear,C=w.toneMapping;w.getClearColor(Mm),w.toneMapping=0,w.autoClear=!1;const R=new u({name:"PMREM.Background",side:fe,depthWrite:!1,depthTest:!1}),U=new _o(new _a,R);let $=!1;const z=e.background;z?z.isColor&&(R.color.copy(z),e.background=null,$=!0):(R.color.copy(Mm),$=!0);for(let L=0;L<6;L++){const te=L%3;0===te?(p.up.set(0,y[L],0),p.lookAt(_[L],0,0)):1===te?(p.up.set(0,0,y[L]),p.lookAt(0,_[L],0)):(p.up.set(0,y[L],0),p.lookAt(0,0,_[L]));const X=this._cubeSize;hf(o,te*X,L>2?X:0,X,X),w.setRenderTarget(o),$&&w.render(U,p),w.render(e,p)}U.geometry.dispose(),U.material.dispose(),w.toneMapping=C,w.autoClear=T,e.background=z}_textureToCubeUV(e,t){const r=this._renderer,o=301===e.mapping||302===e.mapping;o?(null===this._cubemapMaterial&&(this._cubemapMaterial=gv()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=df());const l=o?this._cubemapMaterial:this._equirectMaterial,f=new _o(this._lodPlanes[0],l);l.uniforms.envMap.value=e;const y=this._cubeSize;hf(t,0,0,3*y,2*y),r.setRenderTarget(t),r.render(f,cf)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let o=1;o<this._lodPlanes.length;o++){const l=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]);this._blur(e,o-1,o,l,bm[(o-1)%bm.length])}t.autoClear=r}_blur(e,t,r,o,l){const f=this._pingPongRenderTarget;this._halfBlur(e,f,t,r,o,"latitudinal",l),this._halfBlur(f,e,r,r,o,"longitudinal",l)}_halfBlur(e,t,r,o,l,f,p){const y=this._renderer,_=this._blurMaterial;"latitudinal"!==f&&"longitudinal"!==f&&console.error("blur direction must be either latitudinal or longitudinal!");const T=new _o(this._lodPlanes[o],_),C=_.uniforms,R=this._sizeLods[r]-1,U=isFinite(l)?Math.PI/(2*R):2*Math.PI/39,$=l/U,z=isFinite(l)?1+Math.floor(3*$):20;z>20&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${z} samples when the maximum is set to 20`);const L=[];let te=0;for(let De=0;De<20;++De){const We=De/$,le=Math.exp(-We*We/2);L.push(le),0===De?te+=le:De<z&&(te+=2*le)}for(let De=0;De<L.length;De++)L[De]=L[De]/te;C.envMap.value=e.texture,C.samples.value=z,C.weights.value=L,C.latitudinal.value="latitudinal"===f,p&&(C.poleAxis.value=p);const{_lodMax:X}=this;C.dTheta.value=U,C.mipInt.value=X-r;const ae=this._sizeLods[o];hf(t,3*ae*(o>X-4?o-X+4:0),4*(this._cubeSize-ae),3*ae,2*ae),y.setRenderTarget(t),y.render(T,cf)}}function Za(c,e,t){const r=new Ta(c,e,t);return r.texture.mapping=306,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function hf(c,e,t,r,o){c.viewport.set(e,t,r,o),c.scissor.set(e,t,r,o)}function df(){return new _l({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Gn,depthTest:!1,depthWrite:!1})}function gv(){return new _l({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Gn,depthTest:!1,depthWrite:!1})}function ax(c){let e=new WeakMap,t=null;function l(p){const y=p.target;y.removeEventListener("dispose",l);const _=e.get(y);void 0!==_&&(e.delete(y),_.dispose())}return{get:function r(p){if(p&&p.isTexture){const y=p.mapping,_=y===Ts||304===y,w=301===y||302===y;if(_||w){if(p.isRenderTargetTexture&&!0===p.needsPMREMUpdate){p.needsPMREMUpdate=!1;let T=e.get(p);return null===t&&(t=new wm(c)),T=_?t.fromEquirectangular(p,T):t.fromCubemap(p,T),e.set(p,T),T.texture}if(e.has(p))return e.get(p).texture;{const T=p.image;if(_&&T&&T.height>0||w&&T&&function o(p){let y=0;for(let w=0;w<6;w++)void 0!==p[w]&&y++;return 6===y}(T)){null===t&&(t=new wm(c));const C=_?t.fromEquirectangular(p):t.fromCubemap(p);return e.set(p,C),p.addEventListener("dispose",l),C.texture}return null}}}return p},dispose:function f(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function Em(c){const e={};function t(r){if(void 0!==e[r])return e[r];let o;switch(r){case"WEBGL_depth_texture":o=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=c.getExtension("WEBGL_compressed_texture_pvrtc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=c.getExtension(r)}return e[r]=o,o}return{has:function(r){return null!==t(r)},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const o=t(r);return null===o&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),o}}}function yv(c,e,t,r){const o={},l=new WeakMap;function f(T){const C=T.target;null!==C.index&&e.remove(C.index);for(const U in C.attributes)e.remove(C.attributes[U]);for(const U in C.morphAttributes){const $=C.morphAttributes[U];for(let z=0,L=$.length;z<L;z++)e.remove($[z])}C.removeEventListener("dispose",f),delete o[C.id];const R=l.get(C);R&&(e.remove(R),l.delete(C)),r.releaseStatesOfGeometry(C),!0===C.isInstancedBufferGeometry&&delete C._maxInstanceCount,t.memory.geometries--}function _(T){const C=[],R=T.index,U=T.attributes.position;let $=0;if(null!==R){const te=R.array;$=R.version;for(let X=0,ae=te.length;X<ae;X+=3){const ve=te[X+0],Te=te[X+1],De=te[X+2];C.push(ve,Te,Te,De,De,ve)}}else{if(void 0===U)return;$=U.version;for(let X=0,ae=U.array.length/3-1;X<ae;X+=3){const ve=X+0,Te=X+1,De=X+2;C.push(ve,Te,Te,De,De,ve)}}const z=new(Aa(C)?wn:wt)(C,1);z.version=$;const L=l.get(T);L&&e.remove(L),l.set(T,z)}return{get:function p(T,C){return!0===o[C.id]||(C.addEventListener("dispose",f),o[C.id]=!0,t.memory.geometries++),C},update:function y(T){const C=T.attributes;for(const U in C)e.update(C[U],c.ARRAY_BUFFER);const R=T.morphAttributes;for(const U in R){const $=R[U];for(let z=0,L=$.length;z<L;z++)e.update($[z],c.ARRAY_BUFFER)}},getWireframeAttribute:function w(T){const C=l.get(T);if(C){const R=T.index;null!==R&&C.version<R.version&&_(T)}else _(T);return l.get(T)}}}function Sm(c,e,t,r){const o=r.isWebGL2;let l,p,y;this.setMode=function f(C){l=C},this.setIndex=function _(C){p=C.type,y=C.bytesPerElement},this.render=function w(C,R){c.drawElements(l,R,p,C*y),t.update(R,l,1)},this.renderInstances=function T(C,R,U){if(0===U)return;let $,z;if(o)$=c,z="drawElementsInstanced";else if($=e.get("ANGLE_instanced_arrays"),z="drawElementsInstancedANGLE",null===$)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");$[z](l,R,p,C*y,U),t.update(R,l,U)}}function vv(c){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function o(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function r(l,f,p){switch(t.calls++,f){case c.TRIANGLES:t.triangles+=p*(l/3);break;case c.LINES:t.lines+=p*(l/2);break;case c.LINE_STRIP:t.lines+=p*(l-1);break;case c.LINE_LOOP:t.lines+=p*l;break;case c.POINTS:t.points+=p*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",f)}}}}function _v(c,e){return c[0]-e[0]}function Ka(c,e){return Math.abs(e[1])-Math.abs(c[1])}function xv(c,e,t){const r={},o=new Float32Array(8),l=new WeakMap,f=new tr,p=[];for(let _=0;_<8;_++)p[_]=[_,0];return{update:function y(_,w,T){const C=_.morphTargetInfluences;if(!0===e.isWebGL2){const R=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,U=void 0!==R?R.length:0;let $=l.get(w);if(void 0===$||$.count!==U){let dt=function(){qt.dispose(),l.delete(w),w.removeEventListener("dispose",dt)};void 0!==$&&$.texture.dispose();const te=void 0!==w.morphAttributes.position,X=void 0!==w.morphAttributes.normal,ae=void 0!==w.morphAttributes.color,ve=w.morphAttributes.position||[],Te=w.morphAttributes.normal||[],De=w.morphAttributes.color||[];let We=0;!0===te&&(We=1),!0===X&&(We=2),!0===ae&&(We=3);let le=w.attributes.position.count*We,Se=1;le>e.maxTextureSize&&(Se=Math.ceil(le/e.maxTextureSize),le=e.maxTextureSize);const bt=new Float32Array(le*Se*4*U),qt=new Vs(bt,le,Se,U);qt.type=st,qt.needsUpdate=!0;const ct=4*We;for(let xt=0;xt<U;xt++){const Zt=ve[xt],Pt=Te[xt],Bt=De[xt],en=le*Se*4*xt;for(let nn=0;nn<Zt.count;nn++){const at=nn*ct;!0===te&&(f.fromBufferAttribute(Zt,nn),bt[en+at+0]=f.x,bt[en+at+1]=f.y,bt[en+at+2]=f.z,bt[en+at+3]=0),!0===X&&(f.fromBufferAttribute(Pt,nn),bt[en+at+4]=f.x,bt[en+at+5]=f.y,bt[en+at+6]=f.z,bt[en+at+7]=0),!0===ae&&(f.fromBufferAttribute(Bt,nn),bt[en+at+8]=f.x,bt[en+at+9]=f.y,bt[en+at+10]=f.z,bt[en+at+11]=4===Bt.itemSize?f.w:1)}}$={count:U,texture:qt,size:new Et(le,Se)},l.set(w,$),w.addEventListener("dispose",dt)}let z=0;for(let te=0;te<C.length;te++)z+=C[te];const L=w.morphTargetsRelative?1:1-z;T.getUniforms().setValue(c,"morphTargetBaseInfluence",L),T.getUniforms().setValue(c,"morphTargetInfluences",C),T.getUniforms().setValue(c,"morphTargetsTexture",$.texture,t),T.getUniforms().setValue(c,"morphTargetsTextureSize",$.size)}else{const R=void 0===C?0:C.length;let U=r[w.id];if(void 0===U||U.length!==R){U=[];for(let X=0;X<R;X++)U[X]=[X,0];r[w.id]=U}for(let X=0;X<R;X++){const ae=U[X];ae[0]=X,ae[1]=C[X]}U.sort(Ka);for(let X=0;X<8;X++)X<R&&U[X][1]?(p[X][0]=U[X][0],p[X][1]=U[X][1]):(p[X][0]=Number.MAX_SAFE_INTEGER,p[X][1]=0);p.sort(_v);const $=w.morphAttributes.position,z=w.morphAttributes.normal;let L=0;for(let X=0;X<8;X++){const ae=p[X],ve=ae[0],Te=ae[1];ve!==Number.MAX_SAFE_INTEGER&&Te?($&&w.getAttribute("morphTarget"+X)!==$[ve]&&w.setAttribute("morphTarget"+X,$[ve]),z&&w.getAttribute("morphNormal"+X)!==z[ve]&&w.setAttribute("morphNormal"+X,z[ve]),o[X]=Te,L+=Te):($&&!0===w.hasAttribute("morphTarget"+X)&&w.deleteAttribute("morphTarget"+X),z&&!0===w.hasAttribute("morphNormal"+X)&&w.deleteAttribute("morphNormal"+X),o[X]=0)}const te=w.morphTargetsRelative?1:1-L;T.getUniforms().setValue(c,"morphTargetBaseInfluence",te),T.getUniforms().setValue(c,"morphTargetInfluences",o)}}}}function Am(c,e,t,r){let o=new WeakMap;function p(y){const _=y.target;_.removeEventListener("dispose",p),t.remove(_.instanceMatrix),null!==_.instanceColor&&t.remove(_.instanceColor)}return{update:function l(y){const _=r.render.frame,T=e.get(y,y.geometry);if(o.get(T)!==_&&(e.update(T),o.set(T,_)),y.isInstancedMesh&&(!1===y.hasEventListener("dispose",p)&&y.addEventListener("dispose",p),o.get(y)!==_&&(t.update(y.instanceMatrix,c.ARRAY_BUFFER),null!==y.instanceColor&&t.update(y.instanceColor,c.ARRAY_BUFFER),o.set(y,_))),y.isSkinnedMesh){const C=y.skeleton;o.get(C)!==_&&(C.update(),o.set(C,_))}return T},dispose:function f(){o=new WeakMap}}}const Tm=new ua,Cm=new Vs,Dm=new Ur,Rm=new Vd,ff=[],Im=[],Pm=new Float32Array(16),Lm=new Float32Array(9),Ui=new Float32Array(4);function Bc(c,e,t){const r=c[0];if(r<=0||r>0)return c;const o=e*t;let l=ff[o];if(void 0===l&&(l=new Float32Array(o),ff[o]=l),0!==e){r.toArray(l,0);for(let f=1,p=0;f!==e;++f)p+=t,c[f].toArray(l,p)}return l}function js(c,e){if(c.length!==e.length)return!1;for(let t=0,r=c.length;t<r;t++)if(c[t]!==e[t])return!1;return!0}function $s(c,e){for(let t=0,r=e.length;t<r;t++)c[t]=e[t]}function Vc(c,e){let t=Im[e];void 0===t&&(t=new Int32Array(e),Im[e]=t);for(let r=0;r!==e;++r)t[r]=c.allocateTextureUnit();return t}function Ja(c,e){const t=this.cache;t[0]!==e&&(c.uniform1f(this.addr,e),t[0]=e)}function Om(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(c.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(js(t,e))return;c.uniform2fv(this.addr,e),$s(t,e)}}function Mv(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(c.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(c.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(js(t,e))return;c.uniform3fv(this.addr,e),$s(t,e)}}function pf(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(c.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(js(t,e))return;c.uniform4fv(this.addr,e),$s(t,e)}}function Gl(c,e){const t=this.cache,r=e.elements;if(void 0===r){if(js(t,e))return;c.uniformMatrix2fv(this.addr,!1,e),$s(t,e)}else{if(js(t,r))return;Ui.set(r),c.uniformMatrix2fv(this.addr,!1,Ui),$s(t,r)}}function mf(c,e){const t=this.cache,r=e.elements;if(void 0===r){if(js(t,e))return;c.uniformMatrix3fv(this.addr,!1,e),$s(t,e)}else{if(js(t,r))return;Lm.set(r),c.uniformMatrix3fv(this.addr,!1,Lm),$s(t,r)}}function Fm(c,e){const t=this.cache,r=e.elements;if(void 0===r){if(js(t,e))return;c.uniformMatrix4fv(this.addr,!1,e),$s(t,e)}else{if(js(t,r))return;Pm.set(r),c.uniformMatrix4fv(this.addr,!1,Pm),$s(t,r)}}function gf(c,e){const t=this.cache;t[0]!==e&&(c.uniform1i(this.addr,e),t[0]=e)}function lx(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(c.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(js(t,e))return;c.uniform2iv(this.addr,e),$s(t,e)}}function Nm(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(c.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(js(t,e))return;c.uniform3iv(this.addr,e),$s(t,e)}}function cx(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(c.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(js(t,e))return;c.uniform4iv(this.addr,e),$s(t,e)}}function Yh(c,e){const t=this.cache;t[0]!==e&&(c.uniform1ui(this.addr,e),t[0]=e)}function qh(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(c.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(js(t,e))return;c.uniform2uiv(this.addr,e),$s(t,e)}}function yf(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(c.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(js(t,e))return;c.uniform3uiv(this.addr,e),$s(t,e)}}function vf(c,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(c.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(js(t,e))return;c.uniform4uiv(this.addr,e),$s(t,e)}}function _f(c,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(c.uniform1i(this.addr,o),r[0]=o),t.setTexture2D(e||Tm,o)}function ux(c,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(c.uniform1i(this.addr,o),r[0]=o),t.setTexture3D(e||Dm,o)}function bv(c,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(c.uniform1i(this.addr,o),r[0]=o),t.setTextureCube(e||Rm,o)}function wv(c,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(c.uniform1i(this.addr,o),r[0]=o),t.setTexture2DArray(e||Cm,o)}function Sv(c,e){c.uniform1fv(this.addr,e)}function km(c,e){const t=Bc(e,this.size,2);c.uniform2fv(this.addr,t)}function hx(c,e){const t=Bc(e,this.size,3);c.uniform3fv(this.addr,t)}function Av(c,e){const t=Bc(e,this.size,4);c.uniform4fv(this.addr,t)}function dx(c,e){const t=Bc(e,this.size,4);c.uniformMatrix2fv(this.addr,!1,t)}function Um(c,e){const t=Bc(e,this.size,9);c.uniformMatrix3fv(this.addr,!1,t)}function Bm(c,e){const t=Bc(e,this.size,16);c.uniformMatrix4fv(this.addr,!1,t)}function Tv(c,e){c.uniform1iv(this.addr,e)}function xf(c,e){c.uniform2iv(this.addr,e)}function fx(c,e){c.uniform3iv(this.addr,e)}function px(c,e){c.uniform4iv(this.addr,e)}function mx(c,e){c.uniform1uiv(this.addr,e)}function gx(c,e){c.uniform2uiv(this.addr,e)}function yx(c,e){c.uniform3uiv(this.addr,e)}function vx(c,e){c.uniform4uiv(this.addr,e)}function _x(c,e,t){const r=this.cache,o=e.length,l=Vc(t,o);js(r,l)||(c.uniform1iv(this.addr,l),$s(r,l));for(let f=0;f!==o;++f)t.setTexture2D(e[f]||Tm,l[f])}function xx(c,e,t){const r=this.cache,o=e.length,l=Vc(t,o);js(r,l)||(c.uniform1iv(this.addr,l),$s(r,l));for(let f=0;f!==o;++f)t.setTexture3D(e[f]||Dm,l[f])}function Mx(c,e,t){const r=this.cache,o=e.length,l=Vc(t,o);js(r,l)||(c.uniform1iv(this.addr,l),$s(r,l));for(let f=0;f!==o;++f)t.setTextureCube(e[f]||Rm,l[f])}function bx(c,e,t){const r=this.cache,o=e.length,l=Vc(t,o);js(r,l)||(c.uniform1iv(this.addr,l),$s(r,l));for(let f=0;f!==o;++f)t.setTexture2DArray(e[f]||Cm,l[f])}class Mf{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function Ev(c){switch(c){case 5126:return Ja;case 35664:return Om;case 35665:return Mv;case 35666:return pf;case 35674:return Gl;case 35675:return mf;case 35676:return Fm;case 5124:case 35670:return gf;case 35667:case 35671:return lx;case 35668:case 35672:return Nm;case 35669:case 35673:return cx;case 5125:return Yh;case 36294:return qh;case 36295:return yf;case 36296:return vf;case 35678:case 36198:case 36298:case 36306:case 35682:return _f;case 35679:case 36299:case 36307:return ux;case 35680:case 36300:case 36308:case 36293:return bv;case 36289:case 36303:case 36311:case 36292:return wv}}(t.type)}}class Cv{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function uc(c){switch(c){case 5126:return Sv;case 35664:return km;case 35665:return hx;case 35666:return Av;case 35674:return dx;case 35675:return Um;case 35676:return Bm;case 5124:case 35670:return Tv;case 35667:case 35671:return xf;case 35668:case 35672:return fx;case 35669:case 35673:return px;case 5125:return mx;case 36294:return gx;case 36295:return yx;case 36296:return vx;case 35678:case 36198:case 36298:case 36306:case 35682:return _x;case 35679:case 36299:case 36307:return xx;case 35680:case 36300:case 36308:case 36293:return Mx;case 36289:case 36303:case 36311:case 36292:return bx}}(t.type)}}class Vm{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const o=this.seq;for(let l=0,f=o.length;l!==f;++l){const p=o[l];p.setValue(e,t[p.id],r)}}}const Ju=/(\w+)(\])?(\[|\.)?/g;function bf(c,e){c.seq.push(e),c.map[e.id]=e}function wf(c,e,t){const r=c.name,o=r.length;for(Ju.lastIndex=0;;){const l=Ju.exec(r),f=Ju.lastIndex;let p=l[1];const _=l[3];if("]"===l[2]&&(p|=0),void 0===_||"["===_&&f+2===o){bf(t,void 0===_?new Mf(p,c,e):new Cv(p,c,e));break}{let T=t.map[p];void 0===T&&(T=new Vm(p),bf(t,T)),t=T}}}class Zh{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<r;++o){const l=e.getActiveUniform(t,o);wf(l,e.getUniformLocation(t,l.name),this)}}setValue(e,t,r,o){const l=this.map[t];void 0!==l&&l.setValue(e,r,o)}setOptional(e,t,r){const o=t[r];void 0!==o&&this.setValue(e,r,o)}static upload(e,t,r,o){for(let l=0,f=t.length;l!==f;++l){const p=t[l],y=r[p.id];!1!==y.needsUpdate&&p.setValue(e,y.value,o)}}static seqWithValue(e,t){const r=[];for(let o=0,l=e.length;o!==l;++o){const f=e[o];f.id in t&&r.push(f)}return r}}function Wl(c,e,t){const r=c.createShader(e);return c.shaderSource(r,t),c.compileShader(r),r}let zm=0;function Hm(c,e,t){const r=c.getShaderParameter(e,c.COMPILE_STATUS),o=c.getShaderInfoLog(e).trim();if(r&&""===o)return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const f=parseInt(l[1]);return t.toUpperCase()+"\n\n"+o+"\n\n"+function Dv(c,e){const t=c.split("\n"),r=[],o=Math.max(e-6,0),l=Math.min(e+6,t.length);for(let f=o;f<l;f++){const p=f+1;r.push(`${p===e?">":" "} ${p}: ${t[f]}`)}return r.join("\n")}(c.getShaderSource(e),f)}return o}function Gm(c,e){const t=function Ef(c){switch(c){case Us:return["Linear","( value )"];case Ai:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",c),["Linear","( value )"]}}(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Rv(c,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case Fo:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+c+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function zc(c){return""!==c}function Hc(c,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return c.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Mu(c,e){return c.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const bu=/^[ \t]*#include +<([\w\d./]+)>/gm;function Sf(c){return c.replace(bu,jm)}const Wm=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function jm(c,e){let t=qi[e];if(void 0===t){const r=Wm.get(e);if(void 0===r)throw new Error("Can not resolve #include <"+e+">");t=qi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r)}return Sf(t)}const Af=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Kh(c){return c.replace(Af,$m)}function $m(c,e,t,r){let o="";for(let l=parseInt(e);l<parseInt(t);l++)o+=r.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return o}function eh(c){let e="precision "+c.precision+" float;\nprecision "+c.precision+" int;";return"highp"===c.precision?e+="\n#define HIGH_PRECISION":"mediump"===c.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===c.precision&&(e+="\n#define LOW_PRECISION"),e}function Lv(c,e,t,r){const o=c.getContext(),l=t.defines;let f=t.vertexShader,p=t.fragmentShader;const y=function Pv(c){let e="SHADOWMAP_TYPE_BASIC";return 1===c.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===c.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===c.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),_=function Xm(c){let e="ENVMAP_TYPE_CUBE";if(c.envMap)switch(c.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),w=function wx(c){let e="ENVMAP_MODE_REFLECTION";return c.envMap&&302===c.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),T=function Ym(c){let e="ENVMAP_BLENDING_NONE";if(c.envMap)switch(c.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),C=function qm(c){const e=c.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}(t),R=t.isWebGL2?"":function Iv(c){return[c.extensionDerivatives||c.envMapCubeUVHeight||c.bumpMap||c.normalMapTangentSpace||c.clearcoatNormalMap||c.flatShading||"physical"===c.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(c.extensionFragDepth||c.logarithmicDepthBuffer)&&c.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",c.extensionDrawBuffers&&c.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(c.extensionShaderTextureLOD||c.envMap||c.transmission)&&c.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(zc).join("\n")}(t),U=function Qu(c){const e=[];for(const t in c){const r=c[t];!1!==r&&e.push("#define "+t+" "+r)}return e.join("\n")}(l),$=o.createProgram();let z,L,te=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(z=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U].filter(zc).join("\n"),z.length>0&&(z+="\n"),L=[R,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U].filter(zc).join("\n"),L.length>0&&(L+="\n")):(z=[eh(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+w:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+y:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(zc).join("\n"),L=[R,eh(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+_:"",t.envMap?"#define "+w:"",t.envMap?"#define "+T:"",C?"#define CUBEUV_TEXEL_WIDTH "+C.texelWidth:"",C?"#define CUBEUV_TEXEL_HEIGHT "+C.texelHeight:"",C?"#define CUBEUV_MAX_MIP "+C.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+y:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?qi.tonemapping_pars_fragment:"",0!==t.toneMapping?Rv("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",qi.colorspace_pars_fragment,Gm("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(zc).join("\n")),f=Sf(f),f=Hc(f,t),f=Mu(f,t),p=Sf(p),p=Hc(p,t),p=Mu(p,t),f=Kh(f),p=Kh(p),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(te="#version 300 es\n",z=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+z,L=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+L);const ae=te+L+p,ve=Wl(o,o.VERTEX_SHADER,te+z+f),Te=Wl(o,o.FRAGMENT_SHADER,ae);if(o.attachShader($,ve),o.attachShader($,Te),void 0!==t.index0AttributeName?o.bindAttribLocation($,0,t.index0AttributeName):!0===t.morphTargets&&o.bindAttribLocation($,0,"position"),o.linkProgram($),c.debug.checkShaderErrors){const le=o.getProgramInfoLog($).trim(),Se=o.getShaderInfoLog(ve).trim(),bt=o.getShaderInfoLog(Te).trim();let qt=!0,ct=!0;if(!1===o.getProgramParameter($,o.LINK_STATUS))if(qt=!1,"function"==typeof c.debug.onShaderError)c.debug.onShaderError(o,$,ve,Te);else{const dt=Hm(o,ve,"vertex"),xt=Hm(o,Te,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter($,o.VALIDATE_STATUS)+"\n\nProgram Info Log: "+le+"\n"+dt+"\n"+xt)}else""!==le?console.warn("THREE.WebGLProgram: Program Info Log:",le):(""===Se||""===bt)&&(ct=!1);ct&&(this.diagnostics={runnable:qt,programLog:le,vertexShader:{log:Se,prefix:z},fragmentShader:{log:bt,prefix:L}})}let De,We;return o.deleteShader(ve),o.deleteShader(Te),this.getUniforms=function(){return void 0===De&&(De=new Zh(o,$)),De},this.getAttributes=function(){return void 0===We&&(We=function xu(c,e){const t={},r=c.getProgramParameter(e,c.ACTIVE_ATTRIBUTES);for(let o=0;o<r;o++){const l=c.getActiveAttrib(e,o),f=l.name;let p=1;l.type===c.FLOAT_MAT2&&(p=2),l.type===c.FLOAT_MAT3&&(p=3),l.type===c.FLOAT_MAT4&&(p=4),t[f]={type:l.type,location:c.getAttribLocation(e,f),locationSize:p}}return t}(o,$)),We},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram($),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=zm++,this.cacheKey=e,this.usedTimes=1,this.program=$,this.vertexShader=ve,this.fragmentShader=Te,this}let Zm=0;class Ov{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const r=e.fragmentShader,o=this._getShaderStage(e.vertexShader),l=this._getShaderStage(r),f=this._getShaderCacheForMaterial(e);return!1===f.has(o)&&(f.add(o),o.usedTimes++),!1===f.has(l)&&(f.add(l),l.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new Fv(e),t.set(e,r)),r}}class Fv{constructor(e){this.id=Zm++,this.code=e,this.usedTimes=0}}function xa(c,e,t,r,o,l,f){const p=new cn,y=new Ov,_=[],w=o.isWebGL2,T=o.logarithmicDepthBuffer,C=o.vertexTextures;let R=o.precision;const U={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function $(le){return 0===le?"uv":`uv${le}`}return{getParameters:function z(le,Se,bt,qt,ct){const dt=qt.fog,xt=ct.geometry,Pt=(le.isMeshStandardMaterial?t:e).get(le.envMap||(le.isMeshStandardMaterial?qt.environment:null)),Bt=Pt&&306===Pt.mapping?Pt.image.height:null,en=U[le.type];null!==le.precision&&(R=o.getMaxPrecision(le.precision),R!==le.precision&&console.warn("THREE.WebGLProgram.getParameters:",le.precision,"not supported, using",R,"instead."));const nn=xt.morphAttributes.position||xt.morphAttributes.normal||xt.morphAttributes.color,at=void 0!==nn?nn.length:0;let Nn,Un,$n,_i,Nt=0;if(void 0!==xt.morphAttributes.position&&(Nt=1),void 0!==xt.morphAttributes.normal&&(Nt=2),void 0!==xt.morphAttributes.color&&(Nt=3),en){const os=Hl[en];Nn=os.vertexShader,Un=os.fragmentShader}else Nn=le.vertexShader,Un=le.fragmentShader,y.update(le),$n=y.getVertexShaderID(le),_i=y.getFragmentShaderID(le);const mi=c.getRenderTarget(),bi=!0===ct.isInstancedMesh,Rr=!!le.map,Ii=!!Pt,ze=!!le.aoMap,Sn=!!le.lightMap,Vt=!!le.bumpMap,yn=!!le.normalMap,Jt=!!le.displacementMap,gi=!!le.emissiveMap,Kn=!!le.metalnessMap,ei=!!le.roughnessMap,ji=le.anisotropy>0,hr=le.clearcoat>0,As=le.iridescence>0,Re=le.sheen>0,pe=le.transmission>0,ft=ji&&!!le.anisotropyMap,pn=hr&&!!le.clearcoatMap,dn=hr&&!!le.clearcoatNormalMap,vn=hr&&!!le.clearcoatRoughnessMap,di=As&&!!le.iridescenceMap,xn=As&&!!le.iridescenceThicknessMap,Mt=Re&&!!le.sheenColorMap,Ci=Re&&!!le.sheenRoughnessMap,yi=!!le.specularMap,wi=!!le.specularColorMap,ii=!!le.specularIntensityMap,li=pe&&!!le.transmissionMap,nr=pe&&!!le.thicknessMap,Xe=!!le.alphaMap,An=!!le.extensions,Wn=!!xt.attributes.uv1,xr=!!xt.attributes.uv2,ys=!!xt.attributes.uv3;let Xs=0;return le.toneMapped&&(null===mi||!0===mi.isXRRenderTarget)&&(Xs=c.toneMapping),{isWebGL2:w,shaderID:en,shaderType:le.type,shaderName:le.name,vertexShader:Nn,fragmentShader:Un,defines:le.defines,customVertexShaderID:$n,customFragmentShaderID:_i,isRawShaderMaterial:!0===le.isRawShaderMaterial,glslVersion:le.glslVersion,precision:R,instancing:bi,instancingColor:bi&&null!==ct.instanceColor,supportsVertexTextures:C,outputColorSpace:null===mi?c.outputColorSpace:!0===mi.isXRRenderTarget?mi.texture.colorSpace:Us,map:Rr,matcap:!!le.matcap,envMap:Ii,envMapMode:Ii&&Pt.mapping,envMapCubeUVHeight:Bt,aoMap:ze,lightMap:Sn,bumpMap:Vt,normalMap:yn,displacementMap:C&&Jt,emissiveMap:gi,normalMapObjectSpace:yn&&1===le.normalMapType,normalMapTangentSpace:yn&&0===le.normalMapType,metalnessMap:Kn,roughnessMap:ei,anisotropy:ji,anisotropyMap:ft,clearcoat:hr,clearcoatMap:pn,clearcoatNormalMap:dn,clearcoatRoughnessMap:vn,iridescence:As,iridescenceMap:di,iridescenceThicknessMap:xn,sheen:Re,sheenColorMap:Mt,sheenRoughnessMap:Ci,specularMap:yi,specularColorMap:wi,specularIntensityMap:ii,transmission:pe,transmissionMap:li,thicknessMap:nr,gradientMap:!!le.gradientMap,opaque:!1===le.transparent&&1===le.blending,alphaMap:Xe,alphaTest:le.alphaTest>0,alphaHash:!!le.alphaHash,combine:le.combine,mapUv:Rr&&$(le.map.channel),aoMapUv:ze&&$(le.aoMap.channel),lightMapUv:Sn&&$(le.lightMap.channel),bumpMapUv:Vt&&$(le.bumpMap.channel),normalMapUv:yn&&$(le.normalMap.channel),displacementMapUv:Jt&&$(le.displacementMap.channel),emissiveMapUv:gi&&$(le.emissiveMap.channel),metalnessMapUv:Kn&&$(le.metalnessMap.channel),roughnessMapUv:ei&&$(le.roughnessMap.channel),anisotropyMapUv:ft&&$(le.anisotropyMap.channel),clearcoatMapUv:pn&&$(le.clearcoatMap.channel),clearcoatNormalMapUv:dn&&$(le.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:vn&&$(le.clearcoatRoughnessMap.channel),iridescenceMapUv:di&&$(le.iridescenceMap.channel),iridescenceThicknessMapUv:xn&&$(le.iridescenceThicknessMap.channel),sheenColorMapUv:Mt&&$(le.sheenColorMap.channel),sheenRoughnessMapUv:Ci&&$(le.sheenRoughnessMap.channel),specularMapUv:yi&&$(le.specularMap.channel),specularColorMapUv:wi&&$(le.specularColorMap.channel),specularIntensityMapUv:ii&&$(le.specularIntensityMap.channel),transmissionMapUv:li&&$(le.transmissionMap.channel),thicknessMapUv:nr&&$(le.thicknessMap.channel),alphaMapUv:Xe&&$(le.alphaMap.channel),vertexTangents:!!xt.attributes.tangent&&(yn||ji),vertexColors:le.vertexColors,vertexAlphas:!0===le.vertexColors&&!!xt.attributes.color&&4===xt.attributes.color.itemSize,vertexUv1s:Wn,vertexUv2s:xr,vertexUv3s:ys,pointsUvs:!0===ct.isPoints&&!!xt.attributes.uv&&(Rr||Xe),fog:!!dt,useFog:!0===le.fog,fogExp2:dt&&dt.isFogExp2,flatShading:!0===le.flatShading,sizeAttenuation:!0===le.sizeAttenuation,logarithmicDepthBuffer:T,skinning:!0===ct.isSkinnedMesh,morphTargets:void 0!==xt.morphAttributes.position,morphNormals:void 0!==xt.morphAttributes.normal,morphColors:void 0!==xt.morphAttributes.color,morphTargetsCount:at,morphTextureStride:Nt,numDirLights:Se.directional.length,numPointLights:Se.point.length,numSpotLights:Se.spot.length,numSpotLightMaps:Se.spotLightMap.length,numRectAreaLights:Se.rectArea.length,numHemiLights:Se.hemi.length,numDirLightShadows:Se.directionalShadowMap.length,numPointLightShadows:Se.pointShadowMap.length,numSpotLightShadows:Se.spotShadowMap.length,numSpotLightShadowsWithMaps:Se.numSpotLightShadowsWithMaps,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:le.dithering,shadowMapEnabled:c.shadowMap.enabled&&bt.length>0,shadowMapType:c.shadowMap.type,toneMapping:Xs,useLegacyLights:c._useLegacyLights,premultipliedAlpha:le.premultipliedAlpha,doubleSided:le.side===bn,flipSided:le.side===fe,useDepthPacking:le.depthPacking>=0,depthPacking:le.depthPacking||0,index0AttributeName:le.index0AttributeName,extensionDerivatives:An&&!0===le.extensions.derivatives,extensionFragDepth:An&&!0===le.extensions.fragDepth,extensionDrawBuffers:An&&!0===le.extensions.drawBuffers,extensionShaderTextureLOD:An&&!0===le.extensions.shaderTextureLOD,rendererExtensionFragDepth:w||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:w||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:w||r.has("EXT_shader_texture_lod"),customProgramCacheKey:le.customProgramCacheKey()}},getProgramCacheKey:function L(le){const Se=[];if(le.shaderID?Se.push(le.shaderID):(Se.push(le.customVertexShaderID),Se.push(le.customFragmentShaderID)),void 0!==le.defines)for(const bt in le.defines)Se.push(bt),Se.push(le.defines[bt]);return!1===le.isRawShaderMaterial&&(function te(le,Se){le.push(Se.precision),le.push(Se.outputColorSpace),le.push(Se.envMapMode),le.push(Se.envMapCubeUVHeight),le.push(Se.mapUv),le.push(Se.alphaMapUv),le.push(Se.lightMapUv),le.push(Se.aoMapUv),le.push(Se.bumpMapUv),le.push(Se.normalMapUv),le.push(Se.displacementMapUv),le.push(Se.emissiveMapUv),le.push(Se.metalnessMapUv),le.push(Se.roughnessMapUv),le.push(Se.anisotropyMapUv),le.push(Se.clearcoatMapUv),le.push(Se.clearcoatNormalMapUv),le.push(Se.clearcoatRoughnessMapUv),le.push(Se.iridescenceMapUv),le.push(Se.iridescenceThicknessMapUv),le.push(Se.sheenColorMapUv),le.push(Se.sheenRoughnessMapUv),le.push(Se.specularMapUv),le.push(Se.specularColorMapUv),le.push(Se.specularIntensityMapUv),le.push(Se.transmissionMapUv),le.push(Se.thicknessMapUv),le.push(Se.combine),le.push(Se.fogExp2),le.push(Se.sizeAttenuation),le.push(Se.morphTargetsCount),le.push(Se.morphAttributeCount),le.push(Se.numDirLights),le.push(Se.numPointLights),le.push(Se.numSpotLights),le.push(Se.numSpotLightMaps),le.push(Se.numHemiLights),le.push(Se.numRectAreaLights),le.push(Se.numDirLightShadows),le.push(Se.numPointLightShadows),le.push(Se.numSpotLightShadows),le.push(Se.numSpotLightShadowsWithMaps),le.push(Se.shadowMapType),le.push(Se.toneMapping),le.push(Se.numClippingPlanes),le.push(Se.numClipIntersection),le.push(Se.depthPacking)}(Se,le),function X(le,Se){p.disableAll(),Se.isWebGL2&&p.enable(0),Se.supportsVertexTextures&&p.enable(1),Se.instancing&&p.enable(2),Se.instancingColor&&p.enable(3),Se.matcap&&p.enable(4),Se.envMap&&p.enable(5),Se.normalMapObjectSpace&&p.enable(6),Se.normalMapTangentSpace&&p.enable(7),Se.clearcoat&&p.enable(8),Se.iridescence&&p.enable(9),Se.alphaTest&&p.enable(10),Se.vertexColors&&p.enable(11),Se.vertexAlphas&&p.enable(12),Se.vertexUv1s&&p.enable(13),Se.vertexUv2s&&p.enable(14),Se.vertexUv3s&&p.enable(15),Se.vertexTangents&&p.enable(16),Se.anisotropy&&p.enable(17),le.push(p.mask),p.disableAll(),Se.fog&&p.enable(0),Se.useFog&&p.enable(1),Se.flatShading&&p.enable(2),Se.logarithmicDepthBuffer&&p.enable(3),Se.skinning&&p.enable(4),Se.morphTargets&&p.enable(5),Se.morphNormals&&p.enable(6),Se.morphColors&&p.enable(7),Se.premultipliedAlpha&&p.enable(8),Se.shadowMapEnabled&&p.enable(9),Se.useLegacyLights&&p.enable(10),Se.doubleSided&&p.enable(11),Se.flipSided&&p.enable(12),Se.useDepthPacking&&p.enable(13),Se.dithering&&p.enable(14),Se.transmission&&p.enable(15),Se.sheen&&p.enable(16),Se.opaque&&p.enable(17),Se.pointsUvs&&p.enable(18),le.push(p.mask)}(Se,le),Se.push(c.outputColorSpace)),Se.push(le.customProgramCacheKey),Se.join()},getUniforms:function ae(le){const Se=U[le.type];let bt;return bt=Se?kd.clone(Hl[Se].uniforms):le.uniforms,bt},acquireProgram:function ve(le,Se){let bt;for(let qt=0,ct=_.length;qt<ct;qt++){const dt=_[qt];if(dt.cacheKey===Se){bt=dt,++bt.usedTimes;break}}return void 0===bt&&(bt=new Lv(c,Se,le,l),_.push(bt)),bt},releaseProgram:function Te(le){if(0==--le.usedTimes){const Se=_.indexOf(le);_[Se]=_[_.length-1],_.pop(),le.destroy()}},releaseShaderCache:function De(le){y.remove(le)},programs:_,dispose:function We(){y.dispose()}}}function Nv(){let c=new WeakMap;return{get:function e(l){let f=c.get(l);return void 0===f&&(f={},c.set(l,f)),f},remove:function t(l){c.delete(l)},update:function r(l,f,p){c.get(l)[f]=p},dispose:function o(){c=new WeakMap}}}function kv(c,e){return c.groupOrder!==e.groupOrder?c.groupOrder-e.groupOrder:c.renderOrder!==e.renderOrder?c.renderOrder-e.renderOrder:c.material.id!==e.material.id?c.material.id-e.material.id:c.z!==e.z?c.z-e.z:c.id-e.id}function Uv(c,e){return c.groupOrder!==e.groupOrder?c.groupOrder-e.groupOrder:c.renderOrder!==e.renderOrder?c.renderOrder-e.renderOrder:c.z!==e.z?e.z-c.z:c.id-e.id}function Bv(){const c=[];let e=0;const t=[],r=[],o=[];function f(T,C,R,U,$,z){let L=c[e];return void 0===L?(L={id:T.id,object:T,geometry:C,material:R,groupOrder:U,renderOrder:T.renderOrder,z:$,group:z},c[e]=L):(L.id=T.id,L.object=T,L.geometry=C,L.material=R,L.groupOrder=U,L.renderOrder=T.renderOrder,L.z=$,L.group=z),e++,L}return{opaque:t,transmissive:r,transparent:o,init:function l(){e=0,t.length=0,r.length=0,o.length=0},push:function p(T,C,R,U,$,z){const L=f(T,C,R,U,$,z);R.transmission>0?r.push(L):!0===R.transparent?o.push(L):t.push(L)},unshift:function y(T,C,R,U,$,z){const L=f(T,C,R,U,$,z);R.transmission>0?r.unshift(L):!0===R.transparent?o.unshift(L):t.unshift(L)},finish:function w(){for(let T=e,C=c.length;T<C;T++){const R=c[T];if(null===R.id)break;R.id=null,R.object=null,R.geometry=null,R.material=null,R.group=null}},sort:function _(T,C){t.length>1&&t.sort(T||kv),r.length>1&&r.sort(C||Uv),o.length>1&&o.sort(C||Uv)}}}function Km(){let c=new WeakMap;return{get:function e(r,o){const l=c.get(r);let f;return void 0===l?(f=new Bv,c.set(r,[f])):o>=l.length?(f=new Bv,l.push(f)):f=l[o],f},dispose:function t(){c=new WeakMap}}}function Ex(){const c={};return{get:function(e){if(void 0!==c[e.id])return c[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Me,color:new gn};break;case"SpotLight":t={position:new Me,direction:new Me,color:new gn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Me,color:new gn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Me,skyColor:new gn,groundColor:new gn};break;case"RectAreaLight":t={color:new gn,position:new Me,halfWidth:new Me,halfHeight:new Me}}return c[e.id]=t,t}}}let Tf=0;function Jm(c,e){return(e.castShadow?2:0)-(c.castShadow?2:0)+(e.map?1:0)-(c.map?1:0)}function zv(c,e){const t=new Ex,r=function Vv(){const c={};return{get:function(e){if(void 0!==c[e.id])return c[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et,shadowCameraNear:1,shadowCameraFar:1e3}}return c[e.id]=t,t}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let w=0;w<9;w++)o.probe.push(new Me);const l=new Me,f=new Fi,p=new Fi;return{setup:function y(w,T){let C=0,R=0,U=0;for(let bt=0;bt<9;bt++)o.probe[bt].set(0,0,0);let $=0,z=0,L=0,te=0,X=0,ae=0,ve=0,Te=0,De=0,We=0;w.sort(Jm);const le=!0===T?Math.PI:1;for(let bt=0,qt=w.length;bt<qt;bt++){const ct=w[bt],dt=ct.color,xt=ct.intensity,Zt=ct.distance,Pt=ct.shadow&&ct.shadow.map?ct.shadow.map.texture:null;if(ct.isAmbientLight)C+=dt.r*xt*le,R+=dt.g*xt*le,U+=dt.b*xt*le;else if(ct.isLightProbe)for(let Bt=0;Bt<9;Bt++)o.probe[Bt].addScaledVector(ct.sh.coefficients[Bt],xt);else if(ct.isDirectionalLight){const Bt=t.get(ct);if(Bt.color.copy(ct.color).multiplyScalar(ct.intensity*le),ct.castShadow){const en=ct.shadow,nn=r.get(ct);nn.shadowBias=en.bias,nn.shadowNormalBias=en.normalBias,nn.shadowRadius=en.radius,nn.shadowMapSize=en.mapSize,o.directionalShadow[$]=nn,o.directionalShadowMap[$]=Pt,o.directionalShadowMatrix[$]=ct.shadow.matrix,ae++}o.directional[$]=Bt,$++}else if(ct.isSpotLight){const Bt=t.get(ct);Bt.position.setFromMatrixPosition(ct.matrixWorld),Bt.color.copy(dt).multiplyScalar(xt*le),Bt.distance=Zt,Bt.coneCos=Math.cos(ct.angle),Bt.penumbraCos=Math.cos(ct.angle*(1-ct.penumbra)),Bt.decay=ct.decay,o.spot[L]=Bt;const en=ct.shadow;if(ct.map&&(o.spotLightMap[De]=ct.map,De++,en.updateMatrices(ct),ct.castShadow&&We++),o.spotLightMatrix[L]=en.matrix,ct.castShadow){const nn=r.get(ct);nn.shadowBias=en.bias,nn.shadowNormalBias=en.normalBias,nn.shadowRadius=en.radius,nn.shadowMapSize=en.mapSize,o.spotShadow[L]=nn,o.spotShadowMap[L]=Pt,Te++}L++}else if(ct.isRectAreaLight){const Bt=t.get(ct);Bt.color.copy(dt).multiplyScalar(xt),Bt.halfWidth.set(.5*ct.width,0,0),Bt.halfHeight.set(0,.5*ct.height,0),o.rectArea[te]=Bt,te++}else if(ct.isPointLight){const Bt=t.get(ct);if(Bt.color.copy(ct.color).multiplyScalar(ct.intensity*le),Bt.distance=ct.distance,Bt.decay=ct.decay,ct.castShadow){const en=ct.shadow,nn=r.get(ct);nn.shadowBias=en.bias,nn.shadowNormalBias=en.normalBias,nn.shadowRadius=en.radius,nn.shadowMapSize=en.mapSize,nn.shadowCameraNear=en.camera.near,nn.shadowCameraFar=en.camera.far,o.pointShadow[z]=nn,o.pointShadowMap[z]=Pt,o.pointShadowMatrix[z]=ct.shadow.matrix,ve++}o.point[z]=Bt,z++}else if(ct.isHemisphereLight){const Bt=t.get(ct);Bt.skyColor.copy(ct.color).multiplyScalar(xt*le),Bt.groundColor.copy(ct.groundColor).multiplyScalar(xt*le),o.hemi[X]=Bt,X++}}te>0&&(e.isWebGL2||!0===c.has("OES_texture_float_linear")?(o.rectAreaLTC1=Fn.LTC_FLOAT_1,o.rectAreaLTC2=Fn.LTC_FLOAT_2):!0===c.has("OES_texture_half_float_linear")?(o.rectAreaLTC1=Fn.LTC_HALF_1,o.rectAreaLTC2=Fn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=C,o.ambient[1]=R,o.ambient[2]=U;const Se=o.hash;(Se.directionalLength!==$||Se.pointLength!==z||Se.spotLength!==L||Se.rectAreaLength!==te||Se.hemiLength!==X||Se.numDirectionalShadows!==ae||Se.numPointShadows!==ve||Se.numSpotShadows!==Te||Se.numSpotMaps!==De)&&(o.directional.length=$,o.spot.length=L,o.rectArea.length=te,o.point.length=z,o.hemi.length=X,o.directionalShadow.length=ae,o.directionalShadowMap.length=ae,o.pointShadow.length=ve,o.pointShadowMap.length=ve,o.spotShadow.length=Te,o.spotShadowMap.length=Te,o.directionalShadowMatrix.length=ae,o.pointShadowMatrix.length=ve,o.spotLightMatrix.length=Te+De-We,o.spotLightMap.length=De,o.numSpotLightShadowsWithMaps=We,Se.directionalLength=$,Se.pointLength=z,Se.spotLength=L,Se.rectAreaLength=te,Se.hemiLength=X,Se.numDirectionalShadows=ae,Se.numPointShadows=ve,Se.numSpotShadows=Te,Se.numSpotMaps=De,o.version=Tf++)},setupView:function _(w,T){let C=0,R=0,U=0,$=0,z=0;const L=T.matrixWorldInverse;for(let te=0,X=w.length;te<X;te++){const ae=w[te];if(ae.isDirectionalLight){const ve=o.directional[C];ve.direction.setFromMatrixPosition(ae.matrixWorld),l.setFromMatrixPosition(ae.target.matrixWorld),ve.direction.sub(l),ve.direction.transformDirection(L),C++}else if(ae.isSpotLight){const ve=o.spot[U];ve.position.setFromMatrixPosition(ae.matrixWorld),ve.position.applyMatrix4(L),ve.direction.setFromMatrixPosition(ae.matrixWorld),l.setFromMatrixPosition(ae.target.matrixWorld),ve.direction.sub(l),ve.direction.transformDirection(L),U++}else if(ae.isRectAreaLight){const ve=o.rectArea[$];ve.position.setFromMatrixPosition(ae.matrixWorld),ve.position.applyMatrix4(L),p.identity(),f.copy(ae.matrixWorld),f.premultiply(L),p.extractRotation(f),ve.halfWidth.set(.5*ae.width,0,0),ve.halfHeight.set(0,.5*ae.height,0),ve.halfWidth.applyMatrix4(p),ve.halfHeight.applyMatrix4(p),$++}else if(ae.isPointLight){const ve=o.point[R];ve.position.setFromMatrixPosition(ae.matrixWorld),ve.position.applyMatrix4(L),R++}else if(ae.isHemisphereLight){const ve=o.hemi[z];ve.direction.setFromMatrixPosition(ae.matrixWorld),ve.direction.transformDirection(L),z++}}},state:o}}function Qm(c,e){const t=new zv(c,e),r=[],o=[];return{init:function l(){r.length=0,o.length=0},state:{lightsArray:r,shadowsArray:o,lights:t},setupLights:function y(T){t.setup(r,T)},setupLightsView:function _(T){t.setupView(r,T)},pushLight:function f(T){r.push(T)},pushShadow:function p(T){o.push(T)}}}function Hv(c,e){let t=new WeakMap;return{get:function r(l,f=0){const p=t.get(l);let y;return void 0===p?(y=new Qm(c,e),t.set(l,[y])):f>=p.length?(y=new Qm(c,e),p.push(y)):y=p[f],y},dispose:function o(){t=new WeakMap}}}class Cf extends yo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class eg extends yo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Wv(c,e,t){let r=new Bp;const o=new Et,l=new Et,f=new tr,p=new Cf({depthPacking:3201}),y=new eg,_={},w=t.maxTextureSize,T={[ri]:fe,[fe]:ri,[bn]:bn},C=new _l({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Et},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),R=C.clone();R.defines.HORIZONTAL_PASS=1;const U=new hi;U.setAttribute("position",new de(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const $=new _o(U,C),z=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let L=this.type;function te(ve,Te){const De=e.update($);C.defines.VSM_SAMPLES!==ve.blurSamples&&(C.defines.VSM_SAMPLES=ve.blurSamples,R.defines.VSM_SAMPLES=ve.blurSamples,C.needsUpdate=!0,R.needsUpdate=!0),null===ve.mapPass&&(ve.mapPass=new Ta(o.x,o.y)),C.uniforms.shadow_pass.value=ve.map.texture,C.uniforms.resolution.value=ve.mapSize,C.uniforms.radius.value=ve.radius,c.setRenderTarget(ve.mapPass),c.clear(),c.renderBufferDirect(Te,null,De,C,$,null),R.uniforms.shadow_pass.value=ve.mapPass.texture,R.uniforms.resolution.value=ve.mapSize,R.uniforms.radius.value=ve.radius,c.setRenderTarget(ve.map),c.clear(),c.renderBufferDirect(Te,null,De,R,$,null)}function X(ve,Te,De,We){let le=null;const Se=!0===De.isPointLight?ve.customDistanceMaterial:ve.customDepthMaterial;if(void 0!==Se)le=Se;else if(le=!0===De.isPointLight?y:p,c.localClippingEnabled&&!0===Te.clipShadows&&Array.isArray(Te.clippingPlanes)&&0!==Te.clippingPlanes.length||Te.displacementMap&&0!==Te.displacementScale||Te.alphaMap&&Te.alphaTest>0||Te.map&&Te.alphaTest>0){const bt=le.uuid,qt=Te.uuid;let ct=_[bt];void 0===ct&&(ct={},_[bt]=ct);let dt=ct[qt];void 0===dt&&(dt=le.clone(),ct[qt]=dt),le=dt}return le.visible=Te.visible,le.wireframe=Te.wireframe,le.side=3===We?null!==Te.shadowSide?Te.shadowSide:Te.side:null!==Te.shadowSide?Te.shadowSide:T[Te.side],le.alphaMap=Te.alphaMap,le.alphaTest=Te.alphaTest,le.map=Te.map,le.clipShadows=Te.clipShadows,le.clippingPlanes=Te.clippingPlanes,le.clipIntersection=Te.clipIntersection,le.displacementMap=Te.displacementMap,le.displacementScale=Te.displacementScale,le.displacementBias=Te.displacementBias,le.wireframeLinewidth=Te.wireframeLinewidth,le.linewidth=Te.linewidth,!0===De.isPointLight&&!0===le.isMeshDistanceMaterial&&(c.properties.get(le).light=De),le}function ae(ve,Te,De,We,le){if(!1===ve.visible)return;if(ve.layers.test(Te.layers)&&(ve.isMesh||ve.isLine||ve.isPoints)&&(ve.castShadow||ve.receiveShadow&&3===le)&&(!ve.frustumCulled||r.intersectsObject(ve))){ve.modelViewMatrix.multiplyMatrices(De.matrixWorldInverse,ve.matrixWorld);const qt=e.update(ve),ct=ve.material;if(Array.isArray(ct)){const dt=qt.groups;for(let xt=0,Zt=dt.length;xt<Zt;xt++){const Pt=dt[xt],Bt=ct[Pt.materialIndex];if(Bt&&Bt.visible){const en=X(ve,Bt,We,le);c.renderBufferDirect(De,null,qt,en,ve,Pt)}}}else if(ct.visible){const dt=X(ve,ct,We,le);c.renderBufferDirect(De,null,qt,dt,ve,null)}}const bt=ve.children;for(let qt=0,ct=bt.length;qt<ct;qt++)ae(bt[qt],Te,De,We,le)}this.render=function(ve,Te,De){if(!1===z.enabled||!1===z.autoUpdate&&!1===z.needsUpdate||0===ve.length)return;const We=c.getRenderTarget(),le=c.getActiveCubeFace(),Se=c.getActiveMipmapLevel(),bt=c.state;bt.setBlending(Gn),bt.buffers.color.setClear(1,1,1,1),bt.buffers.depth.setTest(!0),bt.setScissorTest(!1);const qt=3!==L&&3===this.type,ct=3===L&&3!==this.type;for(let dt=0,xt=ve.length;dt<xt;dt++){const Zt=ve[dt],Pt=Zt.shadow;if(void 0===Pt){console.warn("THREE.WebGLShadowMap:",Zt,"has no shadow.");continue}if(!1===Pt.autoUpdate&&!1===Pt.needsUpdate)continue;o.copy(Pt.mapSize);const Bt=Pt.getFrameExtents();if(o.multiply(Bt),l.copy(Pt.mapSize),(o.x>w||o.y>w)&&(o.x>w&&(l.x=Math.floor(w/Bt.x),o.x=l.x*Bt.x,Pt.mapSize.x=l.x),o.y>w&&(l.y=Math.floor(w/Bt.y),o.y=l.y*Bt.y,Pt.mapSize.y=l.y)),null===Pt.map||!0===qt||!0===ct){const nn=3!==this.type?{minFilter:Lt,magFilter:Lt}:{};null!==Pt.map&&Pt.map.dispose(),Pt.map=new Ta(o.x,o.y,nn),Pt.map.texture.name=Zt.name+".shadowMap",Pt.camera.updateProjectionMatrix()}c.setRenderTarget(Pt.map),c.clear();const en=Pt.getViewportCount();for(let nn=0;nn<en;nn++){const at=Pt.getViewport(nn);f.set(l.x*at.x,l.y*at.y,l.x*at.z,l.y*at.w),bt.viewport(f),Pt.updateMatrices(Zt,nn),r=Pt.getFrustum(),ae(Te,De,Pt.camera,Zt,this.type)}!0!==Pt.isPointLightShadow&&3===this.type&&te(Pt,De),Pt.needsUpdate=!1}L=this.type,z.needsUpdate=!1,c.setRenderTarget(We,le,Se)}}function ng(c,e,t){const r=t.isWebGL2,p=new function o(){let Xe=!1;const Ln=new tr;let _t=null;const An=new tr(0,0,0,0);return{setMask:function(Wn){_t!==Wn&&!Xe&&(c.colorMask(Wn,Wn,Wn,Wn),_t=Wn)},setLocked:function(Wn){Xe=Wn},setClear:function(Wn,xr,ys,Xs,wc){!0===wc&&(Wn*=Xs,xr*=Xs,ys*=Xs),Ln.set(Wn,xr,ys,Xs),!1===An.equals(Ln)&&(c.clearColor(Wn,xr,ys,Xs),An.copy(Ln))},reset:function(){Xe=!1,_t=null,An.set(-1,0,0,0)}}},y=new function l(){let Xe=!1,Ln=null,_t=null,An=null;return{setTest:function(Wn){Wn?mi(c.DEPTH_TEST):bi(c.DEPTH_TEST)},setMask:function(Wn){Ln!==Wn&&!Xe&&(c.depthMask(Wn),Ln=Wn)},setFunc:function(Wn){if(_t!==Wn){switch(Wn){case 0:c.depthFunc(c.NEVER);break;case 1:c.depthFunc(c.ALWAYS);break;case 2:c.depthFunc(c.LESS);break;case 3:default:c.depthFunc(c.LEQUAL);break;case 4:c.depthFunc(c.EQUAL);break;case 5:c.depthFunc(c.GEQUAL);break;case 6:c.depthFunc(c.GREATER);break;case 7:c.depthFunc(c.NOTEQUAL)}_t=Wn}},setLocked:function(Wn){Xe=Wn},setClear:function(Wn){An!==Wn&&(c.clearDepth(Wn),An=Wn)},reset:function(){Xe=!1,Ln=null,_t=null,An=null}}},_=new function f(){let Xe=!1,Ln=null,_t=null,An=null,Wn=null,xr=null,ys=null,Xs=null,wc=null;return{setTest:function(os){Xe||(os?mi(c.STENCIL_TEST):bi(c.STENCIL_TEST))},setMask:function(os){Ln!==os&&!Xe&&(c.stencilMask(os),Ln=os)},setFunc:function(os,sl,la){(_t!==os||An!==sl||Wn!==la)&&(c.stencilFunc(os,sl,la),_t=os,An=sl,Wn=la)},setOp:function(os,sl,la){(xr!==os||ys!==sl||Xs!==la)&&(c.stencilOp(os,sl,la),xr=os,ys=sl,Xs=la)},setLocked:function(os){Xe=os},setClear:function(os){wc!==os&&(c.clearStencil(os),wc=os)},reset:function(){Xe=!1,Ln=null,_t=null,An=null,Wn=null,xr=null,ys=null,Xs=null,wc=null}}},w=new WeakMap,T=new WeakMap;let C={},R={},U=new WeakMap,$=[],z=null,L=!1,te=null,X=null,ae=null,ve=null,Te=null,De=null,We=null,le=!1,Se=null,bt=null,qt=null,ct=null,dt=null;const xt=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Zt=!1,Pt=0;const Bt=c.getParameter(c.VERSION);-1!==Bt.indexOf("WebGL")?(Pt=parseFloat(/^WebGL (\d)/.exec(Bt)[1]),Zt=Pt>=1):-1!==Bt.indexOf("OpenGL ES")&&(Pt=parseFloat(/^OpenGL ES (\d)/.exec(Bt)[1]),Zt=Pt>=2);let en=null,nn={};const at=c.getParameter(c.SCISSOR_BOX),Nt=c.getParameter(c.VIEWPORT),Nn=(new tr).fromArray(at),Un=(new tr).fromArray(Nt);function $n(Xe,Ln,_t,An){const Wn=new Uint8Array(4),xr=c.createTexture();c.bindTexture(Xe,xr),c.texParameteri(Xe,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(Xe,c.TEXTURE_MAG_FILTER,c.NEAREST);for(let ys=0;ys<_t;ys++)!r||Xe!==c.TEXTURE_3D&&Xe!==c.TEXTURE_2D_ARRAY?c.texImage2D(Ln+ys,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,Wn):c.texImage3D(Ln,0,c.RGBA,1,1,An,0,c.RGBA,c.UNSIGNED_BYTE,Wn);return xr}const _i={};function mi(Xe){!0!==C[Xe]&&(c.enable(Xe),C[Xe]=!0)}function bi(Xe){!1!==C[Xe]&&(c.disable(Xe),C[Xe]=!1)}_i[c.TEXTURE_2D]=$n(c.TEXTURE_2D,c.TEXTURE_2D,1),_i[c.TEXTURE_CUBE_MAP]=$n(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(_i[c.TEXTURE_2D_ARRAY]=$n(c.TEXTURE_2D_ARRAY,c.TEXTURE_2D_ARRAY,1,1),_i[c.TEXTURE_3D]=$n(c.TEXTURE_3D,c.TEXTURE_3D,1,1)),p.setClear(0,0,0,1),y.setClear(1),_.setClear(0),mi(c.DEPTH_TEST),y.setFunc(3),Jt(!1),gi(1),mi(c.CULL_FACE),Vt(Gn);const ze={100:c.FUNC_ADD,101:c.FUNC_SUBTRACT,102:c.FUNC_REVERSE_SUBTRACT};if(r)ze[103]=c.MIN,ze[104]=c.MAX;else{const Xe=e.get("EXT_blend_minmax");null!==Xe&&(ze[103]=Xe.MIN_EXT,ze[104]=Xe.MAX_EXT)}const Sn={200:c.ZERO,201:c.ONE,202:c.SRC_COLOR,204:c.SRC_ALPHA,210:c.SRC_ALPHA_SATURATE,208:c.DST_COLOR,206:c.DST_ALPHA,203:c.ONE_MINUS_SRC_COLOR,205:c.ONE_MINUS_SRC_ALPHA,209:c.ONE_MINUS_DST_COLOR,207:c.ONE_MINUS_DST_ALPHA};function Vt(Xe,Ln,_t,An,Wn,xr,ys,Xs){if(Xe!==Gn){if(!1===L&&(mi(c.BLEND),L=!0),5===Xe)Wn=Wn||Ln,xr=xr||_t,ys=ys||An,(Ln!==X||Wn!==Te)&&(c.blendEquationSeparate(ze[Ln],ze[Wn]),X=Ln,Te=Wn),(_t!==ae||An!==ve||xr!==De||ys!==We)&&(c.blendFuncSeparate(Sn[_t],Sn[An],Sn[xr],Sn[ys]),ae=_t,ve=An,De=xr,We=ys),te=Xe,le=!1;else if(Xe!==te||Xs!==le){if((100!==X||100!==Te)&&(c.blendEquation(c.FUNC_ADD),X=100,Te=100),Xs)switch(Xe){case 1:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case ce:c.blendFunc(c.ONE,c.ONE);break;case 3:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case 4:c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Xe)}else switch(Xe){case 1:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case ce:c.blendFunc(c.SRC_ALPHA,c.ONE);break;case 3:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case 4:c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Xe)}ae=null,ve=null,De=null,We=null,te=Xe,le=Xs}}else!0===L&&(bi(c.BLEND),L=!1)}function Jt(Xe){Se!==Xe&&(c.frontFace(Xe?c.CW:c.CCW),Se=Xe)}function gi(Xe){0!==Xe?(mi(c.CULL_FACE),Xe!==bt&&c.cullFace(1===Xe?c.BACK:2===Xe?c.FRONT:c.FRONT_AND_BACK)):bi(c.CULL_FACE),bt=Xe}function ei(Xe,Ln,_t){Xe?(mi(c.POLYGON_OFFSET_FILL),(ct!==Ln||dt!==_t)&&(c.polygonOffset(Ln,_t),ct=Ln,dt=_t)):bi(c.POLYGON_OFFSET_FILL)}return{buffers:{color:p,depth:y,stencil:_},enable:mi,disable:bi,bindFramebuffer:function Rr(Xe,Ln){return R[Xe]!==Ln&&(c.bindFramebuffer(Xe,Ln),R[Xe]=Ln,r&&(Xe===c.DRAW_FRAMEBUFFER&&(R[c.FRAMEBUFFER]=Ln),Xe===c.FRAMEBUFFER&&(R[c.DRAW_FRAMEBUFFER]=Ln)),!0)},drawBuffers:function fs(Xe,Ln){let _t=$,An=!1;if(Xe)if(_t=U.get(Ln),void 0===_t&&(_t=[],U.set(Ln,_t)),Xe.isWebGLMultipleRenderTargets){const Wn=Xe.texture;if(_t.length!==Wn.length||_t[0]!==c.COLOR_ATTACHMENT0){for(let xr=0,ys=Wn.length;xr<ys;xr++)_t[xr]=c.COLOR_ATTACHMENT0+xr;_t.length=Wn.length,An=!0}}else _t[0]!==c.COLOR_ATTACHMENT0&&(_t[0]=c.COLOR_ATTACHMENT0,An=!0);else _t[0]!==c.BACK&&(_t[0]=c.BACK,An=!0);An&&(t.isWebGL2?c.drawBuffers(_t):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(_t))},useProgram:function Ii(Xe){return z!==Xe&&(c.useProgram(Xe),z=Xe,!0)},setBlending:Vt,setMaterial:function yn(Xe,Ln){Xe.side===bn?bi(c.CULL_FACE):mi(c.CULL_FACE);let _t=Xe.side===fe;Ln&&(_t=!_t),Jt(_t),1===Xe.blending&&!1===Xe.transparent?Vt(Gn):Vt(Xe.blending,Xe.blendEquation,Xe.blendSrc,Xe.blendDst,Xe.blendEquationAlpha,Xe.blendSrcAlpha,Xe.blendDstAlpha,Xe.premultipliedAlpha),y.setFunc(Xe.depthFunc),y.setTest(Xe.depthTest),y.setMask(Xe.depthWrite),p.setMask(Xe.colorWrite);const An=Xe.stencilWrite;_.setTest(An),An&&(_.setMask(Xe.stencilWriteMask),_.setFunc(Xe.stencilFunc,Xe.stencilRef,Xe.stencilFuncMask),_.setOp(Xe.stencilFail,Xe.stencilZFail,Xe.stencilZPass)),ei(Xe.polygonOffset,Xe.polygonOffsetFactor,Xe.polygonOffsetUnits),!0===Xe.alphaToCoverage?mi(c.SAMPLE_ALPHA_TO_COVERAGE):bi(c.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Jt,setCullFace:gi,setLineWidth:function Kn(Xe){Xe!==qt&&(Zt&&c.lineWidth(Xe),qt=Xe)},setPolygonOffset:ei,setScissorTest:function ji(Xe){Xe?mi(c.SCISSOR_TEST):bi(c.SCISSOR_TEST)},activeTexture:function hr(Xe){void 0===Xe&&(Xe=c.TEXTURE0+xt-1),en!==Xe&&(c.activeTexture(Xe),en=Xe)},bindTexture:function As(Xe,Ln,_t){void 0===_t&&(_t=null===en?c.TEXTURE0+xt-1:en);let An=nn[_t];void 0===An&&(An={type:void 0,texture:void 0},nn[_t]=An),(An.type!==Xe||An.texture!==Ln)&&(en!==_t&&(c.activeTexture(_t),en=_t),c.bindTexture(Xe,Ln||_i[Xe]),An.type=Xe,An.texture=Ln)},unbindTexture:function Re(){const Xe=nn[en];void 0!==Xe&&void 0!==Xe.type&&(c.bindTexture(Xe.type,null),Xe.type=void 0,Xe.texture=void 0)},compressedTexImage2D:function pe(){try{c.compressedTexImage2D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},compressedTexImage3D:function ft(){try{c.compressedTexImage3D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},texImage2D:function Ci(){try{c.texImage2D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},texImage3D:function yi(){try{c.texImage3D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},updateUBOMapping:function li(Xe,Ln){let _t=T.get(Ln);void 0===_t&&(_t=new WeakMap,T.set(Ln,_t));let An=_t.get(Xe);void 0===An&&(An=c.getUniformBlockIndex(Ln,Xe.name),_t.set(Xe,An))},uniformBlockBinding:function nr(Xe,Ln){const An=T.get(Ln).get(Xe);w.get(Ln)!==An&&(c.uniformBlockBinding(Ln,An,Xe.__bindingPointIndex),w.set(Ln,An))},texStorage2D:function xn(){try{c.texStorage2D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},texStorage3D:function Mt(){try{c.texStorage3D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},texSubImage2D:function pn(){try{c.texSubImage2D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},texSubImage3D:function dn(){try{c.texSubImage3D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},compressedTexSubImage2D:function vn(){try{c.compressedTexSubImage2D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},compressedTexSubImage3D:function di(){try{c.compressedTexSubImage3D.apply(c,arguments)}catch(Xe){console.error("THREE.WebGLState:",Xe)}},scissor:function wi(Xe){!1===Nn.equals(Xe)&&(c.scissor(Xe.x,Xe.y,Xe.z,Xe.w),Nn.copy(Xe))},viewport:function ii(Xe){!1===Un.equals(Xe)&&(c.viewport(Xe.x,Xe.y,Xe.z,Xe.w),Un.copy(Xe))},reset:function Vr(){c.disable(c.BLEND),c.disable(c.CULL_FACE),c.disable(c.DEPTH_TEST),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SCISSOR_TEST),c.disable(c.STENCIL_TEST),c.disable(c.SAMPLE_ALPHA_TO_COVERAGE),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ZERO),c.blendFuncSeparate(c.ONE,c.ZERO,c.ONE,c.ZERO),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(c.LESS),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(c.ALWAYS,0,4294967295),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),c.clearStencil(0),c.cullFace(c.BACK),c.frontFace(c.CCW),c.polygonOffset(0,0),c.activeTexture(c.TEXTURE0),c.bindFramebuffer(c.FRAMEBUFFER,null),!0===r&&(c.bindFramebuffer(c.DRAW_FRAMEBUFFER,null),c.bindFramebuffer(c.READ_FRAMEBUFFER,null)),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),C={},en=null,nn={},R={},U=new WeakMap,$=[],z=null,L=!1,te=null,X=null,ae=null,ve=null,Te=null,De=null,We=null,le=!1,Se=null,bt=null,qt=null,ct=null,dt=null,Nn.set(0,0,c.canvas.width,c.canvas.height),Un.set(0,0,c.canvas.width,c.canvas.height),p.reset(),y.reset(),_.reset()}}}function ig(c,e,t,r,o,l,f){const p=o.isWebGL2,y=o.maxTextures,_=o.maxCubemapSize,w=o.maxTextureSize,T=o.maxSamples,C=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,R="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),U=new WeakMap;let $;const z=new WeakMap;let L=!1;try{L="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(Re){}function te(Re,pe){return L?new OffscreenCanvas(Re,pe):Rs("canvas")}function X(Re,pe,ft,pn){let dn=1;if((Re.width>pn||Re.height>pn)&&(dn=pn/Math.max(Re.width,Re.height)),dn<1||!0===pe){if("undefined"!=typeof HTMLImageElement&&Re instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&Re instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&Re instanceof ImageBitmap){const vn=pe?P:Math.floor,di=vn(dn*Re.width),xn=vn(dn*Re.height);void 0===$&&($=te(di,xn));const Mt=ft?te(di,xn):$;return Mt.width=di,Mt.height=xn,Mt.getContext("2d").drawImage(Re,0,0,di,xn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Re.width+"x"+Re.height+") to ("+di+"x"+xn+")."),Mt}return"data"in Re&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Re.width+"x"+Re.height+")."),Re}return Re}function ae(Re){return B(Re.width)&&B(Re.height)}function Te(Re,pe){return Re.generateMipmaps&&pe&&Re.minFilter!==Lt&&Re.minFilter!==Z}function De(Re){c.generateMipmap(Re)}function We(Re,pe,ft,pn,dn=!1){if(!1===p)return pe;if(null!==Re){if(void 0!==c[Re])return c[Re];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Re+"'")}let vn=pe;return pe===c.RED&&(ft===c.FLOAT&&(vn=c.R32F),ft===c.HALF_FLOAT&&(vn=c.R16F),ft===c.UNSIGNED_BYTE&&(vn=c.R8)),pe===c.RED_INTEGER&&(ft===c.UNSIGNED_BYTE&&(vn=c.R8UI),ft===c.UNSIGNED_SHORT&&(vn=c.R16UI),ft===c.UNSIGNED_INT&&(vn=c.R32UI),ft===c.BYTE&&(vn=c.R8I),ft===c.SHORT&&(vn=c.R16I),ft===c.INT&&(vn=c.R32I)),pe===c.RG&&(ft===c.FLOAT&&(vn=c.RG32F),ft===c.HALF_FLOAT&&(vn=c.RG16F),ft===c.UNSIGNED_BYTE&&(vn=c.RG8)),pe===c.RGBA&&(ft===c.FLOAT&&(vn=c.RGBA32F),ft===c.HALF_FLOAT&&(vn=c.RGBA16F),ft===c.UNSIGNED_BYTE&&(vn=pn===Ai&&!1===dn?c.SRGB8_ALPHA8:c.RGBA8),ft===c.UNSIGNED_SHORT_4_4_4_4&&(vn=c.RGBA4),ft===c.UNSIGNED_SHORT_5_5_5_1&&(vn=c.RGB5_A1)),(vn===c.R16F||vn===c.R32F||vn===c.RG16F||vn===c.RG32F||vn===c.RGBA16F||vn===c.RGBA32F)&&e.get("EXT_color_buffer_float"),vn}function le(Re,pe,ft){return!0===Te(Re,ft)||Re.isFramebufferTexture&&Re.minFilter!==Lt&&Re.minFilter!==Z?Math.log2(Math.max(pe.width,pe.height))+1:void 0!==Re.mipmaps&&Re.mipmaps.length>0?Re.mipmaps.length:Re.isCompressedTexture&&Array.isArray(Re.image)?pe.mipmaps.length:1}function Se(Re){return Re===Lt||Re===Xr||Re===Le?c.NEAREST:c.LINEAR}function bt(Re){const pe=Re.target;pe.removeEventListener("dispose",bt),function ct(Re){const pe=r.get(Re);if(void 0===pe.__webglInit)return;const ft=Re.source,pn=z.get(ft);if(pn){const dn=pn[pe.__cacheKey];dn.usedTimes--,0===dn.usedTimes&&dt(Re),0===Object.keys(pn).length&&z.delete(ft)}r.remove(Re)}(pe),pe.isVideoTexture&&U.delete(pe)}function qt(Re){const pe=Re.target;pe.removeEventListener("dispose",qt),function xt(Re){const pe=Re.texture,ft=r.get(Re),pn=r.get(pe);if(void 0!==pn.__webglTexture&&(c.deleteTexture(pn.__webglTexture),f.memory.textures--),Re.depthTexture&&Re.depthTexture.dispose(),Re.isWebGLCubeRenderTarget)for(let dn=0;dn<6;dn++){if(Array.isArray(ft.__webglFramebuffer[dn]))for(let vn=0;vn<ft.__webglFramebuffer[dn].length;vn++)c.deleteFramebuffer(ft.__webglFramebuffer[dn][vn]);else c.deleteFramebuffer(ft.__webglFramebuffer[dn]);ft.__webglDepthbuffer&&c.deleteRenderbuffer(ft.__webglDepthbuffer[dn])}else{if(Array.isArray(ft.__webglFramebuffer))for(let dn=0;dn<ft.__webglFramebuffer.length;dn++)c.deleteFramebuffer(ft.__webglFramebuffer[dn]);else c.deleteFramebuffer(ft.__webglFramebuffer);if(ft.__webglDepthbuffer&&c.deleteRenderbuffer(ft.__webglDepthbuffer),ft.__webglMultisampledFramebuffer&&c.deleteFramebuffer(ft.__webglMultisampledFramebuffer),ft.__webglColorRenderbuffer)for(let dn=0;dn<ft.__webglColorRenderbuffer.length;dn++)ft.__webglColorRenderbuffer[dn]&&c.deleteRenderbuffer(ft.__webglColorRenderbuffer[dn]);ft.__webglDepthRenderbuffer&&c.deleteRenderbuffer(ft.__webglDepthRenderbuffer)}if(Re.isWebGLMultipleRenderTargets)for(let dn=0,vn=pe.length;dn<vn;dn++){const di=r.get(pe[dn]);di.__webglTexture&&(c.deleteTexture(di.__webglTexture),f.memory.textures--),r.remove(pe[dn])}r.remove(pe),r.remove(Re)}(pe)}function dt(Re){const pe=r.get(Re);c.deleteTexture(pe.__webglTexture),delete z.get(Re.source)[pe.__cacheKey],f.memory.textures--}let Zt=0;function nn(Re,pe){const ft=r.get(Re);if(Re.isVideoTexture&&function hr(Re){const pe=f.render.frame;U.get(Re)!==pe&&(U.set(Re,pe),Re.update())}(Re),!1===Re.isRenderTargetTexture&&Re.version>0&&ft.__version!==Re.version){const pn=Re.image;if(null===pn)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==pn.complete)return void Rr(ft,Re,pe);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(c.TEXTURE_2D,ft.__webglTexture,c.TEXTURE0+pe)}const Un={[lr]:c.REPEAT,[fi]:c.CLAMP_TO_EDGE,[On]:c.MIRRORED_REPEAT},$n={[Lt]:c.NEAREST,[Xr]:c.NEAREST_MIPMAP_NEAREST,[Le]:c.NEAREST_MIPMAP_LINEAR,[Z]:c.LINEAR,[he]:c.LINEAR_MIPMAP_NEAREST,[ue]:c.LINEAR_MIPMAP_LINEAR},_i={512:c.NEVER,519:c.ALWAYS,513:c.LESS,515:c.LEQUAL,514:c.EQUAL,518:c.GEQUAL,516:c.GREATER,517:c.NOTEQUAL};function mi(Re,pe,ft){if(ft?(c.texParameteri(Re,c.TEXTURE_WRAP_S,Un[pe.wrapS]),c.texParameteri(Re,c.TEXTURE_WRAP_T,Un[pe.wrapT]),(Re===c.TEXTURE_3D||Re===c.TEXTURE_2D_ARRAY)&&c.texParameteri(Re,c.TEXTURE_WRAP_R,Un[pe.wrapR]),c.texParameteri(Re,c.TEXTURE_MAG_FILTER,$n[pe.magFilter]),c.texParameteri(Re,c.TEXTURE_MIN_FILTER,$n[pe.minFilter])):(c.texParameteri(Re,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(Re,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),(Re===c.TEXTURE_3D||Re===c.TEXTURE_2D_ARRAY)&&c.texParameteri(Re,c.TEXTURE_WRAP_R,c.CLAMP_TO_EDGE),(pe.wrapS!==fi||pe.wrapT!==fi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),c.texParameteri(Re,c.TEXTURE_MAG_FILTER,Se(pe.magFilter)),c.texParameteri(Re,c.TEXTURE_MIN_FILTER,Se(pe.minFilter)),pe.minFilter!==Lt&&pe.minFilter!==Z&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),pe.compareFunction&&(c.texParameteri(Re,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE),c.texParameteri(Re,c.TEXTURE_COMPARE_FUNC,_i[pe.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const pn=e.get("EXT_texture_filter_anisotropic");if(pe.magFilter===Lt||pe.minFilter!==Le&&pe.minFilter!==ue||pe.type===st&&!1===e.has("OES_texture_float_linear")||!1===p&&pe.type===kt&&!1===e.has("OES_texture_half_float_linear"))return;(pe.anisotropy>1||r.get(pe).__currentAnisotropy)&&(c.texParameterf(Re,pn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pe.anisotropy,o.getMaxAnisotropy())),r.get(pe).__currentAnisotropy=pe.anisotropy)}}function bi(Re,pe){let ft=!1;void 0===Re.__webglInit&&(Re.__webglInit=!0,pe.addEventListener("dispose",bt));const pn=pe.source;let dn=z.get(pn);void 0===dn&&(dn={},z.set(pn,dn));const vn=function en(Re){const pe=[];return pe.push(Re.wrapS),pe.push(Re.wrapT),pe.push(Re.wrapR||0),pe.push(Re.magFilter),pe.push(Re.minFilter),pe.push(Re.anisotropy),pe.push(Re.internalFormat),pe.push(Re.format),pe.push(Re.type),pe.push(Re.generateMipmaps),pe.push(Re.premultiplyAlpha),pe.push(Re.flipY),pe.push(Re.unpackAlignment),pe.push(Re.colorSpace),pe.join()}(pe);if(vn!==Re.__cacheKey){void 0===dn[vn]&&(dn[vn]={texture:c.createTexture(),usedTimes:0},f.memory.textures++,ft=!0),dn[vn].usedTimes++;const di=dn[Re.__cacheKey];void 0!==di&&(dn[Re.__cacheKey].usedTimes--,0===di.usedTimes&&dt(pe)),Re.__cacheKey=vn,Re.__webglTexture=dn[vn].texture}return ft}function Rr(Re,pe,ft){let pn=c.TEXTURE_2D;(pe.isDataArrayTexture||pe.isCompressedArrayTexture)&&(pn=c.TEXTURE_2D_ARRAY),pe.isData3DTexture&&(pn=c.TEXTURE_3D);const dn=bi(Re,pe),vn=pe.source;t.bindTexture(pn,Re.__webglTexture,c.TEXTURE0+ft);const di=r.get(vn);if(vn.version!==di.__version||!0===dn){t.activeTexture(c.TEXTURE0+ft),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,pe.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,pe.unpackAlignment),c.pixelStorei(c.UNPACK_COLORSPACE_CONVERSION_WEBGL,c.NONE);const xn=function ve(Re){return!p&&(Re.wrapS!==fi||Re.wrapT!==fi||Re.minFilter!==Lt&&Re.minFilter!==Z)}(pe)&&!1===ae(pe.image);let Mt=X(pe.image,xn,!1,w);Mt=As(pe,Mt);const Ci=ae(Mt)||p,yi=l.convert(pe.format,pe.colorSpace);let li,wi=l.convert(pe.type),ii=We(pe.internalFormat,yi,wi,pe.colorSpace);mi(pn,pe,Ci);const nr=pe.mipmaps,Vr=p&&!0!==pe.isVideoTexture,Xe=void 0===di.__version||!0===dn,Ln=le(pe,Mt,Ci);if(pe.isDepthTexture)ii=c.DEPTH_COMPONENT,p?ii=pe.type===st?c.DEPTH_COMPONENT32F:pe.type===Ve?c.DEPTH_COMPONENT24:pe.type===jt?c.DEPTH24_STENCIL8:c.DEPTH_COMPONENT16:pe.type===st&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),pe.format===He&&ii===c.DEPTH_COMPONENT&&1012!==pe.type&&pe.type!==Ve&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),pe.type=Ve,wi=l.convert(pe.type)),pe.format===je&&ii===c.DEPTH_COMPONENT&&(ii=c.DEPTH_STENCIL,pe.type!==jt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),pe.type=jt,wi=l.convert(pe.type))),Xe&&(Vr?t.texStorage2D(c.TEXTURE_2D,1,ii,Mt.width,Mt.height):t.texImage2D(c.TEXTURE_2D,0,ii,Mt.width,Mt.height,0,yi,wi,null));else if(pe.isDataTexture)if(nr.length>0&&Ci){Vr&&Xe&&t.texStorage2D(c.TEXTURE_2D,Ln,ii,nr[0].width,nr[0].height);for(let _t=0,An=nr.length;_t<An;_t++)li=nr[_t],Vr?t.texSubImage2D(c.TEXTURE_2D,_t,0,0,li.width,li.height,yi,wi,li.data):t.texImage2D(c.TEXTURE_2D,_t,ii,li.width,li.height,0,yi,wi,li.data);pe.generateMipmaps=!1}else Vr?(Xe&&t.texStorage2D(c.TEXTURE_2D,Ln,ii,Mt.width,Mt.height),t.texSubImage2D(c.TEXTURE_2D,0,0,0,Mt.width,Mt.height,yi,wi,Mt.data)):t.texImage2D(c.TEXTURE_2D,0,ii,Mt.width,Mt.height,0,yi,wi,Mt.data);else if(pe.isCompressedTexture)if(pe.isCompressedArrayTexture){Vr&&Xe&&t.texStorage3D(c.TEXTURE_2D_ARRAY,Ln,ii,nr[0].width,nr[0].height,Mt.depth);for(let _t=0,An=nr.length;_t<An;_t++)li=nr[_t],pe.format!==Oe?null!==yi?Vr?t.compressedTexSubImage3D(c.TEXTURE_2D_ARRAY,_t,0,0,0,li.width,li.height,Mt.depth,yi,li.data,0,0):t.compressedTexImage3D(c.TEXTURE_2D_ARRAY,_t,ii,li.width,li.height,Mt.depth,0,li.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Vr?t.texSubImage3D(c.TEXTURE_2D_ARRAY,_t,0,0,0,li.width,li.height,Mt.depth,yi,wi,li.data):t.texImage3D(c.TEXTURE_2D_ARRAY,_t,ii,li.width,li.height,Mt.depth,0,yi,wi,li.data)}else{Vr&&Xe&&t.texStorage2D(c.TEXTURE_2D,Ln,ii,nr[0].width,nr[0].height);for(let _t=0,An=nr.length;_t<An;_t++)li=nr[_t],pe.format!==Oe?null!==yi?Vr?t.compressedTexSubImage2D(c.TEXTURE_2D,_t,0,0,li.width,li.height,yi,li.data):t.compressedTexImage2D(c.TEXTURE_2D,_t,ii,li.width,li.height,0,li.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Vr?t.texSubImage2D(c.TEXTURE_2D,_t,0,0,li.width,li.height,yi,wi,li.data):t.texImage2D(c.TEXTURE_2D,_t,ii,li.width,li.height,0,yi,wi,li.data)}else if(pe.isDataArrayTexture)Vr?(Xe&&t.texStorage3D(c.TEXTURE_2D_ARRAY,Ln,ii,Mt.width,Mt.height,Mt.depth),t.texSubImage3D(c.TEXTURE_2D_ARRAY,0,0,0,0,Mt.width,Mt.height,Mt.depth,yi,wi,Mt.data)):t.texImage3D(c.TEXTURE_2D_ARRAY,0,ii,Mt.width,Mt.height,Mt.depth,0,yi,wi,Mt.data);else if(pe.isData3DTexture)Vr?(Xe&&t.texStorage3D(c.TEXTURE_3D,Ln,ii,Mt.width,Mt.height,Mt.depth),t.texSubImage3D(c.TEXTURE_3D,0,0,0,0,Mt.width,Mt.height,Mt.depth,yi,wi,Mt.data)):t.texImage3D(c.TEXTURE_3D,0,ii,Mt.width,Mt.height,Mt.depth,0,yi,wi,Mt.data);else if(pe.isFramebufferTexture){if(Xe)if(Vr)t.texStorage2D(c.TEXTURE_2D,Ln,ii,Mt.width,Mt.height);else{let _t=Mt.width,An=Mt.height;for(let Wn=0;Wn<Ln;Wn++)t.texImage2D(c.TEXTURE_2D,Wn,ii,_t,An,0,yi,wi,null),_t>>=1,An>>=1}}else if(nr.length>0&&Ci){Vr&&Xe&&t.texStorage2D(c.TEXTURE_2D,Ln,ii,nr[0].width,nr[0].height);for(let _t=0,An=nr.length;_t<An;_t++)li=nr[_t],Vr?t.texSubImage2D(c.TEXTURE_2D,_t,0,0,yi,wi,li):t.texImage2D(c.TEXTURE_2D,_t,ii,yi,wi,li);pe.generateMipmaps=!1}else Vr?(Xe&&t.texStorage2D(c.TEXTURE_2D,Ln,ii,Mt.width,Mt.height),t.texSubImage2D(c.TEXTURE_2D,0,0,0,yi,wi,Mt)):t.texImage2D(c.TEXTURE_2D,0,ii,yi,wi,Mt);Te(pe,Ci)&&De(pn),di.__version=vn.version,pe.onUpdate&&pe.onUpdate(pe)}Re.__version=pe.version}function Ii(Re,pe,ft,pn,dn,vn){const di=l.convert(ft.format,ft.colorSpace),xn=l.convert(ft.type),Mt=We(ft.internalFormat,di,xn,ft.colorSpace);if(!r.get(pe).__hasExternalTextures){const yi=Math.max(1,pe.width>>vn),wi=Math.max(1,pe.height>>vn);dn===c.TEXTURE_3D||dn===c.TEXTURE_2D_ARRAY?t.texImage3D(dn,vn,Mt,yi,wi,pe.depth,0,di,xn,null):t.texImage2D(dn,vn,Mt,yi,wi,0,di,xn,null)}t.bindFramebuffer(c.FRAMEBUFFER,Re),ji(pe)?C.framebufferTexture2DMultisampleEXT(c.FRAMEBUFFER,pn,dn,r.get(ft).__webglTexture,0,ei(pe)):(dn===c.TEXTURE_2D||dn>=c.TEXTURE_CUBE_MAP_POSITIVE_X&&dn<=c.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&c.framebufferTexture2D(c.FRAMEBUFFER,pn,dn,r.get(ft).__webglTexture,vn),t.bindFramebuffer(c.FRAMEBUFFER,null)}function ze(Re,pe,ft){if(c.bindRenderbuffer(c.RENDERBUFFER,Re),pe.depthBuffer&&!pe.stencilBuffer){let pn=c.DEPTH_COMPONENT16;if(ft||ji(pe)){const dn=pe.depthTexture;dn&&dn.isDepthTexture&&(dn.type===st?pn=c.DEPTH_COMPONENT32F:dn.type===Ve&&(pn=c.DEPTH_COMPONENT24));const vn=ei(pe);ji(pe)?C.renderbufferStorageMultisampleEXT(c.RENDERBUFFER,vn,pn,pe.width,pe.height):c.renderbufferStorageMultisample(c.RENDERBUFFER,vn,pn,pe.width,pe.height)}else c.renderbufferStorage(c.RENDERBUFFER,pn,pe.width,pe.height);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,Re)}else if(pe.depthBuffer&&pe.stencilBuffer){const pn=ei(pe);ft&&!1===ji(pe)?c.renderbufferStorageMultisample(c.RENDERBUFFER,pn,c.DEPTH24_STENCIL8,pe.width,pe.height):ji(pe)?C.renderbufferStorageMultisampleEXT(c.RENDERBUFFER,pn,c.DEPTH24_STENCIL8,pe.width,pe.height):c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,pe.width,pe.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,Re)}else{const pn=!0===pe.isWebGLMultipleRenderTargets?pe.texture:[pe.texture];for(let dn=0;dn<pn.length;dn++){const vn=pn[dn],di=l.convert(vn.format,vn.colorSpace),xn=l.convert(vn.type),Mt=We(vn.internalFormat,di,xn,vn.colorSpace),Ci=ei(pe);ft&&!1===ji(pe)?c.renderbufferStorageMultisample(c.RENDERBUFFER,Ci,Mt,pe.width,pe.height):ji(pe)?C.renderbufferStorageMultisampleEXT(c.RENDERBUFFER,Ci,Mt,pe.width,pe.height):c.renderbufferStorage(c.RENDERBUFFER,Mt,pe.width,pe.height)}}c.bindRenderbuffer(c.RENDERBUFFER,null)}function Vt(Re){const pe=r.get(Re),ft=!0===Re.isWebGLCubeRenderTarget;if(Re.depthTexture&&!pe.__autoAllocateDepthBuffer){if(ft)throw new Error("target.depthTexture not supported in Cube render targets");!function Sn(Re,pe){if(pe&&pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(c.FRAMEBUFFER,Re),!pe.depthTexture||!pe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(pe.depthTexture).__webglTexture||pe.depthTexture.image.width!==pe.width||pe.depthTexture.image.height!==pe.height)&&(pe.depthTexture.image.width=pe.width,pe.depthTexture.image.height=pe.height,pe.depthTexture.needsUpdate=!0),nn(pe.depthTexture,0);const pn=r.get(pe.depthTexture).__webglTexture,dn=ei(pe);if(pe.depthTexture.format===He)ji(pe)?C.framebufferTexture2DMultisampleEXT(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.TEXTURE_2D,pn,0,dn):c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.TEXTURE_2D,pn,0);else{if(pe.depthTexture.format!==je)throw new Error("Unknown depthTexture format");ji(pe)?C.framebufferTexture2DMultisampleEXT(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,pn,0,dn):c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,pn,0)}}(pe.__webglFramebuffer,Re)}else if(ft){pe.__webglDepthbuffer=[];for(let pn=0;pn<6;pn++)t.bindFramebuffer(c.FRAMEBUFFER,pe.__webglFramebuffer[pn]),pe.__webglDepthbuffer[pn]=c.createRenderbuffer(),ze(pe.__webglDepthbuffer[pn],Re,!1)}else t.bindFramebuffer(c.FRAMEBUFFER,pe.__webglFramebuffer),pe.__webglDepthbuffer=c.createRenderbuffer(),ze(pe.__webglDepthbuffer,Re,!1);t.bindFramebuffer(c.FRAMEBUFFER,null)}function ei(Re){return Math.min(T,Re.samples)}function ji(Re){const pe=r.get(Re);return p&&Re.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==pe.__useRenderToTexture}function As(Re,pe){const ft=Re.colorSpace,pn=Re.format,dn=Re.type;return!0===Re.isCompressedTexture||1035===Re.format||ft!==Us&&""!==ft&&(ft===Ai?!1===p?!0===e.has("EXT_sRGB")&&pn===Oe?(Re.format=1035,Re.minFilter=Z,Re.generateMipmaps=!1):pe=dl.sRGBToLinear(pe):(pn!==Oe||dn!==Ie)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ft)),pe}this.allocateTextureUnit=function Bt(){const Re=Zt;return Re>=y&&console.warn("THREE.WebGLTextures: Trying to use "+Re+" texture units while this GPU supports only "+y),Zt+=1,Re},this.resetTextureUnits=function Pt(){Zt=0},this.setTexture2D=nn,this.setTexture2DArray=function at(Re,pe){const ft=r.get(Re);Re.version>0&&ft.__version!==Re.version?Rr(ft,Re,pe):t.bindTexture(c.TEXTURE_2D_ARRAY,ft.__webglTexture,c.TEXTURE0+pe)},this.setTexture3D=function Nt(Re,pe){const ft=r.get(Re);Re.version>0&&ft.__version!==Re.version?Rr(ft,Re,pe):t.bindTexture(c.TEXTURE_3D,ft.__webglTexture,c.TEXTURE0+pe)},this.setTextureCube=function Nn(Re,pe){const ft=r.get(Re);Re.version>0&&ft.__version!==Re.version?function fs(Re,pe,ft){if(6!==pe.image.length)return;const pn=bi(Re,pe),dn=pe.source;t.bindTexture(c.TEXTURE_CUBE_MAP,Re.__webglTexture,c.TEXTURE0+ft);const vn=r.get(dn);if(dn.version!==vn.__version||!0===pn){t.activeTexture(c.TEXTURE0+ft),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,pe.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,pe.unpackAlignment),c.pixelStorei(c.UNPACK_COLORSPACE_CONVERSION_WEBGL,c.NONE);const di=pe.isCompressedTexture||pe.image[0].isCompressedTexture,xn=pe.image[0]&&pe.image[0].isDataTexture,Mt=[];for(let _t=0;_t<6;_t++)Mt[_t]=di||xn?xn?pe.image[_t].image:pe.image[_t]:X(pe.image[_t],!1,!0,_),Mt[_t]=As(pe,Mt[_t]);const Ci=Mt[0],yi=ae(Ci)||p,wi=l.convert(pe.format,pe.colorSpace),ii=l.convert(pe.type),li=We(pe.internalFormat,wi,ii,pe.colorSpace),nr=p&&!0!==pe.isVideoTexture,Vr=void 0===vn.__version||!0===pn;let Ln,Xe=le(pe,Ci,yi);if(mi(c.TEXTURE_CUBE_MAP,pe,yi),di){nr&&Vr&&t.texStorage2D(c.TEXTURE_CUBE_MAP,Xe,li,Ci.width,Ci.height);for(let _t=0;_t<6;_t++){Ln=Mt[_t].mipmaps;for(let An=0;An<Ln.length;An++){const Wn=Ln[An];pe.format!==Oe?null!==wi?nr?t.compressedTexSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An,0,0,Wn.width,Wn.height,wi,Wn.data):t.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An,li,Wn.width,Wn.height,0,Wn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):nr?t.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An,0,0,Wn.width,Wn.height,wi,ii,Wn.data):t.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An,li,Wn.width,Wn.height,0,wi,ii,Wn.data)}}}else{Ln=pe.mipmaps,nr&&Vr&&(Ln.length>0&&Xe++,t.texStorage2D(c.TEXTURE_CUBE_MAP,Xe,li,Mt[0].width,Mt[0].height));for(let _t=0;_t<6;_t++)if(xn){nr?t.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,0,0,Mt[_t].width,Mt[_t].height,wi,ii,Mt[_t].data):t.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,li,Mt[_t].width,Mt[_t].height,0,wi,ii,Mt[_t].data);for(let An=0;An<Ln.length;An++){const xr=Ln[An].image[_t].image;nr?t.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An+1,0,0,xr.width,xr.height,wi,ii,xr.data):t.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An+1,li,xr.width,xr.height,0,wi,ii,xr.data)}}else{nr?t.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,0,0,wi,ii,Mt[_t]):t.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,li,wi,ii,Mt[_t]);for(let An=0;An<Ln.length;An++){const Wn=Ln[An];nr?t.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An+1,0,0,wi,ii,Wn.image[_t]):t.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_t,An+1,li,wi,ii,Wn.image[_t])}}}Te(pe,yi)&&De(c.TEXTURE_CUBE_MAP),vn.__version=dn.version,pe.onUpdate&&pe.onUpdate(pe)}Re.__version=pe.version}(ft,Re,pe):t.bindTexture(c.TEXTURE_CUBE_MAP,ft.__webglTexture,c.TEXTURE0+pe)},this.rebindTextures=function yn(Re,pe,ft){const pn=r.get(Re);void 0!==pe&&Ii(pn.__webglFramebuffer,Re,Re.texture,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,0),void 0!==ft&&Vt(Re)},this.setupRenderTarget=function Jt(Re){const pe=Re.texture,ft=r.get(Re),pn=r.get(pe);Re.addEventListener("dispose",qt),!0!==Re.isWebGLMultipleRenderTargets&&(void 0===pn.__webglTexture&&(pn.__webglTexture=c.createTexture()),pn.__version=pe.version,f.memory.textures++);const dn=!0===Re.isWebGLCubeRenderTarget,vn=!0===Re.isWebGLMultipleRenderTargets,di=ae(Re)||p;if(dn){ft.__webglFramebuffer=[];for(let xn=0;xn<6;xn++)if(p&&pe.mipmaps&&pe.mipmaps.length>0){ft.__webglFramebuffer[xn]=[];for(let Mt=0;Mt<pe.mipmaps.length;Mt++)ft.__webglFramebuffer[xn][Mt]=c.createFramebuffer()}else ft.__webglFramebuffer[xn]=c.createFramebuffer()}else{if(p&&pe.mipmaps&&pe.mipmaps.length>0){ft.__webglFramebuffer=[];for(let xn=0;xn<pe.mipmaps.length;xn++)ft.__webglFramebuffer[xn]=c.createFramebuffer()}else ft.__webglFramebuffer=c.createFramebuffer();if(vn)if(o.drawBuffers){const xn=Re.texture;for(let Mt=0,Ci=xn.length;Mt<Ci;Mt++){const yi=r.get(xn[Mt]);void 0===yi.__webglTexture&&(yi.__webglTexture=c.createTexture(),f.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(p&&Re.samples>0&&!1===ji(Re)){const xn=vn?pe:[pe];ft.__webglMultisampledFramebuffer=c.createFramebuffer(),ft.__webglColorRenderbuffer=[],t.bindFramebuffer(c.FRAMEBUFFER,ft.__webglMultisampledFramebuffer);for(let Mt=0;Mt<xn.length;Mt++){const Ci=xn[Mt];ft.__webglColorRenderbuffer[Mt]=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,ft.__webglColorRenderbuffer[Mt]);const yi=l.convert(Ci.format,Ci.colorSpace),wi=l.convert(Ci.type),ii=We(Ci.internalFormat,yi,wi,Ci.colorSpace,!0===Re.isXRRenderTarget),li=ei(Re);c.renderbufferStorageMultisample(c.RENDERBUFFER,li,ii,Re.width,Re.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0+Mt,c.RENDERBUFFER,ft.__webglColorRenderbuffer[Mt])}c.bindRenderbuffer(c.RENDERBUFFER,null),Re.depthBuffer&&(ft.__webglDepthRenderbuffer=c.createRenderbuffer(),ze(ft.__webglDepthRenderbuffer,Re,!0)),t.bindFramebuffer(c.FRAMEBUFFER,null)}}if(dn){t.bindTexture(c.TEXTURE_CUBE_MAP,pn.__webglTexture),mi(c.TEXTURE_CUBE_MAP,pe,di);for(let xn=0;xn<6;xn++)if(p&&pe.mipmaps&&pe.mipmaps.length>0)for(let Mt=0;Mt<pe.mipmaps.length;Mt++)Ii(ft.__webglFramebuffer[xn][Mt],Re,pe,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+xn,Mt);else Ii(ft.__webglFramebuffer[xn],Re,pe,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+xn,0);Te(pe,di)&&De(c.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(vn){const xn=Re.texture;for(let Mt=0,Ci=xn.length;Mt<Ci;Mt++){const yi=xn[Mt],wi=r.get(yi);t.bindTexture(c.TEXTURE_2D,wi.__webglTexture),mi(c.TEXTURE_2D,yi,di),Ii(ft.__webglFramebuffer,Re,yi,c.COLOR_ATTACHMENT0+Mt,c.TEXTURE_2D,0),Te(yi,di)&&De(c.TEXTURE_2D)}t.unbindTexture()}else{let xn=c.TEXTURE_2D;if((Re.isWebGL3DRenderTarget||Re.isWebGLArrayRenderTarget)&&(p?xn=Re.isWebGL3DRenderTarget?c.TEXTURE_3D:c.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(xn,pn.__webglTexture),mi(xn,pe,di),p&&pe.mipmaps&&pe.mipmaps.length>0)for(let Mt=0;Mt<pe.mipmaps.length;Mt++)Ii(ft.__webglFramebuffer[Mt],Re,pe,c.COLOR_ATTACHMENT0,xn,Mt);else Ii(ft.__webglFramebuffer,Re,pe,c.COLOR_ATTACHMENT0,xn,0);Te(pe,di)&&De(xn),t.unbindTexture()}Re.depthBuffer&&Vt(Re)},this.updateRenderTargetMipmap=function gi(Re){const pe=ae(Re)||p,ft=!0===Re.isWebGLMultipleRenderTargets?Re.texture:[Re.texture];for(let pn=0,dn=ft.length;pn<dn;pn++){const vn=ft[pn];if(Te(vn,pe)){const di=Re.isWebGLCubeRenderTarget?c.TEXTURE_CUBE_MAP:c.TEXTURE_2D,xn=r.get(vn).__webglTexture;t.bindTexture(di,xn),De(di),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function Kn(Re){if(p&&Re.samples>0&&!1===ji(Re)){const pe=Re.isWebGLMultipleRenderTargets?Re.texture:[Re.texture],ft=Re.width,pn=Re.height;let dn=c.COLOR_BUFFER_BIT;const vn=[],di=Re.stencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,xn=r.get(Re),Mt=!0===Re.isWebGLMultipleRenderTargets;if(Mt)for(let Ci=0;Ci<pe.length;Ci++)t.bindFramebuffer(c.FRAMEBUFFER,xn.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0+Ci,c.RENDERBUFFER,null),t.bindFramebuffer(c.FRAMEBUFFER,xn.__webglFramebuffer),c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0+Ci,c.TEXTURE_2D,null,0);t.bindFramebuffer(c.READ_FRAMEBUFFER,xn.__webglMultisampledFramebuffer),t.bindFramebuffer(c.DRAW_FRAMEBUFFER,xn.__webglFramebuffer);for(let Ci=0;Ci<pe.length;Ci++){vn.push(c.COLOR_ATTACHMENT0+Ci),Re.depthBuffer&&vn.push(di);const yi=void 0!==xn.__ignoreDepthValues&&xn.__ignoreDepthValues;if(!1===yi&&(Re.depthBuffer&&(dn|=c.DEPTH_BUFFER_BIT),Re.stencilBuffer&&(dn|=c.STENCIL_BUFFER_BIT)),Mt&&c.framebufferRenderbuffer(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.RENDERBUFFER,xn.__webglColorRenderbuffer[Ci]),!0===yi&&(c.invalidateFramebuffer(c.READ_FRAMEBUFFER,[di]),c.invalidateFramebuffer(c.DRAW_FRAMEBUFFER,[di])),Mt){const wi=r.get(pe[Ci]).__webglTexture;c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,wi,0)}c.blitFramebuffer(0,0,ft,pn,0,0,ft,pn,dn,c.NEAREST),R&&c.invalidateFramebuffer(c.READ_FRAMEBUFFER,vn)}if(t.bindFramebuffer(c.READ_FRAMEBUFFER,null),t.bindFramebuffer(c.DRAW_FRAMEBUFFER,null),Mt)for(let Ci=0;Ci<pe.length;Ci++){t.bindFramebuffer(c.FRAMEBUFFER,xn.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0+Ci,c.RENDERBUFFER,xn.__webglColorRenderbuffer[Ci]);const yi=r.get(pe[Ci]).__webglTexture;t.bindFramebuffer(c.FRAMEBUFFER,xn.__webglFramebuffer),c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0+Ci,c.TEXTURE_2D,yi,0)}t.bindFramebuffer(c.DRAW_FRAMEBUFFER,xn.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Vt,this.setupFrameBufferTexture=Ii,this.useMultisampledRTT=ji}function jv(c,e,t){const r=t.isWebGL2;return{convert:function o(l,f=""){let p;if(l===Ie)return c.UNSIGNED_BYTE;if(1017===l)return c.UNSIGNED_SHORT_4_4_4_4;if(1018===l)return c.UNSIGNED_SHORT_5_5_5_1;if(1010===l)return c.BYTE;if(1011===l)return c.SHORT;if(1012===l)return c.UNSIGNED_SHORT;if(1013===l)return c.INT;if(l===Ve)return c.UNSIGNED_INT;if(l===st)return c.FLOAT;if(l===kt)return r?c.HALF_FLOAT:(p=e.get("OES_texture_half_float"),null!==p?p.HALF_FLOAT_OES:null);if(1021===l)return c.ALPHA;if(l===Oe)return c.RGBA;if(1024===l)return c.LUMINANCE;if(1025===l)return c.LUMINANCE_ALPHA;if(l===He)return c.DEPTH_COMPONENT;if(l===je)return c.DEPTH_STENCIL;if(1035===l)return p=e.get("EXT_sRGB"),null!==p?p.SRGB_ALPHA_EXT:null;if(1028===l)return c.RED;if(1029===l)return c.RED_INTEGER;if(1030===l)return c.RG;if(1031===l)return c.RG_INTEGER;if(1033===l)return c.RGBA_INTEGER;if(33776===l||33777===l||33778===l||33779===l)if(f===Ai){if(p=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===p)return null;if(33776===l)return p.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===l)return p.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===l)return p.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===l)return p.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(p=e.get("WEBGL_compressed_texture_s3tc"),null===p)return null;if(33776===l)return p.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===l)return p.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===l)return p.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===l)return p.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===l||35841===l||35842===l||35843===l){if(p=e.get("WEBGL_compressed_texture_pvrtc"),null===p)return null;if(35840===l)return p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===l)return p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===l)return p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===l)return p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===l)return p=e.get("WEBGL_compressed_texture_etc1"),null!==p?p.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===l||37496===l){if(p=e.get("WEBGL_compressed_texture_etc"),null===p)return null;if(37492===l)return f===Ai?p.COMPRESSED_SRGB8_ETC2:p.COMPRESSED_RGB8_ETC2;if(37496===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:p.COMPRESSED_RGBA8_ETC2_EAC}if(37808===l||37809===l||37810===l||37811===l||37812===l||37813===l||37814===l||37815===l||37816===l||37817===l||37818===l||37819===l||37820===l||37821===l){if(p=e.get("WEBGL_compressed_texture_astc"),null===p)return null;if(37808===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:p.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:p.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:p.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:p.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:p.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:p.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:p.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:p.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:p.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:p.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:p.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:p.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:p.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===l)return f===Ai?p.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:p.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===l){if(p=e.get("EXT_texture_compression_bptc"),null===p)return null;if(36492===l)return f===Ai?p.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:p.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===l||36284===l||36285===l||36286===l){if(p=e.get("EXT_texture_compression_rgtc"),null===p)return null;if(36492===l)return p.COMPRESSED_RED_RGTC1_EXT;if(36284===l)return p.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===l)return p.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===l)return p.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return l===jt?r?c.UNSIGNED_INT_24_8:(p=e.get("WEBGL_depth_texture"),null!==p?p.UNSIGNED_INT_24_8_WEBGL:null):void 0!==c[l]?c[l]:null}}}class Ml extends Lo{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class hc extends ws{constructor(){super(),this.isGroup=!0,this.type="Group"}}const $v={type:"move"};class Df{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new hc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new hc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Me,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Me),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new hc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Me,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Me),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let o=null,l=null,f=null;const p=this._targetRay,y=this._grip,_=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(_&&e.hand){f=!0;for(const $ of e.hand.values()){const z=t.getJointPose($,r),L=this._getHandJoint(_,$);null!==z&&(L.matrix.fromArray(z.transform.matrix),L.matrix.decompose(L.position,L.rotation,L.scale),L.matrixWorldNeedsUpdate=!0,L.jointRadius=z.radius),L.visible=null!==z}const C=_.joints["index-finger-tip"].position.distanceTo(_.joints["thumb-tip"].position),R=.02,U=.005;_.inputState.pinching&&C>R+U?(_.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!_.inputState.pinching&&C<=R-U&&(_.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==y&&e.gripSpace&&(l=t.getPose(e.gripSpace,r),null!==l&&(y.matrix.fromArray(l.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,l.linearVelocity?(y.hasLinearVelocity=!0,y.linearVelocity.copy(l.linearVelocity)):y.hasLinearVelocity=!1,l.angularVelocity?(y.hasAngularVelocity=!0,y.angularVelocity.copy(l.angularVelocity)):y.hasAngularVelocity=!1));null!==p&&(o=t.getPose(e.targetRaySpace,r),null===o&&null!==l&&(o=l),null!==o&&(p.matrix.fromArray(o.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,o.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(o.linearVelocity)):p.hasLinearVelocity=!1,o.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(o.angularVelocity)):p.hasAngularVelocity=!1,this.dispatchEvent($v)))}return null!==p&&(p.visible=null!==o),null!==y&&(y.visible=null!==l),null!==_&&(_.visible=null!==f),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const r=new hc;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class Sx extends ua{constructor(e,t,r,o,l,f,p,y,_,w){if((w=void 0!==w?w:He)!==He&&w!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&w===He&&(r=Ve),void 0===r&&w===je&&(r=jt),super(null,o,l,f,p,y,w,r,_),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==p?p:Lt,this.minFilter=void 0!==y?y:Lt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class rg extends zi{constructor(e,t){super();const r=this;let o=null,l=1,f=null,p="local-floor",y=1,_=null,w=null,T=null,C=null,R=null,U=null;const $=t.getContextAttributes();let z=null,L=null;const te=[],X=[],ae=new Lo;ae.layers.enable(1),ae.viewport=new tr;const ve=new Lo;ve.layers.enable(2),ve.viewport=new tr;const Te=[ae,ve],De=new Ml;De.layers.enable(1),De.layers.enable(2);let We=null,le=null;function Se(at){const Nt=X.indexOf(at.inputSource);if(-1===Nt)return;const Nn=te[Nt];void 0!==Nn&&(Nn.update(at.inputSource,at.frame,_||f),Nn.dispatchEvent({type:at.type,data:at.inputSource}))}function bt(){o.removeEventListener("select",Se),o.removeEventListener("selectstart",Se),o.removeEventListener("selectend",Se),o.removeEventListener("squeeze",Se),o.removeEventListener("squeezestart",Se),o.removeEventListener("squeezeend",Se),o.removeEventListener("end",bt),o.removeEventListener("inputsourceschange",qt);for(let at=0;at<te.length;at++){const Nt=X[at];null!==Nt&&(X[at]=null,te[at].disconnect(Nt))}We=null,le=null,e.setRenderTarget(z),R=null,C=null,T=null,o=null,L=null,nn.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function qt(at){for(let Nt=0;Nt<at.removed.length;Nt++){const Nn=at.removed[Nt],Un=X.indexOf(Nn);Un>=0&&(X[Un]=null,te[Un].disconnect(Nn))}for(let Nt=0;Nt<at.added.length;Nt++){const Nn=at.added[Nt];let Un=X.indexOf(Nn);if(-1===Un){for(let _i=0;_i<te.length;_i++){if(_i>=X.length){X.push(Nn),Un=_i;break}if(null===X[_i]){X[_i]=Nn,Un=_i;break}}if(-1===Un)break}const $n=te[Un];$n&&$n.connect(Nn)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(at){let Nt=te[at];return void 0===Nt&&(Nt=new Df,te[at]=Nt),Nt.getTargetRaySpace()},this.getControllerGrip=function(at){let Nt=te[at];return void 0===Nt&&(Nt=new Df,te[at]=Nt),Nt.getGripSpace()},this.getHand=function(at){let Nt=te[at];return void 0===Nt&&(Nt=new Df,te[at]=Nt),Nt.getHandSpace()},this.setFramebufferScaleFactor=function(at){l=at,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(at){p=at,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return _||f},this.setReferenceSpace=function(at){_=at},this.getBaseLayer=function(){return null!==C?C:R},this.getBinding=function(){return T},this.getFrame=function(){return U},this.getSession=function(){return o},this.setSession=function(){var at=(0,N.Z)(function*(Nt){if(o=Nt,null!==o){if(z=e.getRenderTarget(),o.addEventListener("select",Se),o.addEventListener("selectstart",Se),o.addEventListener("selectend",Se),o.addEventListener("squeeze",Se),o.addEventListener("squeezestart",Se),o.addEventListener("squeezeend",Se),o.addEventListener("end",bt),o.addEventListener("inputsourceschange",qt),!0!==$.xrCompatible&&(yield t.makeXRCompatible()),void 0===o.renderState.layers||!1===e.capabilities.isWebGL2)R=new XRWebGLLayer(o,t,{antialias:void 0!==o.renderState.layers||$.antialias,alpha:!0,depth:$.depth,stencil:$.stencil,framebufferScaleFactor:l}),o.updateRenderState({baseLayer:R}),L=new Ta(R.framebufferWidth,R.framebufferHeight,{format:Oe,type:Ie,colorSpace:e.outputColorSpace,stencilBuffer:$.stencil});else{let Nn=null,Un=null,$n=null;$.depth&&($n=$.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Nn=$.stencil?je:He,Un=$.stencil?jt:Ve);const _i={colorFormat:t.RGBA8,depthFormat:$n,scaleFactor:l};T=new XRWebGLBinding(o,t),C=T.createProjectionLayer(_i),o.updateRenderState({layers:[C]}),L=new Ta(C.textureWidth,C.textureHeight,{format:Oe,type:Ie,depthTexture:new Sx(C.textureWidth,C.textureHeight,Un,void 0,void 0,void 0,void 0,void 0,void 0,Nn),stencilBuffer:$.stencil,colorSpace:e.outputColorSpace,samples:$.antialias?4:0}),e.properties.get(L).__ignoreDepthValues=C.ignoreDepthValues}L.isXRRenderTarget=!0,this.setFoveation(y),_=null,f=yield o.requestReferenceSpace(p),nn.setContext(o),nn.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}});return function(Nt){return at.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==o)return o.environmentBlendMode};const ct=new Me,dt=new Me;function Zt(at,Nt){null===Nt?at.matrixWorld.copy(at.matrix):at.matrixWorld.multiplyMatrices(Nt.matrixWorld,at.matrix),at.matrixWorldInverse.copy(at.matrixWorld).invert()}this.updateCamera=function(at){if(null===o)return;De.near=ve.near=ae.near=at.near,De.far=ve.far=ae.far=at.far,(We!==De.near||le!==De.far)&&(o.updateRenderState({depthNear:De.near,depthFar:De.far}),We=De.near,le=De.far);const Nt=at.parent,Nn=De.cameras;Zt(De,Nt);for(let Un=0;Un<Nn.length;Un++)Zt(Nn[Un],Nt);2===Nn.length?function xt(at,Nt,Nn){ct.setFromMatrixPosition(Nt.matrixWorld),dt.setFromMatrixPosition(Nn.matrixWorld);const Un=ct.distanceTo(dt),$n=Nt.projectionMatrix.elements,_i=Nn.projectionMatrix.elements,mi=$n[14]/($n[10]-1),bi=$n[14]/($n[10]+1),Rr=($n[9]+1)/$n[5],fs=($n[9]-1)/$n[5],Ii=($n[8]-1)/$n[0],ze=(_i[8]+1)/_i[0],Sn=mi*Ii,Vt=mi*ze,yn=Un/(-Ii+ze),Jt=yn*-Ii;Nt.matrixWorld.decompose(at.position,at.quaternion,at.scale),at.translateX(Jt),at.translateZ(yn),at.matrixWorld.compose(at.position,at.quaternion,at.scale),at.matrixWorldInverse.copy(at.matrixWorld).invert();const gi=mi+yn,Kn=bi+yn;at.projectionMatrix.makePerspective(Sn-Jt,Vt+(Un-Jt),Rr*bi/Kn*gi,fs*bi/Kn*gi,gi,Kn),at.projectionMatrixInverse.copy(at.projectionMatrix).invert()}(De,ae,ve):De.projectionMatrix.copy(ae.projectionMatrix),function Pt(at,Nt,Nn){null===Nn?at.matrix.copy(Nt.matrixWorld):(at.matrix.copy(Nn.matrixWorld),at.matrix.invert(),at.matrix.multiply(Nt.matrixWorld)),at.matrix.decompose(at.position,at.quaternion,at.scale),at.updateMatrixWorld(!0);const Un=at.children;for(let $n=0,_i=Un.length;$n<_i;$n++)Un[$n].updateMatrixWorld(!0);at.projectionMatrix.copy(Nt.projectionMatrix),at.projectionMatrixInverse.copy(Nt.projectionMatrixInverse),at.isPerspectiveCamera&&(at.fov=2*fr*Math.atan(1/at.projectionMatrix.elements[5]),at.zoom=1)}(at,De,Nt)},this.getCamera=function(){return De},this.getFoveation=function(){if(null!==C||null!==R)return y},this.setFoveation=function(at){y=at,null!==C&&(C.fixedFoveation=at),null!==R&&void 0!==R.fixedFoveation&&(R.fixedFoveation=at)};let Bt=null;const nn=new qa;nn.setAnimationLoop(function en(at,Nt){if(w=Nt.getViewerPose(_||f),U=Nt,null!==w){const Nn=w.views;null!==R&&(e.setRenderTargetFramebuffer(L,R.framebuffer),e.setRenderTarget(L));let Un=!1;Nn.length!==De.cameras.length&&(De.cameras.length=0,Un=!0);for(let $n=0;$n<Nn.length;$n++){const _i=Nn[$n];let mi=null;if(null!==R)mi=R.getViewport(_i);else{const Rr=T.getViewSubImage(C,_i);mi=Rr.viewport,0===$n&&(e.setRenderTargetTextures(L,Rr.colorTexture,C.ignoreDepthValues?void 0:Rr.depthStencilTexture),e.setRenderTarget(L))}let bi=Te[$n];void 0===bi&&(bi=new Lo,bi.layers.enable($n),bi.viewport=new tr,Te[$n]=bi),bi.matrix.fromArray(_i.transform.matrix),bi.matrix.decompose(bi.position,bi.quaternion,bi.scale),bi.projectionMatrix.fromArray(_i.projectionMatrix),bi.projectionMatrixInverse.copy(bi.projectionMatrix).invert(),bi.viewport.set(mi.x,mi.y,mi.width,mi.height),0===$n&&(De.matrix.copy(bi.matrix),De.matrix.decompose(De.position,De.quaternion,De.scale)),!0===Un&&De.cameras.push(bi)}}for(let Nn=0;Nn<te.length;Nn++){const Un=X[Nn],$n=te[Nn];null!==Un&&void 0!==$n&&$n.update(Un,Nt,_||f)}Bt&&Bt(at,Nt),Nt.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Nt}),U=null}),this.setAnimationLoop=function(at){Bt=at},this.dispose=function(){}}}function Xv(c,e){function t(z,L){!0===z.matrixAutoUpdate&&z.updateMatrix(),L.value.copy(z.matrix)}function l(z,L){z.opacity.value=L.opacity,L.color&&z.diffuse.value.copy(L.color),L.emissive&&z.emissive.value.copy(L.emissive).multiplyScalar(L.emissiveIntensity),L.map&&(z.map.value=L.map,t(L.map,z.mapTransform)),L.alphaMap&&(z.alphaMap.value=L.alphaMap,t(L.alphaMap,z.alphaMapTransform)),L.bumpMap&&(z.bumpMap.value=L.bumpMap,t(L.bumpMap,z.bumpMapTransform),z.bumpScale.value=L.bumpScale,L.side===fe&&(z.bumpScale.value*=-1)),L.normalMap&&(z.normalMap.value=L.normalMap,t(L.normalMap,z.normalMapTransform),z.normalScale.value.copy(L.normalScale),L.side===fe&&z.normalScale.value.negate()),L.displacementMap&&(z.displacementMap.value=L.displacementMap,t(L.displacementMap,z.displacementMapTransform),z.displacementScale.value=L.displacementScale,z.displacementBias.value=L.displacementBias),L.emissiveMap&&(z.emissiveMap.value=L.emissiveMap,t(L.emissiveMap,z.emissiveMapTransform)),L.specularMap&&(z.specularMap.value=L.specularMap,t(L.specularMap,z.specularMapTransform)),L.alphaTest>0&&(z.alphaTest.value=L.alphaTest);const te=e.get(L).envMap;if(te&&(z.envMap.value=te,z.flipEnvMap.value=te.isCubeTexture&&!1===te.isRenderTargetTexture?-1:1,z.reflectivity.value=L.reflectivity,z.ior.value=L.ior,z.refractionRatio.value=L.refractionRatio),L.lightMap){z.lightMap.value=L.lightMap;const X=!0===c._useLegacyLights?Math.PI:1;z.lightMapIntensity.value=L.lightMapIntensity*X,t(L.lightMap,z.lightMapTransform)}L.aoMap&&(z.aoMap.value=L.aoMap,z.aoMapIntensity.value=L.aoMapIntensity,t(L.aoMap,z.aoMapTransform))}return{refreshFogUniforms:function r(z,L){L.color.getRGB(z.fogColor.value,kp(c)),L.isFog?(z.fogNear.value=L.near,z.fogFar.value=L.far):L.isFogExp2&&(z.fogDensity.value=L.density)},refreshMaterialUniforms:function o(z,L,te,X,ae){L.isMeshBasicMaterial||L.isMeshLambertMaterial?l(z,L):L.isMeshToonMaterial?(l(z,L),function T(z,L){L.gradientMap&&(z.gradientMap.value=L.gradientMap)}(z,L)):L.isMeshPhongMaterial?(l(z,L),function w(z,L){z.specular.value.copy(L.specular),z.shininess.value=Math.max(L.shininess,1e-4)}(z,L)):L.isMeshStandardMaterial?(l(z,L),function C(z,L){z.metalness.value=L.metalness,L.metalnessMap&&(z.metalnessMap.value=L.metalnessMap,t(L.metalnessMap,z.metalnessMapTransform)),z.roughness.value=L.roughness,L.roughnessMap&&(z.roughnessMap.value=L.roughnessMap,t(L.roughnessMap,z.roughnessMapTransform)),e.get(L).envMap&&(z.envMapIntensity.value=L.envMapIntensity)}(z,L),L.isMeshPhysicalMaterial&&function R(z,L,te){z.ior.value=L.ior,L.sheen>0&&(z.sheenColor.value.copy(L.sheenColor).multiplyScalar(L.sheen),z.sheenRoughness.value=L.sheenRoughness,L.sheenColorMap&&(z.sheenColorMap.value=L.sheenColorMap,t(L.sheenColorMap,z.sheenColorMapTransform)),L.sheenRoughnessMap&&(z.sheenRoughnessMap.value=L.sheenRoughnessMap,t(L.sheenRoughnessMap,z.sheenRoughnessMapTransform))),L.clearcoat>0&&(z.clearcoat.value=L.clearcoat,z.clearcoatRoughness.value=L.clearcoatRoughness,L.clearcoatMap&&(z.clearcoatMap.value=L.clearcoatMap,t(L.clearcoatMap,z.clearcoatMapTransform)),L.clearcoatRoughnessMap&&(z.clearcoatRoughnessMap.value=L.clearcoatRoughnessMap,t(L.clearcoatRoughnessMap,z.clearcoatRoughnessMapTransform)),L.clearcoatNormalMap&&(z.clearcoatNormalMap.value=L.clearcoatNormalMap,t(L.clearcoatNormalMap,z.clearcoatNormalMapTransform),z.clearcoatNormalScale.value.copy(L.clearcoatNormalScale),L.side===fe&&z.clearcoatNormalScale.value.negate())),L.iridescence>0&&(z.iridescence.value=L.iridescence,z.iridescenceIOR.value=L.iridescenceIOR,z.iridescenceThicknessMinimum.value=L.iridescenceThicknessRange[0],z.iridescenceThicknessMaximum.value=L.iridescenceThicknessRange[1],L.iridescenceMap&&(z.iridescenceMap.value=L.iridescenceMap,t(L.iridescenceMap,z.iridescenceMapTransform)),L.iridescenceThicknessMap&&(z.iridescenceThicknessMap.value=L.iridescenceThicknessMap,t(L.iridescenceThicknessMap,z.iridescenceThicknessMapTransform))),L.transmission>0&&(z.transmission.value=L.transmission,z.transmissionSamplerMap.value=te.texture,z.transmissionSamplerSize.value.set(te.width,te.height),L.transmissionMap&&(z.transmissionMap.value=L.transmissionMap,t(L.transmissionMap,z.transmissionMapTransform)),z.thickness.value=L.thickness,L.thicknessMap&&(z.thicknessMap.value=L.thicknessMap,t(L.thicknessMap,z.thicknessMapTransform)),z.attenuationDistance.value=L.attenuationDistance,z.attenuationColor.value.copy(L.attenuationColor)),L.anisotropy>0&&(z.anisotropyVector.value.set(L.anisotropy*Math.cos(L.anisotropyRotation),L.anisotropy*Math.sin(L.anisotropyRotation)),L.anisotropyMap&&(z.anisotropyMap.value=L.anisotropyMap,t(L.anisotropyMap,z.anisotropyMapTransform))),z.specularIntensity.value=L.specularIntensity,z.specularColor.value.copy(L.specularColor),L.specularColorMap&&(z.specularColorMap.value=L.specularColorMap,t(L.specularColorMap,z.specularColorMapTransform)),L.specularIntensityMap&&(z.specularIntensityMap.value=L.specularIntensityMap,t(L.specularIntensityMap,z.specularIntensityMapTransform))}(z,L,ae)):L.isMeshMatcapMaterial?(l(z,L),function U(z,L){L.matcap&&(z.matcap.value=L.matcap)}(z,L)):L.isMeshDepthMaterial?l(z,L):L.isMeshDistanceMaterial?(l(z,L),function $(z,L){const te=e.get(L).light;z.referencePosition.value.setFromMatrixPosition(te.matrixWorld),z.nearDistance.value=te.shadow.camera.near,z.farDistance.value=te.shadow.camera.far}(z,L)):L.isMeshNormalMaterial?l(z,L):L.isLineBasicMaterial?(function f(z,L){z.diffuse.value.copy(L.color),z.opacity.value=L.opacity,L.map&&(z.map.value=L.map,t(L.map,z.mapTransform))}(z,L),L.isLineDashedMaterial&&function p(z,L){z.dashSize.value=L.dashSize,z.totalSize.value=L.dashSize+L.gapSize,z.scale.value=L.scale}(z,L)):L.isPointsMaterial?function y(z,L,te,X){z.diffuse.value.copy(L.color),z.opacity.value=L.opacity,z.size.value=L.size*te,z.scale.value=.5*X,L.map&&(z.map.value=L.map,t(L.map,z.uvTransform)),L.alphaMap&&(z.alphaMap.value=L.alphaMap,t(L.alphaMap,z.alphaMapTransform)),L.alphaTest>0&&(z.alphaTest.value=L.alphaTest)}(z,L,te,X):L.isSpriteMaterial?function _(z,L){z.diffuse.value.copy(L.color),z.opacity.value=L.opacity,z.rotation.value=L.rotation,L.map&&(z.map.value=L.map,t(L.map,z.mapTransform)),L.alphaMap&&(z.alphaMap.value=L.alphaMap,t(L.alphaMap,z.alphaMapTransform)),L.alphaTest>0&&(z.alphaTest.value=L.alphaTest)}(z,L):L.isShadowMaterial?(z.color.value.copy(L.color),z.opacity.value=L.opacity):L.isShaderMaterial&&(L.uniformsNeedUpdate=!1)}}}function Yv(c,e,t,r){let o={},l={},f=[];const p=t.isWebGL2?c.getParameter(c.MAX_UNIFORM_BUFFER_BINDINGS):0;function R(te,X,ae){const ve=te.value;if(void 0===ae[X]){if("number"==typeof ve)ae[X]=ve;else{const Te=Array.isArray(ve)?ve:[ve],De=[];for(let We=0;We<Te.length;We++)De.push(Te[We].clone());ae[X]=De}return!0}if("number"==typeof ve){if(ae[X]!==ve)return ae[X]=ve,!0}else{const Te=Array.isArray(ae[X])?ae[X]:[ae[X]],De=Array.isArray(ve)?ve:[ve];for(let We=0;We<Te.length;We++){const le=Te[We];if(!1===le.equals(De[We]))return le.copy(De[We]),!0}}return!1}function $(te){const X={boundary:0,storage:0};return"number"==typeof te?(X.boundary=4,X.storage=4):te.isVector2?(X.boundary=8,X.storage=8):te.isVector3||te.isColor?(X.boundary=16,X.storage=12):te.isVector4?(X.boundary=16,X.storage=16):te.isMatrix3?(X.boundary=48,X.storage=48):te.isMatrix4?(X.boundary=64,X.storage=64):te.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",te),X}function z(te){const X=te.target;X.removeEventListener("dispose",z);const ae=f.indexOf(X.__bindingPointIndex);f.splice(ae,1),c.deleteBuffer(o[X.id]),delete o[X.id],delete l[X.id]}return{bind:function y(te,X){r.uniformBlockBinding(te,X.program)},update:function _(te,X){let ae=o[te.id];void 0===ae&&(function U(te){const X=te.uniforms;let ae=0;let Te=0;for(let De=0,We=X.length;De<We;De++){const le=X[De],Se={boundary:0,storage:0},bt=Array.isArray(le.value)?le.value:[le.value];for(let qt=0,ct=bt.length;qt<ct;qt++){const xt=$(bt[qt]);Se.boundary+=xt.boundary,Se.storage+=xt.storage}if(le.__data=new Float32Array(Se.storage/Float32Array.BYTES_PER_ELEMENT),le.__offset=ae,De>0){Te=ae%16;const qt=16-Te;0!==Te&&qt-Se.boundary<0&&(ae+=16-Te,le.__offset=ae)}ae+=Se.storage}Te=ae%16,Te>0&&(ae+=16-Te),te.__size=ae,te.__cache={}}(te),ae=function w(te){const X=function T(){for(let te=0;te<p;te++)if(-1===f.indexOf(te))return f.push(te),te;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();te.__bindingPointIndex=X;const ae=c.createBuffer(),ve=te.__size,Te=te.usage;return c.bindBuffer(c.UNIFORM_BUFFER,ae),c.bufferData(c.UNIFORM_BUFFER,ve,Te),c.bindBuffer(c.UNIFORM_BUFFER,null),c.bindBufferBase(c.UNIFORM_BUFFER,X,ae),ae}(te),o[te.id]=ae,te.addEventListener("dispose",z)),r.updateUBOMapping(te,X.program);const Te=e.render.frame;l[te.id]!==Te&&(function C(te){const ae=te.uniforms,ve=te.__cache;c.bindBuffer(c.UNIFORM_BUFFER,o[te.id]);for(let Te=0,De=ae.length;Te<De;Te++){const We=ae[Te];if(!0===R(We,Te,ve)){const le=We.__offset,Se=Array.isArray(We.value)?We.value:[We.value];let bt=0;for(let qt=0;qt<Se.length;qt++){const ct=Se[qt],dt=$(ct);"number"==typeof ct?(We.__data[0]=ct,c.bufferSubData(c.UNIFORM_BUFFER,le+bt,We.__data)):ct.isMatrix3?(We.__data[0]=ct.elements[0],We.__data[1]=ct.elements[1],We.__data[2]=ct.elements[2],We.__data[3]=ct.elements[0],We.__data[4]=ct.elements[3],We.__data[5]=ct.elements[4],We.__data[6]=ct.elements[5],We.__data[7]=ct.elements[0],We.__data[8]=ct.elements[6],We.__data[9]=ct.elements[7],We.__data[10]=ct.elements[8],We.__data[11]=ct.elements[0]):(ct.toArray(We.__data,bt),bt+=dt.storage/Float32Array.BYTES_PER_ELEMENT)}c.bufferSubData(c.UNIFORM_BUFFER,le,We.__data)}}c.bindBuffer(c.UNIFORM_BUFFER,null)}(te),l[te.id]=Te)},dispose:function L(){for(const te in o)c.deleteBuffer(o[te]);f=[],o={},l={}}}}function qv(){const c=Rs("canvas");return c.style.display="block",c}class Jh{constructor(e={}){const{canvas:t=qv(),context:r=null,depth:o=!0,stencil:l=!0,alpha:f=!1,antialias:p=!1,premultipliedAlpha:y=!0,preserveDrawingBuffer:_=!1,powerPreference:w="default",failIfMajorPerformanceCaveat:T=!1}=e;let C;this.isWebGLRenderer=!0,C=null!==r?r.getContextAttributes().alpha:f;const R=new Uint32Array(4),U=new Int32Array(4);let $=null,z=null;const L=[],te=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Ai,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const X=this;let ae=!1,ve=0,Te=0,De=null,We=-1,le=null;const Se=new tr,bt=new tr;let qt=null;const ct=new gn(0);let dt=0,xt=t.width,Zt=t.height,Pt=1,Bt=null,en=null;const nn=new tr(0,0,xt,Zt),at=new tr(0,0,xt,Zt);let Nt=!1;const Nn=new Bp;let Un=!1,$n=!1,_i=null;const mi=new Fi,bi=new Et,Rr=new Me,fs={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ii(){return null===De?Pt:1}let Vt,yn,Jt,gi,Kn,ei,ji,hr,As,Re,pe,ft,pn,dn,vn,di,xn,Mt,Ci,yi,wi,ii,li,nr,ze=r;function Sn(Ce,ot){for(let Dt=0;Dt<Ce.length;Dt++){const St=t.getContext(Ce[Dt],ot);if(null!==St)return St}return null}try{const Ce={alpha:!0,depth:o,stencil:l,antialias:p,premultipliedAlpha:y,preserveDrawingBuffer:_,powerPreference:w,failIfMajorPerformanceCaveat:T};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r155"),t.addEventListener("webglcontextlost",Ln,!1),t.addEventListener("webglcontextrestored",_t,!1),t.addEventListener("webglcontextcreationerror",An,!1),null===ze){const ot=["webgl2","webgl","experimental-webgl"];if(!0===X.isWebGL1Renderer&&ot.shift(),ze=Sn(ot,Ce),null===ze)throw Sn(ot)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&ze instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===ze.getShaderPrecisionFormat&&(ze.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ce){throw console.error("THREE.WebGLRenderer: "+Ce.message),Ce}function Vr(){Vt=new Em(ze),yn=new lf(ze,Vt,e),Vt.init(yn),ii=new jv(ze,Vt,yn),Jt=new ng(ze,Vt,yn),gi=new vv(ze),Kn=new Nv,ei=new ig(ze,Vt,Jt,Kn,yn,ii,gi),ji=new mv(X),hr=new ax(X),As=new yy(ze,yn),li=new dv(ze,Vt,As,yn),Re=new yv(ze,As,gi,li),pe=new Am(ze,Re,As,gi),Ci=new xv(ze,yn,ei),di=new pv(Kn),ft=new xa(X,ji,hr,Vt,yn,li,di),pn=new Xv(X,Kn),dn=new Km,vn=new Hv(Vt,yn),Mt=new af(X,ji,hr,Jt,pe,C,y),xn=new Wv(X,pe,yn),nr=new Yv(ze,gi,yn,Jt),yi=new fv(ze,Vt,gi,yn),wi=new Sm(ze,Vt,gi,yn),gi.programs=ft.programs,X.capabilities=yn,X.extensions=Vt,X.properties=Kn,X.renderLists=dn,X.shadowMap=xn,X.state=Jt,X.info=gi}Vr();const Xe=new rg(X,ze);function Ln(Ce){Ce.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ae=!0}function _t(){console.log("THREE.WebGLRenderer: Context Restored."),ae=!1;const Ce=gi.autoReset,ot=xn.enabled,Dt=xn.autoUpdate,Ke=xn.needsUpdate,St=xn.type;Vr(),gi.autoReset=Ce,xn.enabled=ot,xn.autoUpdate=Dt,xn.needsUpdate=Ke,xn.type=St}function An(Ce){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ce.statusMessage)}function Wn(Ce){const ot=Ce.target;ot.removeEventListener("dispose",Wn),function xr(Ce){(function ys(Ce){const ot=Kn.get(Ce).programs;void 0!==ot&&(ot.forEach(function(Dt){ft.releaseProgram(Dt)}),Ce.isShaderMaterial&&ft.releaseShaderCache(Ce))})(Ce),Kn.remove(Ce)}(ot)}this.xr=Xe,this.getContext=function(){return ze},this.getContextAttributes=function(){return ze.getContextAttributes()},this.forceContextLoss=function(){const Ce=Vt.get("WEBGL_lose_context");Ce&&Ce.loseContext()},this.forceContextRestore=function(){const Ce=Vt.get("WEBGL_lose_context");Ce&&Ce.restoreContext()},this.getPixelRatio=function(){return Pt},this.setPixelRatio=function(Ce){void 0!==Ce&&(Pt=Ce,this.setSize(xt,Zt,!1))},this.getSize=function(Ce){return Ce.set(xt,Zt)},this.setSize=function(Ce,ot,Dt=!0){Xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(xt=Ce,Zt=ot,t.width=Math.floor(Ce*Pt),t.height=Math.floor(ot*Pt),!0===Dt&&(t.style.width=Ce+"px",t.style.height=ot+"px"),this.setViewport(0,0,Ce,ot))},this.getDrawingBufferSize=function(Ce){return Ce.set(xt*Pt,Zt*Pt).floor()},this.setDrawingBufferSize=function(Ce,ot,Dt){xt=Ce,Zt=ot,Pt=Dt,t.width=Math.floor(Ce*Dt),t.height=Math.floor(ot*Dt),this.setViewport(0,0,Ce,ot)},this.getCurrentViewport=function(Ce){return Ce.copy(Se)},this.getViewport=function(Ce){return Ce.copy(nn)},this.setViewport=function(Ce,ot,Dt,Ke){Ce.isVector4?nn.set(Ce.x,Ce.y,Ce.z,Ce.w):nn.set(Ce,ot,Dt,Ke),Jt.viewport(Se.copy(nn).multiplyScalar(Pt).floor())},this.getScissor=function(Ce){return Ce.copy(at)},this.setScissor=function(Ce,ot,Dt,Ke){Ce.isVector4?at.set(Ce.x,Ce.y,Ce.z,Ce.w):at.set(Ce,ot,Dt,Ke),Jt.scissor(bt.copy(at).multiplyScalar(Pt).floor())},this.getScissorTest=function(){return Nt},this.setScissorTest=function(Ce){Jt.setScissorTest(Nt=Ce)},this.setOpaqueSort=function(Ce){Bt=Ce},this.setTransparentSort=function(Ce){en=Ce},this.getClearColor=function(Ce){return Ce.copy(Mt.getClearColor())},this.setClearColor=function(){Mt.setClearColor.apply(Mt,arguments)},this.getClearAlpha=function(){return Mt.getClearAlpha()},this.setClearAlpha=function(){Mt.setClearAlpha.apply(Mt,arguments)},this.clear=function(Ce=!0,ot=!0,Dt=!0){let Ke=0;if(Ce){let St=!1;if(null!==De){const Yn=De.texture.format;St=1033===Yn||1031===Yn||1029===Yn}if(St){const Yn=De.texture.type,Ri=Yn===Ie||Yn===Ve||1012===Yn||Yn===jt||1017===Yn||1018===Yn,Ni=Mt.getClearColor(),Bi=Mt.getClearAlpha(),sr=Ni.r,Li=Ni.g,Zi=Ni.b;Ri?(R[0]=sr,R[1]=Li,R[2]=Zi,R[3]=Bi,ze.clearBufferuiv(ze.COLOR,0,R)):(U[0]=sr,U[1]=Li,U[2]=Zi,U[3]=Bi,ze.clearBufferiv(ze.COLOR,0,U))}else Ke|=ze.COLOR_BUFFER_BIT}ot&&(Ke|=ze.DEPTH_BUFFER_BIT),Dt&&(Ke|=ze.STENCIL_BUFFER_BIT),ze.clear(Ke)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ln,!1),t.removeEventListener("webglcontextrestored",_t,!1),t.removeEventListener("webglcontextcreationerror",An,!1),dn.dispose(),vn.dispose(),Kn.dispose(),ji.dispose(),hr.dispose(),pe.dispose(),li.dispose(),nr.dispose(),ft.dispose(),Xe.dispose(),Xe.removeEventListener("sessionstart",os),Xe.removeEventListener("sessionend",sl),_i&&(_i.dispose(),_i=null),la.stop()},this.renderBufferDirect=function(Ce,ot,Dt,Ke,St,Yn){null===ot&&(ot=fs);const Ri=St.isMesh&&St.matrixWorld.determinant()<0,Ni=function r_(Ce,ot,Dt,Ke,St){!0!==ot.isScene&&(ot=fs),ei.resetTextureUnits();const Yn=ot.fog,Ni=null===De?X.outputColorSpace:!0===De.isXRRenderTarget?De.texture.colorSpace:Us,Bi=(Ke.isMeshStandardMaterial?hr:ji).get(Ke.envMap||(Ke.isMeshStandardMaterial?ot.environment:null)),sr=!0===Ke.vertexColors&&!!Dt.attributes.color&&4===Dt.attributes.color.itemSize,Li=!!Dt.attributes.tangent&&(!!Ke.normalMap||Ke.anisotropy>0),Zi=!!Dt.morphAttributes.position,vs=!!Dt.morphAttributes.normal,_s=!!Dt.morphAttributes.color;let Na=0;Ke.toneMapped&&(null===De||!0===De.isXRRenderTarget)&&(Na=X.toneMapping);const Jl=Dt.morphAttributes.position||Dt.morphAttributes.normal||Dt.morphAttributes.color,Ys=void 0!==Jl?Jl.length:0,or=Kn.get(Ke),Dp=z.state.lights;!0!==Un||!0!==$n&&Ce===le||di.setState(Ke,Ce,Ce===le&&Ke.id===We);let qs=!1;Ke.version===or.__version?(or.needsLights&&or.lightsStateVersion!==Dp.state.version||or.outputColorSpace!==Ni||St.isInstancedMesh&&!1===or.instancing||!St.isInstancedMesh&&!0===or.instancing||St.isSkinnedMesh&&!1===or.skinning||!St.isSkinnedMesh&&!0===or.skinning||St.isInstancedMesh&&!0===or.instancingColor&&null===St.instanceColor||St.isInstancedMesh&&!1===or.instancingColor&&null!==St.instanceColor||or.envMap!==Bi||!0===Ke.fog&&or.fog!==Yn||void 0!==or.numClippingPlanes&&(or.numClippingPlanes!==di.numPlanes||or.numIntersection!==di.numIntersection)||or.vertexAlphas!==sr||or.vertexTangents!==Li||or.morphTargets!==Zi||or.morphNormals!==vs||or.morphColors!==_s||or.toneMapping!==Na||!0===yn.isWebGL2&&or.morphTargetsCount!==Ys)&&(qs=!0):(qs=!0,or.__version=Ke.version);let au=or.currentProgram;!0===qs&&(au=Ch(Ke,ot,St));let oy=!1,Dh=!1,Rp=!1;const so=au.getUniforms(),Ec=or.uniforms;if(Jt.useProgram(au.program)&&(oy=!0,Dh=!0,Rp=!0),Ke.id!==We&&(We=Ke.id,Dh=!0),oy||le!==Ce){if(so.setValue(ze,"projectionMatrix",Ce.projectionMatrix),yn.logarithmicDepthBuffer&&so.setValue(ze,"logDepthBufFC",2/(Math.log(Ce.far+1)/Math.LN2)),le!==Ce&&(le=Ce,Dh=!0,Rp=!0),Ke.isShaderMaterial||Ke.isMeshPhongMaterial||Ke.isMeshToonMaterial||Ke.isMeshStandardMaterial||Ke.envMap){const pa=so.map.cameraPosition;void 0!==pa&&pa.setValue(ze,Rr.setFromMatrixPosition(Ce.matrixWorld))}(Ke.isMeshPhongMaterial||Ke.isMeshToonMaterial||Ke.isMeshLambertMaterial||Ke.isMeshBasicMaterial||Ke.isMeshStandardMaterial||Ke.isShaderMaterial)&&so.setValue(ze,"isOrthographic",!0===Ce.isOrthographicCamera),(Ke.isMeshPhongMaterial||Ke.isMeshToonMaterial||Ke.isMeshLambertMaterial||Ke.isMeshBasicMaterial||Ke.isMeshStandardMaterial||Ke.isShaderMaterial||Ke.isShadowMaterial||St.isSkinnedMesh)&&so.setValue(ze,"viewMatrix",Ce.matrixWorldInverse)}if(St.isSkinnedMesh){so.setOptional(ze,St,"bindMatrix"),so.setOptional(ze,St,"bindMatrixInverse");const pa=St.skeleton;pa&&(yn.floatVertexTextures?(null===pa.boneTexture&&pa.computeBoneTexture(),so.setValue(ze,"boneTexture",pa.boneTexture,ei),so.setValue(ze,"boneTextureSize",pa.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Ld=Dt.morphAttributes;if((void 0!==Ld.position||void 0!==Ld.normal||void 0!==Ld.color&&!0===yn.isWebGL2)&&Ci.update(St,Dt,au),(Dh||or.receiveShadow!==St.receiveShadow)&&(or.receiveShadow=St.receiveShadow,so.setValue(ze,"receiveShadow",St.receiveShadow)),Ke.isMeshGouraudMaterial&&null!==Ke.envMap&&(Ec.envMap.value=Bi,Ec.flipEnvMap.value=Bi.isCubeTexture&&!1===Bi.isRenderTargetTexture?-1:1),Dh&&(so.setValue(ze,"toneMappingExposure",X.toneMappingExposure),or.needsLights&&function Cp(Ce,ot){Ce.ambientLightColor.needsUpdate=ot,Ce.lightProbe.needsUpdate=ot,Ce.directionalLights.needsUpdate=ot,Ce.directionalLightShadows.needsUpdate=ot,Ce.pointLights.needsUpdate=ot,Ce.pointLightShadows.needsUpdate=ot,Ce.spotLights.needsUpdate=ot,Ce.spotLightShadows.needsUpdate=ot,Ce.rectAreaLights.needsUpdate=ot,Ce.hemisphereLights.needsUpdate=ot}(Ec,Rp),Yn&&!0===Ke.fog&&pn.refreshFogUniforms(Ec,Yn),pn.refreshMaterialUniforms(Ec,Ke,Pt,Zt,_i),Zh.upload(ze,or.uniformsList,Ec,ei)),Ke.isShaderMaterial&&!0===Ke.uniformsNeedUpdate&&(Zh.upload(ze,or.uniformsList,Ec,ei),Ke.uniformsNeedUpdate=!1),Ke.isSpriteMaterial&&so.setValue(ze,"center",St.center),so.setValue(ze,"modelViewMatrix",St.modelViewMatrix),so.setValue(ze,"normalMatrix",St.normalMatrix),so.setValue(ze,"modelMatrix",St.matrixWorld),Ke.isShaderMaterial||Ke.isRawShaderMaterial){const pa=Ke.uniformsGroups;for(let Od=0,ay=pa.length;Od<ay;Od++)if(yn.isWebGL2){const Ip=pa[Od];nr.update(Ip,au),nr.bind(Ip,au)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return au}(Ce,ot,Dt,Ke,St);Jt.setMaterial(Ke,Ri);let Bi=Dt.index,sr=1;if(!0===Ke.wireframe){if(Bi=Re.getWireframeAttribute(Dt),void 0===Bi)return;sr=2}const Li=Dt.drawRange,Zi=Dt.attributes.position;let vs=Li.start*sr,_s=(Li.start+Li.count)*sr;null!==Yn&&(vs=Math.max(vs,Yn.start*sr),_s=Math.min(_s,(Yn.start+Yn.count)*sr)),null!==Bi?(vs=Math.max(vs,0),_s=Math.min(_s,Bi.count)):null!=Zi&&(vs=Math.max(vs,0),_s=Math.min(_s,Zi.count));const Na=_s-vs;if(Na<0||Na===1/0)return;li.setup(St,Ke,Ni,Dt,Bi);let Jl,Ys=yi;if(null!==Bi&&(Jl=As.get(Bi),Ys=wi,Ys.setIndex(Jl)),St.isMesh)!0===Ke.wireframe?(Jt.setLineWidth(Ke.wireframeLinewidth*Ii()),Ys.setMode(ze.LINES)):Ys.setMode(ze.TRIANGLES);else if(St.isLine){let or=Ke.linewidth;void 0===or&&(or=1),Jt.setLineWidth(or*Ii()),Ys.setMode(St.isLineSegments?ze.LINES:St.isLineLoop?ze.LINE_LOOP:ze.LINE_STRIP)}else St.isPoints?Ys.setMode(ze.POINTS):St.isSprite&&Ys.setMode(ze.TRIANGLES);if(St.isInstancedMesh)Ys.renderInstances(vs,Na,St.count);else if(Dt.isInstancedBufferGeometry){const Dp=Math.min(Dt.instanceCount,void 0!==Dt._maxInstanceCount?Dt._maxInstanceCount:1/0);Ys.renderInstances(vs,Na,Dp)}else Ys.render(vs,Na)},this.compile=function(Ce,ot){function Dt(Ke,St,Yn){!0===Ke.transparent&&Ke.side===bn&&!1===Ke.forceSinglePass?(Ke.side=fe,Ke.needsUpdate=!0,Ch(Ke,St,Yn),Ke.side=ri,Ke.needsUpdate=!0,Ch(Ke,St,Yn),Ke.side=bn):Ch(Ke,St,Yn)}z=vn.get(Ce),z.init(),te.push(z),Ce.traverseVisible(function(Ke){Ke.isLight&&Ke.layers.test(ot.layers)&&(z.pushLight(Ke),Ke.castShadow&&z.pushShadow(Ke))}),z.setupLights(X._useLegacyLights),Ce.traverse(function(Ke){const St=Ke.material;if(St)if(Array.isArray(St))for(let Yn=0;Yn<St.length;Yn++)Dt(St[Yn],Ce,Ke);else Dt(St,Ce,Ke)}),te.pop(),z=null};let Xs=null;function os(){la.stop()}function sl(){la.start()}const la=new qa;function Id(Ce,ot,Dt,Ke){if(!1===Ce.visible)return;if(Ce.layers.test(ot.layers))if(Ce.isGroup)Dt=Ce.renderOrder;else if(Ce.isLOD)!0===Ce.autoUpdate&&Ce.update(ot);else if(Ce.isLight)z.pushLight(Ce),Ce.castShadow&&z.pushShadow(Ce);else if(Ce.isSprite){if(!Ce.frustumCulled||Nn.intersectsSprite(Ce)){Ke&&Rr.setFromMatrixPosition(Ce.matrixWorld).applyMatrix4(mi);const Ri=pe.update(Ce),Ni=Ce.material;Ni.visible&&$.push(Ce,Ri,Ni,Dt,Rr.z,null)}}else if((Ce.isMesh||Ce.isLine||Ce.isPoints)&&(!Ce.frustumCulled||Nn.intersectsObject(Ce))){const Ri=pe.update(Ce),Ni=Ce.material;if(Ke&&(void 0!==Ce.boundingSphere?(null===Ce.boundingSphere&&Ce.computeBoundingSphere(),Rr.copy(Ce.boundingSphere.center)):(null===Ri.boundingSphere&&Ri.computeBoundingSphere(),Rr.copy(Ri.boundingSphere.center)),Rr.applyMatrix4(Ce.matrixWorld).applyMatrix4(mi)),Array.isArray(Ni)){const Bi=Ri.groups;for(let sr=0,Li=Bi.length;sr<Li;sr++){const Zi=Bi[sr],vs=Ni[Zi.materialIndex];vs&&vs.visible&&$.push(Ce,Ri,vs,Dt,Rr.z,Zi)}}else Ni.visible&&$.push(Ce,Ri,Ni,Dt,Rr.z,null)}const Yn=Ce.children;for(let Ri=0,Ni=Yn.length;Ri<Ni;Ri++)Id(Yn[Ri],ot,Dt,Ke)}function Ah(Ce,ot,Dt,Ke){const St=Ce.opaque,Yn=Ce.transmissive,Ri=Ce.transparent;z.setupLightsView(Dt),!0===Un&&di.setGlobalState(X.clippingPlanes,Dt),Yn.length>0&&function Th(Ce,ot,Dt,Ke){const St=yn.isWebGL2;null===_i&&(_i=new Ta(1,1,{generateMipmaps:!0,type:Vt.has("EXT_color_buffer_half_float")?kt:Ie,minFilter:ue,samples:St?4:0})),X.getDrawingBufferSize(bi),St?_i.setSize(bi.x,bi.y):_i.setSize(P(bi.x),P(bi.y));const Yn=X.getRenderTarget();X.setRenderTarget(_i),X.getClearColor(ct),dt=X.getClearAlpha(),dt<1&&X.setClearColor(16777215,.5),X.clear();const Ri=X.toneMapping;X.toneMapping=0,Pd(Ce,Dt,Ke),ei.updateMultisampleRenderTarget(_i),ei.updateRenderTargetMipmap(_i);let Ni=!1;for(let Bi=0,sr=ot.length;Bi<sr;Bi++){const Li=ot[Bi],Zi=Li.object,vs=Li.geometry,_s=Li.material,Na=Li.group;if(_s.side===bn&&Zi.layers.test(Ke.layers)){const Jl=_s.side;_s.side=fe,_s.needsUpdate=!0,Tp(Zi,Dt,Ke,vs,_s,Na),_s.side=Jl,_s.needsUpdate=!0,Ni=!0}}!0===Ni&&(ei.updateMultisampleRenderTarget(_i),ei.updateRenderTargetMipmap(_i)),X.setRenderTarget(Yn),X.setClearColor(ct,dt),X.toneMapping=Ri}(St,Yn,ot,Dt),Ke&&Jt.viewport(Se.copy(Ke)),St.length>0&&Pd(St,ot,Dt),Yn.length>0&&Pd(Yn,ot,Dt),Ri.length>0&&Pd(Ri,ot,Dt),Jt.buffers.depth.setTest(!0),Jt.buffers.depth.setMask(!0),Jt.buffers.color.setMask(!0),Jt.setPolygonOffset(!1)}function Pd(Ce,ot,Dt){const Ke=!0===ot.isScene?ot.overrideMaterial:null;for(let St=0,Yn=Ce.length;St<Yn;St++){const Ri=Ce[St],Ni=Ri.object,Bi=Ri.geometry,sr=null===Ke?Ri.material:Ke,Li=Ri.group;Ni.layers.test(Dt.layers)&&Tp(Ni,ot,Dt,Bi,sr,Li)}}function Tp(Ce,ot,Dt,Ke,St,Yn){Ce.onBeforeRender(X,ot,Dt,Ke,St,Yn),Ce.modelViewMatrix.multiplyMatrices(Dt.matrixWorldInverse,Ce.matrixWorld),Ce.normalMatrix.getNormalMatrix(Ce.modelViewMatrix),St.onBeforeRender(X,ot,Dt,Ke,Ce,Yn),!0===St.transparent&&St.side===bn&&!1===St.forceSinglePass?(St.side=fe,St.needsUpdate=!0,X.renderBufferDirect(Dt,ot,Ke,St,Ce,Yn),St.side=ri,St.needsUpdate=!0,X.renderBufferDirect(Dt,ot,Ke,St,Ce,Yn),St.side=bn):X.renderBufferDirect(Dt,ot,Ke,St,Ce,Yn),Ce.onAfterRender(X,ot,Dt,Ke,St,Yn)}function Ch(Ce,ot,Dt){!0!==ot.isScene&&(ot=fs);const Ke=Kn.get(Ce),St=z.state.lights,Ri=St.state.version,Ni=ft.getParameters(Ce,St.state,z.state.shadowsArray,ot,Dt),Bi=ft.getProgramCacheKey(Ni);let sr=Ke.programs;Ke.environment=Ce.isMeshStandardMaterial?ot.environment:null,Ke.fog=ot.fog,Ke.envMap=(Ce.isMeshStandardMaterial?hr:ji).get(Ce.envMap||Ke.environment),void 0===sr&&(Ce.addEventListener("dispose",Wn),sr=new Map,Ke.programs=sr);let Li=sr.get(Bi);if(void 0!==Li){if(Ke.currentProgram===Li&&Ke.lightsStateVersion===Ri)return sy(Ce,Ni),Li}else Ni.uniforms=ft.getUniforms(Ce),Ce.onBuild(Dt,Ni,X),Ce.onBeforeCompile(Ni,X),Li=ft.acquireProgram(Ni,Bi),sr.set(Bi,Li),Ke.uniforms=Ni.uniforms;const Zi=Ke.uniforms;(!Ce.isShaderMaterial&&!Ce.isRawShaderMaterial||!0===Ce.clipping)&&(Zi.clippingPlanes=di.uniform),sy(Ce,Ni),Ke.needsLights=function s_(Ce){return Ce.isMeshLambertMaterial||Ce.isMeshToonMaterial||Ce.isMeshPhongMaterial||Ce.isMeshStandardMaterial||Ce.isShadowMaterial||Ce.isShaderMaterial&&!0===Ce.lights}(Ce),Ke.lightsStateVersion=Ri,Ke.needsLights&&(Zi.ambientLightColor.value=St.state.ambient,Zi.lightProbe.value=St.state.probe,Zi.directionalLights.value=St.state.directional,Zi.directionalLightShadows.value=St.state.directionalShadow,Zi.spotLights.value=St.state.spot,Zi.spotLightShadows.value=St.state.spotShadow,Zi.rectAreaLights.value=St.state.rectArea,Zi.ltc_1.value=St.state.rectAreaLTC1,Zi.ltc_2.value=St.state.rectAreaLTC2,Zi.pointLights.value=St.state.point,Zi.pointLightShadows.value=St.state.pointShadow,Zi.hemisphereLights.value=St.state.hemi,Zi.directionalShadowMap.value=St.state.directionalShadowMap,Zi.directionalShadowMatrix.value=St.state.directionalShadowMatrix,Zi.spotShadowMap.value=St.state.spotShadowMap,Zi.spotLightMatrix.value=St.state.spotLightMatrix,Zi.spotLightMap.value=St.state.spotLightMap,Zi.pointShadowMap.value=St.state.pointShadowMap,Zi.pointShadowMatrix.value=St.state.pointShadowMatrix);const vs=Li.getUniforms(),_s=Zh.seqWithValue(vs.seq,Zi);return Ke.currentProgram=Li,Ke.uniformsList=_s,Li}function sy(Ce,ot){const Dt=Kn.get(Ce);Dt.outputColorSpace=ot.outputColorSpace,Dt.instancing=ot.instancing,Dt.instancingColor=ot.instancingColor,Dt.skinning=ot.skinning,Dt.morphTargets=ot.morphTargets,Dt.morphNormals=ot.morphNormals,Dt.morphColors=ot.morphColors,Dt.morphTargetsCount=ot.morphTargetsCount,Dt.numClippingPlanes=ot.numClippingPlanes,Dt.numIntersection=ot.numClipIntersection,Dt.vertexAlphas=ot.vertexAlphas,Dt.vertexTangents=ot.vertexTangents,Dt.toneMapping=ot.toneMapping}la.setAnimationLoop(function wc(Ce){Xs&&Xs(Ce)}),"undefined"!=typeof self&&la.setContext(self),this.setAnimationLoop=function(Ce){Xs=Ce,Xe.setAnimationLoop(Ce),null===Ce?la.stop():la.start()},Xe.addEventListener("sessionstart",os),Xe.addEventListener("sessionend",sl),this.render=function(Ce,ot){if(void 0===ot||!0===ot.isCamera){if(!0!==ae){if(!0===Ce.matrixWorldAutoUpdate&&Ce.updateMatrixWorld(),null===ot.parent&&!0===ot.matrixWorldAutoUpdate&&ot.updateMatrixWorld(),!0===Xe.enabled&&!0===Xe.isPresenting&&(!0===Xe.cameraAutoUpdate&&Xe.updateCamera(ot),ot=Xe.getCamera()),!0===Ce.isScene&&Ce.onBeforeRender(X,Ce,ot,De),z=vn.get(Ce,te.length),z.init(),te.push(z),mi.multiplyMatrices(ot.projectionMatrix,ot.matrixWorldInverse),Nn.setFromProjectionMatrix(mi),$n=this.localClippingEnabled,Un=di.init(this.clippingPlanes,$n),$=dn.get(Ce,L.length),$.init(),L.push($),Id(Ce,ot,0,X.sortObjects),$.finish(),!0===X.sortObjects&&$.sort(Bt,en),this.info.render.frame++,!0===Un&&di.beginShadows(),xn.render(z.state.shadowsArray,Ce,ot),!0===Un&&di.endShadows(),!0===this.info.autoReset&&this.info.reset(),Mt.render($,Ce),z.setupLights(X._useLegacyLights),ot.isArrayCamera){const Ke=ot.cameras;for(let St=0,Yn=Ke.length;St<Yn;St++){const Ri=Ke[St];Ah($,Ce,Ri,Ri.viewport)}}else Ah($,Ce,ot);null!==De&&(ei.updateMultisampleRenderTarget(De),ei.updateRenderTargetMipmap(De)),!0===Ce.isScene&&Ce.onAfterRender(X,Ce,ot),li.resetDefaultState(),We=-1,le=null,te.pop(),z=te.length>0?te[te.length-1]:null,L.pop(),$=L.length>0?L[L.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return ve},this.getActiveMipmapLevel=function(){return Te},this.getRenderTarget=function(){return De},this.setRenderTargetTextures=function(Ce,ot,Dt){Kn.get(Ce.texture).__webglTexture=ot,Kn.get(Ce.depthTexture).__webglTexture=Dt;const Ke=Kn.get(Ce);Ke.__hasExternalTextures=!0,Ke.__hasExternalTextures&&(Ke.__autoAllocateDepthBuffer=void 0===Dt,Ke.__autoAllocateDepthBuffer||!0===Vt.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ke.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ce,ot){const Dt=Kn.get(Ce);Dt.__webglFramebuffer=ot,Dt.__useDefaultFramebuffer=void 0===ot},this.setRenderTarget=function(Ce,ot=0,Dt=0){De=Ce,ve=ot,Te=Dt;let Ke=!0,St=null,Yn=!1,Ri=!1;if(Ce){const Bi=Kn.get(Ce);void 0!==Bi.__useDefaultFramebuffer?(Jt.bindFramebuffer(ze.FRAMEBUFFER,null),Ke=!1):void 0===Bi.__webglFramebuffer?ei.setupRenderTarget(Ce):Bi.__hasExternalTextures&&ei.rebindTextures(Ce,Kn.get(Ce.texture).__webglTexture,Kn.get(Ce.depthTexture).__webglTexture);const sr=Ce.texture;(sr.isData3DTexture||sr.isDataArrayTexture||sr.isCompressedArrayTexture)&&(Ri=!0);const Li=Kn.get(Ce).__webglFramebuffer;Ce.isWebGLCubeRenderTarget?(St=Array.isArray(Li[ot])?Li[ot][Dt]:Li[ot],Yn=!0):St=yn.isWebGL2&&Ce.samples>0&&!1===ei.useMultisampledRTT(Ce)?Kn.get(Ce).__webglMultisampledFramebuffer:Array.isArray(Li)?Li[Dt]:Li,Se.copy(Ce.viewport),bt.copy(Ce.scissor),qt=Ce.scissorTest}else Se.copy(nn).multiplyScalar(Pt).floor(),bt.copy(at).multiplyScalar(Pt).floor(),qt=Nt;if(Jt.bindFramebuffer(ze.FRAMEBUFFER,St)&&yn.drawBuffers&&Ke&&Jt.drawBuffers(Ce,St),Jt.viewport(Se),Jt.scissor(bt),Jt.setScissorTest(qt),Yn){const Bi=Kn.get(Ce.texture);ze.framebufferTexture2D(ze.FRAMEBUFFER,ze.COLOR_ATTACHMENT0,ze.TEXTURE_CUBE_MAP_POSITIVE_X+ot,Bi.__webglTexture,Dt)}else if(Ri){const Bi=Kn.get(Ce.texture);ze.framebufferTextureLayer(ze.FRAMEBUFFER,ze.COLOR_ATTACHMENT0,Bi.__webglTexture,Dt||0,ot||0)}We=-1},this.readRenderTargetPixels=function(Ce,ot,Dt,Ke,St,Yn,Ri){if(!Ce||!Ce.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ni=Kn.get(Ce).__webglFramebuffer;if(Ce.isWebGLCubeRenderTarget&&void 0!==Ri&&(Ni=Ni[Ri]),Ni){Jt.bindFramebuffer(ze.FRAMEBUFFER,Ni);try{const Bi=Ce.texture,sr=Bi.format,Li=Bi.type;if(sr!==Oe&&ii.convert(sr)!==ze.getParameter(ze.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Zi=Li===kt&&(Vt.has("EXT_color_buffer_half_float")||yn.isWebGL2&&Vt.has("EXT_color_buffer_float"));if(!(Li===Ie||ii.convert(Li)===ze.getParameter(ze.IMPLEMENTATION_COLOR_READ_TYPE)||Li===st&&(yn.isWebGL2||Vt.has("OES_texture_float")||Vt.has("WEBGL_color_buffer_float"))||Zi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ot>=0&&ot<=Ce.width-Ke&&Dt>=0&&Dt<=Ce.height-St&&ze.readPixels(ot,Dt,Ke,St,ii.convert(sr),ii.convert(Li),Yn)}finally{const Bi=null!==De?Kn.get(De).__webglFramebuffer:null;Jt.bindFramebuffer(ze.FRAMEBUFFER,Bi)}}},this.copyFramebufferToTexture=function(Ce,ot,Dt=0){const Ke=Math.pow(2,-Dt),St=Math.floor(ot.image.width*Ke),Yn=Math.floor(ot.image.height*Ke);ei.setTexture2D(ot,0),ze.copyTexSubImage2D(ze.TEXTURE_2D,Dt,0,0,Ce.x,Ce.y,St,Yn),Jt.unbindTexture()},this.copyTextureToTexture=function(Ce,ot,Dt,Ke=0){const St=ot.image.width,Yn=ot.image.height,Ri=ii.convert(Dt.format),Ni=ii.convert(Dt.type);ei.setTexture2D(Dt,0),ze.pixelStorei(ze.UNPACK_FLIP_Y_WEBGL,Dt.flipY),ze.pixelStorei(ze.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Dt.premultiplyAlpha),ze.pixelStorei(ze.UNPACK_ALIGNMENT,Dt.unpackAlignment),ot.isDataTexture?ze.texSubImage2D(ze.TEXTURE_2D,Ke,Ce.x,Ce.y,St,Yn,Ri,Ni,ot.image.data):ot.isCompressedTexture?ze.compressedTexSubImage2D(ze.TEXTURE_2D,Ke,Ce.x,Ce.y,ot.mipmaps[0].width,ot.mipmaps[0].height,Ri,ot.mipmaps[0].data):ze.texSubImage2D(ze.TEXTURE_2D,Ke,Ce.x,Ce.y,Ri,Ni,ot.image),0===Ke&&Dt.generateMipmaps&&ze.generateMipmap(ze.TEXTURE_2D),Jt.unbindTexture()},this.copyTextureToTexture3D=function(Ce,ot,Dt,Ke,St=0){if(X.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Yn=Ce.max.x-Ce.min.x+1,Ri=Ce.max.y-Ce.min.y+1,Ni=Ce.max.z-Ce.min.z+1,Bi=ii.convert(Ke.format),sr=ii.convert(Ke.type);let Li;if(Ke.isData3DTexture)ei.setTexture3D(Ke,0),Li=ze.TEXTURE_3D;else{if(!Ke.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ei.setTexture2DArray(Ke,0),Li=ze.TEXTURE_2D_ARRAY}ze.pixelStorei(ze.UNPACK_FLIP_Y_WEBGL,Ke.flipY),ze.pixelStorei(ze.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ke.premultiplyAlpha),ze.pixelStorei(ze.UNPACK_ALIGNMENT,Ke.unpackAlignment);const Zi=ze.getParameter(ze.UNPACK_ROW_LENGTH),vs=ze.getParameter(ze.UNPACK_IMAGE_HEIGHT),_s=ze.getParameter(ze.UNPACK_SKIP_PIXELS),Na=ze.getParameter(ze.UNPACK_SKIP_ROWS),Jl=ze.getParameter(ze.UNPACK_SKIP_IMAGES),Ys=Dt.isCompressedTexture?Dt.mipmaps[0]:Dt.image;ze.pixelStorei(ze.UNPACK_ROW_LENGTH,Ys.width),ze.pixelStorei(ze.UNPACK_IMAGE_HEIGHT,Ys.height),ze.pixelStorei(ze.UNPACK_SKIP_PIXELS,Ce.min.x),ze.pixelStorei(ze.UNPACK_SKIP_ROWS,Ce.min.y),ze.pixelStorei(ze.UNPACK_SKIP_IMAGES,Ce.min.z),Dt.isDataTexture||Dt.isData3DTexture?ze.texSubImage3D(Li,St,ot.x,ot.y,ot.z,Yn,Ri,Ni,Bi,sr,Ys.data):Dt.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ze.compressedTexSubImage3D(Li,St,ot.x,ot.y,ot.z,Yn,Ri,Ni,Bi,Ys.data)):ze.texSubImage3D(Li,St,ot.x,ot.y,ot.z,Yn,Ri,Ni,Bi,sr,Ys),ze.pixelStorei(ze.UNPACK_ROW_LENGTH,Zi),ze.pixelStorei(ze.UNPACK_IMAGE_HEIGHT,vs),ze.pixelStorei(ze.UNPACK_SKIP_PIXELS,_s),ze.pixelStorei(ze.UNPACK_SKIP_ROWS,Na),ze.pixelStorei(ze.UNPACK_SKIP_IMAGES,Jl),0===St&&Ke.generateMipmaps&&ze.generateMipmap(Li),Jt.unbindTexture()},this.initTexture=function(Ce){Ce.isCubeTexture?ei.setTextureCube(Ce,0):Ce.isData3DTexture?ei.setTexture3D(Ce,0):Ce.isDataArrayTexture||Ce.isCompressedArrayTexture?ei.setTexture2DArray(Ce,0):ei.setTexture2D(Ce,0),Jt.unbindTexture()},this.resetState=function(){ve=0,Te=0,De=null,Jt.reset(),li.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return rr}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Ai?ks:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ks?Ai:Us}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class Zv extends Jh{}).prototype.isWebGL1Renderer=!0;class Qh extends ws{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class If{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=H,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=kr()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let o=0,l=this.stride;o<l;o++)this.array[e+o]=t.array[r+o];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Oo=new Me;class jl{constructor(e,t,r,o=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=o}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)Oo.fromBufferAttribute(this,t),Oo.applyMatrix4(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Oo.fromBufferAttribute(this,t),Oo.applyNormalMatrix(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Oo.fromBufferAttribute(this,t),Oo.transformDirection(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}setX(e,t){return this.normalized&&(t=Ct(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ct(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ct(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ct(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=it(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=it(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=it(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=it(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ct(t,this.array),r=Ct(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ct(t,this.array),r=Ct(r,this.array),o=Ct(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=o,this}setXYZW(e,t,r,o,l){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ct(t,this.array),r=Ct(r,this.array),o=Ct(o,this.array),l=Ct(l,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=o,this.data.array[e+3]=l,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const o=r*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)t.push(this.data.array[o+l])}return new de(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new jl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const o=r*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)t.push(this.data.array[o+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ed extends yo{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new gn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Du=new Me,og=new tr,nd=new tr,ag=new Me,Nf=new Fi,Gc=new Me,kf=new Wo,id=new Fi,Uf=new ha;class lg extends _o{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Fi,this.bindMatrixInverse=new Fi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new fo),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)Gc.fromBufferAttribute(t,r),this.applyBoneTransform(r,Gc),this.boundingBox.expandByPoint(Gc)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Wo),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)Gc.fromBufferAttribute(t,r),this.applyBoneTransform(r,Gc),this.boundingSphere.expandByPoint(Gc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const o=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),kf.copy(this.boundingSphere),kf.applyMatrix4(o),!1!==e.ray.intersectsSphere(kf)&&(id.copy(o).invert(),Uf.copy(e.ray).applyMatrix4(id),(null===this.boundingBox||!1!==Uf.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,Uf)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new tr,t=this.geometry.attributes.skinWeight;for(let r=0,o=t.count;r<o;r++){e.fromBufferAttribute(t,r);const l=1/e.manhattanLength();l!==1/0?e.multiplyScalar(l):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,o=this.geometry;og.fromBufferAttribute(o.attributes.skinIndex,e),nd.fromBufferAttribute(o.attributes.skinWeight,e),Du.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let l=0;l<4;l++){const f=nd.getComponent(l);if(0!==f){const p=og.getComponent(l);Nf.multiplyMatrices(r.bones[p].matrixWorld,r.boneInverses[p]),t.addScaledVector(ag.copy(Du).applyMatrix4(Nf),f)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class rd extends ws{constructor(){super(),this.isBone=!0,this.type="Bone"}}class wl extends ua{constructor(e=null,t=1,r=1,o,l,f,p,y,_=Lt,w=Lt,T,C){super(null,f,p,y,_,w,o,l,T,C),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Bf=new Fi,Jv=new Fi;class sd{constructor(e=[],t=[]){this.uuid=kr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new Fi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new Fi;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,o=this.boneTexture;for(let l=0,f=e.length;l<f;l++)Bf.multiplyMatrices(e[l]?e[l].matrixWorld:Jv,t[l]),Bf.toArray(r,16*l);null!==o&&(o.needsUpdate=!0)}clone(){return new sd(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=k(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new wl(t,e,e,Oe,st);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const o=this.bones[t];if(o.name===e)return o}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,o=e.bones.length;r<o;r++){const l=e.bones[r];let f=t[l];void 0===f&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),f=new rd),this.bones.push(f),this.boneInverses.push((new Fi).fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let o=0,l=t.length;o<l;o++)e.bones.push(t[o].uuid),e.boneInverses.push(r[o].toArray());return e}}class El extends de{constructor(e,t,r,o=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=o}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ru=new Fi,cg=new Fi,od=[],ug=new fo,Sl=new Fi,Wc=new _o,Iu=new Wo;class Vf extends _o{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new El(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let o=0;o<r;o++)this.setMatrixAt(o,Sl)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new fo),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Ru),ug.copy(e.boundingBox).applyMatrix4(Ru),this.boundingBox.union(ug)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Wo),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Ru),Iu.copy(e.boundingSphere).applyMatrix4(Ru),this.boundingSphere.union(Iu)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const r=this.matrixWorld,o=this.count;if(Wc.geometry=this.geometry,Wc.material=this.material,void 0!==Wc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Iu.copy(this.boundingSphere),Iu.applyMatrix4(r),!1!==e.ray.intersectsSphere(Iu)))for(let l=0;l<o;l++){this.getMatrixAt(l,Ru),cg.multiplyMatrices(r,Ru),Wc.matrixWorld=cg,Wc.raycast(e,od);for(let f=0,p=od.length;f<p;f++){const y=od[f];y.instanceId=l,y.object=this,t.push(y)}od.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new El(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class aa extends yo{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new gn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const zf=new Me,hg=new Me,dg=new Fi,Hf=new ha,ad=new Wo;class fc extends ws{constructor(e=new hi,t=new aa){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[0];for(let o=1,l=t.count;o<l;o++)zf.fromBufferAttribute(t,o-1),hg.fromBufferAttribute(t,o),r[o]=r[o-1],r[o]+=zf.distanceTo(hg);e.setAttribute("lineDistance",new vt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,o=this.matrixWorld,l=e.params.Line.threshold,f=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),ad.copy(r.boundingSphere),ad.applyMatrix4(o),ad.radius+=l,!1===e.ray.intersectsSphere(ad))return;dg.copy(o).invert(),Hf.copy(e.ray).applyMatrix4(dg);const p=l/((this.scale.x+this.scale.y+this.scale.z)/3),y=p*p,_=new Me,w=new Me,T=new Me,C=new Me,R=this.isLineSegments?2:1,U=r.index,z=r.attributes.position;if(null!==U)for(let X=Math.max(0,f.start),ae=Math.min(U.count,f.start+f.count)-1;X<ae;X+=R){const ve=U.getX(X),Te=U.getX(X+1);if(_.fromBufferAttribute(z,ve),w.fromBufferAttribute(z,Te),Hf.distanceSqToSegment(_,w,C,T)>y)continue;C.applyMatrix4(this.matrixWorld);const We=e.ray.origin.distanceTo(C);We<e.near||We>e.far||t.push({distance:We,point:T.clone().applyMatrix4(this.matrixWorld),index:X,face:null,faceIndex:null,object:this})}else for(let X=Math.max(0,f.start),ae=Math.min(z.count,f.start+f.count)-1;X<ae;X+=R){if(_.fromBufferAttribute(z,X),w.fromBufferAttribute(z,X+1),Hf.distanceSqToSegment(_,w,C,T)>y)continue;C.applyMatrix4(this.matrixWorld);const Te=e.ray.origin.distanceTo(C);Te<e.near||Te>e.far||t.push({distance:Te,point:T.clone().applyMatrix4(this.matrixWorld),index:X,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const o=t[r[0]];if(void 0!==o){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=o.length;l<f;l++){const p=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=l}}}}}const Qv=new Me,Gf=new Me;class ld extends fc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[];for(let o=0,l=t.count;o<l;o+=2)Qv.fromBufferAttribute(t,o),Gf.fromBufferAttribute(t,o+1),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+Qv.distanceTo(Gf);e.setAttribute("lineDistance",new vt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class fg extends fc{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class pg extends yo{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new gn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const e0=new Fi,sh=new ha,cd=new Wo,oh=new Me;class Wf extends ws{constructor(e=new hi,t=new pg){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,o=this.matrixWorld,l=e.params.Points.threshold,f=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),cd.copy(r.boundingSphere),cd.applyMatrix4(o),cd.radius+=l,!1===e.ray.intersectsSphere(cd))return;e0.copy(o).invert(),sh.copy(e.ray).applyMatrix4(e0);const p=l/((this.scale.x+this.scale.y+this.scale.z)/3),y=p*p,_=r.index,T=r.attributes.position;if(null!==_)for(let U=Math.max(0,f.start),$=Math.min(_.count,f.start+f.count);U<$;U++){const z=_.getX(U);oh.fromBufferAttribute(T,z),t0(oh,z,y,o,e,t,this)}else for(let U=Math.max(0,f.start),$=Math.min(T.count,f.start+f.count);U<$;U++)oh.fromBufferAttribute(T,U),t0(oh,U,y,o,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const o=t[r[0]];if(void 0!==o){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,f=o.length;l<f;l++){const p=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=l}}}}}function t0(c,e,t,r,o,l,f){const p=sh.distanceSqToPoint(c);if(p<t){const y=new Me;sh.closestPointToPoint(c,y),y.applyMatrix4(r);const _=o.ray.origin.distanceTo(y);if(_<o.near||_>o.far)return;l.push({distance:_,distanceToRay:Math.sqrt(p),point:y,index:e,face:null,object:f})}}class Qa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,o=this.getPoint(0),l=0;t.push(0);for(let f=1;f<=e;f++)r=this.getPoint(f/e),l+=r.distanceTo(o),t.push(l),o=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let o=0;const l=r.length;let f;f=t||e*r[l-1];let _,p=0,y=l-1;for(;p<=y;)if(o=Math.floor(p+(y-p)/2),_=r[o]-f,_<0)p=o+1;else{if(!(_>0)){y=o;break}y=o-1}if(o=y,r[o]===f)return o/(l-1);const w=r[o];return(o+(f-w)/(r[o+1]-w))/(l-1)}getTangent(e,t){let o=e-1e-4,l=e+1e-4;o<0&&(o=0),l>1&&(l=1);const f=this.getPoint(o),p=this.getPoint(l),y=t||(f.isVector2?new Et:new Me);return y.copy(p).sub(f).normalize(),y}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new Me,o=[],l=[],f=[],p=new Me,y=new Fi;for(let R=0;R<=e;R++)o[R]=this.getTangentAt(R/e,new Me);l[0]=new Me,f[0]=new Me;let _=Number.MAX_VALUE;const w=Math.abs(o[0].x),T=Math.abs(o[0].y),C=Math.abs(o[0].z);w<=_&&(_=w,r.set(1,0,0)),T<=_&&(_=T,r.set(0,1,0)),C<=_&&r.set(0,0,1),p.crossVectors(o[0],r).normalize(),l[0].crossVectors(o[0],p),f[0].crossVectors(o[0],l[0]);for(let R=1;R<=e;R++){if(l[R]=l[R-1].clone(),f[R]=f[R-1].clone(),p.crossVectors(o[R-1],o[R]),p.length()>Number.EPSILON){p.normalize();const U=Math.acos(vr(o[R-1].dot(o[R]),-1,1));l[R].applyMatrix4(y.makeRotationAxis(p,U))}f[R].crossVectors(o[R],l[R])}if(!0===t){let R=Math.acos(vr(l[0].dot(l[e]),-1,1));R/=e,o[0].dot(p.crossVectors(l[0],l[e]))>0&&(R=-R);for(let U=1;U<=e;U++)l[U].applyMatrix4(y.makeRotationAxis(o[U],R*U)),f[U].crossVectors(o[U],l[U])}return{tangents:o,normals:l,binormals:f}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Oa extends hi{constructor(e=[],t=[],r=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:o};const l=[],f=[];function y(te,X,ae,ve){const Te=ve+1,De=[];for(let We=0;We<=Te;We++){De[We]=[];const le=te.clone().lerp(ae,We/Te),Se=X.clone().lerp(ae,We/Te),bt=Te-We;for(let qt=0;qt<=bt;qt++)De[We][qt]=0===qt&&We===Te?le:le.clone().lerp(Se,qt/bt)}for(let We=0;We<Te;We++)for(let le=0;le<2*(Te-We)-1;le++){const Se=Math.floor(le/2);le%2==0?(C(De[We][Se+1]),C(De[We+1][Se]),C(De[We][Se])):(C(De[We][Se+1]),C(De[We+1][Se+1]),C(De[We+1][Se]))}}function C(te){l.push(te.x,te.y,te.z)}function R(te,X){const ae=3*te;X.x=e[ae+0],X.y=e[ae+1],X.z=e[ae+2]}function $(te,X,ae,ve){ve<0&&1===te.x&&(f[X]=te.x-1),0===ae.x&&0===ae.z&&(f[X]=ve/2/Math.PI+.5)}function z(te){return Math.atan2(te.z,-te.x)}function L(te){return Math.atan2(-te.y,Math.sqrt(te.x*te.x+te.z*te.z))}(function p(te){const X=new Me,ae=new Me,ve=new Me;for(let Te=0;Te<t.length;Te+=3)R(t[Te+0],X),R(t[Te+1],ae),R(t[Te+2],ve),y(X,ae,ve,te)})(o),function _(te){const X=new Me;for(let ae=0;ae<l.length;ae+=3)X.x=l[ae+0],X.y=l[ae+1],X.z=l[ae+2],X.normalize().multiplyScalar(te),l[ae+0]=X.x,l[ae+1]=X.y,l[ae+2]=X.z}(r),function w(){const te=new Me;for(let X=0;X<l.length;X+=3){te.x=l[X+0],te.y=l[X+1],te.z=l[X+2];const ae=z(te)/2/Math.PI+.5,ve=L(te)/Math.PI+.5;f.push(ae,1-ve)}(function U(){const te=new Me,X=new Me,ae=new Me,ve=new Me,Te=new Et,De=new Et,We=new Et;for(let le=0,Se=0;le<l.length;le+=9,Se+=6){te.set(l[le+0],l[le+1],l[le+2]),X.set(l[le+3],l[le+4],l[le+5]),ae.set(l[le+6],l[le+7],l[le+8]),Te.set(f[Se+0],f[Se+1]),De.set(f[Se+2],f[Se+3]),We.set(f[Se+4],f[Se+5]),ve.copy(te).add(X).add(ae).divideScalar(3);const bt=z(ve);$(Te,Se+0,te,bt),$(De,Se+2,X,bt),$(We,Se+4,ae,bt)}})(),function T(){for(let te=0;te<f.length;te+=6){const X=f[te+0],ae=f[te+2],ve=f[te+4],Te=Math.max(X,ae,ve),De=Math.min(X,ae,ve);Te>.9&&De<.1&&(X<.2&&(f[te+0]+=1),ae<.2&&(f[te+2]+=1),ve<.2&&(f[te+4]+=1))}}()}(),this.setAttribute("position",new vt(l,3)),this.setAttribute("normal",new vt(l.slice(),3)),this.setAttribute("uv",new vt(f,2)),0===o?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Oa(e.vertices,e.indices,e.radius,e.details)}}const dh=new Me,fh=new Me,pd=new Me,ph=new da;class Xf extends hi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const o=Math.pow(10,4),l=Math.cos(ur*t),f=e.getIndex(),p=e.getAttribute("position"),y=f?f.count:p.count,_=[0,0,0],w=["a","b","c"],T=new Array(3),C={},R=[];for(let U=0;U<y;U+=3){f?(_[0]=f.getX(U),_[1]=f.getX(U+1),_[2]=f.getX(U+2)):(_[0]=U,_[1]=U+1,_[2]=U+2);const{a:$,b:z,c:L}=ph;if($.fromBufferAttribute(p,_[0]),z.fromBufferAttribute(p,_[1]),L.fromBufferAttribute(p,_[2]),ph.getNormal(pd),T[0]=`${Math.round($.x*o)},${Math.round($.y*o)},${Math.round($.z*o)}`,T[1]=`${Math.round(z.x*o)},${Math.round(z.y*o)},${Math.round(z.z*o)}`,T[2]=`${Math.round(L.x*o)},${Math.round(L.y*o)},${Math.round(L.z*o)}`,T[0]!==T[1]&&T[1]!==T[2]&&T[2]!==T[0])for(let te=0;te<3;te++){const X=(te+1)%3,ae=T[te],ve=T[X],Te=ph[w[te]],De=ph[w[X]],We=`${ae}_${ve}`,le=`${ve}_${ae}`;le in C&&C[le]?(pd.dot(C[le].normal)<=l&&(R.push(Te.x,Te.y,Te.z),R.push(De.x,De.y,De.z)),C[le]=null):We in C||(C[We]={index0:_[te],index1:_[X],normal:pd.clone()})}}for(const U in C)if(C[U]){const{index0:$,index1:z}=C[U];dh.fromBufferAttribute(p,$),fh.fromBufferAttribute(p,z),R.push(dh.x,dh.y,dh.z),R.push(fh.x,fh.y,fh.z)}this.setAttribute("position",new vt(R,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class vd extends Oa{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new vd(e.radius,e.detail)}}class qc extends hi{constructor(e=1,t=32,r=16,o=0,l=2*Math.PI,f=0,p=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:o,phiLength:l,thetaStart:f,thetaLength:p},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const y=Math.min(f+p,Math.PI);let _=0;const w=[],T=new Me,C=new Me,R=[],U=[],$=[],z=[];for(let L=0;L<=r;L++){const te=[],X=L/r;let ae=0;0===L&&0===f?ae=.5/t:L===r&&y===Math.PI&&(ae=-.5/t);for(let ve=0;ve<=t;ve++){const Te=ve/t;T.x=-e*Math.cos(o+Te*l)*Math.sin(f+X*p),T.y=e*Math.cos(f+X*p),T.z=e*Math.sin(o+Te*l)*Math.sin(f+X*p),U.push(T.x,T.y,T.z),C.copy(T).normalize(),$.push(C.x,C.y,C.z),z.push(Te+ae,1-X),te.push(_++)}w.push(te)}for(let L=0;L<r;L++)for(let te=0;te<t;te++){const X=w[L][te+1],ae=w[L][te],ve=w[L+1][te],Te=w[L+1][te+1];(0!==L||f>0)&&R.push(X,ae,Te),(L!==r-1||y<Math.PI)&&R.push(ae,ve,Te)}this.setIndex(R),this.setAttribute("position",new vt(U,3)),this.setAttribute("normal",new vt($,3)),this.setAttribute("uv",new vt(z,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Fu extends yo{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new gn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Mh extends Fu{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Et(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return vr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new gn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new gn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new gn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Md extends yo{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new gn(16777215),this.specular=new gn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class bd extends yo{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new gn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function ba(c,e,t){return wd(c)?new c.constructor(c.subarray(e,void 0!==t?t:c.length)):c.slice(e,t)}function ql(c,e,t){return!c||!t&&c.constructor===e?c:"number"==typeof e.BYTES_PER_ELEMENT?new e(c):Array.prototype.slice.call(c)}function wd(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)}function op(c){const t=c.length,r=new Array(t);for(let o=0;o!==t;++o)r[o]=o;return r.sort(function e(o,l){return c[o]-c[l]}),r}function bh(c,e,t){const r=c.length,o=new c.constructor(r);for(let l=0,f=0;f!==r;++l){const p=t[l]*e;for(let y=0;y!==e;++y)o[f++]=c[p+y]}return o}function Ed(c,e,t,r){let o=1,l=c[0];for(;void 0!==l&&void 0===l[r];)l=c[o++];if(void 0===l)return;let f=l[r];if(void 0!==f)if(Array.isArray(f))do{f=l[r],void 0!==f&&(e.push(l.time),t.push.apply(t,f)),l=c[o++]}while(void 0!==l);else if(void 0!==f.toArray)do{f=l[r],void 0!==f&&(e.push(l.time),f.toArray(t,t.length)),l=c[o++]}while(void 0!==l);else do{f=l[r],void 0!==f&&(e.push(l.time),t.push(f)),l=c[o++]}while(void 0!==l)}class Zc{constructor(e,t,r,o){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==o?o:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,o=t[r],l=t[r-1];e:{t:{let f;n:{i:if(!(e<o)){for(let p=r+2;;){if(void 0===o){if(e<l)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===p)break;if(l=o,o=t[++r],e<o)break t}f=t.length;break n}if(e>=l)break e;{const p=t[1];e<p&&(r=2,l=p);for(let y=r-2;;){if(void 0===l)return this._cachedIndex=0,this.copySampleValue_(0);if(r===y)break;if(o=l,l=t[--r-1],e>=l)break t}f=r,r=0}}for(;r<f;){const p=r+f>>>1;e<t[p]?f=p:r=p+1}if(o=t[r],l=t[r-1],void 0===l)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===o)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,l,o)}return this.interpolate_(r,l,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,o=this.valueSize,l=e*o;for(let f=0;f!==o;++f)t[f]=r[l+f];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Dg extends Zc{constructor(e,t,r,o){super(e,t,r,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,r){const o=this.parameterPositions;let l=e-2,f=e+1,p=o[l],y=o[f];if(void 0===p)switch(this.getSettings_().endingStart){case 2401:l=e,p=2*t-r;break;case 2402:l=o.length-2,p=t+o[l]-o[l+1];break;default:l=e,p=r}if(void 0===y)switch(this.getSettings_().endingEnd){case 2401:f=e,y=2*r-t;break;case 2402:f=1,y=r+o[1]-o[0];break;default:f=e-1,y=t}const _=.5*(r-t),w=this.valueSize;this._weightPrev=_/(t-p),this._weightNext=_/(y-r),this._offsetPrev=l*w,this._offsetNext=f*w}interpolate_(e,t,r,o){const l=this.resultBuffer,f=this.sampleValues,p=this.valueSize,y=e*p,_=y-p,w=this._offsetPrev,T=this._offsetNext,C=this._weightPrev,R=this._weightNext,U=(r-t)/(o-t),$=U*U,z=$*U,L=-C*z+2*C*$-C*U,te=(1+C)*z+(-1.5-2*C)*$+(-.5+C)*U+1,X=(-1-R)*z+(1.5+R)*$+.5*U,ae=R*z-R*$;for(let ve=0;ve!==p;++ve)l[ve]=L*f[w+ve]+te*f[_+ve]+X*f[y+ve]+ae*f[T+ve];return l}}class Rg extends Zc{constructor(e,t,r,o){super(e,t,r,o)}interpolate_(e,t,r,o){const l=this.resultBuffer,f=this.sampleValues,p=this.valueSize,y=e*p,_=y-p,w=(r-t)/(o-t),T=1-w;for(let C=0;C!==p;++C)l[C]=f[_+C]*T+f[y+C]*w;return l}}class Ig extends Zc{constructor(e,t,r,o){super(e,t,r,o)}interpolate_(e){return this.copySampleValue_(e-1)}}class tl{constructor(e,t,r,o){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ql(t,this.TimeBufferType),this.values=ql(r,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:ql(e.times,Array),values:ql(e.values,Array)};const o=e.getInterpolation();o!==e.DefaultInterpolation&&(r.interpolation=o)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Ig(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Rg(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Dg(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Uo:t=this.InterpolantFactoryMethodDiscrete;break;case Cs:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Uo;case this.InterpolantFactoryMethodLinear:return Cs;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,o=t.length;r!==o;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,o=t.length;r!==o;++r)t[r]*=e}return this}trim(e,t){const r=this.times,o=r.length;let l=0,f=o-1;for(;l!==o&&r[l]<e;)++l;for(;-1!==f&&r[f]>t;)--f;if(++f,0!==l||f!==o){l>=f&&(f=Math.max(f,1),l=f-1);const p=this.getValueSize();this.times=ba(r,l,f),this.values=ba(this.values,l*p,f*p)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,o=this.values,l=r.length;0===l&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let f=null;for(let p=0;p!==l;p++){const y=r[p];if("number"==typeof y&&isNaN(y)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,p,y),e=!1;break}if(null!==f&&f>y){console.error("THREE.KeyframeTrack: Out of order keys.",this,p,y,f),e=!1;break}f=y}if(void 0!==o&&wd(o))for(let p=0,y=o.length;p!==y;++p){const _=o[p];if(isNaN(_)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,p,_),e=!1;break}}return e}optimize(){const e=ba(this.times),t=ba(this.values),r=this.getValueSize(),o=2302===this.getInterpolation(),l=e.length-1;let f=1;for(let p=1;p<l;++p){let y=!1;const _=e[p];if(_!==e[p+1]&&(1!==p||_!==e[0]))if(o)y=!0;else{const T=p*r,C=T-r,R=T+r;for(let U=0;U!==r;++U){const $=t[T+U];if($!==t[C+U]||$!==t[R+U]){y=!0;break}}}if(y){if(p!==f){e[f]=e[p];const T=p*r,C=f*r;for(let R=0;R!==r;++R)t[C+R]=t[T+R]}++f}}if(l>0){e[f]=e[l];for(let p=l*r,y=f*r,_=0;_!==r;++_)t[y+_]=t[p+_];++f}return f!==e.length?(this.times=ba(e,0,f),this.values=ba(t,0,f*r)):(this.times=e,this.values=t),this}clone(){const e=ba(this.times,0),t=ba(this.values,0),o=new(0,this.constructor)(this.name,e,t);return o.createInterpolant=this.createInterpolant,o}}tl.prototype.TimeBufferType=Float32Array,tl.prototype.ValueBufferType=Float32Array,tl.prototype.DefaultInterpolation=Cs;class Kc extends tl{}Kc.prototype.ValueTypeName="bool",Kc.prototype.ValueBufferType=Array,Kc.prototype.DefaultInterpolation=Uo,Kc.prototype.InterpolantFactoryMethodLinear=void 0,Kc.prototype.InterpolantFactoryMethodSmooth=void 0;class Sd extends tl{}Sd.prototype.ValueTypeName="color";class Nu extends tl{}Nu.prototype.ValueTypeName="number";class Pg extends Zc{constructor(e,t,r,o){super(e,t,r,o)}interpolate_(e,t,r,o){const l=this.resultBuffer,f=this.sampleValues,p=this.valueSize,y=(r-t)/(o-t);let _=e*p;for(let w=_+p;_!==w;_+=4)Is.slerpFlat(l,0,f,_-p,f,_,y);return l}}class Jc extends tl{InterpolantFactoryMethodLinear(e){return new Pg(this.times,this.values,this.getValueSize(),e)}}Jc.prototype.ValueTypeName="quaternion",Jc.prototype.DefaultInterpolation=Cs,Jc.prototype.InterpolantFactoryMethodSmooth=void 0;class Qc extends tl{}Qc.prototype.ValueTypeName="string",Qc.prototype.ValueBufferType=Array,Qc.prototype.DefaultInterpolation=Uo,Qc.prototype.InterpolantFactoryMethodLinear=void 0,Qc.prototype.InterpolantFactoryMethodSmooth=void 0;class ku extends tl{}ku.prototype.ValueTypeName="vector";class Uu{constructor(e,t=-1,r,o=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=o,this.uuid=kr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,o=1/(e.fps||1);for(let f=0,p=r.length;f!==p;++f)t.push(Og(r[f]).scale(o));const l=new this(e.name,e.duration,t,e.blendMode);return l.uuid=e.uuid,l}static toJSON(e){const t=[],r=e.tracks,o={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let l=0,f=r.length;l!==f;++l)t.push(tl.toJSON(r[l]));return o}static CreateFromMorphTargetSequence(e,t,r,o){const l=t.length,f=[];for(let p=0;p<l;p++){let y=[],_=[];y.push((p+l-1)%l,p,(p+1)%l),_.push(0,1,0);const w=op(y);y=bh(y,1,w),_=bh(_,1,w),!o&&0===y[0]&&(y.push(l),_.push(_[0])),f.push(new Nu(".morphTargetInfluences["+t[p].name+"]",y,_).scale(1/r))}return new this(e,-1,f)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const o=e;r=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<r.length;o++)if(r[o].name===t)return r[o];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const o={},l=/^([\w-]*?)([\d]+)$/;for(let p=0,y=e.length;p<y;p++){const _=e[p],w=_.name.match(l);if(w&&w.length>1){const T=w[1];let C=o[T];C||(o[T]=C=[]),C.push(_)}}const f=[];for(const p in o)f.push(this.CreateFromMorphTargetSequence(p,o[p],t,r));return f}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(T,C,R,U,$){if(0!==R.length){const z=[],L=[];Ed(R,z,L,U),0!==z.length&&$.push(new T(C,z,L))}},o=[],l=e.name||"default",f=e.fps||30,p=e.blendMode;let y=e.length||-1;const _=e.hierarchy||[];for(let T=0;T<_.length;T++){const C=_[T].keys;if(C&&0!==C.length)if(C[0].morphTargets){const R={};let U;for(U=0;U<C.length;U++)if(C[U].morphTargets)for(let $=0;$<C[U].morphTargets.length;$++)R[C[U].morphTargets[$]]=-1;for(const $ in R){const z=[],L=[];for(let te=0;te!==C[U].morphTargets.length;++te){const X=C[U];z.push(X.time),L.push(X.morphTarget===$?1:0)}o.push(new Nu(".morphTargetInfluence["+$+"]",z,L))}y=R.length*f}else{const R=".bones["+t[T].name+"]";r(ku,R+".position",C,"pos",o),r(Jc,R+".quaternion",C,"rot",o),r(ku,R+".scale",C,"scl",o)}}return 0===o.length?null:new this(l,y,o,p)}resetDuration(){let t=0;for(let r=0,o=this.tracks.length;r!==o;++r){const l=this.tracks[r];t=Math.max(t,l.times[l.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Og(c){if(void 0===c.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function Lg(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Nu;case"vector":case"vector2":case"vector3":case"vector4":return ku;case"color":return Sd;case"quaternion":return Jc;case"bool":case"boolean":return Kc;case"string":return Qc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}(c.type);if(void 0===c.times){const t=[],r=[];Ed(c.keys,t,r,"value"),c.times=t,c.values=r}return void 0!==e.parse?e.parse(c):new e(c.name,c.times,c.values,c.interpolation)}const wh={enabled:!1,files:{},add:function(c,e){!1!==this.enabled&&(this.files[c]=e)},get:function(c){if(!1!==this.enabled)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}};class Fg{constructor(e,t,r){const o=this;let y,l=!1,f=0,p=0;const _=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(w){p++,!1===l&&void 0!==o.onStart&&o.onStart(w,f,p),l=!0},this.itemEnd=function(w){f++,void 0!==o.onProgress&&o.onProgress(w,f,p),f===p&&(l=!1,void 0!==o.onLoad&&o.onLoad())},this.itemError=function(w){void 0!==o.onError&&o.onError(w)},this.resolveURL=function(w){return y?y(w):w},this.setURLModifier=function(w){return y=w,this},this.addHandler=function(w,T){return _.push(w,T),this},this.removeHandler=function(w){const T=_.indexOf(w);return-1!==T&&_.splice(T,2),this},this.getHandler=function(w){for(let T=0,C=_.length;T<C;T+=2){const R=_[T],U=_[T+1];if(R.global&&(R.lastIndex=0),R.test(w))return U}return null}}}const T0=new Fg;let Bu=(()=>{class c{constructor(t){this.manager=void 0!==t?t:T0,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,r){const o=this;return new Promise(function(l,f){o.load(t,l,r,f)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}return c.DEFAULT_MATERIAL_NAME="__DEFAULT",c})();const Zl={};class ro extends Error{constructor(e,t){super(e),this.response=t}}class Dl extends Bu{constructor(e){super(e)}load(e,t,r,o){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const l=wh.get(e);if(void 0!==l)return this.manager.itemStart(e),setTimeout(()=>{t&&t(l),this.manager.itemEnd(e)},0),l;if(void 0!==Zl[e])return void Zl[e].push({onLoad:t,onProgress:r,onError:o});Zl[e]=[],Zl[e].push({onLoad:t,onProgress:r,onError:o});const f=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),p=this.mimeType,y=this.responseType;fetch(f).then(_=>{if(200===_.status||0===_.status){if(0===_.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===_.body||void 0===_.body.getReader)return _;const w=Zl[e],T=_.body.getReader(),C=_.headers.get("Content-Length")||_.headers.get("X-File-Size"),R=C?parseInt(C):0,U=0!==R;let $=0;const z=new ReadableStream({start(L){!function te(){T.read().then(({done:X,value:ae})=>{if(X)L.close();else{$+=ae.byteLength;const ve=new ProgressEvent("progress",{lengthComputable:U,loaded:$,total:R});for(let Te=0,De=w.length;Te<De;Te++){const We=w[Te];We.onProgress&&We.onProgress(ve)}L.enqueue(ae),te()}})}()}});return new Response(z)}throw new ro(`fetch for "${_.url}" responded with ${_.status}: ${_.statusText}`,_)}).then(_=>{switch(y){case"arraybuffer":return _.arrayBuffer();case"blob":return _.blob();case"document":return _.text().then(w=>(new DOMParser).parseFromString(w,p));case"json":return _.json();default:if(void 0===p)return _.text();{const T=/charset="?([^;"\s]*)"?/i.exec(p),C=T&&T[1]?T[1].toLowerCase():void 0,R=new TextDecoder(C);return _.arrayBuffer().then(U=>R.decode(U))}}}).then(_=>{wh.add(e,_);const w=Zl[e];delete Zl[e];for(let T=0,C=w.length;T<C;T++){const R=w[T];R.onLoad&&R.onLoad(_)}}).catch(_=>{const w=Zl[e];if(void 0===w)throw this.manager.itemError(e),_;delete Zl[e];for(let T=0,C=w.length;T<C;T++){const R=w[T];R.onError&&R.onError(_)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Eh extends Bu{constructor(e){super(e)}load(e,t,r,o){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,f=wh.get(e);if(void 0!==f)return l.manager.itemStart(e),setTimeout(function(){t&&t(f),l.manager.itemEnd(e)},0),f;const p=Rs("img");function y(){w(),wh.add(e,this),t&&t(this),l.manager.itemEnd(e)}function _(T){w(),o&&o(T),l.manager.itemError(e),l.manager.itemEnd(e)}function w(){p.removeEventListener("load",y,!1),p.removeEventListener("error",_,!1)}return p.addEventListener("load",y,!1),p.addEventListener("error",_,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(p.crossOrigin=this.crossOrigin),l.manager.itemStart(e),p.src=e,p}}class Ng extends Bu{constructor(e){super(e)}load(e,t,r,o){const l=new ua,f=new Eh(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(e,function(p){l.image=p,l.needsUpdate=!0,void 0!==t&&t(l)},r,o),l}}class Kl extends ws{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new gn(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const ap=new Fi,lp=new Me,kg=new Me;class Ad{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Et(512,512),this.map=null,this.mapPass=null,this.matrix=new Fi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bp,this._frameExtents=new Et(1,1),this._viewportCount=1,this._viewports=[new tr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;lp.setFromMatrixPosition(e.matrixWorld),t.position.copy(lp),kg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(kg),t.updateMatrixWorld(),ap.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ap),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(ap)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Lx extends Ad{constructor(){super(new Lo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*fr*e.angle*this.focus,o=this.mapSize.width/this.mapSize.height,l=e.distance||t.far;(r!==t.fov||o!==t.aspect||l!==t.far)&&(t.fov=r,t.aspect=o,t.far=l,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class cp extends Kl{constructor(e,t,r=0,o=Math.PI/3,l=0,f=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ws.DEFAULT_UP),this.updateMatrix(),this.target=new ws,this.distance=r,this.angle=o,this.penumbra=l,this.decay=f,this.map=null,this.shadow=new Lx}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Td=new Fi,fa=new Me,up=new Me;class R0 extends Ad{constructor(){super(new Lo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Et(4,2),this._viewportCount=6,this._viewports=[new tr(2,1,1,1),new tr(0,1,1,1),new tr(3,1,1,1),new tr(1,1,1,1),new tr(3,0,1,1),new tr(1,0,1,1)],this._cubeDirections=[new Me(1,0,0),new Me(-1,0,0),new Me(0,0,1),new Me(0,0,-1),new Me(0,1,0),new Me(0,-1,0)],this._cubeUps=[new Me(0,1,0),new Me(0,1,0),new Me(0,1,0),new Me(0,1,0),new Me(0,0,1),new Me(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,o=this.matrix,l=e.distance||r.far;l!==r.far&&(r.far=l,r.updateProjectionMatrix()),fa.setFromMatrixPosition(e.matrixWorld),r.position.copy(fa),up.copy(r.position),up.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(up),r.updateMatrixWorld(),o.makeTranslation(-fa.x,-fa.y,-fa.z),Td.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Td)}}class nl extends Kl{constructor(e,t,r=0,o=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=o,this.shadow=new R0}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class il extends Ad{constructor(){super(new Fc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Fa extends Kl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ws.DEFAULT_UP),this.updateMatrix(),this.target=new ws,this.shadow=new il}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class hp extends Kl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class fp{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,o=e.length;r<o;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(r){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class zg extends Bu{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,o){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,f=wh.get(e);if(void 0!==f)return l.manager.itemStart(e),setTimeout(function(){t&&t(f),l.manager.itemEnd(e)},0),f;const p={};p.credentials="anonymous"===this.crossOrigin?"same-origin":"include",p.headers=this.requestHeader,fetch(e,p).then(function(y){return y.blob()}).then(function(y){return createImageBitmap(y,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(y){wh.add(e,y),t&&t(y),l.manager.itemEnd(e)}).catch(function(y){o&&o(y),l.manager.itemError(e),l.manager.itemEnd(e)}),l.manager.itemStart(e)}}class yp{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=vp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=vp();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function vp(){return("undefined"==typeof performance?Date:performance).now()}const xp="\\[\\]\\.:\\/",U0=new RegExp("["+xp+"]","g"),Mp="[^"+xp+"]",B0="[^"+xp.replace("\\.","")+"]",$g=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Mp)+/(WCOD+)?/.source.replace("WCOD",B0)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Mp)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Mp)+"$"),Xg=["material","materials","bones","map"];class Yg{constructor(e,t,r){const o=r||Kr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,o)}getValue(e,t){this.bind();const o=this._bindings[this._targetGroup.nCachedObjects_];void 0!==o&&o.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let o=this._targetGroup.nCachedObjects_,l=r.length;o!==l;++o)r[o].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}let Kr=(()=>{class c{constructor(t,r,o){this.path=r,this.parsedPath=o||c.parseTrackName(r),this.node=c.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,r,o){return t&&t.isAnimationObjectGroup?new c.Composite(t,r,o):new c(t,r,o)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(U0,"")}static parseTrackName(t){const r=$g.exec(t);if(null===r)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const o={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]},l=o.nodeName&&o.nodeName.lastIndexOf(".");if(void 0!==l&&-1!==l){const f=o.nodeName.substring(l+1);-1!==Xg.indexOf(f)&&(o.nodeName=o.nodeName.substring(0,l),o.objectName=f)}if(null===o.propertyName||0===o.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return o}static findNode(t,r){if(void 0===r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){const o=t.skeleton.getBoneByName(r);if(void 0!==o)return o}if(t.children){const o=function(f){for(let p=0;p<f.length;p++){const y=f[p];if(y.name===r||y.uuid===r)return y;const _=o(y.children);if(_)return _}return null},l=o(t.children);if(l)return l}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,r){t[r]=this.targetObject[this.propertyName]}_getValue_array(t,r){const o=this.resolvedProperty;for(let l=0,f=o.length;l!==f;++l)t[r++]=o[l]}_getValue_arrayElement(t,r){t[r]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,r){this.resolvedProperty.toArray(t,r)}_setValue_direct(t,r){this.targetObject[this.propertyName]=t[r]}_setValue_direct_setNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,r){const o=this.resolvedProperty;for(let l=0,f=o.length;l!==f;++l)o[l]=t[r++]}_setValue_array_setNeedsUpdate(t,r){const o=this.resolvedProperty;for(let l=0,f=o.length;l!==f;++l)o[l]=t[r++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,r){const o=this.resolvedProperty;for(let l=0,f=o.length;l!==f;++l)o[l]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,r){this.resolvedProperty[this.propertyIndex]=t[r]}_setValue_arrayElement_setNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,r){this.resolvedProperty.fromArray(t,r)}_setValue_fromArray_setNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,r){this.bind(),this.getValue(t,r)}_setValue_unbound(t,r){this.bind(),this.setValue(t,r)}bind(){let t=this.node;const r=this.parsedPath,o=r.objectName,l=r.propertyName;let f=r.propertyIndex;if(t||(t=c.findNode(this.rootNode,r.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(o){let w=r.objectIndex;switch(o){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let T=0;T<t.length;T++)if(t[T].name===w){w=T;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[o])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[o]}if(void 0!==w){if(void 0===t[w])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[w]}}const p=t[l];if(void 0===p)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r.nodeName+"."+l+" but it wasn't found.",t);let y=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?y=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(y=this.Versioning.MatrixWorldNeedsUpdate);let _=this.BindingType.Direct;if(void 0!==f){if("morphTargetInfluences"===l){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[f]&&(f=t.morphTargetDictionary[f])}_=this.BindingType.ArrayElement,this.resolvedProperty=p,this.propertyIndex=f}else void 0!==p.fromArray&&void 0!==p.toArray?(_=this.BindingType.HasFromToArray,this.resolvedProperty=p):Array.isArray(p)?(_=this.BindingType.EntireArray,this.resolvedProperty=p):this.propertyName=l;this.getValue=this.GetterByBindingType[_],this.setValue=this.SetterByBindingTypeAndVersioning[_][y]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return c.Composite=Yg,c})();Kr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Kr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Kr.prototype.GetterByBindingType=[Kr.prototype._getValue_direct,Kr.prototype._getValue_array,Kr.prototype._getValue_arrayElement,Kr.prototype._getValue_toArray],Kr.prototype.SetterByBindingTypeAndVersioning=[[Kr.prototype._setValue_direct,Kr.prototype._setValue_direct_setNeedsUpdate,Kr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kr.prototype._setValue_array,Kr.prototype._setValue_array_setNeedsUpdate,Kr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kr.prototype._setValue_arrayElement,Kr.prototype._setValue_arrayElement_setNeedsUpdate,Kr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kr.prototype._setValue_fromArray,Kr.prototype._setValue_fromArray_setNeedsUpdate,Kr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class X0{constructor(e,t,r=0,o=1/0){this.ray=new ha(e,t),this.near=r,this.far=o,this.camera=null,this.layers=new cn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return Jg(e,this,r,t),r.sort(ru),r}intersectObjects(e,t=!0,r=[]){for(let o=0,l=e.length;o<l;o++)Jg(e[o],this,r,t);return r.sort(ru),r}}function ru(c,e){return c.distance-e.distance}function Jg(c,e,t,r){if(c.layers.test(e.layers)&&c.raycast(e,t),!0===r){const o=c.children;for(let l=0,f=o.length;l<f;l++)Jg(o[l],e,t,!0)}}class wp{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(vr(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Ap=new Me,Rd=new Me,iy=new Me;class Q0 extends ws{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",void 0===t&&(t=1);let o=new hi;o.setAttribute("position",new vt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const l=new aa({fog:!1,toneMapped:!1});this.lightPlane=new fc(o,l),this.add(this.lightPlane),o=new hi,o.setAttribute("position",new vt([0,0,0,0,0,1],3)),this.targetLine=new fc(o,l),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Ap.setFromMatrixPosition(this.light.matrixWorld),Rd.setFromMatrixPosition(this.light.target.matrixWorld),iy.subVectors(Rd,Ap),this.lightPlane.lookAt(Rd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Rd),this.targetLine.scale.z=iy.length()}}class i_ extends ld{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],o=new hi;o.setAttribute("position",new vt(t,3)),o.setAttribute("color",new vt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(o,new aa({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const o=new gn,l=this.geometry.attributes.color.array;return o.set(e),o.toArray(l,0),o.toArray(l,3),o.set(t),o.toArray(l,6),o.toArray(l,9),o.set(r),o.toArray(l,12),o.toArray(l,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"155"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="155")},6246:(qn,Rt,ye)=>{ye.d(Rt,{Vx:()=>gt,kX:()=>_n,oY:()=>N});var F,N={Linear:{None:function(ce){return ce}},Quadratic:{In:function(ce){return ce*ce},Out:function(ce){return ce*(2-ce)},InOut:function(ce){return(ce*=2)<1?.5*ce*ce:-.5*(--ce*(ce-2)-1)}},Cubic:{In:function(ce){return ce*ce*ce},Out:function(ce){return--ce*ce*ce+1},InOut:function(ce){return(ce*=2)<1?.5*ce*ce*ce:.5*((ce-=2)*ce*ce+2)}},Quartic:{In:function(ce){return ce*ce*ce*ce},Out:function(ce){return 1- --ce*ce*ce*ce},InOut:function(ce){return(ce*=2)<1?.5*ce*ce*ce*ce:-.5*((ce-=2)*ce*ce*ce-2)}},Quintic:{In:function(ce){return ce*ce*ce*ce*ce},Out:function(ce){return--ce*ce*ce*ce*ce+1},InOut:function(ce){return(ce*=2)<1?.5*ce*ce*ce*ce*ce:.5*((ce-=2)*ce*ce*ce*ce+2)}},Sinusoidal:{In:function(ce){return 1-Math.cos(ce*Math.PI/2)},Out:function(ce){return Math.sin(ce*Math.PI/2)},InOut:function(ce){return.5*(1-Math.cos(Math.PI*ce))}},Exponential:{In:function(ce){return 0===ce?0:Math.pow(1024,ce-1)},Out:function(ce){return 1===ce?1:1-Math.pow(2,-10*ce)},InOut:function(ce){return 0===ce?0:1===ce?1:(ce*=2)<1?.5*Math.pow(1024,ce-1):.5*(2-Math.pow(2,-10*(ce-1)))}},Circular:{In:function(ce){return 1-Math.sqrt(1-ce*ce)},Out:function(ce){return Math.sqrt(1- --ce*ce)},InOut:function(ce){return(ce*=2)<1?-.5*(Math.sqrt(1-ce*ce)-1):.5*(Math.sqrt(1-(ce-=2)*ce)+1)}},Elastic:{In:function(ce){return 0===ce?0:1===ce?1:-Math.pow(2,10*(ce-1))*Math.sin(5*(ce-1.1)*Math.PI)},Out:function(ce){return 0===ce?0:1===ce?1:Math.pow(2,-10*ce)*Math.sin(5*(ce-.1)*Math.PI)+1},InOut:function(ce){return 0===ce?0:1===ce?1:(ce*=2)<1?-.5*Math.pow(2,10*(ce-1))*Math.sin(5*(ce-1.1)*Math.PI):.5*Math.pow(2,-10*(ce-1))*Math.sin(5*(ce-1.1)*Math.PI)+1}},Back:{In:function(ce){return ce*ce*(2.70158*ce-1.70158)},Out:function(ce){return--ce*ce*(2.70158*ce+1.70158)+1},InOut:function(ce){var ke=2.5949095;return(ce*=2)<1?ce*ce*((ke+1)*ce-ke)*.5:.5*((ce-=2)*ce*((ke+1)*ce+ke)+2)}},Bounce:{In:function(ce){return 1-N.Bounce.Out(1-ce)},Out:function(ce){return ce<1/2.75?7.5625*ce*ce:ce<2/2.75?7.5625*(ce-=1.5/2.75)*ce+.75:ce<2.5/2.75?7.5625*(ce-=2.25/2.75)*ce+.9375:7.5625*(ce-=2.625/2.75)*ce+.984375},InOut:function(ce){return ce<.5?.5*N.Bounce.In(2*ce):.5*N.Bounce.Out(2*ce-1)+.5}}};F="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var ce=process.hrtime();return 1e3*ce[0]+ce[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};var ce,Ze=F,mt=function(){function ce(){this._tweens={},this._tweensAddedDuringUpdate={}}return ce.prototype.getAll=function(){var ke=this;return Object.keys(this._tweens).map(function(Ye){return ke._tweens[Ye]})},ce.prototype.removeAll=function(){this._tweens={}},ce.prototype.add=function(ke){this._tweens[ke.getId()]=ke,this._tweensAddedDuringUpdate[ke.getId()]=ke},ce.prototype.remove=function(ke){delete this._tweens[ke.getId()],delete this._tweensAddedDuringUpdate[ke.getId()]},ce.prototype.update=function(ke,Ye){void 0===ke&&(ke=Ze()),void 0===Ye&&(Ye=!1);var rt=Object.keys(this._tweens);if(0===rt.length)return!1;for(;rt.length>0;){this._tweensAddedDuringUpdate={};for(var nt=0;nt<rt.length;nt++){var on=this._tweens[rt[nt]];on&&!1===on.update(ke,!Ye)&&!Ye&&delete this._tweens[rt[nt]]}rt=Object.keys(this._tweensAddedDuringUpdate)}return!0},ce}(),ut={Linear:function(ce,ke){var Ye=ce.length-1,rt=Ye*ke,nt=Math.floor(rt),on=ut.Utils.Linear;return ke<0?on(ce[0],ce[1],rt):ke>1?on(ce[Ye],ce[Ye-1],Ye-rt):on(ce[nt],ce[nt+1>Ye?Ye:nt+1],rt-nt)},Bezier:function(ce,ke){for(var Ye=0,rt=ce.length-1,nt=Math.pow,on=ut.Utils.Bernstein,Qe=0;Qe<=rt;Qe++)Ye+=nt(1-ke,rt-Qe)*nt(ke,Qe)*ce[Qe]*on(rt,Qe);return Ye},CatmullRom:function(ce,ke){var Ye=ce.length-1,rt=Ye*ke,nt=Math.floor(rt),on=ut.Utils.CatmullRom;return ce[0]===ce[Ye]?(ke<0&&(nt=Math.floor(rt=Ye*(1+ke))),on(ce[(nt-1+Ye)%Ye],ce[nt],ce[(nt+1)%Ye],ce[(nt+2)%Ye],rt-nt)):ke<0?ce[0]-(on(ce[0],ce[0],ce[1],ce[1],-rt)-ce[0]):ke>1?ce[Ye]-(on(ce[Ye],ce[Ye],ce[Ye-1],ce[Ye-1],rt-Ye)-ce[Ye]):on(ce[nt?nt-1:0],ce[nt],ce[Ye<nt+1?Ye:nt+1],ce[Ye<nt+2?Ye:nt+2],rt-nt)},Utils:{Linear:function(ce,ke,Ye){return(ke-ce)*Ye+ce},Bernstein:function(ce,ke){var Ye=ut.Utils.Factorial;return Ye(ce)/Ye(ke)/Ye(ce-ke)},Factorial:(ce=[1],function(ke){var Ye=1;if(ce[ke])return ce[ke];for(var rt=ke;rt>1;rt--)Ye*=rt;return ce[ke]=Ye,Ye}),CatmullRom:function(ce,ke,Ye,rt,nt){var on=.5*(Ye-ce),Qe=.5*(rt-ke),Tt=nt*nt;return(2*ke-2*Ye+on+Qe)*(nt*Tt)+(-3*ke+3*Ye-2*on-Qe)*Tt+on*nt+ke}}},sn=function(){function ce(){}return ce.nextId=function(){return ce._nextId++},ce._nextId=0,ce}(),Xt=new mt,_n=function(){function ce(ke,Ye){void 0===Ye&&(Ye=Xt),this._object=ke,this._group=Ye,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=N.Linear.None,this._interpolationFunction=ut.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=sn.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return ce.prototype.getId=function(){return this._id},ce.prototype.isPlaying=function(){return this._isPlaying},ce.prototype.isPaused=function(){return this._isPaused},ce.prototype.to=function(ke,Ye){return this._valuesEnd=Object.create(ke),void 0!==Ye&&(this._duration=Ye),this},ce.prototype.duration=function(ke){return this._duration=ke,this},ce.prototype.start=function(ke){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var Ye in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(Ye),this._valuesStart[Ye]=this._valuesStartRepeat[Ye];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==ke?"string"==typeof ke?Ze()+parseFloat(ke):ke:Ze(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},ce.prototype._setupProperties=function(ke,Ye,rt,nt){for(var on in rt){var Qe=ke[on],Tt=Array.isArray(Qe),Cn=Tt?"array":typeof Qe,kn=!Tt&&Array.isArray(rt[on]);if("undefined"!==Cn&&"function"!==Cn){if(kn){var ai=rt[on];if(0===ai.length)continue;ai=ai.map(this._handleRelativeValue.bind(this,Qe)),rt[on]=[Qe].concat(ai)}if("object"!==Cn&&!Tt||!Qe||kn)void 0===Ye[on]&&(Ye[on]=Qe),Tt||(Ye[on]*=1),nt[on]=kn?rt[on].slice().reverse():Ye[on]||0;else{for(var mn in Ye[on]=Tt?[]:{},Qe)Ye[on][mn]=Qe[mn];nt[on]=Tt?[]:{},this._setupProperties(Qe,Ye[on],rt[on],nt[on])}}}},ce.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},ce.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},ce.prototype.pause=function(ke){return void 0===ke&&(ke=Ze()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=ke,this._group&&this._group.remove(this)),this},ce.prototype.resume=function(ke){return void 0===ke&&(ke=Ze()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=ke-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},ce.prototype.stopChainedTweens=function(){for(var ke=0,Ye=this._chainedTweens.length;ke<Ye;ke++)this._chainedTweens[ke].stop();return this},ce.prototype.group=function(ke){return this._group=ke,this},ce.prototype.delay=function(ke){return this._delayTime=ke,this},ce.prototype.repeat=function(ke){return this._initialRepeat=ke,this._repeat=ke,this},ce.prototype.repeatDelay=function(ke){return this._repeatDelayTime=ke,this},ce.prototype.yoyo=function(ke){return this._yoyo=ke,this},ce.prototype.easing=function(ke){return this._easingFunction=ke,this},ce.prototype.interpolation=function(ke){return this._interpolationFunction=ke,this},ce.prototype.chain=function(){for(var ke=[],Ye=0;Ye<arguments.length;Ye++)ke[Ye]=arguments[Ye];return this._chainedTweens=ke,this},ce.prototype.onStart=function(ke){return this._onStartCallback=ke,this},ce.prototype.onUpdate=function(ke){return this._onUpdateCallback=ke,this},ce.prototype.onRepeat=function(ke){return this._onRepeatCallback=ke,this},ce.prototype.onComplete=function(ke){return this._onCompleteCallback=ke,this},ce.prototype.onStop=function(ke){return this._onStopCallback=ke,this},ce.prototype.update=function(ke,Ye){if(void 0===ke&&(ke=Ze()),void 0===Ye&&(Ye=!0),this._isPaused)return!0;var rt,nt;if(!this._goToEnd&&!this._isPlaying){if(ke>this._startTime+this._duration)return!1;Ye&&this.start(ke)}if(this._goToEnd=!1,ke<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),nt=(ke-this._startTime)/this._duration;var Qe=this._easingFunction(nt=0===this._duration||nt>1?1:nt);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,Qe),this._onUpdateCallback&&this._onUpdateCallback(this._object,nt),1===nt){if(this._repeat>0){for(rt in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)!this._yoyo&&"string"==typeof this._valuesEnd[rt]&&(this._valuesStartRepeat[rt]=this._valuesStartRepeat[rt]+parseFloat(this._valuesEnd[rt])),this._yoyo&&this._swapEndStartRepeatValues(rt),this._valuesStart[rt]=this._valuesStartRepeat[rt];return this._yoyo&&(this._reversed=!this._reversed),this._startTime=void 0!==this._repeatDelayTime?ke+this._repeatDelayTime:ke+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var Tt=0,Cn=this._chainedTweens.length;Tt<Cn;Tt++)this._chainedTweens[Tt].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},ce.prototype._updateProperties=function(ke,Ye,rt,nt){for(var on in rt)if(void 0!==Ye[on]){var Qe=Ye[on]||0,Tt=rt[on],Cn=Array.isArray(ke[on]),kn=Array.isArray(Tt);!Cn&&kn?ke[on]=this._interpolationFunction(Tt,nt):"object"==typeof Tt&&Tt?this._updateProperties(ke[on],Qe,Tt,nt):"number"==typeof(Tt=this._handleRelativeValue(Qe,Tt))&&(ke[on]=Qe+(Tt-Qe)*nt)}},ce.prototype._handleRelativeValue=function(ke,Ye){return"string"!=typeof Ye?Ye:"+"===Ye.charAt(0)||"-"===Ye.charAt(0)?ke+parseFloat(Ye):parseFloat(Ye)},ce.prototype._swapEndStartRepeatValues=function(ke){var Ye=this._valuesStartRepeat[ke],rt=this._valuesEnd[ke];this._valuesStartRepeat[ke]="string"==typeof rt?this._valuesStartRepeat[ke]+parseFloat(rt):this._valuesEnd[ke],this._valuesEnd[ke]=Ye},ce}(),lt=Xt,gt=(lt.getAll.bind(lt),lt.removeAll.bind(lt),lt.add.bind(lt),lt.remove.bind(lt),lt.update.bind(lt))},6497:(qn,Rt,ye)=>{ye.d(Rt,{E:()=>Gn});var N=ye(6682);function lt(Le,J){if(J===N.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),Le;if(J===N.z$h||J===N.UlW){let Z=Le.getIndex();if(null===Z){const ie=[],Ie=Le.getAttribute("position");if(void 0===Ie)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Le;for(let we=0;we<Ie.count;we++)ie.push(we);Le.setIndex(ie),Z=Le.getIndex()}const he=Z.count-2,ne=[];if(J===N.z$h)for(let ie=1;ie<=he;ie++)ne.push(Z.getX(0)),ne.push(Z.getX(ie)),ne.push(Z.getX(ie+1));else for(let ie=0;ie<he;ie++)ie%2==0?(ne.push(Z.getX(ie)),ne.push(Z.getX(ie+1)),ne.push(Z.getX(ie+2))):(ne.push(Z.getX(ie+2)),ne.push(Z.getX(ie+1)),ne.push(Z.getX(ie)));ne.length/3!==he&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const ue=Le.clone();return ue.setIndex(ne),ue.clearGroups(),ue}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",J),Le}class Gn extends N.aNw{constructor(J){super(J),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Z){return new nt(Z)}),this.register(function(Z){return new Jn(Z)}),this.register(function(Z){return new Rn(Z)}),this.register(function(Z){return new Nr(Z)}),this.register(function(Z){return new Qe(Z)}),this.register(function(Z){return new Tt(Z)}),this.register(function(Z){return new Cn(Z)}),this.register(function(Z){return new kn(Z)}),this.register(function(Z){return new rt(Z)}),this.register(function(Z){return new ai(Z)}),this.register(function(Z){return new on(Z)}),this.register(function(Z){return new mn(Z)}),this.register(function(Z){return new ke(Z)}),this.register(function(Z){return new rn(Z)}),this.register(function(Z){return new Wt(Z)})}load(J,Z,he,ne){const ue=this;let ie;ie=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:N.Zp0.extractUrlBase(J),this.manager.itemStart(J);const Ie=function(Ue){ne?ne(Ue):console.error(Ue),ue.manager.itemError(J),ue.manager.itemEnd(J)},we=new N.hH6(this.manager);we.setPath(this.path),we.setResponseType("arraybuffer"),we.setRequestHeader(this.requestHeader),we.setWithCredentials(this.withCredentials),we.load(J,function(Ue){try{ue.parse(Ue,ie,function(Fe){Z(Fe),ue.manager.itemEnd(J)},Ie)}catch(Fe){Ie(Fe)}},he,Ie)}setDRACOLoader(J){return this.dracoLoader=J,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(J){return this.ktx2Loader=J,this}setMeshoptDecoder(J){return this.meshoptDecoder=J,this}register(J){return-1===this.pluginCallbacks.indexOf(J)&&this.pluginCallbacks.push(J),this}unregister(J){return-1!==this.pluginCallbacks.indexOf(J)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(J),1),this}parse(J,Z,he,ne){let ue;const ie={},Ie={},we=new TextDecoder;if("string"==typeof J)ue=JSON.parse(J);else if(J instanceof ArrayBuffer)if(we.decode(new Uint8Array(J,0,4))===Je){try{ie[ce.KHR_BINARY_GLTF]=new yt(J)}catch(Q){return void(ne&&ne(Q))}ue=JSON.parse(ie[ce.KHR_BINARY_GLTF].content)}else ue=JSON.parse(we.decode(J));else ue=J;if(void 0===ue.asset||ue.asset.version[0]<2)return void(ne&&ne(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const Ue=new Lt(ue,{path:Z||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});Ue.fileLoader.setRequestHeader(this.requestHeader);for(let Fe=0;Fe<this.pluginCallbacks.length;Fe++){const Q=this.pluginCallbacks[Fe](Ue);Ie[Q.name]=Q,ie[Q.name]=!0}if(ue.extensionsUsed)for(let Fe=0;Fe<ue.extensionsUsed.length;++Fe){const Q=ue.extensionsUsed[Fe],Ve=ue.extensionsRequired||[];switch(Q){case ce.KHR_MATERIALS_UNLIT:ie[Q]=new Ye;break;case ce.KHR_DRACO_MESH_COMPRESSION:ie[Q]=new hn(ue,this.dracoLoader);break;case ce.KHR_TEXTURE_TRANSFORM:ie[Q]=new $t;break;case ce.KHR_MESH_QUANTIZATION:ie[Q]=new In;break;default:Ve.indexOf(Q)>=0&&void 0===Ie[Q]&&console.warn('THREE.GLTFLoader: Unknown extension "'+Q+'".')}}Ue.setExtensions(ie),Ue.setPlugins(Ie),Ue.parse(he,ne)}parseAsync(J,Z){const he=this;return new Promise(function(ne,ue){he.parse(J,Z,ne,ue)})}}function Vn(){let Le={};return{get:function(J){return Le[J]},add:function(J,Z){Le[J]=Z},remove:function(J){delete Le[J]},removeAll:function(){Le={}}}}const ce={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ke{constructor(J){this.parser=J,this.name=ce.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const J=this.parser,Z=this.parser.json.nodes||[];for(let he=0,ne=Z.length;he<ne;he++){const ue=Z[he];ue.extensions&&ue.extensions[this.name]&&void 0!==ue.extensions[this.name].light&&J._addNodeRef(this.cache,ue.extensions[this.name].light)}}_loadLight(J){const Z=this.parser,he="light:"+J;let ne=Z.cache.get(he);if(ne)return ne;const ue=Z.json,we=((ue.extensions&&ue.extensions[this.name]||{}).lights||[])[J];let Ue;const Fe=new N.Ilk(16777215);void 0!==we.color&&Fe.fromArray(we.color);const Q=void 0!==we.range?we.range:0;switch(we.type){case"directional":Ue=new N.Ox3(Fe),Ue.target.position.set(0,0,-1),Ue.add(Ue.target);break;case"point":Ue=new N.cek(Fe),Ue.distance=Q;break;case"spot":Ue=new N.PMe(Fe),Ue.distance=Q,we.spot=we.spot||{},we.spot.innerConeAngle=void 0!==we.spot.innerConeAngle?we.spot.innerConeAngle:0,we.spot.outerConeAngle=void 0!==we.spot.outerConeAngle?we.spot.outerConeAngle:Math.PI/4,Ue.angle=we.spot.outerConeAngle,Ue.penumbra=1-we.spot.innerConeAngle/we.spot.outerConeAngle,Ue.target.position.set(0,0,-1),Ue.add(Ue.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+we.type)}return Ue.position.set(0,0,0),Ue.decay=2,ar(Ue,we),void 0!==we.intensity&&(Ue.intensity=we.intensity),Ue.name=Z.createUniqueName(we.name||"light_"+J),ne=Promise.resolve(Ue),Z.cache.add(he,ne),ne}getDependency(J,Z){if("light"===J)return this._loadLight(Z)}createNodeAttachment(J){const Z=this,he=this.parser,ue=he.json.nodes[J],Ie=(ue.extensions&&ue.extensions[this.name]||{}).light;return void 0===Ie?null:this._loadLight(Ie).then(function(we){return he._getNodeRef(Z.cache,Ie,we)})}}class Ye{constructor(){this.name=ce.KHR_MATERIALS_UNLIT}getMaterialType(){return N.vBJ}extendParams(J,Z,he){const ne=[];J.color=new N.Ilk(1,1,1),J.opacity=1;const ue=Z.pbrMetallicRoughness;if(ue){if(Array.isArray(ue.baseColorFactor)){const ie=ue.baseColorFactor;J.color.fromArray(ie),J.opacity=ie[3]}void 0!==ue.baseColorTexture&&ne.push(he.assignTexture(J,"map",ue.baseColorTexture,N.KI_))}return Promise.all(ne)}}class rt{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(J,Z){const ne=this.parser.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=ne.extensions[this.name].emissiveStrength;return void 0!==ue&&(Z.emissiveIntensity=ue),Promise.resolve()}}class nt{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_CLEARCOAT}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[],ie=ne.extensions[this.name];if(void 0!==ie.clearcoatFactor&&(Z.clearcoat=ie.clearcoatFactor),void 0!==ie.clearcoatTexture&&ue.push(he.assignTexture(Z,"clearcoatMap",ie.clearcoatTexture)),void 0!==ie.clearcoatRoughnessFactor&&(Z.clearcoatRoughness=ie.clearcoatRoughnessFactor),void 0!==ie.clearcoatRoughnessTexture&&ue.push(he.assignTexture(Z,"clearcoatRoughnessMap",ie.clearcoatRoughnessTexture)),void 0!==ie.clearcoatNormalTexture&&(ue.push(he.assignTexture(Z,"clearcoatNormalMap",ie.clearcoatNormalTexture)),void 0!==ie.clearcoatNormalTexture.scale)){const Ie=ie.clearcoatNormalTexture.scale;Z.clearcoatNormalScale=new N.FM8(Ie,Ie)}return Promise.all(ue)}}class on{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_IRIDESCENCE}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[],ie=ne.extensions[this.name];return void 0!==ie.iridescenceFactor&&(Z.iridescence=ie.iridescenceFactor),void 0!==ie.iridescenceTexture&&ue.push(he.assignTexture(Z,"iridescenceMap",ie.iridescenceTexture)),void 0!==ie.iridescenceIor&&(Z.iridescenceIOR=ie.iridescenceIor),void 0===Z.iridescenceThicknessRange&&(Z.iridescenceThicknessRange=[100,400]),void 0!==ie.iridescenceThicknessMinimum&&(Z.iridescenceThicknessRange[0]=ie.iridescenceThicknessMinimum),void 0!==ie.iridescenceThicknessMaximum&&(Z.iridescenceThicknessRange[1]=ie.iridescenceThicknessMaximum),void 0!==ie.iridescenceThicknessTexture&&ue.push(he.assignTexture(Z,"iridescenceThicknessMap",ie.iridescenceThicknessTexture)),Promise.all(ue)}}class Qe{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_SHEEN}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[];Z.sheenColor=new N.Ilk(0,0,0),Z.sheenRoughness=0,Z.sheen=1;const ie=ne.extensions[this.name];return void 0!==ie.sheenColorFactor&&Z.sheenColor.fromArray(ie.sheenColorFactor),void 0!==ie.sheenRoughnessFactor&&(Z.sheenRoughness=ie.sheenRoughnessFactor),void 0!==ie.sheenColorTexture&&ue.push(he.assignTexture(Z,"sheenColorMap",ie.sheenColorTexture,N.KI_)),void 0!==ie.sheenRoughnessTexture&&ue.push(he.assignTexture(Z,"sheenRoughnessMap",ie.sheenRoughnessTexture)),Promise.all(ue)}}class Tt{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_TRANSMISSION}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[],ie=ne.extensions[this.name];return void 0!==ie.transmissionFactor&&(Z.transmission=ie.transmissionFactor),void 0!==ie.transmissionTexture&&ue.push(he.assignTexture(Z,"transmissionMap",ie.transmissionTexture)),Promise.all(ue)}}class Cn{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_VOLUME}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[],ie=ne.extensions[this.name];Z.thickness=void 0!==ie.thicknessFactor?ie.thicknessFactor:0,void 0!==ie.thicknessTexture&&ue.push(he.assignTexture(Z,"thicknessMap",ie.thicknessTexture)),Z.attenuationDistance=ie.attenuationDistance||1/0;const Ie=ie.attenuationColor||[1,1,1];return Z.attenuationColor=new N.Ilk(Ie[0],Ie[1],Ie[2]),Promise.all(ue)}}class kn{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_IOR}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const ne=this.parser.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=ne.extensions[this.name];return Z.ior=void 0!==ue.ior?ue.ior:1.5,Promise.resolve()}}class ai{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_SPECULAR}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[],ie=ne.extensions[this.name];Z.specularIntensity=void 0!==ie.specularFactor?ie.specularFactor:1,void 0!==ie.specularTexture&&ue.push(he.assignTexture(Z,"specularIntensityMap",ie.specularTexture));const Ie=ie.specularColorFactor||[1,1,1];return Z.specularColor=new N.Ilk(Ie[0],Ie[1],Ie[2]),void 0!==ie.specularColorTexture&&ue.push(he.assignTexture(Z,"specularColorMap",ie.specularColorTexture,N.KI_)),Promise.all(ue)}}class mn{constructor(J){this.parser=J,this.name=ce.KHR_MATERIALS_ANISOTROPY}getMaterialType(J){const he=this.parser.json.materials[J];return he.extensions&&he.extensions[this.name]?N.EJi:null}extendMaterialParams(J,Z){const he=this.parser,ne=he.json.materials[J];if(!ne.extensions||!ne.extensions[this.name])return Promise.resolve();const ue=[],ie=ne.extensions[this.name];return void 0!==ie.anisotropyStrength&&(Z.anisotropy=ie.anisotropyStrength),void 0!==ie.anisotropyRotation&&(Z.anisotropyRotation=ie.anisotropyRotation),void 0!==ie.anisotropyTexture&&ue.push(he.assignTexture(Z,"anisotropyMap",ie.anisotropyTexture)),Promise.all(ue)}}class Jn{constructor(J){this.parser=J,this.name=ce.KHR_TEXTURE_BASISU}loadTexture(J){const Z=this.parser,he=Z.json,ne=he.textures[J];if(!ne.extensions||!ne.extensions[this.name])return null;const ue=ne.extensions[this.name],ie=Z.options.ktx2Loader;if(!ie){if(he.extensionsRequired&&he.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Z.loadTextureImage(J,ue.source,ie)}}class Rn{constructor(J){this.parser=J,this.name=ce.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(J){const Z=this.name,he=this.parser,ne=he.json,ue=ne.textures[J];if(!ue.extensions||!ue.extensions[Z])return null;const ie=ue.extensions[Z],Ie=ne.images[ie.source];let we=he.textureLoader;if(Ie.uri){const Ue=he.options.manager.getHandler(Ie.uri);null!==Ue&&(we=Ue)}return this.detectSupport().then(function(Ue){if(Ue)return he.loadTextureImage(J,ie.source,we);if(ne.extensionsRequired&&ne.extensionsRequired.indexOf(Z)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return he.loadTexture(J)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(J){const Z=new Image;Z.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Z.onload=Z.onerror=function(){J(1===Z.height)}})),this.isSupported}}class Nr{constructor(J){this.parser=J,this.name=ce.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(J){const Z=this.name,he=this.parser,ne=he.json,ue=ne.textures[J];if(!ue.extensions||!ue.extensions[Z])return null;const ie=ue.extensions[Z],Ie=ne.images[ie.source];let we=he.textureLoader;if(Ie.uri){const Ue=he.options.manager.getHandler(Ie.uri);null!==Ue&&(we=Ue)}return this.detectSupport().then(function(Ue){if(Ue)return he.loadTextureImage(J,ie.source,we);if(ne.extensionsRequired&&ne.extensionsRequired.indexOf(Z)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return he.loadTexture(J)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(J){const Z=new Image;Z.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",Z.onload=Z.onerror=function(){J(1===Z.height)}})),this.isSupported}}class rn{constructor(J){this.name=ce.EXT_MESHOPT_COMPRESSION,this.parser=J}loadBufferView(J){const Z=this.parser.json,he=Z.bufferViews[J];if(he.extensions&&he.extensions[this.name]){const ne=he.extensions[this.name],ue=this.parser.getDependency("buffer",ne.buffer),ie=this.parser.options.meshoptDecoder;if(!ie||!ie.supported){if(Z.extensionsRequired&&Z.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return ue.then(function(Ie){const Fe=ne.count,Q=ne.byteStride,Ve=new Uint8Array(Ie,ne.byteOffset||0,ne.byteLength||0);return ie.decodeGltfBufferAsync?ie.decodeGltfBufferAsync(Fe,Q,Ve,ne.mode,ne.filter).then(function(st){return st.buffer}):ie.ready.then(function(){const st=new ArrayBuffer(Fe*Q);return ie.decodeGltfBuffer(new Uint8Array(st),Fe,Q,Ve,ne.mode,ne.filter),st})})}return null}}class Wt{constructor(J){this.name=ce.EXT_MESH_GPU_INSTANCING,this.parser=J}createNodeMesh(J){const Z=this.parser.json,he=Z.nodes[J];if(!he.extensions||!he.extensions[this.name]||void 0===he.mesh)return null;const ne=Z.meshes[he.mesh];for(const Ue of ne.primitives)if(Ue.mode!==tn.TRIANGLES&&Ue.mode!==tn.TRIANGLE_STRIP&&Ue.mode!==tn.TRIANGLE_FAN&&void 0!==Ue.mode)return null;const ie=he.extensions[this.name].attributes,Ie=[],we={};for(const Ue in ie)Ie.push(this.parser.getDependency("accessor",ie[Ue]).then(Fe=>(we[Ue]=Fe,we[Ue])));return Ie.length<1?null:(Ie.push(this.parser.createNodeMesh(J)),Promise.all(Ie).then(Ue=>{const Fe=Ue.pop(),Q=Fe.isGroup?Fe.children:[Fe],Ve=Ue[0].count,st=[];for(const kt of Q){const Kt=new N.yGw,an=new N.Pa4,jt=new N._fP,jn=new N.Pa4(1,1,1),Oe=new N.SPe(kt.geometry,kt.material,Ve);for(let Ae=0;Ae<Ve;Ae++)we.TRANSLATION&&an.fromBufferAttribute(we.TRANSLATION,Ae),we.ROTATION&&jt.fromBufferAttribute(we.ROTATION,Ae),we.SCALE&&jn.fromBufferAttribute(we.SCALE,Ae),Oe.setMatrixAt(Ae,Kt.compose(an,jt,jn));for(const Ae in we)"TRANSLATION"!==Ae&&"ROTATION"!==Ae&&"SCALE"!==Ae&&kt.geometry.setAttribute(Ae,we[Ae]);N.Tme.prototype.copy.call(Oe,kt),this.parser.assignFinalMaterial(Oe),st.push(Oe)}return Fe.isGroup?(Fe.clear(),Fe.add(...st),Fe):st[0]}))}}const Je="glTF";class yt{constructor(J){this.name=ce.KHR_BINARY_GLTF,this.content=null,this.body=null;const Z=new DataView(J,0,12),he=new TextDecoder;if(this.header={magic:he.decode(new Uint8Array(J.slice(0,4))),version:Z.getUint32(4,!0),length:Z.getUint32(8,!0)},this.header.magic!==Je)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const ne=this.header.length-12,ue=new DataView(J,12);let ie=0;for(;ie<ne;){const Ie=ue.getUint32(ie,!0);ie+=4;const we=ue.getUint32(ie,!0);if(ie+=4,1313821514===we){const Ue=new Uint8Array(J,12+ie,Ie);this.content=he.decode(Ue)}else if(5130562===we){const Ue=12+ie;this.body=J.slice(Ue,Ue+Ie)}ie+=Ie}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class hn{constructor(J,Z){if(!Z)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ce.KHR_DRACO_MESH_COMPRESSION,this.json=J,this.dracoLoader=Z,this.dracoLoader.preload()}decodePrimitive(J,Z){const he=this.json,ne=this.dracoLoader,ue=J.extensions[this.name].bufferView,ie=J.extensions[this.name].attributes,Ie={},we={},Ue={};for(const Fe in ie){const Q=Tr[Fe]||Fe.toLowerCase();Ie[Q]=ie[Fe]}for(const Fe in J.attributes){const Q=Tr[Fe]||Fe.toLowerCase();if(void 0!==ie[Fe]){const Ve=he.accessors[J.attributes[Fe]];Ue[Q]=Di[Ve.componentType].name,we[Q]=!0===Ve.normalized}}return Z.getDependency("bufferView",ue).then(function(Fe){return new Promise(function(Q){ne.decodeDracoFile(Fe,function(Ve){for(const st in Ve.attributes){const kt=Ve.attributes[st],Kt=we[st];void 0!==Kt&&(kt.normalized=Kt)}Q(Ve)},Ie,Ue)})})}}class $t{constructor(){this.name=ce.KHR_TEXTURE_TRANSFORM}extendTexture(J,Z){return(void 0===Z.texCoord||Z.texCoord===J.channel)&&void 0===Z.offset&&void 0===Z.rotation&&void 0===Z.scale||(J=J.clone(),void 0!==Z.texCoord&&(J.channel=Z.texCoord),void 0!==Z.offset&&J.offset.fromArray(Z.offset),void 0!==Z.rotation&&(J.rotation=Z.rotation),void 0!==Z.scale&&J.repeat.fromArray(Z.scale),J.needsUpdate=!0),J}}class In{constructor(){this.name=ce.KHR_MESH_QUANTIZATION}}class ci extends N._C8{constructor(J,Z,he,ne){super(J,Z,he,ne)}copySampleValue_(J){const Z=this.resultBuffer,he=this.sampleValues,ne=this.valueSize,ue=J*ne*3+ne;for(let ie=0;ie!==ne;ie++)Z[ie]=he[ue+ie];return Z}interpolate_(J,Z,he,ne){const ue=this.resultBuffer,ie=this.sampleValues,Ie=this.valueSize,we=2*Ie,Ue=3*Ie,Fe=ne-Z,Q=(he-Z)/Fe,Ve=Q*Q,st=Ve*Q,kt=J*Ue,Kt=kt-Ue,an=-2*st+3*Ve,jt=st-Ve,jn=1-an,Oe=jt-Ve+Q;for(let Ae=0;Ae!==Ie;Ae++)ue[Ae]=jn*ie[Kt+Ae+Ie]+Oe*(ie[Kt+Ae+we]*Fe)+an*ie[kt+Ae+Ie]+jt*(ie[kt+Ae]*Fe);return ue}}const Zn=new N._fP;class Yt extends ci{interpolate_(J,Z,he,ne){const ue=super.interpolate_(J,Z,he,ne);return Zn.fromArray(ue).normalize().toArray(ue),ue}}const tn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Di={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$i={9728:N.TyD,9729:N.wem,9984:N.YLQ,9985:N.qyh,9986:N.aH4,9987:N.D1R},Vi={33071:N.uWy,33648:N.OoA,10497:N.rpg},ir={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Tr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ir={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xs={CUBICSPLINE:void 0,LINEAR:N.NMF,STEP:N.Syv};function zr(Le,J,Z){for(const he in Z.extensions)void 0===Le[he]&&(J.userData.gltfExtensions=J.userData.gltfExtensions||{},J.userData.gltfExtensions[he]=Z.extensions[he])}function ar(Le,J){void 0!==J.extras&&("object"==typeof J.extras?Object.assign(Le.userData,J.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+J.extras))}function Ts(Le,J){if(Le.updateMorphTargets(),void 0!==J.weights)for(let Z=0,he=J.weights.length;Z<he;Z++)Le.morphTargetInfluences[Z]=J.weights[Z];if(J.extras&&Array.isArray(J.extras.targetNames)){const Z=J.extras.targetNames;if(Le.morphTargetInfluences.length===Z.length){Le.morphTargetDictionary={};for(let he=0,ne=Z.length;he<ne;he++)Le.morphTargetDictionary[Z[he]]=he}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zs(Le){let J;const Z=Le.extensions&&Le.extensions[ce.KHR_DRACO_MESH_COMPRESSION];if(J=Z?"draco:"+Z.bufferView+":"+Z.indices+":"+Bn(Z.attributes):Le.indices+":"+Bn(Le.attributes)+":"+Le.mode,void 0!==Le.targets)for(let he=0,ne=Le.targets.length;he<ne;he++)J+=":"+Bn(Le.targets[he]);return J}function Bn(Le){let J="";const Z=Object.keys(Le).sort();for(let he=0,ne=Z.length;he<ne;he++)J+=Z[he]+":"+Le[Z[he]]+";";return J}function lr(Le){switch(Le){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const On=new N.yGw;class Lt{constructor(J={},Z={}){this.json=J,this.extensions={},this.plugins={},this.options=Z,this.cache=new Vn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let he=!1,ne=!1,ue=-1;"undefined"!=typeof navigator&&(he=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ne=navigator.userAgent.indexOf("Firefox")>-1,ue=ne?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader="undefined"==typeof createImageBitmap||he||ne&&ue<98?new N.dpR(this.options.manager):new N.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new N.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(J){this.extensions=J}setPlugins(J){this.plugins=J}parse(J,Z){const he=this,ne=this.json,ue=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(ie){return ie._markDefs&&ie._markDefs()}),Promise.all(this._invokeAll(function(ie){return ie.beforeRoot&&ie.beforeRoot()})).then(function(){return Promise.all([he.getDependencies("scene"),he.getDependencies("animation"),he.getDependencies("camera")])}).then(function(ie){const Ie={scene:ie[0][ne.scene||0],scenes:ie[0],animations:ie[1],cameras:ie[2],asset:ne.asset,parser:he,userData:{}};zr(ue,Ie,ne),ar(Ie,ne),Promise.all(he._invokeAll(function(we){return we.afterRoot&&we.afterRoot(Ie)})).then(function(){J(Ie)})}).catch(Z)}_markDefs(){const J=this.json.nodes||[],Z=this.json.skins||[],he=this.json.meshes||[];for(let ne=0,ue=Z.length;ne<ue;ne++){const ie=Z[ne].joints;for(let Ie=0,we=ie.length;Ie<we;Ie++)J[ie[Ie]].isBone=!0}for(let ne=0,ue=J.length;ne<ue;ne++){const ie=J[ne];void 0!==ie.mesh&&(this._addNodeRef(this.meshCache,ie.mesh),void 0!==ie.skin&&(he[ie.mesh].isSkinnedMesh=!0)),void 0!==ie.camera&&this._addNodeRef(this.cameraCache,ie.camera)}}_addNodeRef(J,Z){void 0!==Z&&(void 0===J.refs[Z]&&(J.refs[Z]=J.uses[Z]=0),J.refs[Z]++)}_getNodeRef(J,Z,he){if(J.refs[Z]<=1)return he;const ne=he.clone(),ue=(ie,Ie)=>{const we=this.associations.get(ie);null!=we&&this.associations.set(Ie,we);for(const[Ue,Fe]of ie.children.entries())ue(Fe,Ie.children[Ue])};return ue(he,ne),ne.name+="_instance_"+J.uses[Z]++,ne}_invokeOne(J){const Z=Object.values(this.plugins);Z.push(this);for(let he=0;he<Z.length;he++){const ne=J(Z[he]);if(ne)return ne}return null}_invokeAll(J){const Z=Object.values(this.plugins);Z.unshift(this);const he=[];for(let ne=0;ne<Z.length;ne++){const ue=J(Z[ne]);ue&&he.push(ue)}return he}getDependency(J,Z){const he=J+":"+Z;let ne=this.cache.get(he);if(!ne){switch(J){case"scene":ne=this.loadScene(Z);break;case"node":ne=this._invokeOne(function(ue){return ue.loadNode&&ue.loadNode(Z)});break;case"mesh":ne=this._invokeOne(function(ue){return ue.loadMesh&&ue.loadMesh(Z)});break;case"accessor":ne=this.loadAccessor(Z);break;case"bufferView":ne=this._invokeOne(function(ue){return ue.loadBufferView&&ue.loadBufferView(Z)});break;case"buffer":ne=this.loadBuffer(Z);break;case"material":ne=this._invokeOne(function(ue){return ue.loadMaterial&&ue.loadMaterial(Z)});break;case"texture":ne=this._invokeOne(function(ue){return ue.loadTexture&&ue.loadTexture(Z)});break;case"skin":ne=this.loadSkin(Z);break;case"animation":ne=this._invokeOne(function(ue){return ue.loadAnimation&&ue.loadAnimation(Z)});break;case"camera":ne=this.loadCamera(Z);break;default:if(ne=this._invokeOne(function(ue){return ue!=this&&ue.getDependency&&ue.getDependency(J,Z)}),!ne)throw new Error("Unknown type: "+J)}this.cache.add(he,ne)}return ne}getDependencies(J){let Z=this.cache.get(J);if(!Z){const he=this;Z=Promise.all((this.json[J+("mesh"===J?"es":"s")]||[]).map(function(ue,ie){return he.getDependency(J,ie)})),this.cache.add(J,Z)}return Z}loadBuffer(J){const Z=this.json.buffers[J],he=this.fileLoader;if(Z.type&&"arraybuffer"!==Z.type)throw new Error("THREE.GLTFLoader: "+Z.type+" buffer type is not supported.");if(void 0===Z.uri&&0===J)return Promise.resolve(this.extensions[ce.KHR_BINARY_GLTF].body);const ne=this.options;return new Promise(function(ue,ie){he.load(N.Zp0.resolveURL(Z.uri,ne.path),ue,void 0,function(){ie(new Error('THREE.GLTFLoader: Failed to load buffer "'+Z.uri+'".'))})})}loadBufferView(J){const Z=this.json.bufferViews[J];return this.getDependency("buffer",Z.buffer).then(function(he){const ue=Z.byteOffset||0;return he.slice(ue,ue+(Z.byteLength||0))})}loadAccessor(J){const Z=this,he=this.json,ne=this.json.accessors[J];if(void 0===ne.bufferView&&void 0===ne.sparse){const ie=ir[ne.type],we=!0===ne.normalized,Ue=new(0,Di[ne.componentType])(ne.count*ie);return Promise.resolve(new N.TlE(Ue,ie,we))}const ue=[];return ue.push(void 0!==ne.bufferView?this.getDependency("bufferView",ne.bufferView):null),void 0!==ne.sparse&&(ue.push(this.getDependency("bufferView",ne.sparse.indices.bufferView)),ue.push(this.getDependency("bufferView",ne.sparse.values.bufferView))),Promise.all(ue).then(function(ie){const Ie=ie[0],we=ir[ne.type],Ue=Di[ne.componentType],Fe=Ue.BYTES_PER_ELEMENT,Ve=ne.byteOffset||0,st=void 0!==ne.bufferView?he.bufferViews[ne.bufferView].byteStride:void 0,kt=!0===ne.normalized;let Kt,an;if(st&&st!==Fe*we){const jt=Math.floor(Ve/st),jn="InterleavedBuffer:"+ne.bufferView+":"+ne.componentType+":"+jt+":"+ne.count;let Oe=Z.cache.get(jn);Oe||(Kt=new Ue(Ie,jt*st,ne.count*st/Fe),Oe=new N.vpT(Kt,st/Fe),Z.cache.add(jn,Oe)),an=new N.kB5(Oe,we,Ve%st/Fe,kt)}else Kt=null===Ie?new Ue(ne.count*we):new Ue(Ie,Ve,ne.count*we),an=new N.TlE(Kt,we,kt);if(void 0!==ne.sparse){const Ae=ne.sparse.values.byteOffset||0,me=new(0,Di[ne.sparse.indices.componentType])(ie[1],ne.sparse.indices.byteOffset||0,ne.sparse.count*ir.SCALAR),He=new Ue(ie[2],Ae,ne.sparse.count*we);null!==Ie&&(an=new N.TlE(an.array.slice(),an.itemSize,an.normalized));for(let je=0,Ht=me.length;je<Ht;je++){const Pn=me[je];if(an.setX(Pn,He[je*we]),we>=2&&an.setY(Pn,He[je*we+1]),we>=3&&an.setZ(Pn,He[je*we+2]),we>=4&&an.setW(Pn,He[je*we+3]),we>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return an})}loadTexture(J){const Z=this.json,ue=Z.textures[J].source,ie=Z.images[ue];let Ie=this.textureLoader;if(ie.uri){const we=this.options.manager.getHandler(ie.uri);null!==we&&(Ie=we)}return this.loadTextureImage(J,ue,Ie)}loadTextureImage(J,Z,he){const ne=this,ue=this.json,ie=ue.textures[J],Ie=ue.images[Z],we=(Ie.uri||Ie.bufferView)+":"+ie.sampler;if(this.textureCache[we])return this.textureCache[we];const Ue=this.loadImageSource(Z,he).then(function(Fe){Fe.flipY=!1,Fe.name=ie.name||Ie.name||"",""===Fe.name&&"string"==typeof Ie.uri&&!1===Ie.uri.startsWith("data:image/")&&(Fe.name=Ie.uri);const Ve=(ue.samplers||{})[ie.sampler]||{};return Fe.magFilter=$i[Ve.magFilter]||N.wem,Fe.minFilter=$i[Ve.minFilter]||N.D1R,Fe.wrapS=Vi[Ve.wrapS]||N.rpg,Fe.wrapT=Vi[Ve.wrapT]||N.rpg,ne.associations.set(Fe,{textures:J}),Fe}).catch(function(){return null});return this.textureCache[we]=Ue,Ue}loadImageSource(J,Z){const ne=this.json,ue=this.options;if(void 0!==this.sourceCache[J])return this.sourceCache[J].then(Q=>Q.clone());const ie=ne.images[J],Ie=self.URL||self.webkitURL;let we=ie.uri||"",Ue=!1;if(void 0!==ie.bufferView)we=this.getDependency("bufferView",ie.bufferView).then(function(Q){Ue=!0;const Ve=new Blob([Q],{type:ie.mimeType});return we=Ie.createObjectURL(Ve),we});else if(void 0===ie.uri)throw new Error("THREE.GLTFLoader: Image "+J+" is missing URI and bufferView");const Fe=Promise.resolve(we).then(function(Q){return new Promise(function(Ve,st){let kt=Ve;!0===Z.isImageBitmapLoader&&(kt=function(Kt){const an=new N.xEZ(Kt);an.needsUpdate=!0,Ve(an)}),Z.load(N.Zp0.resolveURL(Q,ue.path),kt,void 0,st)})}).then(function(Q){return!0===Ue&&Ie.revokeObjectURL(we),Q.userData.mimeType=ie.mimeType||function fi(Le){return Le.search(/\.jpe?g($|\?)/i)>0||0===Le.search(/^data\:image\/jpeg/)?"image/jpeg":Le.search(/\.webp($|\?)/i)>0||0===Le.search(/^data\:image\/webp/)?"image/webp":"image/png"}(ie.uri),Q}).catch(function(Q){throw console.error("THREE.GLTFLoader: Couldn't load texture",we),Q});return this.sourceCache[J]=Fe,Fe}assignTexture(J,Z,he,ne){const ue=this;return this.getDependency("texture",he.index).then(function(ie){if(!ie)return null;if(void 0!==he.texCoord&&he.texCoord>0&&((ie=ie.clone()).channel=he.texCoord),ue.extensions[ce.KHR_TEXTURE_TRANSFORM]){const Ie=void 0!==he.extensions?he.extensions[ce.KHR_TEXTURE_TRANSFORM]:void 0;if(Ie){const we=ue.associations.get(ie);ie=ue.extensions[ce.KHR_TEXTURE_TRANSFORM].extendTexture(ie,Ie),ue.associations.set(ie,we)}}return void 0!==ne&&(ie.colorSpace=ne),J[Z]=ie,ie})}assignFinalMaterial(J){const Z=J.geometry;let he=J.material;const ne=void 0===Z.attributes.tangent,ue=void 0!==Z.attributes.color,ie=void 0===Z.attributes.normal;if(J.isPoints){const Ie="PointsMaterial:"+he.uuid;let we=this.cache.get(Ie);we||(we=new N.UY4,N.F5T.prototype.copy.call(we,he),we.color.copy(he.color),we.map=he.map,we.sizeAttenuation=!1,this.cache.add(Ie,we)),he=we}else if(J.isLine){const Ie="LineBasicMaterial:"+he.uuid;let we=this.cache.get(Ie);we||(we=new N.nls,N.F5T.prototype.copy.call(we,he),we.color.copy(he.color),we.map=he.map,this.cache.add(Ie,we)),he=we}if(ne||ue||ie){let Ie="ClonedMaterial:"+he.uuid+":";ne&&(Ie+="derivative-tangents:"),ue&&(Ie+="vertex-colors:"),ie&&(Ie+="flat-shading:");let we=this.cache.get(Ie);we||(we=he.clone(),ue&&(we.vertexColors=!0),ie&&(we.flatShading=!0),ne&&(we.normalScale&&(we.normalScale.y*=-1),we.clearcoatNormalScale&&(we.clearcoatNormalScale.y*=-1)),this.cache.add(Ie,we),this.associations.set(we,this.associations.get(he))),he=we}J.material=he}getMaterialType(){return N.Wid}loadMaterial(J){const Z=this,ne=this.extensions,ue=this.json.materials[J];let ie;const Ie={},Ue=[];if((ue.extensions||{})[ce.KHR_MATERIALS_UNLIT]){const Q=ne[ce.KHR_MATERIALS_UNLIT];ie=Q.getMaterialType(),Ue.push(Q.extendParams(Ie,ue,Z))}else{const Q=ue.pbrMetallicRoughness||{};if(Ie.color=new N.Ilk(1,1,1),Ie.opacity=1,Array.isArray(Q.baseColorFactor)){const Ve=Q.baseColorFactor;Ie.color.fromArray(Ve),Ie.opacity=Ve[3]}void 0!==Q.baseColorTexture&&Ue.push(Z.assignTexture(Ie,"map",Q.baseColorTexture,N.KI_)),Ie.metalness=void 0!==Q.metallicFactor?Q.metallicFactor:1,Ie.roughness=void 0!==Q.roughnessFactor?Q.roughnessFactor:1,void 0!==Q.metallicRoughnessTexture&&(Ue.push(Z.assignTexture(Ie,"metalnessMap",Q.metallicRoughnessTexture)),Ue.push(Z.assignTexture(Ie,"roughnessMap",Q.metallicRoughnessTexture))),ie=this._invokeOne(function(Ve){return Ve.getMaterialType&&Ve.getMaterialType(J)}),Ue.push(Promise.all(this._invokeAll(function(Ve){return Ve.extendMaterialParams&&Ve.extendMaterialParams(J,Ie)})))}!0===ue.doubleSided&&(Ie.side=N.ehD);const Fe=ue.alphaMode||"OPAQUE";if("BLEND"===Fe?(Ie.transparent=!0,Ie.depthWrite=!1):(Ie.transparent=!1,"MASK"===Fe&&(Ie.alphaTest=void 0!==ue.alphaCutoff?ue.alphaCutoff:.5)),void 0!==ue.normalTexture&&ie!==N.vBJ&&(Ue.push(Z.assignTexture(Ie,"normalMap",ue.normalTexture)),Ie.normalScale=new N.FM8(1,1),void 0!==ue.normalTexture.scale)){const Q=ue.normalTexture.scale;Ie.normalScale.set(Q,Q)}return void 0!==ue.occlusionTexture&&ie!==N.vBJ&&(Ue.push(Z.assignTexture(Ie,"aoMap",ue.occlusionTexture)),void 0!==ue.occlusionTexture.strength&&(Ie.aoMapIntensity=ue.occlusionTexture.strength)),void 0!==ue.emissiveFactor&&ie!==N.vBJ&&(Ie.emissive=(new N.Ilk).fromArray(ue.emissiveFactor)),void 0!==ue.emissiveTexture&&ie!==N.vBJ&&Ue.push(Z.assignTexture(Ie,"emissiveMap",ue.emissiveTexture,N.KI_)),Promise.all(Ue).then(function(){const Q=new ie(Ie);return ue.name&&(Q.name=ue.name),ar(Q,ue),Z.associations.set(Q,{materials:J}),ue.extensions&&zr(ne,Q,ue),Q})}createUniqueName(J){const Z=N.iUV.sanitizeNodeName(J||"");return Z in this.nodeNamesUsed?Z+"_"+ ++this.nodeNamesUsed[Z]:(this.nodeNamesUsed[Z]=0,Z)}loadGeometries(J){const Z=this,he=this.extensions,ne=this.primitiveCache;function ue(Ie){return he[ce.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(Ie,Z).then(function(we){return Pi(we,Ie,Z)})}const ie=[];for(let Ie=0,we=J.length;Ie<we;Ie++){const Ue=J[Ie],Fe=Zs(Ue),Q=ne[Fe];if(Q)ie.push(Q.promise);else{let Ve;Ve=Ue.extensions&&Ue.extensions[ce.KHR_DRACO_MESH_COMPRESSION]?ue(Ue):Pi(new N.u9r,Ue,Z),ne[Fe]={primitive:Ue,promise:Ve},ie.push(Ve)}}return Promise.all(ie)}loadMesh(J){const Z=this,ne=this.extensions,ue=this.json.meshes[J],ie=ue.primitives,Ie=[];for(let we=0,Ue=ie.length;we<Ue;we++){const Fe=void 0===ie[we].material?(void 0===(Le=this.cache).DefaultMaterial&&(Le.DefaultMaterial=new N.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:N.Wl3})),Le.DefaultMaterial):this.getDependency("material",ie[we].material);Ie.push(Fe)}var Le;return Ie.push(Z.loadGeometries(ie)),Promise.all(Ie).then(function(we){const Ue=we.slice(0,we.length-1),Fe=we[we.length-1],Q=[];for(let st=0,kt=Fe.length;st<kt;st++){const Kt=Fe[st],an=ie[st];let jt;const jn=Ue[st];if(an.mode===tn.TRIANGLES||an.mode===tn.TRIANGLE_STRIP||an.mode===tn.TRIANGLE_FAN||void 0===an.mode)jt=!0===ue.isSkinnedMesh?new N.TUv(Kt,jn):new N.Kj0(Kt,jn),!0===jt.isSkinnedMesh&&jt.normalizeSkinWeights(),an.mode===tn.TRIANGLE_STRIP?jt.geometry=lt(jt.geometry,N.UlW):an.mode===tn.TRIANGLE_FAN&&(jt.geometry=lt(jt.geometry,N.z$h));else if(an.mode===tn.LINES)jt=new N.ejS(Kt,jn);else if(an.mode===tn.LINE_STRIP)jt=new N.x12(Kt,jn);else if(an.mode===tn.LINE_LOOP)jt=new N.blk(Kt,jn);else{if(an.mode!==tn.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+an.mode);jt=new N.woe(Kt,jn)}Object.keys(jt.geometry.morphAttributes).length>0&&Ts(jt,ue),jt.name=Z.createUniqueName(ue.name||"mesh_"+J),ar(jt,ue),an.extensions&&zr(ne,jt,an),Z.assignFinalMaterial(jt),Q.push(jt)}for(let st=0,kt=Q.length;st<kt;st++)Z.associations.set(Q[st],{meshes:J,primitives:st});if(1===Q.length)return ue.extensions&&zr(ne,Q[0],ue),Q[0];const Ve=new N.ZAu;ue.extensions&&zr(ne,Ve,ue),Z.associations.set(Ve,{meshes:J});for(let st=0,kt=Q.length;st<kt;st++)Ve.add(Q[st]);return Ve})}loadCamera(J){let Z;const he=this.json.cameras[J],ne=he[he.type];if(ne)return"perspective"===he.type?Z=new N.cPb(N.M8C.radToDeg(ne.yfov),ne.aspectRatio||1,ne.znear||1,ne.zfar||2e6):"orthographic"===he.type&&(Z=new N.iKG(-ne.xmag,ne.xmag,ne.ymag,-ne.ymag,ne.znear,ne.zfar)),he.name&&(Z.name=this.createUniqueName(he.name)),ar(Z,he),Promise.resolve(Z);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(J){const Z=this.json.skins[J],he=[];for(let ne=0,ue=Z.joints.length;ne<ue;ne++)he.push(this._loadNodeShallow(Z.joints[ne]));return he.push(void 0!==Z.inverseBindMatrices?this.getDependency("accessor",Z.inverseBindMatrices):null),Promise.all(he).then(function(ne){const ue=ne.pop(),ie=ne,Ie=[],we=[];for(let Ue=0,Fe=ie.length;Ue<Fe;Ue++){const Q=ie[Ue];if(Q){Ie.push(Q);const Ve=new N.yGw;null!==ue&&Ve.fromArray(ue.array,16*Ue),we.push(Ve)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',Z.joints[Ue])}return new N.OdW(Ie,we)})}loadAnimation(J){const he=this,ne=this.json.animations[J],ue=ne.name?ne.name:"animation_"+J,ie=[],Ie=[],we=[],Ue=[],Fe=[];for(let Q=0,Ve=ne.channels.length;Q<Ve;Q++){const st=ne.channels[Q],kt=ne.samplers[st.sampler],Kt=st.target,an=Kt.node,jt=void 0!==ne.parameters?ne.parameters[kt.input]:kt.input,jn=void 0!==ne.parameters?ne.parameters[kt.output]:kt.output;void 0!==Kt.node&&(ie.push(this.getDependency("node",an)),Ie.push(this.getDependency("accessor",jt)),we.push(this.getDependency("accessor",jn)),Ue.push(kt),Fe.push(Kt))}return Promise.all([Promise.all(ie),Promise.all(Ie),Promise.all(we),Promise.all(Ue),Promise.all(Fe)]).then(function(Q){const Ve=Q[0],st=Q[1],kt=Q[2],Kt=Q[3],an=Q[4],jt=[];for(let jn=0,Oe=Ve.length;jn<Oe;jn++){const Ae=Ve[jn],me=st[jn],He=kt[jn],je=Kt[jn],Ht=an[jn];if(void 0===Ae)continue;Ae.updateMatrix&&Ae.updateMatrix();const Pn=he._createAnimationTracks(Ae,me,He,je,Ht);if(Pn)for(let Ei=0;Ei<Pn.length;Ei++)jt.push(Pn[Ei])}return new N.m7l(ue,void 0,jt)})}createNodeMesh(J){const he=this,ne=this.json.nodes[J];return void 0===ne.mesh?null:he.getDependency("mesh",ne.mesh).then(function(ue){const ie=he._getNodeRef(he.meshCache,ne.mesh,ue);return void 0!==ne.weights&&ie.traverse(function(Ie){if(Ie.isMesh)for(let we=0,Ue=ne.weights.length;we<Ue;we++)Ie.morphTargetInfluences[we]=ne.weights[we]}),ie})}loadNode(J){const he=this,ne=this.json.nodes[J],ue=he._loadNodeShallow(J),ie=[],Ie=ne.children||[];for(let Ue=0,Fe=Ie.length;Ue<Fe;Ue++)ie.push(he.getDependency("node",Ie[Ue]));const we=void 0===ne.skin?Promise.resolve(null):he.getDependency("skin",ne.skin);return Promise.all([ue,Promise.all(ie),we]).then(function(Ue){const Fe=Ue[0],Q=Ue[1],Ve=Ue[2];null!==Ve&&Fe.traverse(function(st){!st.isSkinnedMesh||st.bind(Ve,On)});for(let st=0,kt=Q.length;st<kt;st++)Fe.add(Q[st]);return Fe})}_loadNodeShallow(J){const he=this.extensions,ne=this;if(void 0!==this.nodeCache[J])return this.nodeCache[J];const ue=this.json.nodes[J],ie=ue.name?ne.createUniqueName(ue.name):"",Ie=[],we=ne._invokeOne(function(Ue){return Ue.createNodeMesh&&Ue.createNodeMesh(J)});return we&&Ie.push(we),void 0!==ue.camera&&Ie.push(ne.getDependency("camera",ue.camera).then(function(Ue){return ne._getNodeRef(ne.cameraCache,ue.camera,Ue)})),ne._invokeAll(function(Ue){return Ue.createNodeAttachment&&Ue.createNodeAttachment(J)}).forEach(function(Ue){Ie.push(Ue)}),this.nodeCache[J]=Promise.all(Ie).then(function(Ue){let Fe;if(Fe=!0===ue.isBone?new N.N$j:Ue.length>1?new N.ZAu:1===Ue.length?Ue[0]:new N.Tme,Fe!==Ue[0])for(let Q=0,Ve=Ue.length;Q<Ve;Q++)Fe.add(Ue[Q]);if(ue.name&&(Fe.userData.name=ue.name,Fe.name=ie),ar(Fe,ue),ue.extensions&&zr(he,Fe,ue),void 0!==ue.matrix){const Q=new N.yGw;Q.fromArray(ue.matrix),Fe.applyMatrix4(Q)}else void 0!==ue.translation&&Fe.position.fromArray(ue.translation),void 0!==ue.rotation&&Fe.quaternion.fromArray(ue.rotation),void 0!==ue.scale&&Fe.scale.fromArray(ue.scale);return ne.associations.has(Fe)||ne.associations.set(Fe,{}),ne.associations.get(Fe).nodes=J,Fe}),this.nodeCache[J]}loadScene(J){const Z=this.extensions,he=this.json.scenes[J],ne=this,ue=new N.ZAu;he.name&&(ue.name=ne.createUniqueName(he.name)),ar(ue,he),he.extensions&&zr(Z,ue,he);const ie=he.nodes||[],Ie=[];for(let we=0,Ue=ie.length;we<Ue;we++)Ie.push(ne.getDependency("node",ie[we]));return Promise.all(Ie).then(function(we){for(let Fe=0,Q=we.length;Fe<Q;Fe++)ue.add(we[Fe]);return ne.associations=(Fe=>{const Q=new Map;for(const[Ve,st]of ne.associations)(Ve instanceof N.F5T||Ve instanceof N.xEZ)&&Q.set(Ve,st);return Fe.traverse(Ve=>{const st=ne.associations.get(Ve);null!=st&&Q.set(Ve,st)}),Q})(ue),ue})}_createAnimationTracks(J,Z,he,ne,ue){const ie=[],Ie=J.name?J.name:J.uuid,we=[];let Ue;switch(Ir[ue.path]===Ir.weights?J.traverse(function(Ve){Ve.morphTargetInfluences&&we.push(Ve.name?Ve.name:Ve.uuid)}):we.push(Ie),Ir[ue.path]){case Ir.weights:Ue=N.dUE;break;case Ir.rotation:Ue=N.iLg;break;case Ir.position:case Ir.scale:Ue=N.yC1;break;default:Ue=1===he.itemSize?N.dUE:N.yC1}const Fe=void 0!==ne.interpolation?xs[ne.interpolation]:N.NMF,Q=this._getArrayFromAccessor(he);for(let Ve=0,st=we.length;Ve<st;Ve++){const kt=new Ue(we[Ve]+"."+Ir[ue.path],Z.array,Q,Fe);"CUBICSPLINE"===ne.interpolation&&this._createCubicSplineTrackInterpolant(kt),ie.push(kt)}return ie}_getArrayFromAccessor(J){let Z=J.array;if(J.normalized){const he=lr(Z.constructor),ne=new Float32Array(Z.length);for(let ue=0,ie=Z.length;ue<ie;ue++)ne[ue]=Z[ue]*he;Z=ne}return Z}_createCubicSplineTrackInterpolant(J){J.createInterpolant=function(he){return new(this instanceof N.iLg?Yt:ci)(this.times,this.values,this.getValueSize()/3,he)},J.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Pi(Le,J,Z){const he=J.attributes,ne=[];function ue(ie,Ie){return Z.getDependency("accessor",ie).then(function(we){Le.setAttribute(Ie,we)})}for(const ie in he){const Ie=Tr[ie]||ie.toLowerCase();Ie in Le.attributes||ne.push(ue(he[ie],Ie))}if(void 0!==J.indices&&!Le.index){const ie=Z.getDependency("accessor",J.indices).then(function(Ie){Le.setIndex(Ie)});ne.push(ie)}return ar(Le,J),function Xr(Le,J,Z){const he=J.attributes,ne=new N.ZzF;if(void 0===he.POSITION)return;{const Ie=Z.json.accessors[he.POSITION],we=Ie.min,Ue=Ie.max;if(void 0===we||void 0===Ue)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(ne.set(new N.Pa4(we[0],we[1],we[2]),new N.Pa4(Ue[0],Ue[1],Ue[2])),Ie.normalized){const Fe=lr(Di[Ie.componentType]);ne.min.multiplyScalar(Fe),ne.max.multiplyScalar(Fe)}}const ue=J.targets;if(void 0!==ue){const Ie=new N.Pa4,we=new N.Pa4;for(let Ue=0,Fe=ue.length;Ue<Fe;Ue++){const Q=ue[Ue];if(void 0!==Q.POSITION){const Ve=Z.json.accessors[Q.POSITION],st=Ve.min,kt=Ve.max;if(void 0!==st&&void 0!==kt){if(we.setX(Math.max(Math.abs(st[0]),Math.abs(kt[0]))),we.setY(Math.max(Math.abs(st[1]),Math.abs(kt[1]))),we.setZ(Math.max(Math.abs(st[2]),Math.abs(kt[2]))),Ve.normalized){const Kt=lr(Di[Ve.componentType]);we.multiplyScalar(Kt)}Ie.max(we)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}ne.expandByVector(Ie)}Le.boundingBox=ne;const ie=new N.aLr;ne.getCenter(ie.center),ie.radius=ne.min.distanceTo(ne.max)/2,Le.boundingSphere=ie}(Le,J,Z),Promise.all(ne).then(function(){return void 0!==J.targets?function ts(Le,J,Z){let he=!1,ne=!1,ue=!1;for(let Ue=0,Fe=J.length;Ue<Fe;Ue++){const Q=J[Ue];if(void 0!==Q.POSITION&&(he=!0),void 0!==Q.NORMAL&&(ne=!0),void 0!==Q.COLOR_0&&(ue=!0),he&&ne&&ue)break}if(!he&&!ne&&!ue)return Promise.resolve(Le);const ie=[],Ie=[],we=[];for(let Ue=0,Fe=J.length;Ue<Fe;Ue++){const Q=J[Ue];if(he){const Ve=void 0!==Q.POSITION?Z.getDependency("accessor",Q.POSITION):Le.attributes.position;ie.push(Ve)}if(ne){const Ve=void 0!==Q.NORMAL?Z.getDependency("accessor",Q.NORMAL):Le.attributes.normal;Ie.push(Ve)}if(ue){const Ve=void 0!==Q.COLOR_0?Z.getDependency("accessor",Q.COLOR_0):Le.attributes.color;we.push(Ve)}}return Promise.all([Promise.all(ie),Promise.all(Ie),Promise.all(we)]).then(function(Ue){const Q=Ue[1],Ve=Ue[2];return he&&(Le.morphAttributes.position=Ue[0]),ne&&(Le.morphAttributes.normal=Q),ue&&(Le.morphAttributes.color=Ve),Le.morphTargetsRelative=!0,Le})}(Le,J.targets,Z):Le})}},5861:(qn,Rt,ye)=>{function N(Ze,mt,ut,sn,Xt,_n,Mn){try{var Ut=Ze[_n](Mn),lt=Ut.value}catch(Ft){return void ut(Ft)}Ut.done?mt(lt):Promise.resolve(lt).then(sn,Xt)}function F(Ze){return function(){var mt=this,ut=arguments;return new Promise(function(sn,Xt){var _n=Ze.apply(mt,ut);function Mn(lt){N(_n,sn,Xt,Mn,Ut,"next",lt)}function Ut(lt){N(_n,sn,Xt,Mn,Ut,"throw",lt)}Mn(void 0)})}}ye.d(Rt,{Z:()=>F})},7582:(qn,Rt,ye)=>{function Ft(Je,tt,ht,yt){return new(ht||(ht=Promise))(function($t,In){function ci(tn){try{Yt(yt.next(tn))}catch(Di){In(Di)}}function Zn(tn){try{Yt(yt.throw(tn))}catch(Di){In(Di)}}function Yt(tn){tn.done?$t(tn.value):function hn($t){return $t instanceof ht?$t:new ht(function(In){In($t)})}(tn.value).then(ci,Zn)}Yt((yt=yt.apply(Je,tt||[])).next())})}function Ye(Je){return this instanceof Ye?(this.v=Je,this):new Ye(Je)}function rt(Je,tt,ht){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var hn,yt=ht.apply(Je,tt||[]),$t=[];return hn={},In("next"),In("throw"),In("return"),hn[Symbol.asyncIterator]=function(){return this},hn;function In($i){yt[$i]&&(hn[$i]=function(Vi){return new Promise(function(ir,Tr){$t.push([$i,Vi,ir,Tr])>1||ci($i,Vi)})})}function ci($i,Vi){try{!function Zn($i){$i.value instanceof Ye?Promise.resolve($i.value.v).then(Yt,tn):Di($t[0][2],$i)}(yt[$i](Vi))}catch(ir){Di($t[0][3],ir)}}function Yt($i){ci("next",$i)}function tn($i){ci("throw",$i)}function Di($i,Vi){$i(Vi),$t.shift(),$t.length&&ci($t[0][0],$t[0][1])}}function on(Je){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ht,tt=Je[Symbol.asyncIterator];return tt?tt.call(Je):(Je=function gt(Je){var tt="function"==typeof Symbol&&Symbol.iterator,ht=tt&&Je[tt],yt=0;if(ht)return ht.call(Je);if(Je&&"number"==typeof Je.length)return{next:function(){return Je&&yt>=Je.length&&(Je=void 0),{value:Je&&Je[yt++],done:!Je}}};throw new TypeError(tt?"Object is not iterable.":"Symbol.iterator is not defined.")}(Je),ht={},yt("next"),yt("throw"),yt("return"),ht[Symbol.asyncIterator]=function(){return this},ht);function yt($t){ht[$t]=Je[$t]&&function(In){return new Promise(function(ci,Zn){!function hn($t,In,ci,Zn){Promise.resolve(Zn).then(function(Yt){$t({value:Yt,done:ci})},In)}(ci,Zn,(In=Je[$t](In)).done,In.value)})}}}ye.d(Rt,{FC:()=>rt,KL:()=>on,mG:()=>Ft,qq:()=>Ye}),"function"==typeof SuppressedError&&SuppressedError}},qn=>{qn(qn.s=6070)}]);